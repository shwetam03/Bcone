<html>




<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Home</title>

	<!-- <script type="text/javascript" src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script> -->
	<script src="../SiteAssets/BconeExpenseJs/jquery.min.js"></script>
<script src="../SiteAssets/BconeExpenseJs/html5shiv.js"></script>
<script src="../SiteAssets/BconeExpenseJs/html5shiv-printshiv.js"></script>
	
	
	
    <script src="../SiteAssets/BconeExpenseJs/bootstrap.min.js"></script>

    <script src="../SiteAssets/BconeExpenseJs/dialogbox.js"></script>

    <script src="../SiteAssets/BconeExpenseJs/overhang.js"></script>


    <link href="../SiteAssets/BconeExpenseCss/bootstrap.min.css" rel="stylesheet" />
    <link href="../SiteAssets/BconeExpenseCss/overhang.css" rel="stylesheet" />
    <link href="../SiteAssets/BconeExpenseCss/dialogbox.css" rel="stylesheet" />
    <link href="../SiteAssets/BconeExpenseCss/stylesheet.css" rel="stylesheet" />
    <link href="../SiteAssets/BconeExpenseCss/font-awesome.min.css" rel="stylesheet" />
    <link href="../SiteAssets/BconeExpenseCss/jquery-ui.css" rel="stylesheet" />
    <!-- <script src="../SiteAssets/BconeExpenseJs/jquery-ui.js"></script> -->
	 <script src="../SiteAssets/BconeExpenseJs/jqueryui.js"></script>
    <link rel="stylesheet" href="../SiteAssets/BconeExpenseCss/jquery.dataTables.min.css">
    <script src="../SiteAssets/BconeExpenseJs/jquery.dataTables.min.js"></script>
	
	<link rel="stylesheet" href="../SiteAssets/BconeExpenseCss/jqx.base.css" type="text/css" />
    
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxcore.js"></script>
   
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxbuttons.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxscrollbar.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxlistbox.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxdropdownlist.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxmenu.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.pager.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.sort.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.filter.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxcheckbox.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.columnsresize.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.selection.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxpanel.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/demos.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxwindow.js"></script>
	 <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxtooltip.js"></script>
	  
	<script type='text/javascript' src="../SiteAssets/BconeExpenseJs/jquery.mousewheel.min.js"></script>
	
	 <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxdata.js"></script>
	 <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/Config.js"></script>
<style>
.ms-core-pageTitle, .ms-core-pageTitle a{
 color:#fff;
 display:none;
}
.nodatadiv{border: 1px solid #ddd;
    width: 100%;
    display: inline-block;
    text-align: center;
    padding: 20px 0;
    border-radius: 3px;
    margin: 20px 0px;}
</style>
    <style>
        .table > thead > tr > th {
            text-align: center;
        }

        .displayblock {
            display: block;
        }

        .displaynone {
            display: none;
        }
		a, a:visited , a:active, a:link {
    text-decoration: none;
}
input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus,
input:-webkit-autofill:active {
     -webkit-box-shadow: 0 0 0px 50px white inset;


}
#jqxWidget1d584650{display:none !important;}

.jqx-clear > span{display:none !important;}

#WebPartTitleWPQ2{display:none !important;}


        /*.fk-suc-msg {
    background: url('http://img1a.flixcart.com/www/prod/images/tick1-042bc15a.png') no-repeat scroll 5px 10px #cfc;
    border: 1px solid #696;
    color: green;
    font-size: 13px;
    padding: 10px 0 10px 30px;
    text-align: left;
}*/

        .fk-suc-msg {
			background: url(http://img1a.flixcart.com/www/prod/images/tick1-042bc15a.png) no-repeat scroll 5px 2px #337ab7;
			border: 1px solid #2e6da4;
			color: #fff;
			font-size: 13px;
			padding: 2px 0 2px 28px;
			text-align: left;
			width: 91%;
        }
		.new-th{
			border: 0;
			border-top: 1px solid #000;
		}
		#s4-workspace{
			width:100% !important;
		}
		
		a:visited {color:#337ab7;} 
		
		
		.jqx-grid-column-filterbutton {display:none !important;}
		
			#login_name_contain{
	float: right;
    margin: -32px 20px 0px 0px;
    background: url(https://bristleconeonline.sharepoint.com/sites/PPMUAT/SiteAssets/BconeExpenseImg/user-icon.png) no-repeat right center;
    padding: 2px 32px 2px 0px;
	}
    </style>





    <!--<script>

        function classtoggle(){
        
            $('#amol_div').toggleClass('class1', 'class2');

        }

    </script>-->

</head>

<body>




    <!--<div id="amol_div" class="class1" onclick="classtoggle();">
        amol
    </div>-->
<div style="text-align:right;" id="login_name_contain"></div>
    <div id="alertmain" class="alert-main" style="display: none">
        <div class="black-bg" id="backcolor">
            <div class="popup-main">
                <div class="popup-heading">Conformation Message</div>
                <div class="pop-mid">
                    <p id="submitValue"></p>
                    <input type='Button' style="background-color: #4CAF50;" value="Ok" onclick='SubmitGateAForApproval("1")'>
                    <input type='Button' style="background-color: #e7e7e7; color: black;" value="Cancel" />
                </div>
            </div>
        </div>
    </div>
    <div id="successmain" class="success-main" style="display: none">
        <div class="black-bg">
            <div class="popup-main">
                <div class="popup-heading">Success</div>
                <div class="pop-mid">
                    <p id="successValue"></p>
                    <input type="button" style="background-color: #4CAF50;" value="Ok" onclick="redirect()" />
                    <!--<a href="javascript:void(0)" class="grey-btn">Back</a>-->
                </div>
            </div>
        </div>
    </div>

    <div id="rejection" class="alert-main" style="display: none">
        <div class="black-bg" id="backcolorrjc">
            <div class="popup-main">
                <div class="popup-heading">Rejected</div>
                <div class="pop-mid">
                    <p id="rejectedValue"></p>
                    <input type="button" style="background-color: #4CAF50;" value="Ok" onclick="redirect()" />
                    <!--<a href="javascript:void(0)" class="grey-btn">Back</a>-->
                </div>
            </div>
        </div>
    </div>
    <div id="approved1" class="success-main" style="display: none">
        <div class="black-bg" id="backcolorapprove">
            <div class="popup-main">
                <div class="popup-heading">Approved</div>
                <div class="pop-mid">
                    <p id="approvedValue"></p>
                    <input type="button" style="background-color: #4CAF50;" value="Ok" onclick="redirecttoGateb()" />
                    <!--<a href="javascript:void(0)" class="grey-btn">Back</a>-->
                </div>
            </div>
        </div>
    </div>

    <header>
    </header>
    <section class="middle">
        <div class="breadcrumb-new">
            <div class="container-fluid">
                <ul>
                    <li>
                        <a href="https://bristleconeonline.sharepoint.com/sites/PPMUAT/default.aspx">Home</a>
                    </li>
                        <li>
                        <a href="https://bristleconeonline.sharepoint.com/sites/PPMUAT/SitePages/FinanceApproval.aspx">Expense Approval</a>
                    </li>
                    <li>
                        <a href="javascript:void(0)" style="cursor:default; color: #272727;">My Approval History</a>
                    </li>
                </ul>
                <div class="clearfix"></div>
            </div>
        </div>
		<style>
			.newpopdiv tr th,td{padding:5px !important;text-align:left !important;}
			.newpopdiv .modal-header{padding: 5px;font-family: 'Conv_calibri'; background: #0072c6;}
			.newpopdiv .modal-header .modal-title{color: #fff; font-size: 14px;}
			.newpopdiv .close{opacity:1;color:#fff;}
	   </style>
        <div class="container-fluid">
            <div class="row">
                <div class="top-refine">
                        <ul class="pull-left">
                            <!-- <li><a href="https://bristleconeonline.sharepoint.com/sites/PPMUAT/SitePages/FinanceApproval.aspx" class="blue-btn" style="color:#fff;">  <i class="fa fa-reply"></i> Go Back</a></li> -->
							<!-- <li><a class="blue-btn" style="color:#fff;" onclick="showmodal_poup();" >  <i class="fa fa-reply"></i> Click</a> -->
								
							<!-- Modal -->
							<div class="modal fade bs-example-modal-lg newpopdiv" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
							  <div class="modal-dialog modal-lg" role="document">
								<div class="modal-content">
								  <div class="modal-header">
									<a class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></a>
									<h4 class="modal-title" id="myModalLabel">Item Details</h4>
								  </div>
								  <div class="modal-body">
								    <div class="row" id="jqxgrid_container1">
									 <div id="jqxgrid1"></div>
									</div>
								
								  </div>
								  <div class="modal-footer">
									<button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Close</button>								
								  </div>
								</div>
							  </div>
							</div>

							</li>
                    </ul>
						<ul class="pull-right">
                        <li>
							<a href="javascript:void(0)" class="green-btn" id="AllRecord" onclick="refine_status('',this.id);"><i class="fa fa-flag-o" aria-hidden="true"></i>All Record <span  id="AllRecordCount"></span></a>
                           <a href="javascript:void(0)" class="blue-btn" id="Approved" onclick="refine_status('Finance Approved',this.id)"><i class="fa fa-check"></i>Approved By Me<span class="red-count" id="ApprovedExpenceCount"></span></a>
                            
                            <a href="javascript:void(0)" class="blue-btn" id="Rejected" onclick="refine_status('Finance Rejected',this.id)"><i class="fa fa-ban"></i>Rejected By Me<span class="red-count" id="RejectedExpenceCount"></span></a>
							
							<a href="javascript:void(0)" class="blue-btn" id="Reimbursed" onclick="refine_status('Reimbursed',this.id)"><i class="fa fa-usd"></i>Reimbursed<span class="red-count" id="ReimburesedExpenceCount"></span></a>
                           
                           
                        </li>
                    </ul>
                    <div class="clearfix"></div>
            </div>
			<div id="NodataDiv"></div>
			
                </div>
				
				
				
                <div class="clearfix"></div>
                <div class="new-table">
				
				
				
				
				
				
				
				
                    <div class="row" id="jqxgrid_container">
                        <div id="jqxgrid"></div>
                    </div>

                    <!-- <div style="margin: 10px 0px 0 -15px;"><a href="https://bristleconeonline.sharepoint.com/sites/PPMUAT/SitePages/ExpenseApproval.aspx" class="blue-btn" style="color:#fff;">  <i class="fa fa-reply"></i> Go Back</a></div> -->
					
					<!-- <div>
					<input type="button" id="clear_btn" title="clear div" onclick="cleardata();">
					</div> -->
                </div>
        </div>
		<script>
		    function cleardata() {
		        $('#jqxgrid').remove();

		        //setTimeout(function(){
		        //alert('set timeout called..');
		        $("#jqxgrid_container").append("<div id='jqxgrid'></div>")
		        //	getDataByListName(current_url, 'BconeExpenceMaster', 'load1');
		        //},2000);
		    }
		</script>
    </section>
    <div class="export-to-exl">
        <!--<div class="export-to-exl-click">
            <img src="../SiteAssets/BconeExpenseImg/right-imh.jpg" alt="" title="" />
        </div>-->
        <!--<div class="export-to-exl-div">
            	Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.
            </div>-->
        <div class="clearfix"></div>
    </div>
    <!--<script type="text/javascript">
        	$(document).ready(function(){
				$(".export-to-exl-click").click(function(){
					$(".export-to-exl-div").animate({ width: 'toggle'});
				});
			});
        </script>-->

    <div id="myModal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Expense Initiate Form</h4>
                </div>
                <div class="modal-body">
                    <table>
                        <tbody>
						
							<tr>
                                <td style="vertical-align: top;">Select Project<sup style="color: #f00; font-size: 14px;">*</sup></td>
                                <td>

                                    <!-- <input type="text" style="width: 100%; height: 81px;" class="form-control" id="TxtDescription" onkeyup="hideerror('TxtDescription')" style="height: 40px" /> -->
									
									<!-- <textarea rows="4" cols="45" id="TxtDescription" onkeyup="hideerror('TxtDescription')"></textarea> -->

										<select class="form-control" id="ddlProjects" onchange="hideerror(this.id); setProjectManager(this.id)">
                                            <option value="0">Select Project</option>
										</select>	
										
										
									
                                </td>
                            </tr>
							
							  <tr >

                                <td style="width: 195px;">Expense Approval Name<sup style="color: #f00; font-size: 14px;">*</sup></td>
                                <td>
                                    <input  type="text" id="txtProManager"   class="form-control" readonly="true" />
									
									<select class="form-control" style="display:none;" id="ddlProjectsmanager" onchange="hideerror1(this.id)">
										</select>	
										
										
                                </td>
                            </tr>
							
                            <tr>

                                <td style="width: 195px;">Expense Report Name<sup style="color: #f00; font-size: 14px;">*</sup></td>
                                <td>
                                    <input type="text" id="Txtexpensereport" onkeyup="hideerror('Txtexpensereport')" class="form-control" />
                                </td>
                            </tr>
                            <tr>
                                <td style="vertical-align: top;">Description<!--<sup style="color: #f00; font-size: 14px;">*</sup>--></td>
                                <td>

                                    <!-- <input type="text" style="width: 100%; height: 81px;" class="form-control" id="TxtDescription" onkeyup="hideerror('TxtDescription')" style="height: 40px" /> -->
									
									<textarea rows="4" cols="45" id="TxtDescription" onkeyup="hideerror('TxtDescription')"></textarea>

											
									
                                </td>
                            </tr>
							
							
							
							 <tr>
                                <td>Have you taken Advance<sup style="color: #f00; font-size: 14px;">*</sup></td>
                                <td >
								<div id="advance" class="radio-main">
                                    <!-- <select class="form-control" id="ddladvancetaken" onchange="hideerror1(this.id)">
									<option value="No">No</option>
                                        <option value="Yes">Yes</option>
                                    </select> -->
									
                                   
									<input type="radio" name="advance" value="Yes"  > Yes
									<input type="radio" name="advance" value="No" > No
                                    
									</div>

                                </td>
                            </tr>
							
							
							
                            <tr>
                                <td>Currency<sup id="currency_validation_star" style="color: #f00; font-size: 14px; display:none;" >*</sup></td>
                                <td>
                                    <select class="form-control" id="currency" onchange="hideerror1(this.id)">
                                        <option>Select</option>

                                    </select>
                                </td>
                            </tr>
							
							
                            <!--<tr>
                                <td>Expense Intiate Date<sup style="color: #f00; font-size: 14px;">*</sup></td>
                                <td>
                                    <div style="position: relative;">
                                        <input type="text" id="TxtDate"  class="form-control" onkeyup="hideerror('TxtDate')" />
                                        <span class="right-icon">
                                            <i class="fa fa-calendar"></i>
                                        </span>
                                        <div>
                                </td>
                            
							
							</tr>-->
							
							
							
							
							
                            <tr>
                                <td>Advance Amount Taken <sup id="amount_validation_star" style="color: #f00; font-size: 14px; display:none; ">*</sup></td>
                                <td>
								<div class="Amount-right-side">
                                    <input readonly="true"  type="text" id="Txtamttaken" class="form-control"  onkeyup="hideerror('Txtamttaken')"   />
									<span class="amt-right-text" style="color:#ababab;" id="currencyspan"></span>
								</div>	
                                </td>
                            </tr>


                            <tr>
                                <td></td>
                                <td>
                                    <span id="AlertMsg" style="color:red;"></span>
                                    <span id="user_id" style="display: none;"></span>
                                    <span id="user_name" style="display: none;"></span>
                                    <span id="resourse_id" style="display: none;"></span>
                                    <span id="Span3"></span>
                                </td>
                            </tr>
                            <tr id="add_tr">
                                <td></td>
                                <td>
                                    <a href="javascript:void(0)" class="blue-btn" id="btnSubmit">Save & close</a>
									
									<a href="javascript:void(0)" class="blue-btn" id="btnSaveAndAdd">Save & Add Item</a>
									
                                    <a href="javascript:void(0)" class="gray-btn" data-dismiss="modal">Cancel</a>

                                   <!-- <a href="javascript:void(0)" class="blue-btn" id="btnSubmitandNew">Save & create Another</a>-->




                                </td>
                            </tr>

                           


                            <tr id="update_tr" style="display: none;">
                                <td></td>
                                <td>
                                    <span id="edit_id" style="display: none;"></span>
                                    <span id="tr_editid" style="display: none"></span>
                                    <a href="javascript:void(0)" class="blue-btn" id="btn_update" onclick="updateListItem('BconeExpenceMaster','https://bristleconeonline.sharepoint.com/sites/PPMUAT/');">Update</a>
                                    <!-- <a href="javascript:void(0)" class="red-btn">Delete</a>-->
                                    <a href="javascript:void(0)" class="gray-btn" data-dismiss="modal">Cancel</a>


                                </td>
                            </tr>

                             <tr id="mytr">
                                <td></td>
                                <td style="padding-bottom:0px; padding-top:0px;">
                                    <div class="fk-suc-msg" id="per-info-suc" style="display:none;"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="loader"></div>


    <script>


        $(function () {


			disableRightClick();

            $('[data-toggle="tooltip"]').tooltip();




            ////$(".dataTables_paginate paging_simple_numbers").live("click", function() {
            // do something
            //alert('clicked');
            //});



            // $('.loader').show();

            var ditached_counter_div = null;



            //$("#TxtDate").datepicker({
            //    dateFormat: 'dd-M-yy ',
            //    changeMonth: true,
            //    changeYear: true,

            //    onSelect: function (datetext) {

            //        var d = new Date(); // for now

            //        var h = d.getHours();
            //        h = (h < 10) ? ("0" + h) : h;

            //        var m = d.getMinutes();
            //        m = (m < 10) ? ("0" + m) : m;

            //        var s = d.getSeconds();
            //        s = (s < 10) ? ("0" + s) : s;

            //        datetext = datetext + " " + h + ":" + m + ":" + s;

            //        $('#TxtDate').val(datetext);
            //    }


            //});

            //$('.right-icon').click(function () {
            //   // alert('clicked');

            //    $("#TxtDate").datepicker('show');
            //});



            //$(".right-icon").datepicker({
            //    dateFormat: 'dd-M-yy',
            //    changeMonth: true,
            //    changeYear: true


            //});





            // load_datatable_js();





            $('#pageTitle').find("a").html('');

            //$("p").find("span").css("color", "red");

            $('#btnSubmit').click(function (e) {


                // $('.loader').show();
                // alert('submit button clicked..');

                var isValid = false;
                if (check_validation()) {




                    //alert('befor show loader');
                    //  $('.loader').show();
                    //alert('show loader');


                    var expensereport = document.getElementById("Txtexpensereport").value;


                    var Description = document.getElementById("TxtDescription").value;

                    var amount = document.getElementById("Txtamttaken").value;

                    if (amount == '') {
                        amount = '0';
                    }



                    //var date = document.getElementById("TxtDate").value;

                    var currentdate = new Date();

                    var date = currentdate;

                    var currency_text = $('#currency :selected').text();

                    //alert(ss);

                    var currencyval = $('#currency :selected').val();

                    var ProjectId = $('#ddlProjects :selected').val();
                    //alert(currencyval);

                    var Projectname = $('#ddlProjects :selected').text();

                    var ProjectOwner = $('#ddlProjectsmanager :selected').text();
                    ProjectOwner = ProjectOwner.split('|');
                    ProjectOwnerName = ProjectOwner[0];
                    //var ProjectOwnerId=   $('#ddlProjects :selected').val();
                    var ProjectOwnerId = ProjectOwner[1];



                    var EmployeeId = $('#user_id').text();
                    var EmployeeName = $('#user_name').text();
                    var ResourseId = $('#resourse_id').text();

                    //alert('ProjectId:'+ProjectId+',Projectname: '+Projectname+',ProjectOwnerId: '+ProjectOwnerId+',ProjectOwnerName: '+ProjectOwnerName+',EmployeeId: '+EmployeeId+',EmployeeName: '+EmployeeName+',ResourseId: '+ResourseId)

                    var ddladvancetaken = ($('input[name=advance]:checked', '#advance').val());

                    if (ddladvancetaken == 'No') {
                        //set currency default value
                        currencyval = 'null';
                        currency_text = '';
                    }







                    // $("input[name=advance][value=No]").prop('checked', 'checked');







                    //show_loader();
                    addExpense(current_url, 'BconeExpenceMaster', expensereport, Description, currencyval, date, amount, currency_text, 'save', ProjectId, Projectname, ProjectOwnerId, ProjectOwnerName, EmployeeId, EmployeeName, ResourseId);


                    // console.log(data);
                    //  alert(data.d.results);





                    //here record count dynamically based on total record
                    //var record_count = 'new_record';




                    //destroyjs();

                    //cleardata();

                    // var EmployeeId = $('#resourse_id').text();

                    //alert(EmployeeId);


                    //getDataByListName(current_url, 'BconeExpenceMaster', 'load1', EmployeeId);

                    // getListItemById(current_url, 'BconeExpenceMaster', data.d.ID, record_count, 'added');

                    //hidemodal();

                    //$('.loader').hide();

                    // $('#student_datatable').DataTable();


                    //load_datatable_js();

                    //alert('hide loader');
                    // $('.loader').hide();

                    //hideerror1('update');
                    // showmodal1('update');





                }

                else {
                    // //alert("validation is not complete");
                }

            });

            $('#btnSaveAndAdd').click(function (e) {


                // $('.loader').show();
                // alert('submit button clicked..');

                var isValid = false;
                if (check_validation()) {




                    //alert('befor show loader');
                    // $('.loader').show();
                    //alert('show loader');


                    var expensereport = document.getElementById("Txtexpensereport").value;


                    var Description = document.getElementById("TxtDescription").value;

                    var amount = document.getElementById("Txtamttaken").value;

                    if (amount == '') {
                        amount = '0';
                    }



                    //var date = document.getElementById("TxtDate").value;

                    var currentdate = new Date();

                    var date = currentdate;

                    var currency_text = $('#currency :selected').text();

                    //alert(ss);

                    var currencyval = $('#currency :selected').val();

                    //alert(currencyval);

                    var ProjectId = $('#ddlProjects :selected').val();
                    //alert(currencyval);

                    var Projectname = $('#ddlProjects :selected').text();


                    var ProjectOwner = $('#ddlProjectsmanager :selected').text();
                    ProjectOwner = ProjectOwner.split('|');
                    ProjectOwnerName = ProjectOwner[0];
                    //var ProjectOwnerId=   $('#ddlProjects :selected').val();
                    var ProjectOwnerId = ProjectOwner[1];


                    var EmployeeId = $('#user_id').text();
                    var EmployeeName = $('#user_name').text();
                    var ResourseId = $('#resourse_id').text();

                    // alert(EmployeeId);


                    var ddladvancetaken = ($('input[name=advance]:checked', '#advance').val());

                    if (ddladvancetaken == 'No') {
                        //set currency default value
                        currencyval = 'null';
                        currency_text = '';
                    }







                    // $("input[name=advance][value=No]").prop('checked', 'checked');







                    //show_loader();
                    addExpense(current_url, 'BconeExpenceMaster', expensereport, Description, currencyval, date, amount, currency_text, 'saveandcreate', ProjectId, Projectname, ProjectOwnerId, ProjectOwnerName, EmployeeId, EmployeeName, ResourseId);
                    //add_success_exp_msg('Expense created successfully..', 'save');
                    // console.log(data);
                    //  alert(data.d.results);





                    //here record count dynamically based on total record
                    //var record_count = 'new_record';




                    //  destroyjs();


                    // getDataByListName(current_url, 'BconeExpenceMaster', 'load1');

                    // getListItemById(current_url, 'BconeExpenceMaster', data.d.ID, record_count, 'added');

                    //hidemodal();

                    //$('.loader').hide();

                    // $('#student_datatable').DataTable();


                    //load_datatable_js();

                    //alert('hide loader');
                    // $('.loader').hide();

                    //hideerror1('update');
                    // showmodal1('update');





                }

                else {
                    // //alert("validation is not complete");
                }

            });


            $('#btnSubmitandNew').click(function (e) {


                var isValid = false;
                if (check_validation()) {


                    $('.loader').show();

                    // alert('Thank you for submitting');

                    //var attchment=document.getElementById("filename").innerHTML;

                    var expensereport = document.getElementById("Txtexpensereport").value;


                    var Description = document.getElementById("TxtDescription").value;

                    var amount = document.getElementById("Txtamttaken").value;

                    //var date = document.getElementById("TxtDate").value;

                    var currentdate = new Date();

                    var date = currentdate;

                    var ss = $('#currency :selected').text();

                    var currencyval = $('#currency :selected').val();


                    addExpense(current_url, 'BconeExpenceMaster', expensereport, Description, currencyval, date, amount);


                    add_success_exp_msg('Expense created successfully..', 'createnew');
                    $('.loader').hide();
                    // console.log(data);
                    //  alert(data.d.results);



                    clearAllInputs('myModal');

                    //here record count dynamically based on total record
                    var record_count = 'new_record';




                    destroyjs();

                    getDataByListName(current_url, 'BconeExpenceMaster');

                    // getListItemById(current_url, 'BconeExpenceMaster', data.d.ID, record_count, 'added');

                    //hidemodal();

                    //$('.loader').hide();

                    $('#student_datatable').DataTable();




                }

                else {
                    // //alert("validation is not complete");
                }

            });

            $('input:radio[name=advance]').change(function () {


                hideerror1('ddladvancetaken');
                //alert(this.value);	


                //if (this.value == "Yes") {
                //    var amount = $('#Txtamttaken').val();
                //    //alert(amount);
                //    if (amount <= 0 || amount != '') {
                //        $('#Txtamttaken').css({

                //            "border": "1px solid red",
                //            "background": "#FFCECE"
                //        });
                //        $('#Txtamttaken').focus();
                //        $("#Txtamttaken").attr("readonly", false);
                //    }

                //    //document.getElementById("AlertMsg").innerHTML = "Please select currency";

                //}
                //else {




                //    $('#Txtamttaken').css({

                //        "border": "",
                //        "background": ""
                //    });

                //    $("#Txtamttaken").attr("readonly", true);
                //    $("#Txtamttaken").val('');

                //    //document.getElementById("AlertMsg").innerHTML = "";

                //}





            });

            // ditached_counter_div = $('.dataTables_length').detach();

            //$(ditached_counter_div).insertAfter('.dataTables_info');

            //$("body").overhang({
            //    custom: true, // Set custom to true
            //    primary: "#337ab7", // Your custom primary color
            //    accent: "#fff",// Your custom accent color
            //    message: "What is your name Nilima"
            //});

            //$("body").overhang({
            //    custom: true, // Set custom to true
            //    primary: "#34495E", // Your custom primary color
            //    accent: "#F4B350", // Your custom accent color
            //    message: "What is your name"
            //});

            //setTimeout(function () {

            //    $("body").overhang({
            //        type: "confirm",
            //        message: "Are you sure?",

            //        // This code will run once an option is clicked.
            //        callback: function (selection) {
            //            //alert("You made your selection of " + selection);
            //        }
            //    });

            //},1000)

            //setTimeout(function () {

            //    $("body").overhang({
            //        type: "error",
            //        message: "You could not be logged in at this time.",
            //        closeConfirm: "true"
            //    })


            //},5000);


            //$('#student_datatable_length').appendTo('#student_datatable_info');



            $('#Txtamttaken').mouseout(function () {
                //alert('hi');
                convert_amount();
            });

            $("#Txtamttaken").blur(function () {
                convert_amount();
                ////alert("This input field has lost its focus.");
            });



            $("input[id*='Txtamttaken']").keydown(function (event) {


                if (event.shiftKey == true) {
                    event.preventDefault();
                }

                //alert(event.keyCode);

                if ((event.keyCode >= 48 && event.keyCode <= 57) ||
                    (event.keyCode >= 96 && event.keyCode <= 105) ||
                    event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
                    event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) {

                } else {
                    event.preventDefault();
                }

                if ($(this).val().indexOf('.') !== -1 && event.keyCode == 190 || $(this).val().indexOf('.') !== -1 && event.keyCode == 110)
                    event.preventDefault();
                //if a decimal has been added, disable the "."-button

            });


        });

        function show_loader() {

            $('.loader').show();
        }

        function convert_amount() {

            var current_val = $('#Txtamttaken').val();
            //alert(current_val);
            // var updated_val='';
            //if(current_val!='' && current_val!='0')
            // {
            // alert(current_val);
            // updated_val=(current_val).toFixed(2);
            // }
            // alert(updated_val);
            if (current_val != '') {
                var num = parseFloat(current_val);
                //alert(num.toFixed(2)); // "2.40"
                $('#Txtamttaken').val(num.toFixed(2));
            }

        }



        function load_datatable_js() {




            $('#student_datatable').DataTable({

                aoColumnDefs: [

                   { "aTargets": [0], "bSortable": false }


                ],
                "lengthMenu": [[25, 50, 100, -1], [25, 50, 100, "All"]],
                "order": []

                // $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
            });

            //alert('loaded');

            $('#student_datatable tfoot th').each(function () {
                var title = $(this).text();
                //var title = '';
                //alert(title);
                if (title != '') {
                    $(this).html('<input style="width:100px;" type="text" placeholder="Search" />');
                }
            });


            var table = $('#student_datatable').DataTable();


            table.columns().every(function () {
                var that = this;

                $('input', this.footer()).on('keyup change', function () {
                    if (that.search() !== this.value) {
                        that
                            .search(this.value)
                            .draw();
                    }
                });
            });

            //$('.loader').hide();

            //setTimeout(function(){
            //alert('called');
            $('.dataTables_wrapper #student_datatable').wrapAll(document.createElement('div'));
            $('.dataTables_wrapper #student_datatable').parent('div').addClass('table-responsive');
            //$('.dataTables_wrapper .table-responsive').css("width", "1180px");
            $('.dataTables_wrapper .table-responsive').css("width", "1030px");

            //},2000);


            $('[data-toggle="tooltip"]').tooltip();

            $("#student_datatable_paginate").on("click", function () {
                $('[data-toggle="tooltip"]').tooltip();
            });

            $(".sorting").on("click", function () {
                $('[data-toggle="tooltip"]').tooltip();
            });




        }




        function add_success_exp_msg(message, type) {

            $('#per-info-suc').text(message);

            $("#per-info-suc").fadeIn("slow");



            $("#per-info-suc").fadeOut(1000, function () {

                if (type == 'save') {
                    hidemodal();
                    clearAllInputs('myModal');
                }
                else if (type = 'saveandcreate') {

                }
                else {
                    // hidemodal();
                    // showmodal();
                    $('#Txtexpensereport').focus();
                }
            });



        }

        function alert_message_overhang(message) {
            $("body").overhang({
                custom: true, // Set custom to true
                primary: "#337ab7", // Your custom primary color
                accent: "#fff",// Your custom accent color
                message: message
            });
        }



        function isNumber1(evt) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {

                //alert($('#Txtamttaken').val());
                return false;
            }

            //alert($('#Txtamttaken').val());
            return true;
        }

        function isNumber(evt, element) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if ((charCode != 190 || $(element).val().indexOf('.') != -1)  // “.” CHECK DOT, AND ONLY ONE.
                    && (charCode != 110 || $(element).val().indexOf('.') != -1)  // “.” CHECK DOT, AND ONLY ONE.
                    && ((charCode < 48 && charCode != 8)
                            || (charCode > 57 && charCode < 96)
                            || charCode > 105))
                return false;
            return true;
        }

        function openalerbox() {
            var title = 'my amol m';
            $.dialogbox({
                type: 'msg',
                title: title,
                icon: 'http://i.stack.imgur.com/akO3g.png',
                content: 'Alert Content',
                btn: ['Confirm'],
                call: [
                  function () {
                      $.dialogbox.close();
                  }
                ]
            });
        }

        function destroyjs() {

            //alert('js distroy');

            //var table = $('#student_datatable').DataTable();

            //table.clear();
            //table.draw();

            $('#student_datatable').dataTable({
                "filter": false,
                "destroy": true
            });

            // $('#student_datatable').empty();

            //table.destroy();
            //table.empty();



            var tables = $.fn.dataTable.fnTables(true);

            $(tables).each(function () {
                $(this).dataTable().fnDestroy();
            });


            clear_tbody();





        }

        function getDataByListName_old(url, listname, type) {

            // alert('called');
            //$('.loader').show();

            //alert(listname);
            //var viewflds = '<ViewFields><FieldRef Name="Title"/><FieldRef Name="Status"/><FieldRef Name="Id"/></ViewFields>';

            //var query_cml = '<View><Query><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime"             IncludeTimeValue="True"></Value></OrderBy></Query><View>';



            var query_cml = '<View><Query><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';

            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/GetItems",
                type: "POST",
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                success: function (data) {

                    ////alert("got data on page load event");

                    // Console.log(data.d.results);

                    var table_tr = "";

                    var table_tr_edit = "";
                    if (data.d.results.length > 0) {

                        document.getElementById("totalrecord").value = data.d.results.length;
                        if (document.getElementById("totalrecord").value > 0) {
                            //$("#deletediv").show();
                        }

                        var list_name = listname;
                        var i = "0";
                        var url1 = url;
                        var rowhide = "";

                        var Project_Name = "Project Name";
                        var Pending_With = "Pending With";
                        var Reimbursed_Total_Money = "Reimbursed_Total_Money";
                        var Balance = "Balance";
                        var fromdate = "";
                        var ReportCreatedDate = "";
                        var converted_date = "";

                        var ModifiedDate = "";

                        var openstatus_count = 0;
                        var submittedstatus_count = 0;
                        var approvedstatus_count = 0;
                        var rejectedstatus_count = 0;
                        var reimburesedstatus_count = 0;
                        var ReSubmittedExpenceCount = 0;
                        var curreuncyvalue = 0;
                        var advance = "";
                        var tooltip_date = "";
                        var allrecord_count = "";
                        var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/PPMUAT/SitePages/ExpenseItemDetail.aspx?TrackingNo=";








                        $.each(data.d.results, function (key, value) {


                            //alert(value.Modified);

                            allrecord_count++;

                            if (value.ReportStatus == "Open") {
                                openstatus_count++;
                            }

                            if (value.ReportStatus == "Submitted") {
                                submittedstatus_count++;
                            }
                            if (value.ReportStatus == "ReSubmitted") {
                                ReSubmittedExpenceCount++;
                            }


                            if (value.ReportStatus == "Rejected") {
                                rejectedstatus_count++;
                            }

                            if (value.ReportStatus == "Approved") {
                                approvedstatus_count++;
                            }

                            if (value.ReportStatus == "Reimbursed") {
                                reimburesedstatus_count++;
                            }




                            //ReportCreatedDate = new Date(value.Modified);
                            ReportCreatedDate = value.Modified;


                            //converted_date = ReportCreatedDate;
                            converted_date = convert_date(ReportCreatedDate);
                            tooltip_date = convert_date1(ReportCreatedDate);

                            // alert();
                            //var date = new Date();
                            //  updated_date = fromdate.yyyymmdd();

                            //alert('updated_date' + updated_date);

                            //alert('fromdate:' + fromdate);
                            // var dd = fromdate.getDate();
                            //	alert('dd: '+ dd);
                            //  var mm = fromdate.getMonth() + 1; //January is 0!
                            //alert('mm: '+ mm);
                            //  var yyyy = fromdate.getFullYear();
                            //	alert('yyyy: '+ yyyy);

                            //  var updated_date = (fromdate.getMonth() + 1) + '-' + fromdate.getDate() + '-' + fromdate.getFullYear();

                            //  var updated_date = value.CalRepCreatedDate;

                            rowhide = "rowhideslow" + i + "";

                            //tr_edit = "row_edit" + i + "";

                            //alert(value.Currency_x003a_ID);

                            curreuncyvalue = "";
                            advance = "-";
                            //alert(value.AmountTaken);

                            if (value.AmountTaken != null) {
                                advance = value.AmountTaken;
                                if (advance.toString().indexOf(".")) {
                                }
                                else {
                                    advance = advance + ".00";

                                }



                            }

                            curreuncyvalue = value.currencytext;

                            if (curreuncyvalue == null) {
                                curreuncyvalue = "";
                                //alert(value.ID);

                            }
                            else {
                                //alert('value.CurrencyId'+ value.CurrencyId);

                                //curreuncyvalue = getcurrencyValueById(current_url, 'BconeCurrency', value.CurrencyId);


                                Expenseitem = curreuncyvalue;

                                // alert(Expenseitem);
                                if (Expenseitem.indexOf("-")) {
                                    var curr = Expenseitem.split("-");
                                    //alert(curr[0]);
                                    curreuncyvalue = curr[0];

                                }
                                else {

                                    //document.getElementById("currencyspan").innerHTML = Expenseitem;

                                }

                            }


                            //alert(Expenseitem);






                            //alert('currency id: ' + value.CurrencyId);
                            // alert('currency name: ' + value.curr);

                            //curreuncyvalue = getcurrencyValueById(current_url, 'BconeCurrency', value.CurrencyId);
                            //alert(curreuncyvalue);

                            //alert(ss);
                            var expenceid = value.ID;


                            table_tr = table_tr + "<tr id=" + rowhide + "  class='deleteall" + value.ID + "' value=" + value.ID + ">";

                            table_tr = table_tr + " <td><a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block;margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete' style='display:inline-block;' onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a> </td>";

                            //table_tr = table_tr + "<td><input type='checkbox' id='record" + i + "' name='record" + i + "'  value=" + value.ID + "                              /></td>";

                            // alert(value.attchment);
                            table_tr = table_tr + "<td>" + value.ID + "</td>";

                            table_tr = table_tr + " <td><a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a></td>";

                            // table_tr = table_tr + " <td><a href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name +                             "\",\"" + value.ID + "\",\"" + i + "\",\"update\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a></td>";

                            table_tr = table_tr + "<td><a style='text-decoration:none;' data-toggle='tooltip' title='' data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a></td>";

                            //if (value.ReportStatus != 'Submitted') {
                            table_tr = table_tr + " <td>" + value.ReportStatus + "</td>";
                            //}
                            //else {
                            //    table_tr = table_tr + " <td>hmm</td>";
                            // }



                            table_tr = table_tr + " <td>" + Project_Name + "</td>";

                            table_tr = table_tr + " <td>" + Pending_With + "</td>";

                            table_tr = table_tr + "<td>" + advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span></td>";

                            table_tr = table_tr + " <td>" + Reimbursed_Total_Money + "</td>";

                            table_tr = table_tr + " <td>" + Balance + "</td>";


                            //  table_tr = table_tr + "<td>" + curreuncyvalue + "</td>";



                            if (value.ReportStatus != 'Submitted') {
                                //table_tr = table_tr + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-                                trash'></i></a></td>";
                            }
                            else {
                                //table_tr = table_tr + " <td><i class='fa fa-check-circle' aria-hidden='true'></i></td>";
                            }




                            table_tr = table_tr + "</tr>";


                            //amol coding




                            // table_tr_edit = table_tr_edit + "<tr id=" + tr_edit + " class='deleteall" + value.ID + "' value=" + value.ID + "                             style='display:'block';' >";

                            // table_tr_edit = table_tr_edit + "<td><input type='checkbox' id='record" + i + "' name='record" + i + "'  value=" +                             value.ID + "  /></td>";

                            // alert(value.attchment);
                            //table_tr_edit = table_tr_edit + "<td>" + value.ID + "</td>";

                            // table_tr_edit = table_tr_edit + " <td><input type='text' id='ExpenseReportName" + i + "' value=" +                             value.ExpenseReportName + "/></td>";
                            // table_tr_edit = table_tr_edit + "<td><input type='text' id='Description" + i + "' value=" + value.Description + "                             /></td>";
                            // table_tr_edit = table_tr_edit + "<td><select id='curreuncyvalue" + i + "'></select></td>";
                            // table_tr_edit = table_tr_edit + "<td><input type='text' id='AmountTaken" + i + "' value=" + value.AmountTaken + "                             /></td>";
                            // table_tr_edit = table_tr_edit + "<td><input type='text' id='ReportCreatedDate" + i + "' value=" +                             value.ReportCreatedDate + " /></td>";
                            // table_tr_edit = table_tr_edit + " <td>" + value.ReportStatus + "</td>";
                            // table_tr_edit = table_tr_edit + " <td><a href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" +                             list_name + "\",\"" + value.ID + "\",\"" + i + "\");  '><i class='fa fa-pencil'></i></a></td>";
                            // table_tr_edit = table_tr_edit + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa                             fa-trash'></i></a></td>";



                            // table_tr_edit = table_tr_edit + "</tr>";

                            i++;


                        });
                    }
                    else {
                        //alert(data.d.results.length);

                        table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a                         href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";

                    }

                    //document.getElementById("OpenExpenceCount").innerHTML = openstatus_count;
                    //document.getElementById("SubmittedExpenceCount").innerHTML = submittedstatus_count;
                   // document.getElementById("ReSubmittedExpenceCount").innerHTML = ReSubmittedExpenceCount;
                  //  document.getElementById("RejectedExpenceCount").innerHTML = rejectedstatus_count;
                  //  document.getElementById("ApprovedExpenceCount").innerHTML = approvedstatus_count;
                  //  document.getElementById("ReimburesedExpenceCount").innerHTML = reimburesedstatus_count;
                  //  document.getElementById("AllRecordCount").innerHTML = allrecord_count;
                    // alert(table_tr);
                    $('#student_data').append(table_tr);

                    //  $('#student_data').append(table_tr_edit);

                    // $('.loader').hide();


                    //alert(table_tr);


                    console.log(data.d);


                },
                error: function (data) {
                    //failure(data);
                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                    if (type != 'load') {
                        load_datatable_js();
                    }
                }
            });
        }


        function getDataByListName(url, listname, type, EmployeeId) {

        $('.loader').show();
            jsonObj = [];
            var trackingno = '';
            var title = '';

            var status = '';
            var advanceamount = '';

            var list_name = listname;
            var i = "0";
            var url1 = url;
            var rowhide = "";

            var Project_Name = "Project Name";
            var Pending_With = "Pending With";
            var Reimbursed_Total_Money = "-";
            var Balance = "Balance";
            var fromdate = "";
            var ReportCreatedDate = "";
            var converted_date = "";

            var ModifiedDate = "";

            var openstatus_count = 0;
            var submittedstatus_count = 0;
            var approvedstatus_count = 0;
            var rejectedstatus_count = 0;
            var reimburesedstatus_count = 0;
            var ReSubmittedExpenceCount = 0;
            var curreuncyvalue = 0;
            var advance = "";
            var tooltip_date = "";
            var allrecord_count = 0;
            var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/PPMUAT/SitePages/FinanceItemDetails.aspx?TrackingNo=";
            var expenceid = '';
            var curr = '';
            var action_data = '';

            var data = '';
			
			var datetooltip='datetooltip';
			
			var ReimburseCurrency='';
			var final_status='';

			//var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="ProjectOwnerId"/><Value Type="Text">' + EmployeeId + '</Value></Eq><And><eq><FieldRef Name="ReportStatus"/><Value Type="Text">Approved</Value></eq><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Rejected</Value></Eq></Or></And></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="ProjectOwnerId" /><Value Type="Text">' + EmployeeId + '</Value></Eq><And><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Approved</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Rejected</Value></Eq></Or></And></And></Where></Query></View>';
            //var query_cml = '<View><Query><Where><Eq><FieldRef Name="ProjectOwnerId"/><Value Type="Text">' + EmployeeId + '</Value></Eq></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//var query_cml = '<View><Query><Where><And><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Approved</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Rejected</Value></Eq></Or> <Or><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">CompleteCycle</Value></Eq><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">' + EmployeeId + '</Value></Eq></Or></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//var query_cml = '<View><Query><Where><Or><And><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Approved</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Reimbursed</Value></Eq><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">ApprovedSuccessfully</Value></Eq></And> <And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">' + EmployeeId + '</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Rejected</Value></Eq></And></Or></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//var query_cml='<View><Query><Where><And><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Rejected</Value></Eq><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">ApprovedSuccessfully</Value></Eq></Or><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Reimbursed</Value><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">ApprovedSuccessfully</Value></Eq></Eq></Or><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">' + EmployeeId + '</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//var query_cml = '<View><Query><Where><Or><And><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Approved</Value></Eq><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">ApprovedSuccessfully</Value></Eq></And> <And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">' + EmployeeId + '</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Rejected</Value></Eq></And><And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">' + EmployeeId + '</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Reimbursed</Value></Eq></And></Or></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//var query_cml = '<View><Query><Where><And><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Rejected</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Reimbursed</Value></Eq><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Approved</Value></Eq></Or></Or><Eq><FieldRef Name="PendingWithId"/><Value Type="Text">ApprovedSuccessfully</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//var query_cml = '<View><Query><Where><And><Or><Eq><FieldRef Name="FinanceExpenseStatus"/><Value Type="Text">Rejected</Value></Eq><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Reimbursed</Value></Eq><Eq><FieldRef Name="FinanceExpenseStatus"/><Value Type="Text">Approved</Value></Eq></Or></Or><Eq><FieldRef Name="FinanceId"/><Value Type="Text">'+EmployeeId+'</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			
			var query_cml = '<View><Query><Where><And><Or><Eq><FieldRef Name="Action"/><Value Type="Text">Finance Approved</Value></Eq><Or><Eq><FieldRef Name="Action"/><Value Type="Text">Reimbursed</Value></Eq><Eq><FieldRef Name="Action"/><Value Type="Text">Finance Rejected</Value></Eq></Or></Or><Eq><FieldRef Name="ActorID"/><Value Type="Text">'+EmployeeId+'</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			
			//var query_cml = '<View><Query><Where><And><Or><Eq><FieldRef Name="Action"/><Value Type="Text" >Finance Approved</Value></Eq><Eq><FieldRef Name="Action"/><Value Type="Text">Finance Rejected</Value></Eq></Or><Eq><FieldRef Name="ActorID" /><Value Type="Text">' + EmployeeId + '</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//alert(query_cml);

            $.ajax({
                url: url + "/_api/web/lists/getbytitle('BconeExpenseLogHistory')/GetItems",
                type: "POST",
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                beforeSend: function () {
                    //$('.loader').show();
                },

                success: function (data) {
			
				console.log(data);



                    var table_tr = "";

                    var table_tr_edit = "";
					//alert(data.d.results.length);
					
                    if (data.d.results.length > 0) {







                        $.each(data.d.results, function (key, value) {

                          BindMethod(url, listname, type, EmployeeId,value.TrackingNo,value.Created) ;
                            //alert(value.Modified);
							
							ReimburseCurrency='';

                            allrecord_count++;
                            //alert(allrecord_count);
                   

                           // action_data = "<a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block; margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete' style='display:inline-block;' onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a>";

                            if (value.Action == "Open") {
                                openstatus_count++;
                            }

                            if (value.Action == "Submitted") {
                                submittedstatus_count++;
                            }
                            if (value.Action == "ReSubmitted") {
                                ReSubmittedExpenceCount++;
                            }


                            if (value.Action == "Finance Rejected") {
                                rejectedstatus_count++;
                            }

                            if (value.Action == "Finance Approved") {
                                approvedstatus_count++;
                                //action_data = "";
                                action_data = "<a data-toggle='tooltip' data-placement='right'  style='display:inline-block; text-decoration:none; color:#a6a6a6;margin-right:12px ' href='javascript:void(0)' ><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right'  style='display:inline-block; text-decoration:none; color:#a6a6a6;' ><i class='fa fa-trash'></i></a>";

                            }

                            if (value.Action == "Reimbursed") {
                                reimburesedstatus_count++;
                                // action_data = "";
                                action_data = "<a data-toggle='tooltip' data-placement='right'  style='display:inline-block; text-decoration:none; color:#a6a6a6;margin-right:12px ' href='javascript:void(0)' ><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right'  style='display:inline-block; text-decoration:none; color:#a6a6a6;' ><i class='fa fa-trash'></i></a>";
                            }

                            
						   

                        });
                    }
                    else {
                        //table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";
table_tr = table_tr +"<div class='nodatadiv'>";
      table_tr = table_tr +"<h3>No data to display</h3>";
       table_tr = table_tr +"</div>";
          $('#NodataDiv').html(table_tr);
                    }
					//allrecord_count=approvedstatus_count+rejectedstatus_count;
                    //document.getElementById("OpenExpenceCount").innerHTML = openstatus_count;
                   // document.getElementById("SubmittedExpenceCount").innerHTML = submittedstatus_count;
                    //document.getElementById("ReSubmittedExpenceCount").innerHTML = ReSubmittedExpenceCount;
                    document.getElementById("RejectedExpenceCount").innerHTML = rejectedstatus_count;
                    document.getElementById("ApprovedExpenceCount").innerHTML = approvedstatus_count;
                    document.getElementById("ReimburesedExpenceCount").innerHTML = reimburesedstatus_count;
                    //document.getElementById("AllRecordCount").innerHTML = allrecord_count;


                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                    $('.loader').hide();
                }

            });
        }
		
		
		
		
		 function getExpenseDetailById(url, listname, id) {
		 
		  var web_url = "https://bristleconeonline.sharepoint.com/sites/PPMUAT/";
		 // alert(web_url);

		 
		 
                   //  alert('getDataByListName');
			$('.loader').show();
            jsonObj = [];
            var trackingno = '';
            var title = '';

            var status = '';
            var advanceamount = '';

            var list_name = listname;
            var i = "0";
            var url1 = url;
            var rowhide = "";

            var Project_Name = "Project Name";
            var Pending_With = "Pending With";
            var Reimbursed_Total_Money = "-";
            var Balance = "Balance";
            var fromdate = "";
            var ReportCreatedDate = "";
            var converted_date = "";

            var ModifiedDate = "";

            var openstatus_count = 0;
            var submittedstatus_count = 0;
            var approvedstatus_count = 0;
            var rejectedstatus_count = 0;
            var reimburesedstatus_count = 0;
            var ReSubmittedExpenceCount = 0;
            var curreuncyvalue = 0;
            var advance = "";
            var tooltip_date = "";
            var allrecord_count = 1;
            var redirect_tolink = "";
            var expenceid = '';
            var curr = '';

            var data = '';
			var condition_report_status="";

			var query_cml = '<View><Query><Where><Eq><FieldRef Name="TrackingNo" /><Value Type="Number">' + id + '</Value></Eq></Where><OrderBy><FieldRef Name="ExpenseDate" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
         //alert(query_cml);
          //  var query_cml = '<View><Query><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
       
            $.ajax({
               
				url: _spPageContextInfo.webAbsoluteUrl + "/_api/Web/Lists/getbytitle('BconeExpenceLogDetail')/GetItems",
                type: "POST",
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                success: function (data) {
				console.log(data);
				
				
				//alert('success');
                  var curreny_amt_array=[];
                 var rowhide;
                  var i = "0";
                    var table_tr = "";

                    var table_tr_edit = "";
					//alert(data.d.results.length);
                    if (data.d.results.length > 0) {

               
					//condition_report_status=GetExpenceDetailByTrackingNo(url, 'BconeExpenceMaster', id);
					////alert("condition_report_status"+  condition_report_status);
                   

                        $.each(data.d.results, function (key, value) {
						 rowhide = "rowhideslow" + value.ID + "";

                           i++;
						  // alert(value.ExpenceItemId);
						   
						  
						   var Expense_item = getcurrencyValueById(web_url,'BconeItemMaster', value.ExpenceItemId);
						   //alert(Expense_item);
						   var payment_type = getcurrencyValueById(web_url,'BconeItemMaster', value.PaymentTypeId);
						    var Currency= getcurrencyValueById(web_url,'BconeCurrency', value.ExpenceCurrencyId);
								 
								 var curr_val;
								 
								 			   if(Currency.indexOf("-"))
			                                 {
			                                 var curr=Currency.split("-");
			
                                             curr_val=curr[0]; 
											 } else {
				                              curr_val=Currency;
											  }
							////alert("Expense_item"+Expense_item);
                            //alert(value.Modified);

                            allrecord_count++;
                            //alert(allrecord_count);

                          

                            ReportCreatedDate = value.Modified;
                          var convert_date1=convert_date(value.ExpenseDate);
						  
                          //  converted_date = convert_date(ReportCreatedDate);
                           // tooltip_date = convert_date1(ReportCreatedDate);

                            rowhide = "rowhideslow" + i + "";

                            curreuncyvalue = "";
                            advance = "-";


                            if (value.ExpensceAmount != null) {
                                advance = value.ExpensceAmount;
                                if (advance.toString().indexOf(".")) {
                                }
                                else {
                                    advance = advance + ".00";

                                }



                            }

                            curreuncyvalue = value.currencytext;

                            if (curreuncyvalue == null) {
                                curreuncyvalue = "";

                            }
                            else {

                                Expenseitem = curreuncyvalue;


                                if (Expenseitem.indexOf("-")) {
                                    curr = Expenseitem.split("-");
                                    curreuncyvalue = curr[0];
                                }
                                else {
                                }

                            }
                            expenceid = value.ID;
							
							 curreny_amt_array.push(curr_val+"-"+value.ExpensceAmount+"-"+value.ExpenceCurrencyId);
                           
                            var item = {}
							
							if(condition_report_status=="Open")
							{
							
							$("#Add_item").show();
                            if (value.BillAttachment != null) 
							{
							 var ss = 'https://bristleconeonline.sharepoint.com/sites/PPMUAT/BconeBillAttachment/' + value.BillAttachment;
                            item["action"] = "<a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block; margin-right:12px;'  onclick='getListItemByIdForUpdate(\"" + url + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + rowhide + "\");showmodal();'><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete' style='display:inline-block;margin-right: 12px;' onclick='DeleteExpenseLog(" + value.ID+ ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a><a style='display: inline-block;margin-left: 12px;' href='" + ss + "'  download><i  class='fa fa-paperclip' style='color:#5cb85c;font-size: 16px;' ></i></a>";
							 }
                            else {
							item["action"] = "<a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block; margin-right:12px;'  onclick='getListItemByIdForUpdate(\"" + url + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + rowhide + "\");showmodal();'><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete' style='display:inline-block;margin-right: 12px;' onclick='DeleteExpenseLog(" + value.ID+ ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a><a style='display: inline-block;margin-left: 12px;' data-toggle='tooltip' data-placement='left' title='"+value.Justification+"'><i class='fa fa-commenting' style='color:#333;font-size: 16px;'></i></a>";
                              }
							  
							  if(Type_query!='' && Type_query=='new')
                             {
                              showmodal1('Add');
                             }
							 
							  
							 }
							 else
							 {
							 ////alert("no data found");
							 $("#Add_item").hide();
							 
							 }
							  
                            item["expenceid"] = i;
							item["projectpahse"] = value.TaskName;
                            item["Item"] =  Expense_item ;
                            item["status"] = value.Status;
							item["amount"] =advance + "<span style='color: #ababab;margin-left: 6px;'>"+ curr_val +"</span>";
							item["payment"] = payment_type;
                            item["expensedate"] = convert_date1;
							item["billabletoclient"] = value.BliableToClient;
                          

                            jsonObj.push(item);

                            //alert(jsonObj);



                            





                        });
						//Currency_refine(url, listname, id,curreny_amt_array);
                    }
                    else {
					
					 if(Type_query!='' && Type_query=='new')
                             {
                              showmodal1('Add');
                             }
							 
                        //table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";
                    $('.loader').hide();
					 //$("#Add_item").show();
					//$('#Expense_submit').hide();
                    }
							//document.getElementById("OpenExpenceCount").innerHTML = openstatus_count;
							//document.getElementById("SubmittedExpenceCount").innerHTML = submittedstatus_count;
							//document.getElementById("ReSubmittedExpenceCount").innerHTML = ReSubmittedExpenceCount;
							//document.getElementById("RejectedExpenceCount").innerHTML = rejectedstatus_count;
							//document.getElementById("ApprovedExpenceCount").innerHTML = approvedstatus_count;
							//document.getElementById("ReimburesedExpenceCount").innerHTML = reimburesedstatus_count;
							//document.getElementById("AllRecordCount").innerHTML = allrecord_count;


                },
                error: function (data) {
                   //  alert('f');
					  alert(data.responseJSON.error.message.value);
                    
                },
                complete: function () {
				
				
				
				$('.loader').hide();
				
				if(condition_report_status=="Open")
							{
				//alert('completed');
                    data =
                            {
                                        datatype: "json",
                                        datafields: [
                                        { name: 'action', type: '' },
                                        { name: 'expenceid', type: 'float' },
										{ name: 'projectpahse', type: 'string' },										
                                        { name: 'Item', type: 'string' },
                                        { name: 'status', type: 'string' },
										{ name: 'amount', type: 'string' },										
										{ name: 'payment', type: 'string' },
                                        { name: 'expensedate', type: 'string' },
										 { name: 'billabletoclient', type: 'string' }
										
                                       
                                        ],

                                      updaterow: function (rowid, rowdata, commit) {
                                          // synchronize with the server - send update command
                                          // call commit with parameter true if the synchronization with the server is successful 
                                          // and with parameter false if the synchronization failder.
                                          commit(true);
                                      },
									  

                                      id: 'expenceid',

                                      localdata: jsonObj,
									  
									  
                        };

                            var dataAdapter = new $.jqx.dataAdapter(data);


                            $("#jqxgrid1").jqxGrid({
                    
                                width: '100%',
                                source: dataAdapter,
                                sortable: true,
                                filterable: true,
                                filtermode: 'excel',
                                columnsresize: true,
								  autoheight:true,
								 
                                autoshowfiltericon: false,
                                            columns: [
                                     { text: 'Action', datafield: 'action', width: 110 },
                                     { text: 'Ref No', datafield: 'expenceid', width: 80 },
									{ text: 'Project Phase', datafield: 'projectpahse', width: 180 },
                                     { text: 'Item', datafield: 'Item', width: 80 },
                                     { text: 'Status', datafield: 'status', width: 180 }  ,  
									 { text: 'Amount', datafield: 'amount', width: 130 }  ,
                                     { text: 'Payment Type', datafield: 'payment', width: 180 }	,								 
                                    { text: 'Expence Date', datafield: 'expensedate', width: 180 },
									{ text: 'Billable To Client', datafield: 'billabletoclient', width: 180 }

                                                ],
												pagesize: 10, 
							pagesizeoptions: ['25', '50','100','1000']
                                     });
						 }
						 else
						 {
						 data =
                            {
                                        datatype: "json",
                                        datafields: [
                                     
                                        { name: 'expenceid', type: 'float' },
										{ name: 'projectpahse', type: 'string' },										
                                        { name: 'Item', type: 'string' },
                                        { name: 'status', type: 'string' },
										{ name: 'amount', type: 'string' },										
										{ name: 'payment', type: 'string' },
                                        { name: 'expensedate', type: 'string' },
										 { name: 'billabletoclient', type: 'string' }
										
                                       
                                        ],

                                      updaterow: function (rowid, rowdata, commit) {
                                          // synchronize with the server - send update command
                                          // call commit with parameter true if the synchronization with the server is successful 
                                          // and with parameter false if the synchronization failder.
                                          commit(true);
                                      },
									  

                                      id: 'expenceid',

                                      localdata: jsonObj,
									  
									  
                        };

                            var dataAdapter = new $.jqx.dataAdapter(data);


                            $("#jqxgrid1").jqxGrid({
                    
                                width: '100%',
                                source: dataAdapter,
                                sortable: true,
                                filterable: true,
                                filtermode: 'excel',
                                columnsresize: true,
								  autoheight:true,
								 
                                autoshowfiltericon: false,
                                            columns: [
                                    
                                     { text: 'Ref No', datafield: 'expenceid', width: 80 },
									{ text: 'Project Phase', datafield: 'projectpahse', width: 180 },
                                     { text: 'Item', datafield: 'Item', width: 80 },
                                     { text: 'Status', datafield: 'status', width: 180 }  ,  
									 { text: 'Amount', datafield: 'amount', width: 130 }  ,
                                     { text: 'Payment Type', datafield: 'payment', width: 180 }	,								 
                                    { text: 'Expence Date', datafield: 'expensedate', width: 180 },
									{ text: 'Billable To Client', datafield: 'billabletoclient', width: 180 }

                                                ],
												pagesize: 10, 
							pagesizeoptions: ['25', '50','100','1000']
                                     });
						 
						 }
                             }
                        });
						
					//	$('.loader').hide();
        }
		
		
			function Currency_refine(url, listname, id,Temp)
		{
		
		 var web_url = "https://bristleconeonline.sharepoint.com/sites/PPMUAT/";
	//alert(Temp.length);
		var temp="";
		var myString=Temp.sort();
		////alert("myString"+myString)
		//var mySplitResult = myString.split(',');
       var rowhide = "";
	   var listName="BconeExpenceLogDetail";
      var ul_div="<a class='green-btn'  id='All_Currency' onclick='check(\""+web_url+"\", \""+listName+"\",TrackingNo,this.id,\""+rowhide+"\");'  style='color:white;cursor: pointer;'>All</a>";
     for(i = 0; i < myString.length; i++){	
	   //alert(myString[i]);
	   var ss=myString[i];
	   var b=ss.split("-");
	  // alert(b[2]);
	    if(temp==b[0])
	  { 
	  }
		  else
			 { 											  
				  temp=b[0];
				// alert(b[2]);
				  var Sum_amount= GetExpenseAmtSumByCurrencyId(url, listname, id,b[2]);
				  ////alert("Sum_amount"+  Sum_amount);
														  
				 ul_div= ul_div +"<a style='color:white;cursor: pointer;' id="+b[0]+" class='blue-btn'  onclick='check(\""+web_url+"\", \""+listName+"\",TrackingNo,this.id,\""+b[2]+"\");' >"+Sum_amount+" - "+b[0]+"</a>";
													   
			  }
      }

	//  $('#refine_currency_Bind').html(ul_div);
		
		}



        function getDataByListName_Refine(url, listname, type,trackingid) {
            //alert(type);

            var EmployeeId = $('#resourse_id').text();
			
			//alert(EmployeeId);

            jsonObj = [];
            var trackingno = '';
            var title = '';

            var status = '';
            var advanceamount = '';
            var refine_status = type;

            var list_name = listname;
            var i = "0";
            var url1 = url;
            var rowhide = "";

            var Project_Name = "Project Name";
            var Pending_With = "Pending With";
            var Reimbursed_Total_Money = "Reimbursed_Total_Money";
            var Balance = "Balance";
            var fromdate = "";
            var ReportCreatedDate = "";
            var converted_date = "";

            var ModifiedDate = "";

            var openstatus_count = 0;
            var submittedstatus_count = 0;
            var approvedstatus_count = 0;
            var rejectedstatus_count = 0;
            var reimburesedstatus_count = 0;
            var ReSubmittedExpenceCount = 0;
            var curreuncyvalue = 0;
            var advance = "";
            var tooltip_date = "";
            var allrecord_count = 1;
            var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/PPMUAT/SitePages/FinanceItemDetails.aspx?TrackingNo=";
            var expenceid = '';
            var curr = '';

            var data = '';
            var comment = '';
			
			var datetooltip='datetooltip';
			
			var ReimburseCurrency='';



         //   var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">' + refine_status + '</Value></Eq><Eq><FieldRef Name="ProjectOwnerId"/><Value Type="Text" >' + EmployeeId + '</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
		 
		 <!-- if(type=='Approved') -->
		 <!-- { -->
		 <!-- var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="FinanceExpenseStatus"/><Value Type="Text" >Approved</Value></Eq><Eq><FieldRef Name="FinanceId" /><Value Type="Text">'+EmployeeId+'</Value></Eq></And> </Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>'; -->
		 <!-- } -->
		 <!-- else if(type=='Rejected') -->
		 <!-- { -->
		 <!-- var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="FinanceId" /><Value Type="Text">' + EmployeeId + '</Value></Eq><Eq><FieldRef Name="FinanceExpenseStatus"/><Value Type="Text" >Rejected</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>'; -->
		 <!-- } -->
		 <!-- else if(type=='Reimbursed') -->
		 <!-- { -->
			<!-- var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="FinanceId" /><Value Type="Text">'+EmployeeId+'</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Reimbursed</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>'; -->
		 <!-- } -->
		 
		 
				var query_cml = '<View><Query><Where><Eq><FieldRef Name="ID"/><Value Type="COUNTER">' + trackingid + '</Value></Eq></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			
			//var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="ProjectOwnerId"/><Value Type="Text">' + EmployeeId + '</Value></Eq><And><eq><FieldRef Name="ReportStatus"/><Value Type="Text">Approved</Value></eq><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Rejected</Value></Eq></Or></And></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
            //var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="ProjectOwnerId" /><Value Type="Number">' + EmployeeId + '</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Submitted</Value></Eq></And></Where></Query></View>';
			
			
			//alert(query_cml);
            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/GetItems",
                type: "POST",
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                beforeSend: function () {
                    $('.loader').show();
                },

                success: function (data) {



                    var table_tr = "";

                    var table_tr_edit = "";
                    if (data.d.results.length > 0) {







                        $.each(data.d.results, function (key, value) {
						
						ReimburseCurrency='';

							Project_Name = value.Projectname;
                            Pending_With = value.PendingWithName;
                            //alert(value.Modified);

                            allrecord_count++;
                            //alert(allrecord_count);


                            ReportCreatedDate = value.Modified;

                           // converted_date = convert_date(ReportCreatedDate);
                          //  tooltip_date = convert_date1(ReportCreatedDate);
						  
						    converted_date = convert_date_amol_tooltip(ReportCreatedDate);
						   tooltip_date = convert_date_amol(ReportCreatedDate);

                            rowhide = "rowhideslow" + i + "";

                            curreuncyvalue = "";
                            advance = "-";


                            if (value.AmountTaken != null) {
                                advance = value.AmountTaken;
                                if (advance.toString().indexOf(".")) {
                                }
                                else {
                                    advance = advance + ".00";

                                }



                            }
							
							if (value.BalanceAmount != null) {
                                Reimbursed_Total_Money = value.BalanceAmount;
                                if (Reimbursed_Total_Money.toString().indexOf(".")) {
                                }
                                else {
                                    Reimbursed_Total_Money = Reimbursed_Total_Money + ".00";

                                }



                            }

                            curreuncyvalue = value.currencytext;

                            if (curreuncyvalue == null) {
                                curreuncyvalue = "";

                            }
                            else {

                                Expenseitem = curreuncyvalue;


                                if (Expenseitem.indexOf("-")) {
                                    curr = Expenseitem.split("-");
                                    curreuncyvalue = curr[0];
                                }
                                else {
                                }

                            }
							
							
							
							 ReimburseCurrency = value.ReimburseCurrencyText;

                            //alert(curreuncyvalue);

                            if (ReimburseCurrency == null) {
                                ReimburseCurrency = "";

                            }
                            else {
							Expenseitem='';

                                Expenseitem = ReimburseCurrency;



                                if (Expenseitem.indexOf("-")) {
                                    curr = Expenseitem.split("-");
                                    ReimburseCurrency = curr[0];
                                }
                                else {
                                }

                            }
							
							
							
                            expenceid = value.ID;
                            comment = value.Comment;
							datetooltip=datetooltip+expenceid;


                            table_tr = table_tr + "<tr id=" + rowhide + "  class='deleteall" + value.ID + "' value=" + value.ID + ">";

                            table_tr = table_tr + " <td><a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block; margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete' style='display:inline-block;' onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a> </td>";

                            table_tr = table_tr + "<td>" + value.ID + "</td>";

                            table_tr = table_tr + " <td><a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a></td>";

                            table_tr = table_tr + "<td><a style='text-decoration:none;' data-toggle='tooltip' title='' data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a></td>";

                            table_tr = table_tr + " <td>" + value.ReportStatus + "</td>";

                            table_tr = table_tr + " <td>" + Project_Name + "</td>";

                            table_tr = table_tr + " <td>" + Pending_With + "</td>";

                            table_tr = table_tr + "<td>" + advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span></td>";

                            table_tr = table_tr + " <td>" + Reimbursed_Total_Money + "</td>";

                            table_tr = table_tr + " <td>" + Balance + "</td>";

                            table_tr = table_tr + "</tr>";

                        var ReimburseComment="-";
							if(value.ReimburseComment!=null && value.ReimburseComment!='')
							{
							
							ReimburseComment=value.ReimburseComment;
							}
                           var item = {}
                            //console.log(refine_status);

                            if (refine_status == 'Open') {
                                item["action"] = "<a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block; margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete' style='display:inline-block;' onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a>";
                                item["expenceid"] = expenceid;
                                item["title"] = "<a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a>";
                                //item["createddate"] = "<a style='text-decoration:none;' data-toggle='tooltip' title='' data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
								item["createddate"] = "<a id='"+datetooltip+"' class='mouseover_date' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")' style='text-decoration:none; cursor:default;'   data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
                                //item["status"] = value.ReportStatus;
                                item["projectname"] = Project_Name;

                                item["advancetaken"] ="<div style='text-align:right;'>"+ advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span></div>";

                            }
                            else if (refine_status == 'Submitted') {
                                item["action"] = "<a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block; margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update                                \"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete'                                 style='display:inline-block;' onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a>";
                                item["expenceid"] = expenceid;
                                item["title"] = "<a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a>";
                                //item["createddate"] = "<a style='text-decoration:none;' data-toggle='tooltip' title='' data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
								item["createddate"] = "<a id='"+datetooltip+"' class='mouseover_date' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")' style='text-decoration:none; cursor:default;'   data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
                                //item["status"] = value.ReportStatus;
                                item["projectname"] = Project_Name;
                                item["pendingwith"] = Pending_With;
                                // item["advancetaken"] = advance;
                                item["advancetaken"] ="<div style='text-align:right;'>"+ advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span></div>";
                                // item["reimbursedtotal"] = Reimbursed_Total_Money;
                                //item["balance"] = Balance;

                            }
                            else if (refine_status == 'ReSubmitted') {
                                item["action"] = "<a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block; margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update                                \"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete'                                 style='display:inline-block;' onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a>";
                                item["expenceid"] = expenceid;
                                item["title"] = "<a onclick='showmodal_poup(\""+value.ID+"\")' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a>";
                                //item["createddate"] = "<a style='text-decoration:none;' data-toggle='tooltip' title='' data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
								item["createddate"] = "<a id='"+datetooltip+"' class='mouseover_date' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")' style='text-decoration:none; cursor:default;'   data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
                                // item["status"] = value.ReportStatus;
                                item["projectname"] = Project_Name;
                                item["pendingwith"] = Pending_With;
                                // item["advancetaken"] = advance;
                                item["advancetaken"] ="<div style='text-align:right;'>"+ advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span></div>";
                                // item["reimbursedtotal"] = Reimbursed_Total_Money;
                                //item["balance"] = Balance;

                            }
                            else if (refine_status == 'Finance Approved') {
                                // item["action"] = "<a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block;                                 margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",                                \"update\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete'                                 style='display:inline-block;' onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a>";
                                item["expenceid"] = expenceid;
                               // item["title"] = "<a onclick='showmodal_poup(\""+value.ID+"\")' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a>";
							   item["title"] = "<a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a>";
                                //item["createddate"] = "<a style='text-decoration:none;' data-toggle='tooltip' title='' data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
								
								item["createddate"] = "<a id='"+datetooltip+"' class='mouseover_date' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")' style='text-decoration:none; cursor:default;'   data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
                                // item["status"] = value.ReportStatus;
                                item["projectname"] = Project_Name;
                                //item["pendingwith"] = Pending_With;
                                // item["advancetaken"] = advance;
                                item["advancetaken"] ="<div style='text-align:right;'>"+ advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span></div>";
                                // item["reimbursedtotal"] = Reimbursed_Total_Money;
                                // item["balance"] = Balance;
								item["submittedby"] =value.EmployeeName;
								converted_date = convert_date_amol_tooltip(value.ReportSubmittedDate);
						           tooltip_date = convert_date_amol(value.ReportSubmittedDate);
								  item["submitteddate"] = "<a id='"+datetooltip+"' class='mouseover_date' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")' style='text-decoration:none; cursor:default;'   data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
                                

                            }
                            else if (refine_status == 'Finance Rejected') {
                               // item["action"] = "<a data-toggle='tooltip' data-placement='right'  style='display:inline-block; margin-right:12px;text-decoration:none; color:#a6a6a6; ' href='javascript:void(0)' ><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right'                                  style='display:inline-block; text-decoration:none; color:#a6a6a6;' ><i class='fa fa-trash'></i></a>";
                                item["expenceid"] = expenceid;
								item["title"] = "<a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a>";
                               // item["title"] = "<a onclick='showmodal_poup(\""+value.ID+"\")' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a>";
                               // item["createddate"] = "<a style='text-decoration:none;' data-toggle='tooltip' title='' data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
							   item["createddate"] = "<a id='"+datetooltip+"' class='mouseover_date' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")' style='text-decoration:none; cursor:default;'   data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
                                //item["status"] = value.ReportStatus;
                                item["projectname"] = Project_Name;
                               // item["rejectedby"] = Pending_With;
                                //item["advancetaken"] = advance;
                                item["advancetaken"] ="<div style='text-align:right;'>"+ advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span></div>";
                                item["comment"] = comment;
                                // item["reimbursedtotal"] = Reimbursed_Total_Money;
                                // item["balance"] = Balance;
								item["submittedby"] =value.EmployeeName;
								converted_date = convert_date_amol_tooltip(value.ReportSubmittedDate);
						           tooltip_date = convert_date_amol(value.ReportSubmittedDate);
								  item["submitteddate"] = "<a id='"+datetooltip+"' class='mouseover_date' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")' style='text-decoration:none; cursor:default;'   data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
                                

                            }
                            else if (refine_status == 'Reimbursed') {
							var commnet_tooptip="ReimburseComment"+expenceid;
                                //item["action"] = "<a data-toggle='tooltip' data-placement='right'  style='display:inline-block; margin-right:12px;                                 text-decoration:none; color:#a6a6a6; ' href='javascript:void(0)' ><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right'                                  style='display:inline-block; text-decoration:none; color:#a6a6a6;' ><i class='fa fa-trash'></i></a>";
                                item["expenceid"] = expenceid;
                                item["title"] = "<a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a>";
                                //item["createddate"] = "<a style='text-decoration:none;' data-toggle='tooltip' title='' data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
								item["createddate"] = "<a id='"+datetooltip+"' class='mouseover_date' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")' style='text-decoration:none; cursor:default;'   data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
                                //item["status"] = value.ReportStatus;
                                item["projectname"] = Project_Name;
                                //item["pendingwith"] = Pending_With;
                                //item["advancetaken"] = advance;
                                item["advancetaken"] ="<div style='text-align:right;'>"+ advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span></div>";
                                //item["reimbursedtotal"] = Reimbursed_Total_Money;
								  item["reimbursedtotal"] ="<div style='text-align:right;'>"+ Reimbursed_Total_Money + " <span style='color: #ababab;margin-left: 6px;'>" + ReimburseCurrency + " </span></div>";
                               // item["balance"] = value.ReimburseComment;
                                       item["balance"] ="<div style=' white-space: nowrap;overflow: hidden;width: 90px; display: inline-block;text-overflow: ellipsis'><a style='color:black;cursor:default;text-decoration: none;' id='"+commnet_tooptip+"' onmouseover='bigImg(\"" + ReimburseComment + "\",\"" + commnet_tooptip + "\")' >"+ReimburseComment+"</a><div>";
                            item["submittedby"] =value.EmployeeName;
							converted_date = convert_date_amol_tooltip(value.ReportSubmittedDate);
						           tooltip_date = convert_date_amol(value.ReportSubmittedDate);
								  item["submitteddate"] = "<a id='"+datetooltip+"' class='mouseover_date' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")' style='text-decoration:none; cursor:default;'   data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
                                
							}

                            jsonObj.push(item);

                            //alert(jsonObj);



                            i++;





                        });
                    }
                    else {
                        table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a                         href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";

                    }



                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                    //alert('completed');
                    if (refine_status == 'Open') {
                        data =
                                {
                                    datatype: "json",
                                    datafields: [
                                    { name: 'action', type: '' },
                                    { name: 'expenceid', type: 'float' },
                                    { name: 'title', type: 'string' },
                                    { name: 'createddate', type: 'string' },
                                    //{ name: 'status', type: 'string' },
                                    { name: 'projectname', type: 'string' },
									

                                    { name: 'advancetaken', type: 'string' }


                                    ],

                                    updaterow: function (rowid, rowdata, commit) {
                                        // synchronize with the server - send update command
                                        // call commit with parameter true if the synchronization with the server is successful 
                                        // and with parameter false if the synchronization failder.
                                        commit(true);
                                    },


									
                                    id: 'expenceid',

                                    localdata: jsonObj,


                                };

                    }
                    else if (refine_status == 'Submitted') {
                        data =
                               {
                                   datatype: "json",
                                   datafields: [
                                   { name: 'action', type: '' },
                                   { name: 'expenceid', type: 'float' },
                                   { name: 'title', type: 'string' },
                                   { name: 'createddate', type: 'string' },
                                   //{ name: 'status', type: 'string' },
                                   { name: 'projectname', type: 'string' },
                                   { name: 'pendingwith', type: 'string' },
								   
                                   { name: 'advancetaken', type: 'string' }
                                  // { name: 'reimbursedtotal', type: 'string' }
                                  // { name: 'balance', type: 'string' }
                                   ],

                                   updaterow: function (rowid, rowdata, commit) {
                                       // synchronize with the server - send update command
                                       // call commit with parameter true if the synchronization with the server is successful 
                                       // and with parameter false if the synchronization failder.
                                       commit(true);
                                   },


                                   id: 'expenceid',

                                   localdata: jsonObj,


                               };
                    }
                    else if (refine_status == 'ReSubmitted') {
                        data =
                               {
                                   datatype: "json",
                                   datafields: [
                                   { name: 'action', type: '' },
                                   { name: 'expenceid', type: 'float' },
                                   { name: 'title', type: 'string' },
                                   { name: 'createddate', type: 'string' },
                                  // { name: 'status', type: 'string' },
                                   { name: 'projectname', type: 'string' },
                                   { name: 'pendingwith', type: 'string' },
                                   { name: 'advancetaken', type: 'string' }
                                  // { name: 'reimbursedtotal', type: 'string' }
                                   //{ name: 'balance', type: 'string' }
                                   ],

                                   updaterow: function (rowid, rowdata, commit) {
                                       // synchronize with the server - send update command
                                       // call commit with parameter true if the synchronization with the server is successful 
                                       // and with parameter false if the synchronization failder.
                                       commit(true);
                                   },


                                   id: 'expenceid',

                                   localdata: jsonObj,


                               };
                    }
                    else if (refine_status == 'Finance Approved') {
                        data =
                               {
                                   datatype: "json",
                                   datafields: [
                                   //{ name: 'action', type: '' },
                                   { name: 'expenceid', type: 'float' },
                                   { name: 'title', type: 'string' },
                                   { name: 'createddate', type: 'string' },
                                   //{ name: 'status', type: 'string' },
                                   { name: 'projectname', type: 'string' },
								      { name: 'submittedby', type: 'string' },
									  { name: 'submitteddate', type: 'string' },
                                   //{ name: 'pendingwith', type: 'string' },
                                   { name: 'advancetaken', type: 'string' }
                                  // { name: 'reimbursedtotal', type: 'string' },
                                 //  { name: 'balance', type: 'string' }
                                   ],

                                   updaterow: function (rowid, rowdata, commit) {
                                       // synchronize with the server - send update command
                                       // call commit with parameter true if the synchronization with the server is successful 
                                       // and with parameter false if the synchronization failder.
                                       commit(true);
                                   },


                                   id: 'expenceid',

                                   localdata: jsonObj,


                               };
                    }
                    else if (refine_status == 'Finance Rejected') {
                        data =
                               {
                                   datatype: "json",
                                   datafields: [
                                  // { name: 'action', type: '' },
                                   { name: 'expenceid', type: 'float' },
                                   { name: 'title', type: 'string' },
                                   { name: 'createddate', type: 'string' },
                                  // { name: 'status', type: 'string' },
                                   { name: 'projectname', type: 'string' },
								{ name: 'submittedby', type: 'string' },
								{ name: 'submitteddate', type: 'string' },
                                  // { name: 'rejectedby', type: 'string' },
                                   { name: 'advancetaken', type: 'string' },
                                  // { name: 'reimbursedtotal', type: 'string' },
                                  // { name: 'balance', type: 'string' }
                                   { name: 'comment', type: 'string' }
                                   ],

                                   updaterow: function (rowid, rowdata, commit) {
                                       // synchronize with the server - send update command
                                       // call commit with parameter true if the synchronization with the server is successful 
                                       // and with parameter false if the synchronization failder.
                                       commit(true);
                                   },


                                   id: 'expenceid',

                                   localdata: jsonObj,


                               };
                    }
                    else if (refine_status == 'Reimbursed') {
                        data =
                               {
                                   datatype: "json",
                                   datafields: [
                                   //{ name: 'action', type: '' },
                                   { name: 'expenceid', type: 'float' },
                                   { name: 'title', type: 'string' },
                                   { name: 'createddate', type: 'string' },
                                   //{ name: 'status', type: 'string' },
                                   { name: 'projectname', type: 'string' },
								   { name: 'submittedby', type: 'string' },
                                  // { name: 'pendingwith', type: 'string' },
                                   { name: 'advancetaken', type: 'string' },
                                   { name: 'reimbursedtotal', type: 'string' },
								   { name: 'submitteddate', type: 'string' },
                                   { name: 'balance', type: 'string' }
                                   ],

                                   updaterow: function (rowid, rowdata, commit) {
                                       // synchronize with the server - send update command
                                       // call commit with parameter true if the synchronization with the server is successful 
                                       // and with parameter false if the synchronization failder.
                                       commit(true);
                                   },


                                   id: 'expenceid',

                                   localdata: jsonObj,


                               };
                    }





                    var dataAdapter = new $.jqx.dataAdapter(data);

                    if (refine_status == 'Open') {
                        $("#jqxgrid").jqxGrid({

                            width: '100%',
                            source: dataAdapter,
                            sortable: true,
                            filterable: true,
                            filtermode: 'excel',
                            columnsresize: true,
                            pageable: true,
                            autoheight: true,
							autoshowfiltericon: false,
						enablemousewheel:false,
						autorowheight: true,

                            autoshowfiltericon: false,
                            columns: [
                     { text: 'Action', datafield: 'action', width: "10%" },
                     { text: 'Tracking No', datafield: 'expenceid', width: "10%" },
                     { text: 'Title', datafield: 'title', width: "30%" },
                     { text: 'Date Created', datafield: 'createddate', width: "10%" },
                    // { text: 'Status', datafield: 'status', width: 160 },
                     { text: 'Project Name', datafield: 'projectname', width: "40%" },

                     //{ text: 'Advance Amount', datafield: 'advancetaken', width: 218 }


                            ],
                            pagesize: 10,
                            pagesizeoptions: ['25', '50', '100', '1000']
                        });

                    }
                    else if (refine_status == 'Submitted') {
                        $("#jqxgrid").jqxGrid({

                            width: '100%',
                            source: dataAdapter,
                            sortable: true,
                            filterable: true,
                            filtermode: 'excel',
                            columnsresize: true,
                            pageable: true,
                            autoheight: true,
                            autoshowfiltericon: false,
							enablemousewheel:false,
						autorowheight: true,
                            columns: [
                     { text: 'Action', datafield: 'action', width: "10%" },
                     { text: 'Tracking No', datafield: 'expenceid', width: "10%" },
                     { text: 'Title', datafield: 'title', width: "20%" },
                     { text: 'Date Created', datafield: 'createddate', width: "10%" },
                    // { text: 'Status', datafield: 'status', width: 120 },
                     { text: 'Project Name', datafield: 'projectname', width: "30%" },
                     { text: 'Pending With', datafield: 'pendingwith', width: "20%" },
                   //  { text: 'Advance Amount', datafield: 'advancetaken', width: 168 }
                    // { text: 'Reimbursed Total', datafield: 'reimbursedtotal', width: 120 }
                    // { text: 'Balance', datafield: 'balance', width: 120 }

                            ],
                            pagesize: 10,
                            pagesizeoptions: ['25', '50', '100', '1000']
                        });
                    }
                    else if (refine_status == 'ReSubmitted') {
                        $("#jqxgrid").jqxGrid({

                            width: '100%',
                            source: dataAdapter,
                            sortable: true,
                            filterable: true,
                            filtermode: 'excel',
                            columnsresize: true,
                            pageable: true,
                            autoheight: true,
                            autoshowfiltericon: false,
							enablemousewheel:false,
						autorowheight: true,
                            columns: [
                     { text: 'Action', datafield: 'action', width: 80 },
                     { text: 'Tracking No', datafield: 'expenceid', width: 150 },
                     { text: 'Title', datafield: 'title', width: 280 },
                     { text: 'Date Created', datafield: 'createddate', width: 140 },
                    // { text: 'Status', datafield: 'status', width: 120 },
                     { text: 'Project Name', datafield: 'projectname', width: 140 },
                     { text: 'Pending With', datafield: 'pendingwith', width: 150 },
                     { text: 'Advance Amount', datafield: 'advancetaken', width: 168 }
                    // { text: 'Reimbursed Total', datafield: 'reimbursedtotal', width: 120 }
                     //{ text: 'Balance', datafield: 'balance', width: 120 }

                            ],
                            pagesize: 10,
                            pagesizeoptions: ['25', '50', '100', '1000']
                        });
                    }
                    else if (refine_status == 'Finance Approved') {
                        $("#jqxgrid").jqxGrid({

                            width: '100%',
                            source: dataAdapter,
                            sortable: true,
                            filterable: true,
                            filtermode: 'excel',
                            columnsresize: true,
                            pageable: true,
                            autoheight: true,
                            autoshowfiltericon: false,
							enablemousewheel:false,
						autorowheight: true,
                            columns: [
                     //{ text: 'Action', datafield: 'action', width: 100 },
                     { text: 'Tracking No', datafield: 'expenceid', width: "10%" },
                     { text: 'Title', datafield: 'title', width: "20%" },
					 { text: 'Project Name', datafield: 'projectname', width: "30%" },
					 
					  { text: 'Submitted By', datafield: 'submittedby', width: "20%" },
					  { text: 'Date Submitted', datafield: 'submitteddate', width: "10%" },
					//{ text: 'Advance Amount', datafield: 'advancetaken', width: "10%" },
                     { text: 'Date Approved ', datafield: 'createddate', width: "10%" }
                     //{ text: 'Status', datafield: 'status', width: 120 },
                   
                     //{ text: 'Pending With', datafield: 'pendingwith', width: 134 },
                    
                     //{ text: 'Reimbursed Total', datafield: 'reimbursedtotal', width: 120 },
                    // { text: 'Balance', datafield: 'balance', width: 120 }

                            ],
                            pagesize: 10,
                            pagesizeoptions: ['25', '50', '100', '1000']
                        });
                    }
                    else if (refine_status == 'Finance Rejected') {
                        $("#jqxgrid").jqxGrid({

                            width: '100%',
                            source: dataAdapter,
                            sortable: true,
                            filterable: true,
                            filtermode: 'excel',
                            columnsresize: true,
                            pageable: true,
                            autoheight: true,
                            autoshowfiltericon: false,
							enablemousewheel:false,
						autorowheight: true,
                            columns: [
                    // { text: 'Action', datafield: 'action', width: 80 },
                     { text: 'Tracking No', datafield: 'expenceid', width: "10%" },
                     { text: 'Title', datafield: 'title', width: "10%" },
					{ text: 'Project Name', datafield: 'projectname', width: "20%" },
					
					 { text: 'Submitted By', datafield: 'submittedby', width: "20%" },
					 { text: 'Date Submitted', datafield: 'submitteddate', width: "10%" },
					 //{ text: 'Advance Amount', datafield: 'advancetaken', width: 120 },
                     { text: 'Date Rejected', datafield: 'createddate', width: "10%" },
                    // { text: 'Status', datafield: 'status', width: 120 },
                   
                   //  { text: 'Pending With', datafield: 'rejectedby', width: 150 },
                  
                    // { text: 'Reimbursed Total', datafield: 'reimbursedtotal', width: 120 },
                   //  { text: 'Balance', datafield: 'balance', width: 120 }
                   { text: 'Rejection Comment', datafield: 'comment', width: "20%" }

                            ],
                            pagesize: 10,
                            pagesizeoptions: ['25', '50', '100', '1000']
                        });
                    }
                    else if (refine_status == 'Reimbursed') {
                        $("#jqxgrid").jqxGrid({

                            width: '100%',
                            source: dataAdapter,
                            sortable: true,
                            autoheight: true,
                            filterable: true,
                            filtermode: 'excel',
                            columnsresize: true,
                            pageable: true,

                            autoshowfiltericon: false,
							enablemousewheel:false,
						autorowheight: true,
                            columns: [
                    // { text: 'Action', datafield: 'action', width: 80 },
                     { text: 'Tracking No', datafield: 'expenceid', width: "10%" },
                     { text: 'Title', datafield: 'title', width: "10%" },
					  { text: 'Project Name', datafield: 'projectname', width: "20%" },
					  //{ text: 'Date Submitted', datafield: 'submitteddate', width: "10%" },
                     { text: 'Submitted By', datafield: 'submittedby', width: "10%" },
					 { text: 'Date Submitted', datafield: 'submitteddate', width: "10%" },
                    // { text: 'Status', datafield: 'status', width: 120 },
                    
                     //{ text: 'Pending With', datafield: 'pendingwith', width: 140 },
                     //{ text: 'Advance Amount', datafield: 'advancetaken', width: 150 },
                     { text: 'Reimbursed Total', datafield: 'reimbursedtotal', width: "10%" },
					 { text: 'Date Reimbursed', datafield: 'createddate', width: "10%" },
                     { text: 'Reimbursed Comment', datafield: 'balance', width: "20%" }

                            ],
                            pagesize: 10,
                            pagesizeoptions: ['25', '50', '100', '1000']
                        });
                    }


                    $('.loader').hide();
                }
            });
        }




        function getDataByListName1(url, listname, type) {

            // alert('called');
            //$('.loader').show();

            //alert(listname);
            // var viewflds = '<ViewFields><FieldRef Name="Title"/><FieldRef Name="Status"/><FieldRef Name="Id"/></ViewFields>';

            // var qry = '<Query><Where><Eq><FieldRef Name="Title" /><Value Type="Text">test1</Value></Eq></Where></Query>';


            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/items?$top=10000",
                method: "GET",
                async: false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                beforeSend: function () {
                    // alert('before send called');
                    // destroyjs();
                },
                success: function (data) {

                    ////alert("got data on page load event");

                    // Console.log(data.d.results);

                    var table_tr = "";

                    var table_tr_edit = "";
                    if (data.d.results.length > 0) {

                        //alert(data.d.results.length);

                        document.getElementById("totalrecord").value = data.d.results.length;
                        if (document.getElementById("totalrecord").value > 0) {
                            //$("#deletediv").show();
                        }

                        var list_name = listname;
                        var i = "0";
                        var url1 = url;
                        var rowhide = "";

                        var Project_Name = "Project Name";
                        var Pending_With = "Pending With";
                        var Reimbursed_Total_Money = "Reimbursed_Total_Money";
                        var Balance = "Balance";
                        var fromdate = "";
                        var ReportCreatedDate = "";
                        var converted_date = "";

                        var ModifiedDate = "";

                        var openstatus_count = 0;
                        var submittedstatus_count = 0;
                        var approvedstatus_count = 0;
                        var rejectedstatus_count = 0;
                        var reimburesedstatus_count = 0;
                        var ReSubmittedExpenceCount = 0;
                        var curreuncyvalue = "";
                        var advance = "";
                        var tooltip_date = "";
                        var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/PPMUAT/SitePages/ExpenseItemDetail.aspx?TrackingNo=";








                        $.each(data.d.results, function (key, value) {

                            //alert(value.Modified);

                            if (value.ReportStatus == "Open") {
                                openstatus_count++;
                            }

                            if (value.ReportStatus == "Submitted") {
                                submittedstatus_count++;
                            }

                            if (value.ReportStatus == "Rejected") {
                                rejectedstatus_count++;
                            }

                            if (value.ReportStatus == "Approved") {
                                approvedstatus_count++;
                            }

                            if (value.ReportStatus == "Reimbursed") {
                                reimburesedstatus_count++;
                            }
                            if (value.ReportStatus == "ReSubmitted") {
                                ReSubmittedExpenceCount++;
                            }


                            //ReportCreatedDate = new Date(value.Modified);

                            ReportCreatedDate = value.Modified;


                            //converted_date = ReportCreatedDate;
                            converted_date = convert_date(ReportCreatedDate);
                            tooltip_date = convert_date1(ReportCreatedDate);
                            //var date = new Date();
                            //  updated_date = fromdate.yyyymmdd();

                            //alert('updated_date' + updated_date);

                            //alert('fromdate:' + fromdate);
                            // var dd = fromdate.getDate();
                            //	alert('dd: '+ dd);
                            //  var mm = fromdate.getMonth() + 1; //January is 0!
                            //alert('mm: '+ mm);
                            //  var yyyy = fromdate.getFullYear();
                            //	alert('yyyy: '+ yyyy);

                            //  var updated_date = (fromdate.getMonth() + 1) + '-' + fromdate.getDate() + '-' + fromdate.getFullYear();

                            //  var updated_date = value.CalRepCreatedDate;

                            rowhide = "rowhideslow" + i + "";

                            //tr_edit = "row_edit" + i + "";

                            //alert(value.Currency_x003a_ID);

                            curreuncyvalue = "";
                            advance = "-";
                            //alert(value.AmountTaken);

                            if (value.AmountTaken != null) {
                                advance = value.AmountTaken;
                                if (advance.toString().indexOf(".")) {
                                }
                                else {
                                    advance = advance + ".00";

                                }



                            }

                            curreuncyvalue = value.currencytext;

                            if (curreuncyvalue == null) {
                                curreuncyvalue = "";
                                //alert(value.ID);

                            }
                            else {
                                //alert('value.CurrencyId'+ value.CurrencyId);

                                //curreuncyvalue = getcurrencyValueById(current_url, 'BconeCurrency', value.CurrencyId);


                                Expenseitem = curreuncyvalue;

                                // alert(Expenseitem);
                                if (Expenseitem.indexOf("-")) {
                                    var curr = Expenseitem.split("-");
                                    //alert(curr[0]);
                                    curreuncyvalue = curr[0];

                                }
                                else {

                                    //document.getElementById("currencyspan").innerHTML = Expenseitem;

                                }

                            }


                            //alert(Expenseitem);






                            //alert('currency id: ' + value.CurrencyId);
                            // alert('currency name: ' + value.curr);

                            //curreuncyvalue = getcurrencyValueById(current_url, 'BconeCurrency', value.CurrencyId);
                            //alert(curreuncyvalue);

                            //alert(ss);
                            var expenceid = value.ID;

                            table_tr = table_tr + "<tr id=" + rowhide + "  class='deleteall" + value.ID + "' value=" + value.ID + ">";

                            table_tr = table_tr + " <td><a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block;                             margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",                            \"update\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete'                             style='display:inline-block;' onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a> </td>";


                            //table_tr = table_tr + "<td><input type='checkbox' id='record" + i + "' name='record" + i + "'  value=" + value.ID + "                              /></td>";

                            // alert(value.attchment);
                            table_tr = table_tr + "<td>" + value.ID + "</td>";

                            table_tr = table_tr + " <td><a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a></td>";

                            //table_tr = table_tr + " <td><a href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name +                             "\",\"" + value.ID + "\",\"" + i + "\",\"update\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a></td>";

                            //table_tr = table_tr + "<td><div class=tooltip'><span class='tooltiptext'>" + tooltip_date + "</span></div></td>";

                            table_tr = table_tr + "<td><a data-toggle='tooltip' title='' data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a></td>";

                            //if (value.ReportStatus != 'Submitted') {
                            table_tr = table_tr + " <td>" + value.ReportStatus + "</td>";
                            //}
                            //else {
                            //    table_tr = table_tr + " <td>hmm</td>";
                            // }



                            table_tr = table_tr + " <td>" + Project_Name + "</td>";

                            table_tr = table_tr + " <td>" + Pending_With + "</td>";

                            table_tr = table_tr + "<td>" + advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span></td>";

                            table_tr = table_tr + " <td>" + Reimbursed_Total_Money + "</td>";

                            table_tr = table_tr + " <td>" + Balance + "</td>";


                            //  table_tr = table_tr + "<td>" + curreuncyvalue + "</td>";



                            // if (value.ReportStatus != 'Submitted') {
                            //table_tr = table_tr + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-                            trash'></i></a></td>";
                            //}
                            //else {
                            // table_tr = table_tr + " <td><i class='fa fa-check-circle' aria-hidden='true'></i></td>";
                            //}




                            table_tr = table_tr + "</tr>";


                            //amol coding




                            // table_tr_edit = table_tr_edit + "<tr id=" + tr_edit + " class='deleteall" + value.ID + "' value=" + value.ID + "                             style='display:'block';' >";

                            // table_tr_edit = table_tr_edit + "<td><input type='checkbox' id='record" + i + "' name='record" + i + "'  value=" +                             value.ID + "  /></td>";

                            // alert(value.attchment);
                            //table_tr_edit = table_tr_edit + "<td>" + value.ID + "</td>";

                            // table_tr_edit = table_tr_edit + " <td><input type='text' id='ExpenseReportName" + i + "' value=" +                             value.ExpenseReportName + "/></td>";
                            // table_tr_edit = table_tr_edit + "<td><input type='text' id='Description" + i + "' value=" + value.Description + "                             /></td>";
                            // table_tr_edit = table_tr_edit + "<td><select id='curreuncyvalue" + i + "'></select></td>";
                            // table_tr_edit = table_tr_edit + "<td><input type='text' id='AmountTaken" + i + "' value=" + value.AmountTaken + "                             /></td>";
                            // table_tr_edit = table_tr_edit + "<td><input type='text' id='ReportCreatedDate" + i + "' value=" +                             value.ReportCreatedDate + " /></td>";
                            // table_tr_edit = table_tr_edit + " <td>" + value.ReportStatus + "</td>";
                            // table_tr_edit = table_tr_edit + " <td><a href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" +                             list_name + "\",\"" + value.ID + "\",\"" + i + "\");  '><i class='fa fa-pencil'></i></a></td>";
                            // table_tr_edit = table_tr_edit + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa                             fa-trash'></i></a></td>";



                            // table_tr_edit = table_tr_edit + "</tr>";

                            i++;


                        });
                    }
                    else {
                        //alert(data.d.results.length);

                        table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a                         href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";

                    }

                    document.getElementById("OpenExpenceCount").innerHTML = openstatus_count;
                    document.getElementById("SubmittedExpenceCount").innerHTML = submittedstatus_count;
                    document.getElementById("RejectedExpenceCount").innerHTML = rejectedstatus_count;
                    document.getElementById("ApprovedExpenceCount").innerHTML = approvedstatus_count;
                    document.getElementById("ReimburesedExpenceCount").innerHTML = reimburesedstatus_count;
                    // alert(table_tr);
                    $('#student_data').append(table_tr);

                    //  $('#student_data').append(table_tr_edit);

                    // $('.loader').hide();


                    //alert(table_tr);


                    console.log(data.d);


                },
                error: function (data) {

                    // alert(JSON.stringify(error));

                },
                complete: function () {
                    // alert('complete called');
                    if (type == 'refine') {
                        // load_datatable_js();
                    }
                }
            });
        }

        function getCurrencyListData(url, listname) {
            ////alert("gfhkltnyklhmdtykhtkh");
            ////alert("getListItem1");
            ////alert("show();");
            //$('.loader').show();

            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/items",
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                success: function (data) {




                    $.each(data.d.results, function (key, value) {

                        var class1 = "";
                        // alert(value.ID);
                        // alert(value.Currency);
                        $("#currency").append($("<option></option>").val(value.ID).html(value.Currency));

                    });
                    //loginuser();



                },
                error: function (data) {
                    failure(data);
                }
            });
        }


        var pathname = window.location.pathname; // Returns path only
        var current_url = window.location.href;  //Return full url

        current_url = current_url.substring(0, current_url.lastIndexOf('/') - 9); // current url changes to specific path.

        // getDataByListName(current_url, 'BconeExpenceMaster', 'load1');  //getting data by ListName on page load
        getCurrencyListData(current_url, 'BconeCurrency');


        //load_datatable_js();
        // getDataByStatus('Open', '');
        //  getDataByStatus('Submitted', '');
        // getDataByStatus('Rejected', '');
        //getDataByStatus('Approved', '');
        // getDataByStatus('Reimbursed', '');

        function clear_tbody() {
            //alert('clear tbody called');
            $("#student_data").html("");
            //$("#student_datatable > thead").html("");
            $("#student_datatable tbody tr").remove();
            // alert('after clear');
        }

        function refine_status1(status_name, id) {


            $('.pull-right').find('a').each(function () {

                $(this).removeClass('green-btn').addClass('blue-btn');


            })

            var a = $('#' + id).hasClass('blue-btn');


            a ? $('#' + id).removeClass('blue-btn').addClass('green-btn') : $('#' + id).removeClass('blue-btn').addClass('green-btn');

            $('#' + id).css('color', '#fff');


            $('.loader').show();


            //setTimeout(function(){
            destroyjs();
            //},2000);






            setTimeout(function () {

                getDataByListName1(current_url, 'BconeExpenceMaster', 'refine');
                update_refine(status_name);

            }, 2000);

            //setTimeout(function () {
            // alert('called');
            // $('#student_datatable').DataTable();

            //}, 1000);

            // $('#student_datatable').DataTable();

            //if (update_refine()) {
            //alert('return from update refine');
            // load_datatable_js();
            // }


            setTimeout(function () {
                //load_datatable_js();
                $('.loader').hide();
                load_datatable_js();
            }, 5000)


            // $('.loader').show();

        }


        function refine_status_old(inputVal, id) {
            //alert(inputVal);
            //var table = $('#student_datatable');
            var table = $('#student_datatable').DataTable();

            // #column3_search is a <input type="text"> element
            if (inputVal != '') {
                table
                    .columns(4)
                    .search("^" + inputVal + "$", true, false, true)
                    .draw();
            }
            else {
                table
                .columns(4)
                .search(inputVal)
                .draw();
            }

            $('.pull-right').find('a').each(function () {

                $(this).removeClass('green-btn').addClass('blue-btn');


            })

            var a = $('#' + id).hasClass('blue-btn');


            a ? $('#' + id).removeClass('blue-btn').addClass('green-btn') : $('#' + id).removeClass('blue-btn').addClass('green-btn');

            $('#' + id).css('color', '#fff');



        }

        function refine_status(inputVal, id) {

            $( "#NodataDiv" ).empty();
            $('.pull-right').find('a').each(function () {

                $(this).removeClass('green-btn').addClass('blue-btn');


            })

            var a = $('#' + id).hasClass('blue-btn');


            a ? $('#' + id).removeClass('blue-btn').addClass('green-btn') : $('#' + id).removeClass('blue-btn').addClass('green-btn');

            $('#' + id).css('color', '#fff');

            var EmployeeId = $('#resourse_id').text();


            cleardata();
            if (inputVal != '') {
                //getDataByListName_Refine(current_url, 'BconeExpenceMaster', inputVal);
				GetDataFrmLog_Refine(current_url, 'BconeExpenceMaster', inputVal,EmployeeId);
            }
            else {

                getDataByListName(current_url, 'BconeExpenceMaster', 'load1', EmployeeId);

            }
        }

        function update_refine(status_name) {
            var status = '';
            //alert(status_name);
            //alert(('#student_data').html());

            if (status_name.toString().toLowerCase() != 'allrecord') {

                $('#student_data > tr').each(function (key, value) {

                    //alert('main ids: '+this.id);

                    status = $(this).closest('tr').find('td:eq(4)').text().toLowerCase();
                    //alert(status);

                    if (status_name.toLowerCase() == status) {

                        //alert(status_name);
                        //$(this).css('display', 'block');
                        // $(this).addClass('displayblock');
                        // $(this).show();
                        // alert(this.id);

                    }
                    else {
                        //alert('not loaded');
                        $(this).remove();
                    }









                });
            }
            else {
                //alert('aaal');
            }

            return true;


        }


        function getListItemById(url, listname, id, i, type) {

            $('#edit_id').text(id);
            $('#tr_editid').text(i);
            var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/PPMUAT/SitePages/ExpenseItemDetail.aspx?TrackingNo=";


            // alert(type);

            var table_tr_edit = "";

            $('.loader').show();


            // $('#rowhideslow' + i).html('');

            var rowhide = "rowhideslow" + i + "";

            var Project_Name = "Project Name";
            var Pending_With = "Pending With";
            var Reimbursed_Total_Money = "Reimbursed_Total_Money";
            var Balance = "Balance";
            var fromdate = "";


            var ReportCreatedDate = "";
            var converted_date = "";




            // Getting our list items
            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/items(" + id + ")",
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                success: function (data) {
                    //alert(data);
                    console.log(data);
                    $.each(data, function (key, value) {



                        // var fromdate = new Date(value.ReportCreatedDate);

                        //alert('fromdate:' + fromdate);
                        // var dd = fromdate.getDate();
                        //	alert('dd: '+ dd);
                        //var mm = fromdate.getMonth() + 1; //January is 0!
                        //alert('mm: '+ mm);
                        //var yyyy = fromdate.getFullYear();
                        //	alert('yyyy: '+ yyyy);

                        //var updated_date = (fromdate.getMonth() + 1) + '-' + fromdate.getDate() + '-' + fromdate.getFullYear();

                        // var updated_date = value.CalRepCreatedDate;

                        // ReportCreatedDate = new Date(value.ReportCreatedDate);
                        // ReportCreatedDate = new Date(value.Modified);
                        ReportCreatedDate = value.Modified;
                        converted_date = convert_date(ReportCreatedDate);


                        if (type == 'update') {

                            $('#add_tr').hide();
                            $('#update_tr').show();


                            //  alert('ReportCreatedDate :' + value.ReportCreatedDate);
                            // alert('Parse ReportCreatedDate :' + value.ReportCreatedDate.toISOString());

                            // var strDate = value.ReportCreatedDate;
                            // var dateParts = strDate.split(".");

                            // var date = new Date(dateParts[2], (dateParts[1] - 1), dateParts[0]);

                            // alert('Parse ReportCreatedDate :' + date);



                            //alert('updated_date :'+ updated_date);



                            //  $("#currency").prop("selectedItem", 1);

                            //$("#currency").attr('selectedIndex', 1);

                            //$( "#currency option:selected" ).text(value.CurrencyId);

                            //  $("#currency1 option:selected").text('INR');


                            var element = document.getElementById('currency');
                            element.value = value.CurrencyId;



                            var ddlProjects = document.getElementById('ddlProjects');

                            //alert(ddlProjects + ' ' + value.ProjectId);

                            if (value.ProjectId != null) {
                                ddlProjects.value = value.ProjectId;

                                //$("#ddlProjects").change();

                                setProjectManager('ddlProjects');


                            }
                            else {

                                $('#txtProManager').val('');

                            }

                            $('#Txtexpensereport').val(value.ExpenseReportName);
                            $('#TxtDescription').val(value.Description);

                            // $('#currency').val(value.Currency);
                            // $("#currency option:selected").val(value.CurrencyId);

                            $('#TxtDate').val(converted_date);
                            //alert(value.AmountTaken);
                            if (value.AmountTaken > 0) {

                                var curreuncyvalue = getcurrencyValueById(current_url, 'BconeCurrency', value.CurrencyId);
                                // alert(curreuncyvalue);

                                hideerror1('currency');


                                advance = value.AmountTaken;
                                if (advance.toString().indexOf(".")) {
                                }
                                else {
                                    advance = advance + ".00";

                                }

                                //  $('#currencyspan').text(curreuncyvalue);


                                // alert('inside');
                                $('#Txtamttaken').val(advance);

                                $("input[name=advance][value=Yes]").prop('checked', 'checked');

                                $("#Txtamttaken").attr("readonly", false);

                                $('#currency_validation_star').show();
                                $('#amount_validation_star').show();

                            }
                            else {
                                $("input[name=advance][value=No]").prop('checked', 'checked');
                                $("#Txtamttaken").attr("readonly", true);
                                $("select#currency").prop('selectedIndex', 0);

                                $('#currency').attr("disabled", true);


                            }



                            // $('#filename').text(value.attchment);


                            // table_tr_edit = table_tr_edit + "<tr id=" + tr_edit + " class='deleteall" + id + "' value=" + id + " >";

                            // table_tr_edit = table_tr_edit + "<td><input type='checkbox' id='record" + i + "' name='record" + i + "'  value=" + id                             + "  /></td>";

                            // alert(value.attchment);
                            // table_tr_edit = table_tr_edit + "<td>" + id + "</td>";

                            // table_tr_edit = table_tr_edit + " <td><input type='text' id='ExpenseReportName" + i + "' value=" +                             value.ExpenseReportName + " /></td>";
                            //table_tr_edit = table_tr_edit + "<td><input type='text' id='Description" + i + "' value=" + value.Description + "                             /></td>";
                            // table_tr_edit = table_tr_edit + "<td><select id='curreuncyvalue" + i + "'><option>select</option></select></td>";
                            // table_tr_edit = table_tr_edit + "<td><input type='text' id='AmountTaken" + i + "' value=" + value.AmountTaken + "                             /></td>";
                            // table_tr_edit = table_tr_edit + "<td><input type='text' id='ReportCreatedDate" + i + "' value=" + updated_date + "                             /></td>";
                            // table_tr_edit = table_tr_edit + " <td>" + value.status + "</td>";
                            // table_tr_edit = table_tr_edit + " <td><a href='javascript:void(0)' onclick='updateListItem_Inline(\"" + url + "\",\""                             + listname + "\",\"" + value.ID + "\",\"" + i + "\",\"updated\")';>Update</a><hr/><a href='javascript:void(0)' onclick='getListItemById(\"" + url +                             "\",\"" + listname + "\",\"" + value.ID + "\",\"" + i + "\",\"cancel\")';>Cancel</a></td>";
                            // table_tr_edit = table_tr_edit + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa                             fa-trash'></i></a></td>";
                            // table_tr_edit = table_tr_edit + "</tr>";

                            // alert(table_tr_edit);

                            // $('#rowhideslow' + i).html(table_tr_edit);

                            //   getCurrencyDataUpdate(current_url, 'BconeCurrency', i, value.CurrencyId);


                        }
                        else if (type == 'cancel') {

                            var curreuncyvalue = getcurrencyValueById('https://e2eprojects.sharepoint.com/sites/pwa/', 'BconeCurrency', value.CurrencyId);


                            table_tr_edit = table_tr_edit + "<td><input type='checkbox' id='record" + i + "' name='record" + i + "'  value=" + value.ID + "  /></td>";

                            // alert(value.attchment);
                            table_tr_edit = table_tr_edit + "<td>" + value.ID + "</td>";

                            table_tr_edit = table_tr_edit + " <td><a href='javascript:void(0)' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a></td>";
                            table_tr_edit = table_tr_edit + "<td>" + value.Description + "</td>";
                            table_tr_edit = table_tr_edit + "<td>" + curreuncyvalue + "</td>";
                            table_tr_edit = table_tr_edit + "<td>" + value.AmountTaken + "</td>";
                            table_tr_edit = table_tr_edit + "<td>" + updated_date + "</td>";
                            table_tr_edit = table_tr_edit + " <td>" + value.status + "</td>";
                            table_tr_edit = table_tr_edit + " <td><a href='javascript:void(0)' onclick='getListItemById(\"" + url + "\",\"" + listname + "\",\"" + value.ID + "\",\"" + i + "\",\"update\")';><i class='fa fa-pencil'></i></a></td>";
                            table_tr_edit = table_tr_edit + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-                            trash'></i></a></td>";

                            $('#rowhideslow' + i).html(table_tr_edit);





                        }

                        else if (type == 'updated') {



                            //old coding to update single record 

                            //ReportCreatedDate = new Date(value.ReportCreatedDate);
                            //converted_date = convert_date(ReportCreatedDate);

                            //var curreuncyvalue = getcurrencyValueById(current_url, 'BconeCurrency', value.CurrencyId);
                            //table_tr_edit = table_tr_edit + "<td>" + value.ID + "</td>";

                            //table_tr_edit = table_tr_edit + " <td><a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;'>"                             + value.ExpenseReportName + "</a></td>";

                            //table_tr_edit = table_tr_edit + " <td><a href='javascript:void(0)' onclick='getListItemById(\"" + url + "\",\"" +                             listname + "\",\"" + value.ID + "\",\"" + i + "\",\"update\"); showmodal1(); ';><i class='fa fa-pencil'></i></a></td>";

                            //table_tr_edit = table_tr_edit + "<td>" + converted_date + "</td>";

                            //table_tr_edit = table_tr_edit + " <td>" + value.ReportStatus + "</td>";

                            // table_tr_edit = table_tr_edit + " <td>" + Project_Name + "</td>";

                            //table_tr_edit = table_tr_edit + " <td>" + Pending_With + "</td>";

                            //table_tr_edit = table_tr_edit + "<td>" + value.AmountTaken + "</td>";

                            //table_tr_edit = table_tr_edit + " <td>" + Reimbursed_Total_Money + "</td>";

                            // table_tr_edit = table_tr_edit + " <td>" + Balance + "</td>";


                            //table_tr_edit = table_tr_edit + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa                             fa-trash'></i></a></td>";


                            //$('#rowhideslow' + i).html(table_tr_edit);


                            //New code to bind all record 

                            destroyjs();
                            getDataByListName(current_url, 'BconeExpenceMaster');







                        }

                        else if (type == 'added') {



                            ReportCreatedDate = new Date(value.ReportCreatedDate);
                            converted_date = convert_date(ReportCreatedDate);

                            var curreuncyvalue = getcurrencyValueById(current_url, 'BconeCurrency', value.CurrencyId);

                            table_tr_edit = table_tr_edit + "<tr id=" + rowhide + "  class='deleteall" + value.ID + "' value=" + value.ID + ">";

                            table_tr_edit = table_tr_edit + "<td>" + value.ID + "</td>";

                            table_tr_edit = table_tr_edit + " <td><a href='javascript:void(0)' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a></td>";

                            table_tr_edit = table_tr_edit + " <td><a href='javascript:void(0)' onclick='getListItemById(\"" + url + "\",\"" + listname + "\",\"" + value.ID + "\",\"" + i + "\",\"update\"); showmodal1(); ';><i class='fa fa-pencil'></i></a></td>";

                            table_tr_edit = table_tr_edit + "<td>" + converted_date + "</td>";

                            table_tr_edit = table_tr_edit + " <td>" + value.ReportStatus + "</td>";

                            table_tr_edit = table_tr_edit + " <td>" + Project_Name + "</td>";

                            table_tr_edit = table_tr_edit + " <td>" + Pending_With + "</td>";

                            table_tr_edit = table_tr_edit + "<td>" + value.AmountTaken + "</td>";

                            table_tr_edit = table_tr_edit + " <td>" + Reimbursed_Total_Money + "</td>";

                            table_tr_edit = table_tr_edit + " <td>" + Balance + "</td>";


                            table_tr_edit = table_tr_edit + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-                            trash'></i></a></td>";

                            table_tr_edit = table_tr_edit + "</tr>";



                            //$('#rowhideslow' + i).html(table_tr_edit);

                            $('#student_data').append(table_tr_edit);


                        }




                        $('.loader').hide();




                    });
                    // Returning the results
                    // complete(data);
                },
                error: function (data) {
                    //failure(data);
                }

            });
        }

        function convert_date(date_to_convert) {


            //2016-10-06T11:32:46


            var arr_date = date_to_convert.split('T');
            var updated_date = arr_date[0] + " " + arr_date[1];

            var m_names = new Array("Jan", "Feb", "Mar",
                        "Apr", "May", "Jun", "Jul", "Aug", "Sep",
                        "Oct", "Nov", "Dec");

            //var d = new Date(date_to_convert).toISOString();
            var d = new Date(updated_date);
            //var d =  Date.parse(date_to_convert);
            // d = date_to_convert;
            var curr_date = d.getDate();
            var curr_month = d.getMonth();
            var curr_year = d.getFullYear();
            var suffix = "";


            //hours minute and seconds add here



            var curr_hours = d.getHours();


            suffix = (curr_hours >= 12) ? 'PM' : 'AM';

            if (curr_hours > 12) {
                curr_hours -= 12;
            }

            //alert(suffix);

            var curr_min = d.getMinutes();

            if (curr_min < 10) {
                curr_min = "0" + curr_min;
            }


            var curr_seconds = d.getSeconds();

            var converted_date = curr_date + "-" + m_names[curr_month] + "-" + curr_year + " " + curr_hours + ":" + curr_min + " " + suffix;

            return converted_date;

        }

        function convert_date1(date_to_convert) {
            //alert(convert_date1);

            var arr_date = date_to_convert.split('T');
            var updated_date = arr_date[0] + " " + arr_date[1];


            var m_names = new Array("Jan", "Feb", "Mar",
                        "Apr", "May", "Jun", "Jul", "Aug", "Sep",
                        "Oct", "Nov", "Dec");

            // var d = new Date(date_to_convert).toISOString();
            //  var d = new Date("2016-06-10 02:03:05");

            var d = new Date(updated_date);

            //d = date_to_convert;
            // var d = Date.parse(date_to_convert);

            var curr_date = d.getDate();
            var curr_month = d.getMonth();
            var curr_year = d.getFullYear();

            //hours minute and seconds add here

            // var curr_hours = d.getHours();
            // var curr_min = d.getMinutes();
            // var curr_seconds = d.getSeconds();

            var converted_date = curr_date + "-" + m_names[curr_month] + "-" + curr_year;

            return converted_date;

        }


        function getDataByStatus(ReportStatus, refine) {

            //$('#student_datatable').DataTable();

            //alert(ReportStatus);

            var query_cml = '<View><Query><Where><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">' + ReportStatus + '</Value></Eq></Where></Query></View>';

            //alert(query_cml);

            $.ajax({
                url: _spPageContextInfo.webAbsoluteUrl + "/_api/Web/Lists/getbytitle('BconeExpenceMaster')/GetItems",
                type: "POST",
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),
                success: function (data) {
                    console.log(data);
                    //alert(data.d.results.length);
                    //if (ReportStatus == "Open") {
                    //    document.getElementById("OpenExpenceCount").innerHTML = data.d.results.length;
                    //}
                    //else if (ReportStatus == "Submitted") {
                    //    document.getElementById("SubmittedExpenceCount").innerHTML = data.d.results.length;
                    //}
                    //else if (ReportStatus == "Rejected") {
                    //    document.getElementById("RejectedExpenceCount").innerHTML = data.d.results.length;
                    //}
                    //else if (ReportStatus == "Approved") {
                    //    document.getElementById("ApprovedExpenceCount").innerHTML = data.d.results.length;
                    //}
                    //else if (ReportStatus == "Reimbursed") {
                    //    document.getElementById("ReimburesedExpenceCount").innerHTML = data.d.results.length;
                    //}

                    if (refine != "") {
                        $('.loader').show();
                        ////alert("loader");


                        $("#student_data").find("tr").remove();
                        var table_tr = "";

                        var table_tr_edit = "";
                        //alert(data.d.results.length);
                        if (data.d.results.length > 0) {

                            document.getElementById("totalrecord").value = data.d.results.length;
                            if (document.getElementById("totalrecord").value > 0) {
                                //$("#deletediv").show();
                            }

                            var list_name = "BconeExpenceMaster";
                            var i = "0";
                            var url1 = current_url;
                            var rowhide = "";





                            $.each(data.d.results, function (key, value) {


                                var fromdate = new Date(value.ReportCreatedDate);

                                // alert('fromdate:' + fromdate);
                                var dd = fromdate.getDate();
                                //	alert('dd: '+ dd);
                                var mm = fromdate.getMonth() + 1; //January is 0!
                                //alert('mm: '+ mm);
                                var yyyy = fromdate.getFullYear();
                                //	alert('yyyy: '+ yyyy);

                                var updated_date = (fromdate.getMonth() + 1) + '-' + fromdate.getDate() + '-' + fromdate.getFullYear();

                                rowhide = "rowhideslow" + i + "";

                                tr_edit = "row_edit" + i + "";

                                //alert(value.Currency_x003a_ID);

                                var curreuncyvalue = "INR";

                                //var curreuncyvalue = getcurrencyValueById('https://e2eprojects.sharepoint.com/sites/pwa/', 'BconeCurrency',                                 value.CurrencyId);
                                //alert(curreuncyvalue);

                                //alert(ss);
                                var expenceid = value.ID;

                                table_tr = table_tr + "<tr id=" + rowhide + " class='deleteall" + value.ID + "' value=" + value.ID + ">";

                                table_tr = table_tr + "<td><input type='checkbox' id='record" + i + "' name='record" + i + "'  value=" + value.ID + "  /></td>";

                                // alert(value.attchment);
                                table_tr = table_tr + "<td>" + value.ID + "</td>";

                                table_tr = table_tr + " <td><a href='javascript:void(0)' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a></td>";
                                table_tr = table_tr + "<td>" + value.Description + "</td>";
                                table_tr = table_tr + "<td>" + curreuncyvalue + "</td>";
                                table_tr = table_tr + "<td>" + value.AmountTaken + "</td>";
                                table_tr = table_tr + "<td>" + updated_date + "</td>";
                                table_tr = table_tr + " <td>" + value.ReportStatus + "</td>";
                                table_tr = table_tr + " <td><a href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\")';><i class='fa fa-pencil'></i></a></td>";
                                table_tr = table_tr + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-                                trash'></i></a></td>";



                                table_tr = table_tr + "</tr>";


                                //amol coding




                                table_tr_edit = table_tr_edit + "<tr id=" + tr_edit + " class='deleteall" + value.ID + "' value=" + value.ID + "                                 style='display:'block';' >";

                                table_tr_edit = table_tr_edit + "<td><input type='checkbox' id='record" + i + "' name='record" + i + "'  value=" + value.ID + "  /></td>";

                                // alert(value.attchment);
                                table_tr_edit = table_tr_edit + "<td>" + value.ID + "</td>";

                                table_tr_edit = table_tr_edit + " <td><input type='text' id='ExpenseReportName" + i + "' value=" + value.ExpenseReportName + "/></td>";
                                table_tr_edit = table_tr_edit + "<td><input type='text' id='Description" + i + "' value=" + value.Description + " /></td>";
                                table_tr_edit = table_tr_edit + "<td><select id='curreuncyvalue" + i + "'></select></td>";
                                table_tr_edit = table_tr_edit + "<td><input type='text' id='AmountTaken" + i + "' value=" + value.AmountTaken + " /></td>";
                                table_tr_edit = table_tr_edit + "<td><input type='text' id='ReportCreatedDate" + i + "' value=" + value.ReportCreatedDate + " /></td>";
                                table_tr_edit = table_tr_edit + " <td>" + value.ReportStatus + "</td>";
                                table_tr_edit = table_tr_edit + " <td><a href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\");  '><i class='fa fa-pencil'></i></a></td>";
                                table_tr_edit = table_tr_edit + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa                                 fa-trash'></i></a></td>";



                                table_tr_edit = table_tr_edit + "</tr>";

                                i++;


                            });
                        }
                        else {
                            //alert(data.d.results.length);

                            table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a                             href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";

                        }
                        //alert(table_tr);
                        //$('#student_data').append(table_tr);

                        //  $('#student_data').append(table_tr_edit);

                        $('.loader').hide();


                        //alert(table_tr);


                        console.log(data.d);


                        $('.loader').hide();
                    }


                },
                error: function (error) {
                    alert(JSON.stringify(error));
                }
            });

        }

        function setCurrencySelectedValUpdate(element_id, currency_id) {
            var element = document.getElementById(element_id);
            alert('element_id : ' + element_id);

            alert('currency_id : ' + currency_id);

            element.value = currency_id;
        }

        function setCalendorToControl(control_id) {
            //alert(control_id);

            $('#' + control_id).datepicker({ dateFormat: 'mm-dd-yy' });

        }


        function updateListItem(listName, siteUrl) {

            //alert(listName);
            // alert(siteUrl);




            if (check_validation()) {


                // $('.loader').show();
                ////alert("updateListItem: "+ Id_edit);

                //var Id_edit= document.getElementById('hiddenid').value;
                var Id_edit = $('#edit_id').text();

                var tr_editid = $('#tr_editid').text();

                //var Id_edit = edit_id;

                ////alert("updateListItem: "+ Id_edit);


                var itemType = getListprotocol(listName);

                //alert(itemType);

                var curency_name = "";
                var expensereport = document.getElementById("Txtexpensereport").value;

                //var attchment=cc;
                // alert(expensereport);

                var Description = document.getElementById("TxtDescription").value;
                //alert(Description);
                var amount = document.getElementById("Txtamttaken").value;

                var ss = $('#currency :selected').text();
                var currencyval = $('#currency :selected').val();
                var item = "";

                var ProjectId = $('#ddlProjects :selected').val();
                var Projectname = $('#ddlProjects :selected').text();

                var ProjectOwner = $('#ddlProjectsmanager :selected').text();
                ProjectOwner = ProjectOwner.split('|');
                ProjectOwnerName = ProjectOwner[0];
                //var ProjectOwnerId=   $('#ddlProjects :selected').val();
                var ProjectOwnerId = ProjectOwner[1];



                var ddladvancetaken = ($('input[name=advance]:checked', '#advance').val());



                //alert(ddladvancetaken);

                if (ddladvancetaken == 'No') {
                    //set currency default value
                    currencyval = null;
                    amount = null;
                    curency_name = null;

                    item = {
                        "__metadata": { "type": itemType },
                        "Title": expensereport,
                        "ExpenseReportName": expensereport,
                        "Description": Description,
                        "AmountTaken": amount,
                        "CurrencyId": currencyval,
                        "currencytext": curency_name,
                        "ProjectId": ProjectId,
                        "Projectname": Projectname,
                        "ProjectOwnerId": ProjectOwnerId,
                        "ProjectOwnerName": ProjectOwnerName

                    };
                }
                else {

                    curency_name = $('#currency :selected').text();

                    item = {
                        "__metadata": { "type": itemType },
                        "Title": expensereport,
                        "ExpenseReportName": expensereport,
                        "Description": Description,
                        "AmountTaken": amount,
                        "CurrencyId": currencyval,
                        "currencytext": curency_name,
                        "ProjectId": ProjectId,
                        "Projectname": Projectname,
                        "ProjectOwnerId": ProjectOwnerId,
                        "ProjectOwnerName": ProjectOwnerName
                    };

                }

                //if (amount == '') {
                //amount = '0';
                // }

                //alert(amount);

                // var date = document.getElementById("TxtDate").value;

                //alert('date :'+ date);







                //alert(item);

                getListItemForUpdate(siteUrl, listName, Id_edit, function (data) {

                    ////alert("vvv");


                    $.ajax({
                        url: data.d.__metadata.uri,
                        type: "POST",
                        contentType: "application/json;odata=verbose",
                        data: JSON.stringify(item),
                        headers: {
                            "Accept": "application/json;odata=verbose",
                            "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                            "X-HTTP-Method": "MERGE",
                            "If-Match": data.d.__metadata.etag
                        },
                        success: function (data) {
                            ////alert("true");



                            //  //alert("Data upadted sucessfully");

                            destroyjs();

                            add_success_exp_msg('Expense updated successfully..', 'save');

                            //getDataByListName(current_url, 'BconeExpenceMaster', 'load1');

                            cleardata();

                            var EmployeeId = $('#resourse_id').text();

                            getDataByListName(current_url, 'BconeExpenceMaster', 'load1', EmployeeId);



                            //alert_message_overhang('Expense updated successfully.');

                            //window.frameElement.COMMENT_NODE;

                            //pass this para dynamically..

                            // $('#rowhideslow' + tr_editid).html('');



                            // getListItemById(current_url, 'BconeExpenceMaster', Id_edit, tr_editid, 'updated');

                            //$('#myModal').hide();
                            // $('.modal-backdrop.in').hide();
                            // $("#student_data").find("tr").remove();

                            // hidemodal();

                            //load_datatable_js();






                            // setTimeout(function () { }, 1000);

                            // $('.loader').hide();






                            // success(data);
                        },
                        error: function (data) {
                            alert(data.responseJSON.error.message.value);
                            ////alert("false");
                            // failure(data);
                            $('.loader').hide();
                        }
                    });


                }, function (data) {
                    failure(data);
                });
            }
            else {
                //  alert('validation not complete');
            }
        }

        function getListItemForUpdate(url, listname, Id, complete) {

            // alert(Id);
            // //alert("getlistitembyid");

            $.ajax({

                url: url + "/_api/web/lists/GetByTitle('" + listname + "')/items('" + Id + "')",
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                success: function (data) {

                    complete(data);
                    ////alert("getListItembyid1");
                },
                error: function (data) {
                    //  //alert("false");   
                }
            });
        }
        function getListprotocol(name) {
            //alert(name);

            return "SP.Data." + name.charAt(0).toUpperCase() + name.split(" ").join("").slice(1) + "ListItem";
        }


        function check_validation() {
            var isValid = true;
            var expensereport = document.getElementById("Txtexpensereport").value;
            var Description = document.getElementById("TxtDescription").value;
            var amount = document.getElementById("Txtamttaken").value;
            var ProjectId = $('#ddlProjects :selected').val();

            // alert(ProjectId);

            var ss = $('#currency :selected').text();
            var currencyval = $('#currency :selected').val();


            var ddladvancetaken = ($('input[name=advance]:checked', '#advance').val());



            if (ProjectId == '0') {
                isValid = false;
                $('#ddlProjects').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });




                document.getElementById("AlertMsg").innerHTML = "Please select the Project";
                document.getElementById("ddlProjects").focus();

                return isValid;

            }

            if (expensereport == '') {
                isValid = false;
                $('#Txtexpensereport').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });




                document.getElementById("AlertMsg").innerHTML = "Please enter the Expence Report Name";
                document.getElementById("Txtexpensereport").focus();

                return isValid;

            }
            // alert(expensereport.length);

            if (expensereport.length > 256) {
                isValid = false;
                $('#Txtexpensereport').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });




                document.getElementById("AlertMsg").innerHTML = "Expence Report Name should be 256 character max";
                document.getElementById("Txtexpensereport").focus();

                return isValid;

            }

            if (Description.length > 1000) {
                isValid = false;
                $('#TxtDescription').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });




                document.getElementById("AlertMsg").innerHTML = "Description should be 1000 character max";
                document.getElementById("TxtDescription").focus();

                return isValid;

            }




            //alert(ddladvancetaken);

            if (ddladvancetaken != 'Yes' && ddladvancetaken != 'No') {
                //alert(ddladvancetaken);
                isValid = false;

                $('#advance').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });
                document.getElementById("AlertMsg").innerHTML = "Please select the Option";
                document.getElementById("advance").focus();

                return isValid;

            }



            if (ddladvancetaken == 'Yes') {


                if (currencyval == 'Select') {
                    isValid = false;
                    $('#currency').css({

                        "border": "1px solid red",
                        "background": "#FFCECE"
                    });
                    document.getElementById("AlertMsg").innerHTML = "Please select the Currency";
                    document.getElementById("currency").focus();

                    return isValid;
                }

                if (amount == '') {

                    ////alert("amount");
                    isValid = false;
                    $('#Txtamttaken').css({

                        "border": "1px solid red",
                        "background": "#FFCECE"
                    });
                    document.getElementById("AlertMsg").innerHTML = "Please enter the Amount";
                    document.getElementById("Txtamttaken").focus();
                    return isValid;
                }

                if (parseFloat(amount) != amount && parseInt(amount) != amount) {
                    isValid = false;

                    $('#Txtamttaken').css({
                        "border": "1px solid red",
                        "background": "#FFCECE"
                    });

                    document.getElementById("AlertMsg").innerHTML = "Please enter valid amount ";
                    document.getElementById("Txtamttaken").focus();
                    return isValid;
                }

            }










            return isValid;
        }



        function getcurrencyValueById(url, listname, id) {
           /// //alert("id"+id);
            ////alert("getListItem1");
            ////alert("show();");
            //$('.loader').show();
            var ss;
            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/items(" + id + ")",
                async: false,
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },

                success: function (data) {
				
				//console.log(data);




                    //alert(data.d);
                    $.each(data, function (key, value) {
                        ////alert("value"+value.Currency);
                       if(listname!="BconeCurrency")
						{
                        ss = value.Item;
						
                        return ss;
						}else
						{
						ss = value.Currency;
						
                        return ss;
						
						}

                    });

                },
                error: function (data) {
                    //failure(data);
                    alert(data.responseJSON.error.message.value);
                }
            });
            return ss;
        }


        function getCurrencyDataUpdate(url, listname, i, currency_value) {
            ////alert("gfhkltnyklhmdtykhtkh");
            ////alert("getListItem1");
            ////alert("show();");
            //$('.loader').show();

            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/items",
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                success: function (data) {




                    // $.each(data.d.results, function (key, value) {

                    var class1 = "";
                    // alert(value.ID);
                    // alert(value.Currency);
                    // $("#curreuncyvalue" + i).append($("<option></option>").val(value.ID).html(value.Currency));

                    //});

                    // setCurrencySelectedValUpdate('curreuncyvalue' + i, currency_value);

                    //setCurrencySelectedValUpdate('currency', currency_value);

                    // setCalendorToControl('ReportCreatedDate' + i);


                    //loginuser();



                },
                error: function (data) {
                    // failure(data);
                }
            });
        }
        function noattchment() {

            //alert("Attachement not found!!!!");

        }

        function getListItemForDelete(url, listname, Id, complete) {
            //alert(Id);


            $.ajax({

                url: url + "/_api/web/lists/GetByTitle('" + listname + "')/items('" + Id + "')",
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                success: function (data) {



                    complete(data);
                    ////alert("getListItembyid1");
                },
                error: function (data) {
                    //  //alert("false");  
                    ////alert("hide();");
                    //$('.loader').hide();
                }
            });
        }


        function deleteexpense(id, i) {
            ////alert("deleteexpense");
            //alert(i);
            //var r = confirm("Are you sure to Delete the record?");
            var r = confirm("Are you sure you want to Delete the record?");
            if (r == true) {

                // $('.loader').show();

                var listname = "BconeExpenceMaster";
                //alert(listname);
                var requestUri = _spPageContextInfo.siteAbsoluteUrl;
                // alert(requestUri);

                //destroyjs();

                getListItemForDelete(requestUri, listname, id, function (data) {

                    //alert('getListItem1 function Returning');

                    $.ajax({
                        url: data.d.__metadata.uri,
                        type: "POST",
                        headers: {
                            "Accept": "application/json;odata=verbose",
                            "X-Http-Method": "DELETE",
                            "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                            "If-Match": data.d.__metadata.etag
                        },
                        success: function (data) {
                            // $('.loader').hide();

                            // $('#' + i).fadeOut();
                            //alert('delete success');
                            //  $("#student_data").find("tr").remove();

                            // hidemodal();

                            //getDataByListName(current_url, 'BconeExpenceMaster');

                            var offset = $("#jqxgrid").offset();

                            $('#jqxgrid').jqxGrid('deleterow', id);


                        },
                        error: function (data) {


                        },
                        complete: function (data) {

                            //getDataByListName(current_url, 'BconeExpenceMaster');

                        }
                    });
                });




                //setTimeout(function () {
                //load_datatable_js();
                //}, 1000);


                //$('#' + i).fadeOut();
                // $('#' + i).remove();


                //}
                //else {

                //}



            }
        }





        function loginuser() {
            var loginid = "";
            var userid = _spPageContextInfo.userId;


            var requestUri = _spPageContextInfo.siteAbsoluteUrl + "/_api/web/getuserbyid(" + userid + ")";
            var requestHeaders = { "accept": "application/json;odata=verbose" };
            $.ajax({
                async: false,
                url: requestUri,

                contentType: "application/json;odata=verbose",
                headers: requestHeaders,
                success: onSuccess,
                error: onError
            });

            function onSuccess(data, request) {
                var loginName = data.d.Id;
                loginid = data.d.Id;
                //alert(loginName);
            }

            function onError(error) {
                //alert("error");
            }
            return loginid;
        }


        function hideerror1(val) {
            //alert(val);

            //var ss = $('#val :selected').text();

            var Expenseitem = '';

            if (val == 'currency') {

                var e = document.getElementById(val);
                var ss = e.options[e.selectedIndex].value;

                // Expenseitem =ss;

                if (ss == "Select") {
                    $('#' + val).css({

                        "border": "1px solid red",
                        "background": "#FFCECE"
                    });

                    document.getElementById("AlertMsg").innerHTML = "Please select currency";
                    document.getElementById("currencyspan").innerHTML = "";

                    $("#Txtamttaken").attr("readonly", true);


                }
                else {

                    $("#Txtamttaken").attr("readonly", false);

                    //alert('false');
                    $('#' + val).css({

                        "border": "",
                        "background": ""
                    });

                    document.getElementById("AlertMsg").innerHTML = "";
                    //document.getElementById("currencyspan").innerHTML="";



                    Expenseitem = $('#' + val + ' :selected').text();




                    // alert(Expenseitem);
                    if (Expenseitem.indexOf("-")) {
                        var curr = Expenseitem.split("-");
                        //alert(curr[0]);
                        document.getElementById("currencyspan").innerHTML = curr[0];

                    }
                    else {
                        document.getElementById("currencyspan").innerHTML = Expenseitem;

                    }


                }



            }
            else if (val == 'ddladvancetaken') {

                ss = $('input[name=advance]:checked', '#advance').val();

                //alert(ss);

                if (ss == "Yes") {
                    // $('#Txtamttaken').css({

                    //   "border": "1px solid red",
                    // "background": "#FFCECE"
                    // });

                    $('#advance').css({

                        "border": "",
                        "background": ""
                    });

                    $('#currency').focus();
                    //$("#Txtamttaken").attr("readonly", false);

                    $('#currency_validation_star').show();
                    $('#amount_validation_star').show();

                    $('#currency').attr("disabled", false);

                    document.getElementById("AlertMsg").innerHTML = "";

                }
                else {
                    $('#Txtamttaken').css({

                        "border": "",
                        "background": ""
                    });

                    $('#advance').css({

                        "border": "",
                        "background": ""
                    });



                    //$("#Txtamttaken").attr("readonly", true);
                    $("#Txtamttaken").val('');

                    $("select#currency").prop('selectedIndex', 0);

                    $('#currency').attr("disabled", true);

                    $('#currency_validation_star').hide();
                    $('#amount_validation_star').hide();

                    document.getElementById("AlertMsg").innerHTML = "";

                    document.getElementById("currencyspan").innerHTML = "";

                }

            }

        }

        function hideerror(val) {



            $('#' + val).css({

                "border": "",
                "background": ""
            });

            document.getElementById("AlertMsg").innerHTML = "";
        }

        function amount_validation(selecetd_value) {


        }
        function addExpense(url, listname, expensereport, Description, currencyval, date, amount, curency_name, type, ProjectId, Projectname, ProjectOwnerId, ProjectOwnerName, EmployeeId, EmployeeName, ResourseId) {

            // $('.loader').show();

            //alert(listname);
            // var start = new Date();
            //alert(start);




            var item = "";
            var item_collections = getListprotocol(listname);
            //var loginid=loginuser();

            if (currencyval != 'null') {

                item = {
                    "__metadata": { "type": item_collections },
                    "Title": expensereport,
                    "ExpenseReportName": expensereport,
                    "Description": Description,
                    "AmountTaken": amount,
                    "ReportStatus": 'Open',
                    "status": 'Active',
                    "CurrencyId": currencyval,
                    "ReportCreatedDate": date,
                    "currencytext": curency_name,
                    "ProjectId": ProjectId,
                    "Projectname": Projectname,
                    "ProjectOwnerId": ProjectOwnerId,
                    "ProjectOwnerName": ProjectOwnerName,
                    "EmployeeId": ResourseId,
                    "EmployeeName": EmployeeName
                };
            }
            else {
                item = {
                    "__metadata": { "type": item_collections },
                    "Title": expensereport,
                    "ExpenseReportName": expensereport,
                    "Description": Description,
                    "ReportStatus": 'Open',
                    "status": 'Active',
                    "ReportCreatedDate": date,
                    "ProjectId": ProjectId,
                    "Projectname": Projectname,
                    "ProjectOwnerId": ProjectOwnerId,
                    "ProjectOwnerName": ProjectOwnerName,
                    "EmployeeId": ResourseId,
                    "EmployeeName": EmployeeName
                };

            }




            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/items",

                type: "POST",
                contentType: "application/json;odata=verbose",
                data: JSON.stringify(item),
                headers: {
                    "Accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val()
                },
                success: function (data) {

                    add_success_exp_msg('Expense created successfully..', 'save');

                    //console.log(data);
                    if (type == 'saveandcreate') {
                        var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/PPMUAT/SitePages/ExpenseItemDetail.aspx?TrackingNo=" + data.d.ID + "&type=new";
                        //alert(redirect_tolink);
                        window.location = redirect_tolink;
                    }

                    // //alert("Data added sucessfully");

                    // alert_message_overhang('Expense added successfully.');

                    //add_success_exp_msg('Expense added successfully.');
                    // console.log(data);
                    //  alert(data.d.results);



                    // clearAllInputs('myModal');

                    //here record count dynamically based on total record
                    // var record_count = 'new_record';




                    // destroyjs();

                    //  getDataByListName(current_url, 'BconeExpenceMaster');

                    // getListItemById(current_url, 'BconeExpenceMaster', data.d.ID, record_count, 'added');

                    //hidemodal();

                    //$('.loader').hide();

                    //$('#student_datatable').DataTable();


                    //  alert(data.d.attchment);

                    // var list_name = "BconeExpenceMaster";

                    //var url1 = "https://e2eprojects.sharepoint.com/sites/pwa/";

                    // document.getElementById("Txtexpensereport").value = "";


                    //document.getElementById("TxtDescription").value = "";
                    //
                    //document.getElementById("Txtamttaken").value = "";


                    //document.getElementById("TxtDate").value = "";
                    //document.getElementById("filename").innerHTML="";

                    //$("#currency")[0].selectedIndex = 0;

                    //var genderS = document.getElementsByName('gender');

                    // $("#student_data").find("tr").remove();




                    //getDataByListName(current_url, 'BconeExpenceMaster');


                    //$('.loader').hide();

                    //return true;


                },
                complete: function () {

                    cleardata();
                    var EmployeeId = $('#resourse_id').text();
                    getDataByListName(current_url, 'BconeExpenceMaster', 'load1', EmployeeId);

                },
                error: function (data) {
                    //alert("error");
                    alert(data.responseJSON.error.message.value);
                    //return false;

                }
            });


        }


        function clearAllInputs(selector) {
            $('#' + selector).find(':input').each(function () {

                // alert(this.type);

                if (this.type == 'submit') {
                    //do nothing
                }
                else if (this.type == 'checkbox') {
                    this.checked = false;
                }
                else if (this.type == 'file') {
                    var control = $(this);
                    control.replaceWith(control = control.clone(true));
                }
                else if (this.type == 'select-one') {
                    var control = $(this);
                    this.selectedIndex = 0;
                }
                else if (this.type == 'radio') {
                    this.checked = false;
                }

                else {
                    $(this).val('');
                }
            });
        }



        function clearvalues() {
            //   //alert("dfghjft");
            document.getElementById("Txtexpensereport").value = "";


            document.getElementById("TxtDescription").value = "";

            document.getElementById("Txtamttaken").value = "";


            // document.getElementById("TxtDate").value = "";
            // document.getElementById("filename").innerHTML="";

            $("#currency")[0].selectedIndex = 0;



        }

        function hidepopup() {
            //alert();
            $('#myModal').modal('hide');
            $('.modal-backdrop.in').hide();



        }


        function tempfunction() {


            if (document.getElementById("all").checked) {
                ////alert("checked");
                var count = document.getElementById("totalrecord").value;
                //alert(count);
                for (var i = 0; i <= parseInt(count - 1) ; i++) {

                    //alert();
                    document.getElementById("record" + i.toString()).checked = true;
                    ////alert("record" + i.toString());
                    //  $("#record" + i.toString()).attr('checked', 'checked');


                }
            }
            else {
                ////alert("uncheck");
                var count = document.getElementById("totalrecord").value;
                for (var i = 0; i <= parseInt(count - 1) ; i++) {

                    //alert();
                    document.getElementById("record" + i.toString()).checked = false;
                    ////alert("record" + i.toString());
                    // $("#record" + i.toString()).removeAttr('checked', '');


                }
            }

        }

        function showmodal() {

            ////alert("showmodal");
            $('#myModal').modal('show');
            $('.modal-backdrop.in').show();

            // $("input[name=advance][value=No]").attr('checked', 'checked');

            $('#Txtexpensereport').focus();



        }

        function hidemodal() {
            ////alert("showmodal");
            $('#myModal').modal('hide');
            $('.modal-backdrop.in').hide();


        }

        function showmodal1(type) {

            if (type == 'update' || type == 'add') {


                $('#myModal').modal('show');
                $('.modal-backdrop.in').show();
                $('#update_tr').hide();
                $('#add_tr').show();

                //clearvalues();

                clearAllInputs('myModal');


                $('#myModal').find(':input').each(function (key, value) {


                    $(this).css('border', '');
                    $(this).css('background', '');

                    $(this).attr("readonly", false);
                    $(this).attr("disabled", false);



                });

                if (type == 'add') {
                    //$("#Txtamttaken").attr("readonly", true);
                    //$("#Txtamttaken").attr("readonly","readonly");
                    $("#Txtamttaken").attr("readonly", true);
                    $('#currency').attr("disabled", true);
                    //alert('readonly');
                }

                $('#currency_validation_star').hide();
                $('#amount_validation_star').hide();

                document.getElementById("AlertMsg").innerHTML = "";
                document.getElementById("currencyspan").innerHTML = "";
            }
            else {
                $('#myModal').modal('show');
                $('.modal-backdrop.in').show();
                $('#update_tr').hide();
                $('#add_tr').show();

                //clearvalues();

                //clearAllInputs('myModal');


                //$('#myModal').find(':input').each(function (key, value) {


                // $(this).css('border', '');
                // $(this).css('background', '');

                // $(this).attr("readonly", false);
                // $(this).attr("disabled", false);



                // });

                // $('#currency_validation_star').hide();
                //$('#amount_validation_star').hide();

                document.getElementById("AlertMsg").innerHTML = "";
                document.getElementById("currencyspan").innerHTML = "";
            }

            $("#txtProManager").attr("readonly", true);
        }


        function uploadFile() {
            $('.loader').show();
            if (document.getElementById("getFile").files.length === 0) {
                alert('No file was selected');
                return;
            }
            var parts = document.getElementById("getFile").value.split("\\");
            var filename = parts[parts.length - 1];
            var file = document.getElementById("getFile").files[0];
            //alert(filename);
            uploadFileSync("https://e2eprojects.sharepoint.com/sites/pwa/", "BconeBillLibrary", filename, file);
            return filename;

        }


        function uploadFileSync(spWebUrl, library, filename, file) {
            var reader = new FileReader();
            reader.onloadend = function (evt) {
                if (evt.target.readyState == FileReader.DONE) {
                    var buffer = evt.target.result;
                    var completeUrl = spWebUrl
                      + "/_api/web/lists/getByTitle('" + library + "')"
                      + "/RootFolder/Files/add(url='" + filename + "',overwrite='true')?"
                      + "@TargetLibrary='" + library + "'&@TargetFileName='" + filename + "'";

                    $.ajax({
                        url: completeUrl,
                        type: "POST",
                        data: buffer,
                        async: false,
                        processData: false,
                        headers: {
                            "accept": "application/json;odata=verbose",
                            "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                            "content-length": buffer.byteLength
                        },
                        complete: function (data) {
                            alert('succes');
                            //document.getElementById("filename").innerHTML=filename;
                            $('.loader').hide();
                            return filename;



                        },
                        error: function (err) {
                            alert('failed');
                            return filename;

                        }
                    });
                }
            };
            reader.readAsArrayBuffer(file);
        }


        function deletecheckrecord() {
            var count = document.getElementById("totalrecord").value;
            //alert(count);

            var my_count = 0;
            var r = confirm("Are you sure to Delete the record?");
            if (r == true) {


                for (var i = 0; i <= parseInt(count - 1) ; i++) {



                    if ($("#record" + i.toString()).prop("checked") == true) {
                        ////alert("true");
                        var checkboxes = true;
                        my_count++;

                    }
                    else {

                        ////alert("false");
                        var checkboxes = false;
                    }

                    if (checkboxes == true) {
                        var expenes_id = document.getElementById("record" + i.toString()).value;
                        $(".deleteall" + expenes_id).addClass("deletealloncomplete");


                        tp(expenes_id);

                    }

                    else {
                    }
                }
                ////alert("deletealloncomplete");
                $(".deletealloncomplete").fadeOut("slow");

                //$("#student_data").find("tr").remove();



                if (my_count == 0) {
                    //alert("Please check checkbox to delete.");
                }


                $('.loader').hide();

                return true;

            }
            else {
                return false;
                ////alert("return false");

            }


        }
        function tp(id) {
            //alert();
            var listname = "BconeExpenceMaster";
            //alert(listname);
            var requestUri = _spPageContextInfo.siteAbsoluteUrl;
            // alert(requestUri);
            getListItemForDelete(requestUri, listname, id, function (data) {

                //alert('getListItem1 function Returning');

                $.ajax({
                    url: data.d.__metadata.uri,
                    type: "POST",
                    headers: {
                        "Accept": "application/json;odata=verbose",
                        "X-Http-Method": "DELETE",
                        "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                        "If-Match": data.d.__metadata.etag
                    },
                    success: function (data) {
                        $('.loader').hide();
                        //  alert('delete success');

                        // 	$("#student_data").find("tr").remove();

                        //hidemodal();
                        //getDataByListName('https://e2eprojects.sharepoint.com/sites/pwa/','BconeExpenceMaster');


                        $('.loader').hide();

                        return true;
                    },
                    error: function (data) {
                        return false;


                    }
                });
            });
        }

        function getResourcesGuid(NewloginName) {
            var GUID;
            jQuery.ajax({

                url: "/sites/PPMUAT/_api/ProjectData/Resources?$filter=ResourceNTAccount eq('" + NewloginName + "')",
                type: "GET",
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
                    //console.log(data);
                    GUID = data.d.results[0].ResourceId;
                   // alert('GUID' + GUID);
                    $('#resourse_id').text(GUID);

                    $('.loader').hide();
                    getDataByListName(current_url, 'BconeExpenceMaster', 'load1', GUID);


                   // getProjectsByGUID(GUID);

                    //return GUID;

                }
            });

        }

        function GetUserId(userid) {
            var NewloginName = "";
            jQuery.ajax({
                url: "/sites/PPMUAT/_api/Web/GetUserById(" + userid + ")",
                type: "GET",
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
                    var dataResults = data.d;
                    //console.log(dataResults);
                    //get login name  
                    //  console.log(data);
                    var loginName = dataResults.LoginName;
                    //console.log(loginName);
                    //alert('loginName: '+loginName);
                    $('#user_name').text(dataResults.Title);
					$('#login_name_contain').text(dataResults.Title);
                    //get display name
                    // console.log(dataResults.Title);
                    NewloginName = encodeURIComponent(loginName); //encoding loginName from special charater to normal text
                    //alert('NewloginName: '+NewloginName);
                    getResourcesGuid(NewloginName);
                    // console.log(NewloginName);
                    //alert('NewloginName :' + NewloginName);

                },
                complete: function () {

                    // var result = getResourcesGuid(NewloginName);
                    // alert(result);
                },
            });
        }

        function getProjectsByGUID(ResGUID) {

           // var url = "https://ppmdev.bcone.com/api/BCONE/GetProjectName";
            //var requestData = { "ResGUID": ResGUID };
			
			var url = "https://ppmdev.bcone.com/api/BCONE/GetProjectNameDBDev";
           var requestData = { "ResGUID": ResGUID,"EmployeeID":Emp_ID };
			
            $.ajax({
                url: url,
                data: requestData,
                async: false,
                type: "POST",
                dataType: "json",
                success: function (res) {
                    //console.log(res);

                    // $('#ddlProjects').append(new Option("Select Project", 0));

                    //$('#ddlProjectsmanager').append(new Option("Select Project", 0));

                    //alert(res);
                    $.each(res.SubOptions[0].Projectinfo, function (index, value) {
                        //alert(value.ProjectId);
                        //$('#ddlProjects').append(new Option("", 0));
                        $('#ddlProjects').append("<option value = '" + value.ProjectId + "'>" + value.Projectname + "</option>");
                        $('#ddlProjectsmanager').append("<option value = '" + value.ProjectId + "'>" + value.ProjectOwnerName + "|" + value.ProjectOwnerId + "</option>");
                    });
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    ////alert("ResourcesFailed");
                },
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                }
            });

        }

        function setProjectManager(dropdown) {
            //alert(dropdown);

            var project_id = $("#ddlProjects option:selected").val();
            //alert(project_id);

            // $("#ddlProjectsmanager option:selected").val(project_id);
            //  $('#ddlProjectsmanager').val(project_id).prop("selected", "selected");

            // $('#ddlProjectsmanager').prop('selectedIndex', 1);

            // $('#ddlProjectsmanager option[value=project_id]').prop("selected", true);

            //  var element = document.getElementById('leaveCode');
            // element.value = valueToSelect;
            if (project_id == 'undefined') {

                // alert('executed this block');
                //$("select#ddlProjects").prop('selectedIndex', 0);
                $('#ddlProjects').prop('selectedIndex', 0);


            }
            else {

                document.getElementById('ddlProjectsmanager').value = project_id;


                var projectManager = $("#ddlProjectsmanager option:selected").text();
                projectManager = projectManager.split('|');

                if (project_id != '0') {
                    $('#txtProManager').val(projectManager[0]);
                }
                else {
                    $('#txtProManager').val('');
                }
            }

        }
		
		    function showmodal_poup(expenes_id) {
		//	alert(expenes_id);
                $('#myModal1').modal('show');
				
				 var requestUri = _spPageContextInfo.siteAbsoluteUrl;
				
				getExpenseDetailById(requestUri,'BconeExpenceLogDetail',expenes_id);
              
        }



        $(document).ready(function () {
		//alert('ready is called');
            //$('.dataTables_wrapper #student_datatable').wrapAll(document.createElement('div'));
            //$('.dataTables_wrapper #student_datatable').parent('div').addClass('table-responsive');
            //$('.dataTables_wrapper .table-responsive').css("width","1110px");

            $('.new-th').css("display", "block");
            $("#txtProManager").prop("readonly", true);

            $("#student_datatable_paginate").click(function () {
                //do something
                alert('clicked');
            });

            $('.dataTables_paginate').click(function () {
                alert('hi');
            });

            $("#student_datatable_paginate").on("click", function () {
                alert('hi11');
            });

            $('.loader').show();

            var userid = _spPageContextInfo.userId;

            // alert('userid: '+userid);
            $('#user_id').text(userid);
            GetUserId(userid);
        });

		
		function bigImg(date,tooltipid){
		// alert(date);
		//tooltipid
		
				$("#"+tooltipid).jqxTooltip({ content: date, position: 'top', name: 'movieTooltip', top: 5,opacity: 1});
		}
		
		function convert_date_amol(date_to_convert){
		 var arr_dateandtime = date_to_convert.split('T');
		var arr_dateonly = arr_dateandtime[0].split('-');
		var arr_timeonly = arr_dateandtime[1].split(':');
		var Month;
		 var converted_date;
		switch ( parseInt(arr_dateonly[1])-1) {
									case 0:
									Month = "Jan";
									break;
									case 1:
									Month = "Feb";
									break;
									case 2:
									Month = "Mar";
									break;
									case 3:
									Month = "Apr";
									break;
									case 4:
									Month = "May";
									break;
									case 5:
									Month = "Jun";
									break;
									case 6:
									Month = "Jul";
									
									case 7:
									Month = "Aug";
									break;
									case 8:
									Month = "Sep";
									break;
									case 9:
									Month = "Oct";
									break;
									case 10:
									Month = "Nov";
									break;
									case 11:
									Month = "Dec";
									break;
								
									
				}
				
				converted_date=arr_dateonly[2]+"-"+Month+"-"+arr_dateonly[0];
				return converted_date;
				//alert(converted_date);
				
			
		
		}
		
		function convert_date_amol_tooltip(date_to_convert){
		var arr_dateandtime = date_to_convert.split('T');
		var arr_dateonly = arr_dateandtime[0].split('-');
		var arr_timeonly = arr_dateandtime[1].split(':');
		var Month;
		 var converted_date;
		  var suffix;
				switch ( parseInt(arr_dateonly[1])-1) {
									case 0:
									Month = "Jan";
									break;
									case 1:
									Month = "Feb";
									break;
									case 2:
									Month = "Mar";
									break;
									case 3:
									Month = "Apr";
									break;
									case 4:
									Month = "May";
									break;
									case 5:
									Month = "Jun";
									break;
									case 6:
									Month = "Jul";
									
									case 7:
									Month = "Aug";
									break;
									case 8:
									Month = "Sep";
									break;
									case 9:
									Month = "Oct";
									break;
									case 10:
									Month = "Nov";
									break;
									case 11:
									Month = "Dec";
									break;
								
									
				}
				
				
							var curr_hours = arr_timeonly[0];


							suffix = (curr_hours >= 12) ? 'PM' : 'AM';

							if (curr_hours > 12) {
								curr_hours -= 12;
							}

							//alert(suffix);

							var curr_min = arr_timeonly[1];

							if (curr_min < 10) {
								//curr_min = "0" + curr_min;
								curr_min =  curr_min;
							}


							var curr_seconds = arr_timeonly[2];
				
				converted_date=arr_dateonly[2]+"-"+Month+"-"+arr_dateonly[0]+" " + curr_hours + ":" + curr_min + " " + suffix;
				return converted_date;
				//alert(converted_date);
				
		
		}
function BindMethod(url, listname, type, EmployeeId,trackingid,Created) {
		////alert("nial");
           ////alert("BconeExpenseLogHistory");
//$('.loader').show();
            jsonObj = [];
            var trackingno = '';
            var title = '';

            var status = '';
            var advanceamount = '';

            var list_name = listname;
            var i = "0";
            var url1 = url;
            var rowhide = "";

            var Project_Name = "Project Name";
            var Pending_With = "Pending With";
            var Reimbursed_Total_Money = "-";
            var Balance = "-";
            var fromdate = "";
            var ReportCreatedDate = "";
            var converted_date = "";

            var ModifiedDate = "";

            var openstatus_count = 0;
            var submittedstatus_count = 0;
            var approvedstatus_count = 0;
            var rejectedstatus_count = 0;
            var reimburesedstatus_count = 0;
            var ReSubmittedExpenceCount = 0;
            var curreuncyvalue = 0;
            var advance = "";
            var tooltip_date = "";
            var allrecord_count = 0;
            var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/PPMUAT/SitePages/Approved_Item_Detail.aspx?TrackingNo=";
            var expenceid = '';
            var curr = '';
            var action_data = '';

            var data = '';
			
			var datetooltip='datetooltip';

			//var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="ProjectOwnerId"/><Value Type="Text">' + EmployeeId + '</Value></Eq><And><eq><FieldRef Name="ReportStatus"/><Value Type="Text">Approved</Value></eq><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Rejected</Value></Eq></Or></And></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="ProjectOwnerId" /><Value Type="Text">' + EmployeeId + '</Value></Eq><And><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Approved</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Rejected</Value></Eq></Or></And></And></Where></Query></View>';
            //var query_cml = '<View><Query><Where><Eq><FieldRef Name="ProjectOwnerId"/><Value Type="Text">' + EmployeeId + '</Value></Eq></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			
			//var query_cml = '<View><Query><Where><And><Or><Eq><FieldRef Name="ProjectManagerExpenseStatus"/><Value Type="Text" >Approved</Value></Eq><Eq><FieldRef Name="ProjectManagerExpenseStatus"/><Value Type="Text">Rejected</Value></Eq></Or><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">' + EmployeeId + '</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			
			//var query_cml = '<View><Query><Where><And><Or><Eq><FieldRef Name="ProjectManagerExpenseStatus"/><Value Type="Text" >Approved</Value></Eq><Eq><FieldRef Name="ProjectManagerExpenseStatus"/><Value Type="Text">Rejected</Value></Eq></Or><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">' + EmployeeId + '</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			 var query_cml = '<View><Query><Where><Eq><FieldRef Name="ID"/><Value Type="COUNTER">' + trackingid + '</Value></Eq></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			 
			//alert(query_cml);

            $.ajax({
                url: url + "/_api/web/lists/getbytitle('BconeExpenceMaster')/GetItems",
                type: "POST",
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                beforeSend: function () {
                   // $('.loader').show();
                },

                success: function (data) {



                    var table_tr = "";

                    var table_tr_edit = "";
                    if (data.d.results.length > 0) {







                        $.each(data.d.results, function (key, value) {


                            //alert(value.Modified);

                            allrecord_count++;
                            //alert(allrecord_count);
                            Project_Name = value.Projectname;
                            Pending_With = value.PendingWithName;


                            action_data = "<a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block; margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete' style='display:inline-block;' onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a>";

                            if (value.ProjectManagerExpenseStatus == "Open") {
                                openstatus_count++;
                            }

                            if (value.ProjectManagerExpenseStatus == "Submitted") {
                                submittedstatus_count++;
                            }
                            if (value.ProjectManagerExpenseStatus == "ReSubmitted") {
                                ReSubmittedExpenceCount++;
                            }


                            if (value.ProjectManagerExpenseStatus == "Finance Rejected") {
                                rejectedstatus_count++;
                            }

                            if (value.ProjectManagerExpenseStatus == "Finance Approved") {
                                approvedstatus_count++;
                                //action_data = "";
                                action_data = "<a data-toggle='tooltip' data-placement='right'  style='display:inline-block; text-decoration:none; color:#a6a6a6;margin-right:12px ' href='javascript:void(0)' ><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right'  style='display:inline-block; text-decoration:none; color:#a6a6a6;' ><i class='fa fa-trash'></i></a>";

                            }

                            if (value.ProjectManagerExpenseStatus == "Reimburesed") {
                                reimburesedstatus_count++;
                                // action_data = "";
                                action_data = "<a data-toggle='tooltip' data-placement='right'  style='display:inline-block; text-decoration:none; color:#a6a6a6;margin-right:12px ' href='javascript:void(0)' ><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right'  style='display:inline-block; text-decoration:none; color:#a6a6a6;' ><i class='fa fa-trash'></i></a>";
                            }

                            ReportCreatedDate =Created;

                          //  converted_date = convert_date(ReportCreatedDate);
                          //  tooltip_date = convert_date1(ReportCreatedDate);
						  
						   converted_date = convert_date_amol_tooltip(ReportCreatedDate);
						   tooltip_date = convert_date_amol(ReportCreatedDate);

                            rowhide = "rowhideslow" + i + "";

                            curreuncyvalue = "";
                            advance = "-";


                            if (value.AmountTaken != null) {
                                advance = value.AmountTaken;
                                if (advance.toString().indexOf(".")) {
                                }
                                else {
                                    advance = advance + ".00";

                                }



                            }

                            curreuncyvalue = value.currencytext;

                            //alert(curreuncyvalue);

                            if (curreuncyvalue == null) {
                                curreuncyvalue = "";

                            }
                            else {

                                Expenseitem = curreuncyvalue;



                                if (Expenseitem.indexOf("-")) {
                                    curr = Expenseitem.split("-");
                                    curreuncyvalue = curr[0];
                                }
                                else {
                                }

                            }
                            expenceid = value.ID;
							datetooltip=datetooltip+expenceid;


                            table_tr = table_tr + "<tr id=" + rowhide + "  class='deleteall" + value.ID + "' value=" + value.ID + ">";

                            table_tr = table_tr + " <td><a data-toggle='tooltip' data-placement='right' title='Edit' style='display:inline-block; margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='right' title='Delete' style='display:inline-block;' onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a> </td>";

                            table_tr = table_tr + "<td>" + value.ID + "</td>";

                            table_tr = table_tr + " <td><a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a></td>";

                            table_tr = table_tr + "<td><a style='text-decoration:none;' data-toggle='tooltip' title='' data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a></td>";

                            table_tr = table_tr + " <td>" + value.ReportStatus + "</td>";

                            table_tr = table_tr + " <td>" + Project_Name + "</td>";

                            table_tr = table_tr + " <td>" + Pending_With + "</td>";

                            table_tr = table_tr + "<td>" + advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span></td>";

                            table_tr = table_tr + " <td>" + Reimbursed_Total_Money + "</td>";

                            table_tr = table_tr + " <td>" + Balance + "</td>";

                            table_tr = table_tr + "</tr>";



//if (value.ReportStatus == "Rejected" || value.ReportStatus == "Approved") {

                           var  item = {}

                          //  item["action"] = action_data;
                            item["expenceid"] = expenceid;
                           // item["title"] = "<a onclick='showmodal_poup(\""+value.ID+"\")' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a>";
						   item["title"] = "<a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a>";
                           // item["createddate"] = "<a style='text-decoration:none;' data-toggle='tooltip' title='' data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
						    item["createddate"] = "<a id='"+datetooltip+"' class='mouseover_date' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")' style='text-decoration:none; cursor:default;'   data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
                            item["status"] = value.ReportStatus;
                            item["projectname"] = Project_Name;
                            item["pendingwith"] = Pending_With;
                            //item["advancetaken"] = advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span>";
							 item["advancetaken"] ="<div style='text-align:right;'>"+ advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue + " </span></div>";
                            item["reimbursedtotal"] = Reimbursed_Total_Money;
                            item["balance"] = Balance;
                          item["submittedby"] = value.EmployeeName;
						  converted_date = convert_date_amol_tooltip(value.ReportSubmittedDate);
						  tooltip_date = convert_date_amol(value.ReportSubmittedDate);

						  item["submitteddate"] = "<a id='"+datetooltip+"' class='mouseover_date' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")' style='text-decoration:none; cursor:default;'   data-original-title=\"" + converted_date + "\">" + tooltip_date + "</a>";
                           
						  
                            jsonObj.push(item);

                            //alert(jsonObj);
//}


                            i++;





                        });
                    }
                    else {
                        table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";

                    }
					//allrecord_count=approvedstatus_count+rejectedstatus_count;
                    //document.getElementById("OpenExpenceCount").innerHTML = openstatus_count;
                   // document.getElementById("SubmittedExpenceCount").innerHTML = submittedstatus_count;
                    //document.getElementById("ReSubmittedExpenceCount").innerHTML = ReSubmittedExpenceCount;
                   // document.getElementById("RejectedExpenceCount").innerHTML = rejectedstatus_count;
                   // document.getElementById("ApprovedExpenceCount").innerHTML = approvedstatus_count;
                    //document.getElementById("ReimburesedExpenceCount").innerHTML = reimburesedstatus_count;
                    //document.getElementById("AllRecordCount").innerHTML = allrecord_count;


                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                    //alert('completed');
                    data =
                            {
                                datatype: "json",
                                datafields: [
                               // { name: 'action', type: '' },
                                { name: 'expenceid', type: 'float' },
                                { name: 'title', type: 'string' },
                                { name: 'createddate', type: 'string' },
                                { name: 'status', type: 'string' },
                                { name: 'projectname', type: 'string' },
									  { name: 'submittedby', type: 'string' },
									   { name: 'submitteddate', type: 'string' },
									  
                                { name: 'pendingwith', type: 'string' },
                                { name: 'advancetaken', type: 'string' },
                                { name: 'reimbursedtotal', type: 'string' },
                                { name: 'balance', type: 'string' }
                                ],

                                updaterow: function (rowid, rowdata, commit) {
                                    // synchronize with the server - send update command
                                    // call commit with parameter true if the synchronization with the server is successful 
                                    // and with parameter false if the synchronization failder.
                                    commit(true);
                                },


                                id: 'expenceid',

                                localdata: jsonObj,


                            };

                    var dataAdapter = new $.jqx.dataAdapter(data);


                    $("#jqxgrid").jqxGrid({

                        width: '100%',
                        source: dataAdapter,
                        sortable: true,
                        filterable: true,
                        filtermode: 'excel',
                        columnsresize: true,
                        pageable: true,
                        autoheight: true,
                        autoshowfiltericon: false,
						enablemousewheel:false,
						autorowheight: true,
						
                        columns: [
                // { text: 'Action', datafield: 'action', width: 80 },
                 { text: 'Tracking No', datafield: 'expenceid', width: "10%" },
                 { text: 'Title', datafield: 'title', width: "15%" },
				  { text: 'Project Name', datafield: 'projectname', width: "25%" },
				   { text: 'Submitted By', datafield: 'submittedby', width: "20%" },
				   { text: 'Date Submitted', datafield: 'submitteddate', width: "10%" },
				     //{ text: 'Advance Amount', datafield: 'advancetaken', width: 146 },
					 
					 { text: 'Action Taken', datafield: 'status', width: "10%" },
                 { text: 'Date Action', datafield: 'createddate', width: "10%" }
				 
                 
                
                // { text: 'Pending With', datafield: 'pendingwith', width: 130 },
              
               //  { text: 'Reimbursed Total', datafield: 'reimbursedtotal', width: 120 },
                // { text: 'Comment', datafield: 'balance', width: 140 }

                        ],
                        pagesize: 10,
                        pagesizeoptions: ['25', '50', '100', '1000']
                    });

                    setTimeout(function () {
                        $('#jqxWidgetead9a064').hide();
                        $('#jqxWidget1d584650').css('display:none !important');
                    }, 2000);

                    $('#jqxgrid').mousewheel(function (e, delta) {

                    });

                   

                    $('#jqxWidget1d584650').css('display:none !important');
					
					// $('.loader').hide();
                }





            });
        }
		
		  function GetDataFrmLog_Refine(url, listname, inputVal,EmployeeId) {
		////alert("nial");
          $('.loader').show();

            jsonObj = [];
            var trackingno = '';
            var title = '';

            var status = '';
            var advanceamount = '';

            var list_name = listname;
            var i = "0";
            var url1 = url;
            var rowhide = "";

            var Project_Name = "Project Name";
            var Pending_With = "Pending With";
            var Reimbursed_Total_Money = "-";
            var Balance = "-";
            var fromdate = "";
            var ReportCreatedDate = "";
            var converted_date = "";

            var ModifiedDate = "";

            var openstatus_count = 0;
            var submittedstatus_count = 0;
            var approvedstatus_count = 0;
            var rejectedstatus_count = 0;
            var reimburesedstatus_count = 0;
            var ReSubmittedExpenceCount = 0;
            var curreuncyvalue = 0;
            var advance = "";
            var tooltip_date = "";
            var allrecord_count = 0;
            var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/PPMUAT/SitePages/Approved_Item_Detail.aspx?TrackingNo=";
            var expenceid = '';
            var curr = '';
            var action_data = '';

            var data = '';
			
			var datetooltip='datetooltip';

			//var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="ProjectOwnerId"/><Value Type="Text">' + EmployeeId + '</Value></Eq><And><eq><FieldRef Name="ReportStatus"/><Value Type="Text">Approved</Value></eq><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Rejected</Value></Eq></Or></And></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="ProjectOwnerId" /><Value Type="Text">' + EmployeeId + '</Value></Eq><And><Or><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Approved</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text">Rejected</Value></Eq></Or></And></And></Where></Query></View>';
            //var query_cml = '<View><Query><Where><Eq><FieldRef Name="ProjectOwnerId"/><Value Type="Text">' + EmployeeId + '</Value></Eq></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			
			//var query_cml = '<View><Query><Where><And><Or><Eq><FieldRef Name="ProjectManagerExpenseStatus"/><Value Type="Text" >Approved</Value></Eq><Eq><FieldRef Name="ProjectManagerExpenseStatus"/><Value Type="Text">Rejected</Value></Eq></Or><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">' + EmployeeId + '</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			
			//var query_cml = '<View><Query><Where><And><Or><Eq><FieldRef Name="ProjectManagerExpenseStatus"/><Value Type="Text" >Approved</Value></Eq><Eq><FieldRef Name="ProjectManagerExpenseStatus"/><Value Type="Text">Rejected</Value></Eq></Or><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">' + EmployeeId + '</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			
			//alert(query_cml);
         var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="Action"/><Value Type="Text" >'+inputVal+'</Value></Eq><Eq><FieldRef Name="ActorID" /><Value Type="Text">' + EmployeeId + '</Value></Eq></And></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
            
			$.ajax({
                <!-- url: url + "/_api/web/lists/getbytitle('" + listname + "')/GetItems", -->
				url: url + "/_api/web/lists/getbytitle('BconeExpenseLogHistory')/GetItems",
				 
                type: "POST",
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                beforeSend: function () {
                    
                },

                success: function (data) {



                    var table_tr = "";

                    var table_tr_edit = "";
					//alert(data.d.results.length );
                    if (data.d.results.length > 0) {


                        $.each(data.d.results, function (key, value) {
						
                           //BindMethod(url, listname,type, EmployeeId,value.TrackingNo) ;
                         getDataByListName_Refine(current_url, 'BconeExpenceMaster',inputVal,value.TrackingNo);

                        });
                    }
                    else {
					
					table_tr = table_tr +"<div class='nodatadiv'>";
      table_tr = table_tr +"<h3>No record found</h3>";
       table_tr = table_tr +"</div>";
          $('#NodataDiv').html(table_tr);
                       // table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";
               $('.loader').hide();
                    }
					


                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
				$('.loader').hide();
             
                 } 





            });
        }

    </script>
	 <script>
$(document).ready(function(){
 $('.ms-rte-layoutszone-inner p:first').hide();
 $('.ms-rte-layoutszone-inner p:last').hide();
});
</script>

</body>


</html>
			
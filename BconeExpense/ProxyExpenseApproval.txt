<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>New Expence</title>
    <script src="../SiteAssets/BconeExpenseJs/jquery.min.js"></script>
    <script src="../SiteAssets/BconeExpenseJs/bootstrap.min.js"></script>
    <link href="../SiteAssets/BconeExpenseCss/bootstrap.min.css" rel="stylesheet" />
    <link href="../SiteAssets/BconeExpenseCss/stylesheet.css" rel="stylesheet" />
    <link href="../SiteAssets/BconeExpenseCss/font-awesome.min.css" rel="stylesheet" />
    <script src="../SiteAssets/BconeExpenseJs/jquery.mCustomScrollbar.concat.min.js"></script>

    <link href="../SiteAssets/BconeExpenseCss/jquery.mCustomScrollbar(3).css" rel="stylesheet" />


    <!--  <script src="https://bristleconeonline.sharepoint.com/sites/pwa/SiteAssets/BconeExpenseJs/jquery.SPServices-0.7.2.min.js"></script> -->
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/LINQ_JS.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/LINQ_JS_MIN.js"></script>
    <!-- https://bristleconeonline.sharepoint.com/sites/pwa/SiteAssets/BconeExpenseJs/jinqjs.min.js -->

    <!-- <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/enumerable.js"></script> -->
    <link rel="stylesheet" href="../SiteAssets/BconeExpenseCss/jqx.base.css" type="text/css" />
    <!-- <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxcore.js"></script>
			<script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxwindow.js"></script>  
			<script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxtooltip.js"></script> -->

   <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jinqjs.min.js"></script>

    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jquery.SPServices.min.js"></script>
    <link rel="stylesheet" href="../SiteAssets/Timesheet/css/sumoselect.css">
    <script type="text/javascript" src="../SiteAssets/Timesheet/js/jquery.sumoselect.min.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/Config.js"></script>
    <style>
        .SumoSelect {
            width: 80% !important;
        }

        .select2-drop.select2-drop-above.select2-drop-active {
            border-top: 1px solid #5897fb;
            width: auto !important;
        }

        .resource-view1 {
            width: 200px;
        }

        .ms-core-pageTitle,
        .ms-core-pageTitle a {
            color: #fff;
            display: none;
        }

        #login_name_contain {
            float: right;
            margin: -32px 20px 0px 0px;
            background: url(https://bristleconeonline.sharepoint.com/sites/pwa/SiteAssets/BconeExpenseImg/user-icon.png) no-repeat right center;
            padding: 2px 32px 2px 0px;
        }

        #accordion a.accordion-toggle {
            width: 100%;
        }

        #accordion .panel-body {
            width: 100%;
            margin: 0px;
        }

        #accordion .panel-body .new-checkbox {
            margin: 10px 10px 10px -5px !important;
        }

        .breadcrumb-new a:visited {
            color: #337ab7 !important;
        }
    </style>
    <style type="text/css">
        #pageTitle {
            display: none;
        }

        .ms-breadcrumb-top {
            display: none;
        }

        .ms-core-pageTitle {
            margin: 0px;
        }

        .modal {
            padding-left: 0 !important;
        }

        #WebPartWPQ2_ChromeTitle {
            display: none !important;
        }

        .nodatadiv {
            width: 96.8%;
            display: inline-block;
            text-align: center;
            padding: 20px 0;
            border-radius: 3px;
            margin: 0 20px;
        }

        .blue_text:visited {
            color: #fff;
        }

        .spanbor {
            border-right: 1px solid #fff;
            padding: 0 2px;
        }

        .spanbor:last-child {
            border-right: 0;
        }
    </style>
    <style>
        #ui-id-1,
        #ui-id-2,
        #ui-id-3,
        #ui-id-4 {
            height: auto !important;
        }

        .SumoSelect {
            margin-bottom: 10px;
        }

        .readonlycolor {
            background: #F2F2F2 !important;
        }

        .body {
            margin: 0px;
            padding: 0px;
            font-size: 13px;
            font-family: Arial, Helvetica, sans-serif;
        }

        .black-bg {
            width: 100%;
            height: 100%;
            top: 0;
            position: fixed;
            background-color: rgba(22, 22, 22, 0.5);
            z-index: 9999;
            left: 0;
        }


        .popup-main {
            background-color: #fff;
            width: 350px;
            margin: 19% auto;
            text-align: center;
        }

        .green-btn {
            < !-- padding: 5px 10px;
            -->border-radius: 3px;
            color: #fff;
            background: #0A891A;
            text-decoration: none;
            display: inline-block;
        }

        .grey-btn {
            padding: 5px 10px;
            border-radius: 3px;
            color: #333;
            background: #ccc;
            text-decoration: none;
            display: inline-block;
        }

        .popup-heading {
            width: 100%;
            text-align: center;
            font-size: 15px;
            color: #fff;
            padding: 8px 0;
        }

        .alert-main .popup-heading {
            background-color: #0072c6;
        }

        .success-main .popup-heading {
            background-color: #090;
        }

        .pop-mid {
            padding: 0 15px 15px 15px;
        }

        .pop-mid p {
            margin-bottom: 20px;
        }

        .divnewbtn {
            background-color: #e7e7e7 !important;
            color: black;
        }

        #bindcurrencydata {

            padding: 0px;
            background: #f3f3f3;
            /* margin-top: 5px; */
            display: inline-block;
            background-color: white;
        }

        #bindcurrencydata span {
            border-right: 1px solid #fff;
            padding: 3px 5px;
            display: inline-block;
            background: #ccc;
            cursor: default;
            font-size: 11px;
        }

        #bindcurrencydata span:last-child {
            border: 0;
        }

        .bgcolorrow tr th {
            background: #e8e8e8;
        }

        .wordellipsis {
            display: inline-block;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
            overflow: hidden;
        }

        .innertable td {
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>

<body>

    <script type="text/javascript">
        var proxyid;
        $(document).ready(function() {
            //disableRightClick();
            ///$("#ddlemployee").select2();
            $('#ddlemployee').SumoSelect({
                search: true,
                placeholder: 'Select Resource'
            });


        });
    </script>


    <div style="text-align:right;" id="login_name_contain"></div>
    <section class="middle">
        <div class="breadcrumb-new">
            <div class="container-fluid">
                <ul>
                    <li>
                        <a href="https://bristleconeonline.sharepoint.com/sites/pwa/default.aspx">Home</a>
                    </li>
                    <li>
                        <a style="cursor:default;text-decoration:none; color: #272727;">Proxy Expense Approval</a>
                    </li>
                </ul>
                <div class="clearfix"></div>
            </div>
        </div>
        <div class="container-fluid" id="Upper_strip1">

            <div class="mid-top" style="margin-bottom:5px;">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6">
                            <div style="display: inline-block;width: 36%;vertical-align: super;margin-right: -87px;">Select on behalf of :</div>
                            <div style="display:inline-block;width:69%">
                                <select id="ddlemployee" style="width:100%">
                                    <option value="-1" style="display:none">Select Resource</option>
                                </select>
                                <a href="javascript:void(0)" class="blue-btn" id="btnShow" style="width:15%;margin-top: -10px;" onclick="Binddata()">SHOW</a>
                                <a href="javascript:void(0)" class="blue-btn" id="btnReset" style="width: 15%;float: right; margin-top: 10px;margin-right: -66px;" onclick="Reset()">CLEAR</a>

                            </div>
                        </div>


                        <li class="pull-right" style="list-style-type: none;">
                            <a href="https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/ProxyExpenseApprovalHistory.aspx" class="History-btn">
                                <i class="fa fa-history"></i>My Approval History
                            </a>
                        </li>


                    </div>

                </div>
            </div>
        </div>
        <div class="container-fluid" style="display:none;" id="Upper_strip">
            <div class="row">
                <div class="top-refine">
                    <ul class="pull-left">
                        <li>
                            <select class="resource-view" style="display:none;" Id="Project_Resource_View" onchange="ProjectResourceView()">
                                <option value="Project_view">Project View</option>
                                <option value="Resource_view">Resource View</option>
                            </select>
                        </li>
                        <li>
                            <a id="all" onclick="linqrefine();" class="History-btn" style="cursor: pointer; padding: 2px 6px;"><i class="fa fa-plus"></i> <span>Expand All</span></a>
                            <div class="bedcrumdiv">
                                <div class="pull-left" id="bindcurrencydata" style="display:none;"></div>
                            </div>
                        </li>

                    </ul>

                    <ul class="pull-right">
                        <li>
                            <a class="blue-btn blue_text" style="position:relative; color: #fff !important;text-decoration: none;cursor: default;">Pending Approval <span class="red-count" id="PendingExpenseCount"></span></a>
                        </li>


                    </ul>

                    <div class="clearfix"></div>
                </div>
                <div class="clearfix"></div>

            </div>

        </div>


        <div class="panel-group" id="accordion">
        </div>

    </section>



    <div id="myModal" class="modal fade newpopup-table" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" onclick="Clear_Span()">&times;</button>
                    <h4 class="modal-title">Expense Approval Summary</h4>
                </div>
                <div class="modal-body" style="padding:0 5px 5px 5px;">

                    <div>
                        <!--code here-->

                        <style>
                            .blockdiv a {
                                color: #000 !important;
                                font-size: 13px;
                                border-bottom: 1px solid #d2d2d2;
                                padding-bottom: 5px;
                                width: 100%;
                                display: inline-block;
                            }

                            .blockdiv a:last-child {
                                border: none;
                                padding-bottom: 0;
                            }

                            .scrolldiv {
                                float: left;
                                width: 100%;
                            }

                            .blockdiv {
                                border-bottom: 1px solid #ddd;
                                margin-bottom: 0px;
                                padding: 5px;
                                border-radius: 3px;
                            }

                            .blockdiv h4 {
                                color: #fff;
                                background: #203864 !important;
                                padding: 2px 5px;
                                font-size: 14px;
                                border-radius: 3px 3px 0px 0;
                                width: 100%;
                                display: inline-block;
                            }

                            .blockdiv i {
                                margin-right: 4px;
                                font-size: 5px;
                                vertical-align: middle;
                                display: inline-block;
                            }

                            .msgdiv {
                                color: #2fa934;
                                font-weight: 600;
                            }

                            .mldiv {
                                margin-left: 8px;
                                border-right: 1px solid #ddd;
                            }

                            .mldiv:last-child {
                                border: none;
                            }

                            .curdiv {
                                float: right;
                                margin-right: 10px;
                                font-size: 12px;
                            }

                            .namediv {
                                float: left;
                                ;
                                width: 200px;
                            }

                            .cureencydiv {
                                text-align: right;
                            }

                            .topstrip {
                                background: #ddd;
                                width: 96%;
                                padding: 3px 5px;
                                margin-left: 8px;
                            }

                            .curdiv_main {
                                float: left;
                                margin-right: 301px;
                                font-size: 12px;
                            }
                        </style>
                        <div class="text-left topstrip">
                            <div class="namediv">Total Approved Currency Amount: </div>
                            <div class="cureencydiv" id="Popup_currency">


                            </div>
                        </div>
                        <div class="scrolldiv">
                            <div class="content1 mCustomScrollbar wow fadeIn animated" id="">
                                <div id="Modal_Div" class="mCSB_container">


                                </div>
                            </div>
                            <!--code here end-->
                        </div>
                    </div>
                    <div>
                        <p class="msgdiv" style="display:none;">Updated Successfully!!!</p>
                        <div id="ApproveAllBtn">
                            <a href="javascript:void(0)" class="blue-btn" onclick="ApproveAll()">Approve All</a>

                            <a href="javascript:void(0)" class="blue-btn" data-dismiss="modal" onclick="Clear_Span()">Cancel</a>
                        </div>
                        <span id="AllApproval_id" style="display:none;"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <style>
        .newpopupdiv .modal-header {
            padding: 5px 8px;
            font-family: 'Conv_calibri';
            background: #0072c6;
        }

        .newpopupdiv .modal-title {
            color: #fff;
            font-size: 15px;
        }

        .newpopupdiv .close {
            opacity: 1;
            color: #fff;
        }

        .newpopupdiv .modal-dialog {
            margin: 190px auto;
        }
    </style>
    <div id="alertmain" class="alert-main" style="display:none">
        <div class="black-bg" id="backcolor">
            <div class="popup-main">
                <div class="popup-heading"><span id="Alert_msg"></span></div>
                <div class="pop-mid">
                    <p id="submitValue"></p>
                    <input type='Button' class="divnewbtn" value="OK" onclick="close_div()" />
                </div>
            </div>
        </div>
    </div>
    <div id="Confirmation_alert" class="alert-main" style="display:none;">
        <span id="confirmation_type"></span>
        <div class="black-bg" id="backcolor">
            <div class="popup-main">
                <div class="popup-heading"><span id="Confirmation_msg"></span></div>
                <div class="pop-mid">
                    <p id="submitValue"></p>
                    <span id="Method_tocall"></span>
                    <input type='Button' class="divnewbtn" value="OK" id="ok_click" />
                    <input type='Button' class="divnewbtn" value="Cancel" onclick='confirmation_close();' />
                </div>
            </div>
        </div>
    </div>
    <div id="myModal2" class="modal fade newpopup-table newpopupdiv" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">&times;</a>
                    <h4 class="modal-title">Please Provide Reason For Rejection Of This Expense.</h4>
                </div>
                <div class="modal-body">
                    <table class="tabledivnew">
                        <tbody>

                            <tr>
                                <td colspan="2" style="width: 195px;">
                                    <textarea rows="4" class="form-control" cols="45" id="Txt_Comment" onkeyup="hideerror('Txt_Comment')"></textarea>
                                    <br>
                                    <sup style="color: #ababab; font-size: 12px;">(Max 500 characters and these special characters are not allowed !@#$%^&amp;*()+=[]'/{}|\":&lt;&gt;)</sup>
                                </td>




                            </tr>


                            <tr>
                                <td colspan="2">
                                    <span id="AlertMsg" style="color: red;"></span>
                                </td>
                            </tr>


                            <tr>

                                <td colspan="2">
                                    <span id="Expense_Comment_Id" style="display:none"></span>
                                    <span id="Expense_Tracking_No" style="display:none"></span>
                                    <span id="Reject_Hide" style="display:none"></span>


                                </td>


                            </tr>
                            <tr>
                                <td colspan="2"> <a href="javascript:void(0)" class="red-btn" id="Save_comment" onclick="Rejectcomment('Rejected')" style="margin-right:10px;">Reject</a><a class="blue-btn" data-dismiss="modal" href="javascript:void(0)">Cancel</a> </td>
                            </tr>

                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
    <style>
        .tabledivnew {
            width: 100%;
        }

        .tabledivnew tr td {
            padding: 2px;
        }
    </style>
    <div class="loader"></div>


    <script>
        var web_url = "https://bristleconeonline.sharepoint.com/sites/pwa/";
        var userid = _spPageContextInfo.userId;
        var people = [];
        var TrackingIds = [];
        var Summary_TrackingIds = [];
        var owner_id = GetUserId(userid);
        var Approver2Id = "";
        var ExpenseApproveType = "";
        var Approver2Name = "";
        var Approver1Id = "";
        var Approver1Name = "";
        var finance_approver_id = "";
        var finance_approver_name = "";
        var pending_with_id = "";
        var pending_with_name = "";
        var finalCc = "";
        var finalTo = "";
        var expense_creater_id = "";
        var PathUrl = "";
        var PathURLPDF = "";
		var master_data='';


        function GetUserId(userid) {
            var NewloginName = "";
            var result;
            jQuery.ajax({
                url: "/sites/pwa/_api/Web/GetUserById(" + userid + ")",
                type: "GET",
                async: false,
                headers: {
                    "Accept": "application/json;odata=verbose"
                },
                success: function(data) {
                    var dataResults = data.d;
                    //get login name  
                    //console.log(data);
                    var loginName = dataResults.LoginName;
                    // console.log(loginName);
                    //get display name
                    //console.log(dataResults.Title);
                    $('#login_name_contain').text(dataResults.Title);
                    NewloginName = encodeURIComponent(loginName); //encoding loginName from special charater to normal text
                    result = getResourcesGuid(NewloginName);
                    // console.log(NewloginName);
                    // alert('result :' + result);

                },
                complete: function() {

                    var result = getResourcesGuid(NewloginName);
                    // alert(result);
                },
            });
            return result;
        }

        function getResourcesGuid(NewloginName) {

            ////alert("NewloginName"+ NewloginName)
            var GUID;
            jQuery.ajax({

                url: "/sites/pwa/_api/ProjectData/Resources?$filter=ResourceNTAccount eq('" + NewloginName + "')",
                type: "GET",
                async: false,
                headers: {
                    "Accept": "application/json;odata=verbose"
                },
                success: function(data) {
                    // console.log(data);
                    GUID = data.d.results[0].ResourceId;

                    //alert('GUID' +     GUID);

                    // getProjectsByGUID(GUID);

                    return GUID;

                }
            });
            return GUID;
        }

        function loaddata(id, resourse) {
            //alert('loaddatacall');
            //var query_cml = '<View><Query><Where><Eq><FieldRef Name="TrackingNo" /><Value Type="Number">' + id + '</Value></Eq></Where><OrderBy><FieldRef Name="ExpenceCurrencyId" /><Value ></Value></OrderBy></Query></View>';

            $.ajax({
                url: _spPageContextInfo.webAbsoluteUrl + "/_api/Web/Lists/getbytitle('BconeExpenceLogDetail')/Items?$filter=TrackingNo eq '" + id + "'&$orderby= ExpenceCurrencyId asc",
                type: "GET",
                async: false,
                headers: {
                    "Accept": "application/json;odata=verbose"
                },

                success: function(data) {
                    var table_tr = "";
                    var table_tr_edit = "";
                    var curreny_amt_array = [];

                    if (data.d.results.length > 0) {

                        var list_name = "BconeExpenceLogDetail";
                        var i = "0";
                        //var url1 = "https://e2eprojects.sharepoint.com/sites/pwa/";
                        var rowhide = "";

                        $.each(data.d.results, function(key, value) {

                            var Currency = getcurrencyValueById('BconeCurrency', value.ExpenceCurrencyId);

                            var curr_val;

                            if (Currency.indexOf("-")) {
                                var curr = Currency.split("-");

                                curr_val = curr[0];
                            } else {
                                curr_val = Currency;
                            }

                            curreny_amt_array.push(curr_val + "-" + value.ExpensceAmount + "-" + value.ExpenceCurrencyId);


                        });

                        ////alert("curreny_amt_array"+curreny_amt_array);

                        //Currency_refine(web_url,'BconeExpenceLogDetail',id,curreny_amt_array,resourse);
                    } else {

                    }
                    // alert(table_tr);


                },
                error: function(data) {
                    alert(data.responseJSON.error.message.value);
                    failure(data);
                }
            });


        }

        function Clear_Span() {
            ////alert("Clear_Span");
            //AllApproval_id
            $("#AllApproval_id").text("");
            $(".msgdiv").hide();

        }

       function GetExpenseAmtSumByCurrencyId(url, listname, id, ExpenceCurrencyId) {

    // //alert("GetExpenseAmtSumByCurrencyId");
    // alert(ExpenceCurrencyId);
    //  $('.loader').show();

    var temp1 = "0";

    //	var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="TrackingNo" /><Value Type="Number">' + id + '</Value></Eq><Eq><FieldRef Name="ExpenceCurrency" /><Value Type="Number">' + ExpenceCurrencyId + '</Value></Eq></And></Where><OrderBy><FieldRef Name="ExpenceCurrency" Ascending="True"/><Value Type="Number" ></Value></OrderBy></Query></View>';
    //alert(query_cml);




    // alert(query_cml);
    $.ajax({
        url: _spPageContextInfo.webAbsoluteUrl + "/_api/Web/Lists/getbytitle('BconeExpenceLogDetail')/Items?$filter=TrackingNo eq '" + id + "'and ExpenceCurrency eq '" + ExpenceCurrencyId + "'&$orderby= ExpenceCurrency asc",
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },

        success: function(data) {
            var table_tr = "";

            var table_tr_edit = "";

            //alert(data.d.results.length);
            if (data.d.results.length > 0) {

                $.each(data.d.results, function(key, value) {

                    temp1 = parseInt(temp1) + value.ExpensceAmount;

                });
                //document.getElementById('Curreny_data628').innerHTML =	temp1;

            } else {


            }

            //  $('.loader').hide();
            //  $('#student_data').append(table_tr);                                 
            // load_datatable_js();


        },
        error: function(data) {
            alert(data.responseJSON.error.message.value);
            failure(data);
        }
    });
    return temp1;
}

function ApproveAll() {
    var temp = $("#AllApproval_id").text();
    var myString = temp.split(",");
    var bool = false;
    for (i = 1; i < myString.length; i++) {
        var my_var = "";
        //alert(myString.length);		
        UpdateExpenseStatus(myString[i], "Approved", "", "Project_View", "MultiApprove", my_var, my_var);
        //   UpdateExpenseStatus(myString[i],"Submitted","","Project_View","MultiApprove");
    }

    var alert_var = "Expence Approved sucessfully";

    //calling_alert(alert_var);

    setTimeout(function() {
        calling_alert(alert_var);
    }, 3000);

}

function calling_alert(temp) {
    //alert(temp);
    //$(".msgdiv").show();
    $("#ApproveAllBtn").hide();
    $('#myModal').modal('hide');

    document.getElementById("Alert_msg").innerHTML = "Selected Expence's Approved sucessfully";
    $("#alertmain").show();
}

function Currency_refine(url, listname, id, Temp, reource) {

    var temp = "";
    var myString = Temp.sort();
    var rowhide = "";
    var ul_div = "";
    for (i = 0; i < myString.length; i++) {
        //alert(myString[i]);
        var ss = myString[i];
        var b = ss.split("-");
        // alert(b[2]);
        if (temp == b[0]) {} else {
            temp = b[0];
            // alert(b[2]);
            var Sum_amount = GetExpenseAmtSumByCurrencyId(url, listname, id, b[2]);
            ////alert("Sum_amount"+  Sum_amount);

            //ul_div= ul_div +"<a style='color:white;cursor: pointer;' id="+b[0]+" class='blue-btn'  >"+Sum_amount+" - "+b[0]+"</a>";
            //ul_div= ul_div +"<li>Tracker ID : "+Sum_amount+" - "+b[0]+"  </li>";
            //alert('Curreny_data'+id);
            document.getElementById('Curreny_data').innerHTML = Sum_amount + " - " + b[0];

        }
    }
    ////alert("id"+id+   "ul_div"+ul_div);
    // $('#Currency_div555').append(ul_div);

}

function GetExpenseByResourceid(listname, reourse_id, type) {
    ////alert("GetExpenseByResourceid");

    var count = "0";
    //SPList list = SPContext.Current.Site.RootWeb.Lists["TableA"];
    // SPQuery query = new SPQuery();
    if (type == "Resource_View")

    {
        // var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">'+owner_id+'</Value></Eq><And><Eq><FieldRef Name="EmployeeId" /><Value Type="Text">'+reourse_id+'</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Submitted</Value></Eq></And></And></Where></Query><Join Type="INNER" ListAlias="test"><Eq><FieldRef List="BconeExpenceMaster"  RefType="Id"/><FieldRef List="BconeExpenceLogDetail" Name="TrackingNo"/></Eq></Join></View>';

        // var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">'+owner_id+'</Value></Eq><And><Eq><FieldRef Name="EmployeeId" /><Value Type="Text">'+reourse_id+'</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Submitted</Value></Eq></And></And></Where></Query><Join Type="INNER" ListAlias="test"><Eq><FieldRef List="BconeExpenceMaster"  RefType="Id"/><FieldRef List="BconeExpenceLogDetail" Name="TrackingNo"/></Eq></Join></View>';
        //	var query_cml='<View><Query><Where><And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">'+owner_id+'</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Submitted</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Manager Approved</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Approver 1 Approved</Value></Eq><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Approver 2 Approved</Value></Eq></Or></Or></Or></And></Where><OrderBy><FieldRef Name="EmployeeId" Ascending="False"/><Value ></Value></OrderBy></Query></View>';		

        //var query_cml='<View><Query><Where><And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">'+proxyid+'</Value></Eq><And><Eq><FieldRef Name="EmployeeId" /><Value Type="Text">' + reourse_id + '</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Submitted</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Manager Approved</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Approver 1 Approved</Value></Eq><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Approver 2 Approved</Value></Eq></Or></Or></Or></And></And></Where><OrderBy><FieldRef Name="EmployeeId" Ascending="False"/><Value ></Value></OrderBy></Query></View>';		

        var query_cml = 'Items?$filter=PendingWithId eq \'' + proxyid + '\' and  EmployeeId eq \'' + reourse_id + '\' and  ((ReportStatus eq \'Manager Approved\') or (ReportStatus eq \'Submitted\') or (ReportStatus eq \'Approver 2 Approved\') or (ReportStatus eq \'Approver 1 Approved\')) &$orderby= EmployeeId desc';
    } else {
        //var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">'+owner_id+'</Value></Eq><And><Eq><FieldRef Name="Projectname" /><Value Type="Text">'+reourse_id+'</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Submitted</Value></Eq></And></And></Where></Query><Join Type="INNER" ListAlias="test"><Eq><FieldRef List="BconeExpenceMaster"  RefType="Id"/><FieldRef List="BconeExpenceLogDetail" Name="TrackingNo"/></Eq></Join></View>';

        //var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">'+owner_id+'</Value></Eq><And><Eq><FieldRef Name="Projectname" /><Value Type="Text">'+reourse_id+'</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Submitted</Value></Eq></And></And></Where></Query><Join Type="INNER" ListAlias="test"><Eq><FieldRef List="BconeExpenceMaster"  RefType="Id"/><FieldRef List="BconeExpenceLogDetail" Name="TrackingNo"/></Eq></Join></View>';
        //var query_cml='<View><Query><Where><And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">'+proxyid+'</Value></Eq><And><Eq><FieldRef Name="Projectname" /><Value Type="Text">' + reourse_id + '</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Submitted</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Manager Approved</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Approver 1 Approved</Value></Eq><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Approver 2 Approved</Value></Eq></Or></Or></Or></And></And></Where><OrderBy><FieldRef Name="EmployeeId" Ascending="False"/><Value ></Value></OrderBy></Query></View>';		
        var query_cml = 'Items?$filter=PendingWithId eq \'' + proxyid + '\' and  ProjectId eq \'' + reourse_id + '\' and  ((ReportStatus eq \'Manager Approved\') or (ReportStatus eq \'Submitted\') or (ReportStatus eq \'Approver 2 Approved\') or (ReportStatus eq \'Approver 1 Approved\')) &$orderby= EmployeeId desc';
    }
    // alert(query_cml);
    $.ajax({
        url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('" + listname + "')/" + query_cml,
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },

        success: function(data) {
            var table_tr = "";

            var table_tr_edit = "";
            var resource_div_data = "";

            // //alert("GetExpenseByResourceid"+data.d.results.length);
            if (data.d.results.length > 0) {
                //console.log(data);
                $.each(data.d.results, function(key, value) {
                    var temp = value.ID;
                    TrackingIds.push({
                        Tracking: temp,
                        EmployeeId: value.EmployeeId,
                        ProjectId: value.ProjectId
                    });
                    loaddata1(value.ID);

                });
                //console.log(TrackingIds);

                count = data.d.results.length;



                return count;

            } else {

                //  table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";
                return count;
            }


        },
        error: function(data) {
            alert(data.responseJSON.error.message.value);
            failure(data);
        }
    });
    return count;

}


function GetCurrencyDetail(listname, reourse_id) {
    //alert(listname);

    var count = "0";


    // var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="EmployeeId" /><Value Type="Number">'+reourse_id+'</Value></Eq><Eq><FieldRef Name="ReportStatus"/><Value Type="Text" >Submitted</Value></Eq></And></Where></Query></View>';
    // alert(query_cml);


    var query_cml = 'Items?$filter=EmployeeId eq \'' + reourse_id + '\' and ReportStatus eq \'Submitted\' ';
    $.ajax({

        url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('" + listname + "')/" + query_cml,
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },

        success: function(data) {
            var table_tr = "";

            var table_tr_edit = "";
            var resource_div_data = "";

            // alert(data.d.results.length);
            if (data.d.results.length > 0) {
                //console.log(data);

                $.each(data.d.results, function(key, value) {

                    ////alert("value.TrackingNoId" + value.TrackingNoId);

                });
                count = data.d.results.length;



                return count;

            } else {

                //  table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";
                return count;
            }


        },
        error: function(data) {
            alert(data.responseJSON.error.message.value);
            failure(data);
        }
    });
    return count;

}

function getResources(url, listname, owner_id, type1)
{
    // $('.loader').show();
    people = [];
    TrackingIds = [];
    var type = type1;
    $('#accordion').empty();

    var Resourcediv_Main = "";
    var Resourcediv_Id = "";
    var Resource_sub_div = "";
    var checkbox_id = "";
    var anchor_tagid = "";
    var count = 0;
    var PendingExpenseCount = "0";

    var EmpBaseLocation = '';
    var AdavanceCurrency = '';

    //alert(listname);
    if (type1 == "Resource_view") {
        //var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">'+owner_id+'</Value></Eq><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Submitted</Value></Eq></And></Where><OrderBy><FieldRef Name="EmployeeId" Ascending="False"/><Value ></Value></OrderBy></Query></View>';
        //var query_cml='<View><Query><Where><And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">'+owner_id+'</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Submitted</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Manager Approved</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Approver 1 Approved</Value></Eq><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Approver 2 Approved</Value></Eq></Or></Or></Or></And></Where><OrderBy><FieldRef Name="EmployeeId" Ascending="False"/><Value ></Value></OrderBy></Query></View>';		
        var query_cml = 'Items?$filter=PendingWithId eq \'' + owner_id + '\'  and  ((ReportStatus eq \'Manager Approved\') or (ReportStatus eq \'Submitted\') or (ReportStatus eq \'Approver 2 Approved\') or (ReportStatus eq \'Approver 1 Approved\')) &$orderby= EmployeeId desc';
    } else {

        //var query_cml='<View><Query><Where><And><Eq><FieldRef Name="PendingWithId" /><Value Type="Text">'+owner_id+'</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Submitted</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Manager Approved</Value></Eq><Or><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Approver 1 Approved</Value></Eq><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">Approver 2 Approved</Value></Eq></Or></Or></Or></And></Where><OrderBy><FieldRef Name="ProjectId" Ascending="False"/><Value ></Value></OrderBy></Query></View>';
        var query_cml = 'Items?$filter=PendingWithId eq \'' + owner_id + '\'  and  ((ReportStatus eq \'Manager Approved\') or (ReportStatus eq \'Submitted\') or (ReportStatus eq \'Approver 2 Approved\') or (ReportStatus eq \'Approver 1 Approved\')) &$orderby= ProjectId desc';
    }
    $.ajax({
        url: url + "/_api/web/lists/getbytitle('" + listname + "')/" + query_cml,
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },

        success: function(data) 
		{
			var temp;
            var temp_amount = "";
            var temp_currency = "";

            if (data.d.results.length > 0) {
                // alert(data.d.results.length);
				master_data=data.d.results;
                $.each(data.d.results, function(key, value) {
                    EmpBaseLocation = '';
                    AdavanceCurrency = '';

                    BaseLocation = value.EmpBaseLocation;
                    AdavanceCurrency = value.CurrencyId;

                    if (type == "Resource_view") 
					{
                        if (value.EmployeeId != temp) 
						{
                            temp = value.EmployeeId;
                            checkbox_id = "Resource";
                            Resourcediv_Id = "Resource";
                            Resource_sub_div = "Resource_child";
                            count++;
                            Resource_sub_div = Resource_sub_div + count;
                            Resourcediv_Id = Resourcediv_Id + value.EmployeeId;
                            checkbox_id = checkbox_id + count + "checkbox";
                            anchor_tagid = "Resource" + count + "anchor";
                            var expense_count;
                            //expense_count = GetExpenseByResourceid('BconeExpenceMaster', value.EmployeeId, 'Resource_View');
							
							expense_count= linqrefine('Resource_View',value.EmployeeId);
                            ////alert("expense_count"+expense_count);
                            PendingExpenseCount = parseInt(expense_count) + parseInt(PendingExpenseCount);
                            document.getElementById("PendingExpenseCount").innerHTML = PendingExpenseCount;

                            var attrname = value.EmployeeName + ":" + Resourcediv_Id;
                            //alert(attrname);
                            var nilam = Mymethod();
                            // //alert("nilam"+nilam);
                            //alert(value.CurrencyId);
                            var testtt = "";
                            for (i = 0; i < nilam.length; i++) {
                                testtt = testtt + "<span>" + nilam[i].Amount + "-" + nilam[i].CurrencyId + "</span>";

                            }
                            $('#bindcurrencydata').html(testtt);

                            var currencybyproject = Mymethod1(value.EmployeeId, "Emp");
                            var testtt1 = "";
                            for (i = 0; i < currencybyproject.length; i++) {
                                var exp_amount = "";
                                if (currencybyproject[i].Amount != null) {
                                    exp_amount = currencybyproject[i].Amount;
                                    if (exp_amount.toString().indexOf(".")) {

                                        //exp_amount=exp_amount.toFixed(2);
                                        exp_amount = parseFloat(exp_amount).toFixed(2);
                                    } else {
                                        exp_amount = exp_amount + ".00";

                                    }

                                }
                                testtt1 = testtt1 + "<span class='spanbor'>" + exp_amount + "-" + currencybyproject[i].CurrencyId + "</span>";
                              
                            }
                            if (expense_count != 0)
                            {
                                getExpenseByResourceId(web_url, "BconeExpenceMaster", Resourcediv_Id, value.EmployeeId, Resource_sub_div, anchor_tagid, checkbox_id, "Resource_View", AdavanceCurrency, BaseLocation);

                                // getExpenseByResourceId( web_url ,'BconeExpenceMaster', Resourcediv_Id , value.EmployeeId ,Resource_sub_div,anchor_tagid,checkbox_id,'Resource_View');
                                var panal_headingid = "panal_heading" + value.ID;
                                Resourcediv_Main = Resourcediv_Main + "<div class='panel panel-default MainDiv' onclick='panelfun()' name='ss'>";
                                Resourcediv_Main = Resourcediv_Main + " <div class='panel-heading' id='" + panal_headingid + "'>";
                                Resourcediv_Main = Resourcediv_Main + "<h4 class='panel-title'>";
                                Resourcediv_Main = Resourcediv_Main + "<h4 class='panel-title'>";

                                // Resourcediv_Main=Resourcediv_Main+"<input type='checkbox' name=\""+attrname+"\" class='new-checkbox  Parencheckbox "+Resourcediv_Id+"' id="+checkbox_id+" onchange='checkchild_checkboxex(\"" + Resourcediv_Id + "\",\""+checkbox_id+"\")' onclick='getExpenseByResourceId(\"" + web_url + "\",\"BconeExpenceMaster\", \"" + Resourcediv_Id + "\", \"" + value.EmployeeId + "\",\""+Resource_sub_div+"\",\""+anchor_tagid+"\",\""+checkbox_id+"\",\"Resource_View\",\""+AdavanceCurrency+"\",\""+BaseLocation+"\")'  />";
                                Resourcediv_Main = Resourcediv_Main + "<a style='padding-bottom:1px;' class='accordion-toggle' data-toggle='collapse' data-parent='#accordion' id=" + anchor_tagid + " href='#" + Resource_sub_div + "' onclick='getExpenseByResourceId(\"" + web_url + "\",\"BconeExpenceMaster\", \"" + Resourcediv_Id + "\", \"" + value.EmployeeId + "\",\"" + Resource_sub_div + "\",\"" + anchor_tagid + "\",\"" + checkbox_id + "\",\"Resource_View\",\"" + AdavanceCurrency + "\",\"" + BaseLocation + "\")'>";
                                Resourcediv_Main = Resourcediv_Main + "<span class='row' style='display:inline-block; width:100%;'>";
                                Resourcediv_Main = Resourcediv_Main + "<span class='col-md-4'>";
                                //Resourcediv_Main=Resourcediv_Main+"<li> </li>";
                                Resourcediv_Main = Resourcediv_Main + "" + value.EmployeeName + "";
                                Resourcediv_Main = Resourcediv_Main + "</span>";
                                Resourcediv_Main = Resourcediv_Main + "<span class='col-md-4 text-center' style='font-size:11px;'>";
                                Resourcediv_Main = Resourcediv_Main + "" + testtt1 + "";
                                Resourcediv_Main = Resourcediv_Main + "</span>";
                                Resourcediv_Main = Resourcediv_Main + "<span class='col-md-4' style='text-align:right; padding-right:0''>";
                                Resourcediv_Main = Resourcediv_Main + "" + expense_count + "–  Expense Request";
                                Resourcediv_Main = Resourcediv_Main + "</span>";
                                Resourcediv_Main = Resourcediv_Main + "</span>"
                                Resourcediv_Main = Resourcediv_Main + "</a>";
                                Resourcediv_Main = Resourcediv_Main + "</h4>";
                                Resourcediv_Main = Resourcediv_Main + "</div>";
                                Resourcediv_Main = Resourcediv_Main + "<div id=" + Resource_sub_div + " class='panel-collapse collapse'><!-- Add 'in' class Heare -->";
                                Resourcediv_Main = Resourcediv_Main + "<div class='panel-body' style='padding-right:0''>";
                                Resourcediv_Main = Resourcediv_Main + "<div class='panel-group accordion1' id='" + Resourcediv_Id + "'>";
                                Resourcediv_Main = Resourcediv_Main + "</div>";
                                Resourcediv_Main = Resourcediv_Main + "</div>";
                                Resourcediv_Main = Resourcediv_Main + "</div>";
                                Resourcediv_Main = Resourcediv_Main + "</div>";

                            }
                        }
                    } 
					else 
					{
                        if (value.ProjectId != temp) 
						{
                            temp = value.ProjectId;
                            checkbox_id = "Resource";
                            Resourcediv_Id = "Resource";
                            Resource_sub_div = "Resource_child";
                            count++;
                            Resource_sub_div = Resource_sub_div + count;
                            Resourcediv_Id = Resourcediv_Id + value.ProjectId;
                            checkbox_id = checkbox_id + count + "checkbox";
                            anchor_tagid = "Resource" + count + "anchor";
                            var expense_count;
                           // expense_count = GetExpenseByResourceid('BconeExpenceMaster', value.ProjectId, 'Project_view', AdavanceCurrency, BaseLocation);
							expense_count= linqrefine('Project_view',value.ProjectId);
                            PendingExpenseCount = parseInt(expense_count) + parseInt(PendingExpenseCount);
                            document.getElementById("PendingExpenseCount").innerHTML = PendingExpenseCount;
                            var attrname = value.Projectname + ":" + Resourcediv_Id;
                         
                            var nilam = Mymethod();
                            //alert(nilam);
                            var testtt = "";
                            for (i = 0; i < nilam.length; i++) {
                                testtt = testtt + "<span>" + nilam[i].Amount + "-" + nilam[i].CurrencyId + "</span>";
                        
                            }
                            $('#bindcurrencydata').html(testtt);

                            var currencybyproject = Mymethod1(value.ProjectId, "Proj");
                            var testtt1 = "";
                            for (i = 0; i < currencybyproject.length; i++) {

                                var exp_amount = "";
                                if (currencybyproject[i].Amount != null) {
                                    exp_amount = currencybyproject[i].Amount;
                                    if (exp_amount.toString().indexOf(".")) 
									{
										exp_amount = parseFloat(exp_amount).toFixed(2);
                                    } 
									else
									{
                                        exp_amount = exp_amount + ".00";
                                    }
                                }
                                testtt1 = testtt1 + "<span class='spanbor'>" + exp_amount + "-" + currencybyproject[i].CurrencyId + "</span>";
                            }

                            if (expense_count != 0) {
                                getExpenseByResourceId(web_url, "BconeExpenceMaster", Resourcediv_Id, value.ProjectId, Resource_sub_div, anchor_tagid, checkbox_id, "Project_View", AdavanceCurrency, BaseLocation);

                                // getExpenseByResourceId( web_url ,'BconeExpenceMaster', Resourcediv_Id , value.EmployeeId ,Resource_sub_div,anchor_tagid,checkbox_id,'Project_View');
                                var panal_headingid = "panal_heading" + value.ID;
                                Resourcediv_Main = Resourcediv_Main + "<div class='panel panel-default MainDiv' name='ss' onclick='panelfun()'>";
                                Resourcediv_Main = Resourcediv_Main + " <div class='panel-heading' id='" + panal_headingid + "' >";
                                Resourcediv_Main = Resourcediv_Main + "<h4 class='panel-title'>";
                                Resourcediv_Main = Resourcediv_Main + "<h4 class='panel-title'>";
                                //Resourcediv_Main=Resourcediv_Main+"<input type='checkbox' name=\""+attrname+"\" class='new-checkbox  Parencheckbox "+Resourcediv_Id+"' id="+checkbox_id+" onchange='checkchild_checkboxex(\"" + Resourcediv_Id + "\",\""+checkbox_id+"\")' onclick='getExpenseByResourceId(\"" + web_url + "\",\"BconeExpenceMaster\", \"" + Resourcediv_Id + "\", \"" + value.ProjectId + "\",\""+Resource_sub_div+"\",\""+anchor_tagid+"\",\""+checkbox_id+"\",\"Project_View\",\""+AdavanceCurrency+"\",\""+BaseLocation+"\")'/>";
                                Resourcediv_Main = Resourcediv_Main + "<a style='padding-bottom:1px;' class='accordion-toggle' data-toggle='collapse' data-parent='#accordion' id=" + anchor_tagid + " href='#" + Resource_sub_div + "' onclick='getExpenseByResourceId(\"" + web_url + "\",\"BconeExpenceMaster\", \"" + Resourcediv_Id + "\", \"" + value.ProjectId + "\",\"" + Resource_sub_div + "\",\"" + anchor_tagid + "\",\"" + checkbox_id + "\",\"Project_View\",\"" + AdavanceCurrency + "\",\"" + BaseLocation + "\")'>";
                                Resourcediv_Main = Resourcediv_Main + "<span class='row' style='width:100%; display:inline-block;'>";
                                Resourcediv_Main = Resourcediv_Main + "<span class='col-md-4'>";
                                //Resourcediv_Main=Resourcediv_Main+"<li> </li>";
                                Resourcediv_Main = Resourcediv_Main + "" + value.Projectname + "";
                                Resourcediv_Main = Resourcediv_Main + "</span>";
                                Resourcediv_Main = Resourcediv_Main + "<span class='col-md-4 text-center' style='font-size:11px;'>";
                                Resourcediv_Main = Resourcediv_Main + "" + testtt1 + "";
                                Resourcediv_Main = Resourcediv_Main + "</span>";
                                Resourcediv_Main = Resourcediv_Main + "<span class='col-md-4' style='text-align:right; padding-right:0px;'>";
                                Resourcediv_Main = Resourcediv_Main + "" + expense_count + "–  Expense Request";
                                Resourcediv_Main = Resourcediv_Main + "</span>";
                                Resourcediv_Main = Resourcediv_Main + "</span>";
                                Resourcediv_Main = Resourcediv_Main + "</a>";
                                Resourcediv_Main = Resourcediv_Main + "</h4>";
                                Resourcediv_Main = Resourcediv_Main + "</div>";
                                Resourcediv_Main = Resourcediv_Main + "<div id=" + Resource_sub_div + " class='panel-collapse collapse'><!-- Add 'in' class Heare -->";
                                Resourcediv_Main = Resourcediv_Main + "<div class='panel-body' style='padding-right:0px;'>";
                                Resourcediv_Main = Resourcediv_Main + "<div class='panel-group accordion1' id='" + Resourcediv_Id + "'>";
                                Resourcediv_Main = Resourcediv_Main + "</div>";
                                Resourcediv_Main = Resourcediv_Main + "</div>";
                                Resourcediv_Main = Resourcediv_Main + "</div>";
                                Resourcediv_Main = Resourcediv_Main + "</div>";
                            }
                        }


                    }


                });
                $("#Upper_strip").show();
            } else {
                Resourcediv_Main = Resourcediv_Main + "<div class='nodatadiv'>";
                Resourcediv_Main = Resourcediv_Main + "<h3 style='color:#2EA0E6;'>No Expense Pending for Approval</h3>";
                Resourcediv_Main = Resourcediv_Main + "</div>";
                $("#Upper_strip").hide();
                $("#Upper_strip1").show();

                //alert(Resourcediv_Main);  

            }
            // alert(Resourcediv_Main);
            $('#accordion').html(Resourcediv_Main);


            // alert(Resourcediv_Main);
            // $('.loader').hide();


        },
        error: function(data) {
            alert(data.responseJSON.error.message.value);
            failure(data);
            $('.loader').hide();
        },
        complete: function() {
               $('.loader').hide();
					//console.log('completed');
				if(PendingExpenseCount=master_data.length)
					{
						setTimeout(function(){
							Bind_CurrencyData();
						},4000);
					}




        }
    });
}


function getExpenseByResourceId(url, listname, datatobind_divid, Resource_id, dataparent_div, parent_anchor, parent_checkbox, type, CurrencyId, EmpBaseLocation) {
    ////alert("getExpenseByResourceId_amol");

    var CurrencyId = '';
    var EmpBaseLocation = '';

    //people=[];
    // $('.loader').show();
    if (type == "Resource_View") {
        var query_cml = 'Items?$filter=PendingWithId eq \'' + proxyid + '\' and  EmployeeId eq \'' + Resource_id + '\' and  ((ReportStatus eq \'Manager Approved\') or (ReportStatus eq \'Submitted\') or (ReportStatus eq \'Approver 2 Approved\') or (ReportStatus eq \'Approver 1 Approved\')) &$orderby= EmployeeId desc';
    } else {
        var query_cml = 'Items?$filter=PendingWithId eq \'' + proxyid + '\' and  ProjectId eq \'' + Resource_id + '\' and  ((ReportStatus eq \'Manager Approved\') or (ReportStatus eq \'Submitted\') or (ReportStatus eq \'Approver 2 Approved\') or (ReportStatus eq \'Approver 1 Approved\')) &$orderby= EmployeeId desc';
    }

    //alert(query_cml);
    var expense_div_data = "";
    var parentcheck = $('#' + parent_checkbox).prop("checked");
    var childanchor = "";

    var expense_data_div_id = "expense_data_div";
    var check_boxex_class = "Resource" + Resource_id + "checkboxex";
    var i = 0;
    $.ajax({
        url: url + "/_api/web/lists/getbytitle('" + listname + "')/" + query_cml,
        type: "GET",
        headers: {
            "Accept": "application/json;odata=verbose"
        },

        success: function(data) {
            //console.log(data);
            i = 0;
            //alert(data.d.results.length);
            if (data.d.results.length > 0) 
			{
				$('.loader').show();
                $.each(data.d.results, function(key, value) {
                    var currval = "_";
                    if (value.ExpenseCurrencyText != null && value.ExpenseCurrencyText != "") {
                        if (value.ExpenseCurrencyText.indexOf("-")) {
                            var curr = value.ExpenseCurrencyText.split("-");
                            //alert(curr[0]);
                            currval = curr[0];
                        } else {
                            currval = value.ExpenseCurrencyText;
                        }
                    }
                    CurrencyId = value.CurrencyId;
                    EmpBaseLocation = value.EmpBaseLocation;
                    var currencybyproject = GroupByTrackingNo(value.ID);
                    var testtt1 = "";
                    var curr_values = "";
                    for (var j = 0; j < currencybyproject.length; j++) {
                        var exp_amount = "";
                        if (currencybyproject[j].Amount != null) {
                            exp_amount = currencybyproject[j].Amount;
                            if (exp_amount.toString().indexOf(".")) {

                                //exp_amount=exp_amount.toFixed(2);
                                exp_amount = parseFloat(exp_amount).toFixed(2);
                            } else {
                                exp_amount = exp_amount + ".00";
                            }
                        }
                        testtt1 = testtt1 + "<span class='spanbor'>" + exp_amount + "-" + currencybyproject[j].CurrencyId + "</span>"
                        if (curr_values != "") {
                            curr_values = curr_values + "," + exp_amount + "-" + currencybyproject[j].CurrencyId + "";
                        } else {
                            curr_values = exp_amount + "-" + currencybyproject[j].CurrencyId + "";
                        }
                    }

                    i = i + 1;
                    childanchor = parent_anchor + "child_" + i;
                    expense_data_div_id = datatobind_divid + "_" + "expense_data_div";
                    expense_data_div_id = expense_data_div_id + "_" + i;
                    expense_div_data = expense_div_data + "<div class='panel panel-default' id='FadeoutDiv" + value.ID + "' >";
                    expense_div_data = expense_div_data + "<div class='panel-heading'>";
                    expense_div_data = expense_div_data + "<h4 class='panel-title'>";
                    if (parentcheck) {
                        // expense_div_data=expense_div_data+"<input type='checkbox' checked='checked' name='"+ value.ID+":"+value.ExpenseReportName+"' class='new-checkbox "+check_boxex_class+" ChildCheckbox' onchange='checkparent_checkboxex(\"" + Resource_id + "\")' />";
                    } else {
                        //expense_div_data=expense_div_data+"<input type='checkbox' class='new-checkbox "+check_boxex_class+" ChildCheckbox'  name='"+ value.ID+":"+value.ExpenseReportName+"' onchange='checkparent_checkboxex(\"" + Resource_id + "\")' />";
                    }

                    getExpenseItemByExpenseID(value.ID, expense_data_div_id, childanchor, type, CurrencyId, EmpBaseLocation, value.ExpenseTrackingNo, currval);

                    expense_div_data = expense_div_data + " <a style='display: inline-block; width: 100%; padding-bottom:1px; margin-left: -5px; margin-right: -13px;' class='accordion-toggle' id=" + childanchor + " data-toggle='collapse' data-parent='#" + datatobind_divid + "' href='#" + expense_data_div_id + "' onclick='getExpenseItemByExpenseID(\"" + value.ID + "\",\"" + expense_data_div_id + "\",\"" + childanchor + "\",\"" + type + "\",\"" + CurrencyId + "\",\"" + EmpBaseLocation + "\",\"" + value.ExpenseTrackingNo + "\",\"" + currval + "\")'>";

                    expense_div_data = expense_div_data + " <span class='row' style='display:inline-block; width: 99%; margin-left: -5px;'>";
                    expense_div_data = expense_div_data + " <ul class='pull-left col-md-6'>";
                    // expense_div_data=expense_div_data+" <li>ID : " + value.ID + " </li>";
                    expense_div_data = expense_div_data + " <li>" + value.ExpenseTrackingNo + " </li>";
                    expense_div_data = expense_div_data + " <li> | ExpName: " + value.ExpenseReportName + "</li>";
                    if (type != "Resource_View") {
                        expense_div_data = expense_div_data + " <li> | ResName: " + value.EmployeeName + "</li>";
                    } else {
                        expense_div_data = expense_div_data + " <li> | PrjName: " + value.Projectname + "</li>";
                    }



                    expense_div_data = expense_div_data + " <li> | ER Currency: " + currval + "</li>";
                    expense_div_data = expense_div_data + "</ul>";
                    var exp_amount = "";
                    if (value.FinalExpenseValue != null) {
                        exp_amount = value.FinalExpenseValue;
                        if (exp_amount.toString().indexOf(".")) {

                            //exp_amount=exp_amount.toFixed(2);
                            exp_amount = parseFloat(exp_amount).toFixed(2);
                        } else {
                            exp_amount = exp_amount + ".00";

                        }

                    }
                    expense_div_data = expense_div_data + "<ul class='col-md-6 text-right' style='font-size:11px;'>";
                    expense_div_data = expense_div_data + " <li>" + exp_amount + "   " + currval + "</li>";

                    expense_div_data = expense_div_data + " </ul>";

                    var advance_amt = "";
                    expense_div_data = expense_div_data + " </span>";
                    expense_div_data = expense_div_data + " </a>";
                    expense_div_data = expense_div_data + "</h4>";
                    expense_div_data = expense_div_data + " </div>";
                    expense_div_data = expense_div_data + " <div id=" + expense_data_div_id + " class='panel-collapse collapse ' >";
                    expense_div_data = expense_div_data + " </div>";
                    expense_div_data = expense_div_data + "</div>";
                });
                $('#' + datatobind_divid).html(expense_div_data);
                $('#' + parent_anchor).prop('onclick', null).off('click');
                $('#' + parent_checkbox).prop('onclick', null).off('click');
				$('.loader').hide();
            } 
			else {
                // $('.loader').hide();
            }
			 
        },
        error: function(data) {
            alert(data.responseJSON.error.message.value);
            failure(data);
        }
    });
}

function getcurrencyValueById(listname, id) {
    // //alert("id" + id);
    ////alert("getListItem1");
    ////alert("show();");
    //$('.loader').show();
    var ss;
    $.ajax({
        url: web_url + "/_api/web/lists/getbytitle('" + listname + "')/items(" + id + ")",
        async: false,
        method: "GET",
        headers: {
            "Accept": "application/json; odata=verbose"
        },

        success: function(data) {




            //alert(data.d);
            $.each(data, function(key, value) {
                ////alert("value"+value.Currency);

                if (listname != "BconeCurrency") {
                    ss = value.Item;

                    return ss;
                } else {
                    ss = value.Currency;

                    return ss;

                }


            });

        },
        error: function(data) {
            //failure(data);
            alert(data.responseJSON.error.message.value);
        }
    });
    return ss;
}

function convert_date(date_to_convert) {
    //alert(date_to_convert);
    var m_names = new Array("Jan", "Feb", "Mar",
        "Apr", "May", "Jun", "Jul", "Aug", "Sep",
        "Oct", "Nov", "Dec");

    var d = new Date(date_to_convert);

    var curr_date = d.getDate();
    var curr_month = d.getMonth();
    var curr_year = d.getFullYear();
    var converted_date = curr_date + "-" + m_names[curr_month] + "-" + curr_year;

    return converted_date;

}

function getListItemForUpdate(url, listname, Id, complete) {
    //alert(Id);
    ////alert("getListItembyid");

    $.ajax({

        url: url + "/_api/web/lists/GetByTitle('" + listname + "')/items('" + Id + "')",
        method: "GET",
        headers: {
            "Accept": "application/json; odata=verbose"
        },
        success: function(data) {

            complete(data);




        },
        error: function(data) {
            //  //alert("false");   
        }
    });
}
function getListprotocol(name) {
    //alert(name);

    return "SP.Data." + name.charAt(0).toUpperCase() + name.split(" ").join("").slice(1) + "ListItem";
}

function UpdateExpenseStatusTemp(id, status, expense_item_table_tbody_id, type, approve_type, finance_guid, finance_name, show_id) {

    ////alert("Confirmation_alert");

    // Method_tocall=UpdateExpenseStatus(id,status,expense_item_table_tbody_id,type,approve_type);
    //var  hiddenInput = document.getElementById("#ok_click");
    //alert(hiddenInput);
    // hiddenInput.setAttribute("value", "test");
    //var test=UpdateExpenseStatusTemp(id,status,expense_item_table_tbody_id,type,approve_type);
    document.getElementById("Confirmation_msg").innerHTML = "Are you sure you want to approve expense?";
    $('#ok_click').attr('onclick', 'UpdateExpenseStatus("' + id + '","' + status + '","' + expense_item_table_tbody_id + '","' + type + '","' + approve_type + '","' + finance_guid + '","' + finance_name + '","' + show_id + '")');
    $("#Confirmation_alert").show();


}



function UpdateExpenseStatus(id, status, expense_item_table_tbody_id, type, approve_type, finance_guid, finance_name, show_id) {
    $('.loader').show();
    var status_temp = "";

    Approver2Id = "";
    Approver2Name = "";
    Approver1Id = "";
    Approver1Name = "";
    finance_approver_id = "";
    finance_approver_name = "";
    pending_with_id = "";
    pending_with_name = "";

    PendingWithId = "";
    PendingWithName = "";
    ExpenseApproveType = "";
    expense_creater_id = "";
    GetApprovalFinaceDetail(id);
    var user_id = _spPageContextInfo.userId;
    var current_username = _spPageContextInfo.userDisplayName;
    var current_user_GUID = GetUserId(user_id);

    if (pending_with_id == Approver1Id) {
        if (Approver2Id != "Na" && Approver2Id != null && Approver2Id != "") {
            PendingWithId = Approver2Id;
            PendingWithName = Approver2Name;
            status_temp = "Approver 1 Approved";

        } else {

            if (ExpenseApproveType == "2-Level") {
                //PendingWithId=finance_approver_id; 
                PendingWithId = "";
                PendingWithName = finance_approver_name;
                status_temp = "Manager Approved";
            } else {
                //PendingWithId=finance_approver_id; 
                PendingWithId = "";
                PendingWithName = finance_approver_name;
                status_temp = "Approver 1 Approved";

            }

            //status_temp="Approved";
        }
    } else if (pending_with_id == Approver2Id) {
        //PendingWithId=finance_approver_id; 
        PendingWithId = "";
        PendingWithName = finance_approver_name;
        status_temp = "Approver 2 Approved";
    }




    <!-- if(Approver2Id!="Na") -->
    <!-- { -->
    <!-- if(pending_with_id!=Approver2Id) -->
    <!-- { -->
    <!-- PendingWithId=finance_approver_id; -->
    <!-- PendingWithName=finance_approver_name; -->
    <!-- } -->
    <!-- else -->
    <!-- { -->
    <!-- PendingWithId=Approver2Id; -->
    <!-- PendingWithName=Approver2Name; -->
    <!-- } -->

    <!-- } -->
    <!-- else -->
    <!-- { -->
    <!-- PendingWithId=finance_approver_id; -->
    <!-- PendingWithName=finance_approver_name; -->
    <!-- } -->

    var currentdate = new Date();

    var date = currentdate;

    $("#Confirmation_alert").hide();
    var listName = "BconeExpenceMaster";
    var proxy_name = $('#login_name_contain').text();
    var proxy_msg = "Approved on behalf of " + pending_with_name + " by Proxy " + proxy_name + "";

    //$('.loader').show();
    var itemType = getListprotocol(listName);


    <!--  "ReportStatus": status       -->


    var item = {
        "__metadata": {
            "type": itemType
        },
        "PendingWithName": PendingWithName,
        "PendingWithId": PendingWithId,
        //  "FinanceName":PendingWithName,
        //  "FinanceId":PendingWithId,
        "ManagerActionDate": date,
        "ProjectManagerExpenseStatus": status,
        "ReportStatus": status_temp,
        <!-- "LastActionBy": pending_with_name, -->
        "LastActionBy": current_username,
        "LastActionById": current_user_GUID,
        "ProxyApprovalRemark": proxy_msg
    };


    getListItemForUpdate(web_url, listName, id, function(data) {



        $.ajax({
            url: data.d.__metadata.uri,
            type: "POST",
            contentType: "application/json;odata=verbose",
            data: JSON.stringify(item),
            headers: {
                "Accept": "application/json;odata=verbose",
                "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                "X-HTTP-Method": "MERGE",
                "If-Match": data.d.__metadata.etag
            },
            success: function(data) {
                //InsertIntoLog(web_url, "BconeExpenseLogHistory",id,"03",pending_with_name,pending_with_id,"Approved",'');
                InsertIntoLog(web_url, "BconeExpenseLogHistory", id, "", pending_with_name, pending_with_id, "Approved", proxy_msg, owner_id, proxy_name);


                //finalCc=pending_with_id;
                //finalTo=expense_creater_id;
                //
                //GetEmailData(id,'02');
                if (pending_with_id == Approver1Id) {
                    if (Approver2Id != "Na" && Approver2Id != null && Approver2Id != "") {
                        PendingWithId = Approver2Id;
                        PendingWithName = Approver2Name;
                        status_temp = "Approver 1 Approved";
                        finalCc = pending_with_id;
                        finalTo = expense_creater_id;
                        PathUrl = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/MyExpense.aspx?status=Approved";
                        PathURLPDF = "https://ppmprod.bcone.com/download.aspx?TID=" + id;
                        var finalccc = $('#ddlemployee option:selected').val();
                        //GetEmailData(id,'02');
                        InsertIntoMailLog('BconeEmailData', finalTo, finalccc, PathUrl, '02', id, '2', PathURLPDF);
                        finalCc = pending_with_id + ";" + expense_creater_id;
                        finalTo = Approver2Id;
                        PathUrl = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/ExpenseApproval.aspx";
                        //Adding Manohar finalCC  

                        InsertIntoMailLog('BconeEmailData', finalTo, '', PathUrl, '01', id, '1', '');
                        //GetEmailData(id,'01');


                    } else {

                        if (ExpenseApproveType == "2-Level") {
                            PendingWithId = finance_approver_id;
                            PendingWithName = finance_approver_name;
                            status_temp = "Manager Approved";
                            finalCc = pending_with_id;
                            finalTo = expense_creater_id;
                            PathUrl = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/MyExpense.aspx?status=Approved";
                            // GetEmailData(id,'02');
                            PathURLPDF = "https://ppmprod.bcone.com/download.aspx?TID=" + id;
                            var finalccc = $('#ddlemployee option:selected').val();
                            InsertIntoMailLog('BconeEmailData', finalTo, finalccc, PathUrl, '02', id, '2', PathURLPDF);
                            finalCc = pending_with_id + ";" + expense_creater_id;
                            finalTo = finance_approver_id;
                            PathUrl = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/FinanceExpenseApproveDetail.aspx?TrackingNo=" + id;
                            // GetEmailData(id,'04');
                            InsertIntoMailLog('BconeEmailData', finalTo, '', PathUrl, '04', id, '1', '');

                        } else {
                            PendingWithId = finance_approver_id;
                            PendingWithName = finance_approver_name;
                            status_temp = "Approver 1 Approved";
                            finalCc = pending_with_id;
                            finalTo = expense_creater_id;
                            PathUrl = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/MyExpense.aspx?status=Approved";
                            // GetEmailData(id,'02');
                            PathURLPDF = "https://ppmprod.bcone.com/download.aspx?TID=" + id;
                            var finalccc = $('#ddlemployee option:selected').val();
                            InsertIntoMailLog('BconeEmailData', finalTo, finalccc, PathUrl, '02', id, '2', PathURLPDF);

                            finalCc = pending_with_id + ";" + expense_creater_id;
                            finalTo = Approver2Id;
                            PathUrl = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/ExpenseApproval.aspx";
                            //GetEmailData(id,'01');
                            InsertIntoMailLog('BconeEmailData', finalTo, '', PathUrl, '01', id, '1', '');


                        }

                    }
                } else if (pending_with_id == Approver2Id) {
                    PendingWithId = finance_approver_id;
                    PendingWithName = finance_approver_name;
                    status_temp = "Approver 2 Approved";
                    finalCc = pending_with_id + ";" + Approver1Id;
                    finalTo = expense_creater_id;
                    PathUrl = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/MyExpense.aspx?status=Approved";
                    // GetEmailData(id,'02');
                    PathURLPDF = "https://ppmprod.bcone.com/download.aspx?TID=" + id;
                    var finalccc = $('#ddlemployee option:selected').val();
                    InsertIntoMailLog('BconeEmailData', finalTo, finalccc, PathUrl, '02', id, '2', PathURLPDF);
                    finalCc = Approver2Id + ";" + expense_creater_id + ";" + Approver1Id;
                    finalTo = finance_approver_id;
                    PathUrl = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/FinanceExpenseApproveDetail.aspx?TrackingNo=" + id;
                    //GetEmailData(id,'04');	
                    InsertIntoMailLog('BconeEmailData', finalTo, '', PathUrl, '04', id, '1', '');
                }

                if (approve_type != "MultiApprove") {
                    ////alert("Expence Approved sucessfully");

                    $("#alertmain").show();

                    document.getElementById("Alert_msg").innerHTML = " " + show_id + " | Approved sucessfully";

                }
                //alert('FadeoutDiv'+id);							
                $('#FadeoutDiv' + id).fadeOut();



                getResources(web_url, 'BconeExpenceMaster', proxyid, 'Project_view');

            },
            error: function(data) {
                alert(data.responseJSON.error.message.value);
                ////alert("false");
                // failure(data);
                //  $('.loader').hide();
            },
            complete: function() {

                $('.loader').hide();
            }

        });

    }, function(data) {
        failure(data);
    });



}
        function RejectExpense(id, status, expense_item_table_tbody_id, type, ExpenseTrackingNo) {


            $('#Txt_Comment').css({

                "border": "",
                "background": ""
            });
            document.getElementById("AlertMsg").innerHTML = "";
            document.getElementById("Txt_Comment").value = "";
            //$('#myModal2').modal('show');	
            // document.getElementById("Expense_Comment_Id").innerHTML = id;	
            // document.getElementById("Reject_Hide").innerHTML=expense_item_table_tbody_id;
            //document.getElementById("Confirmation_msg").innerHTML="Are you sure you want To Reject Expense?";
            //$('#ok_click').attr('onclick','RejectExpenseOkClick("'+id+'","'+status+'","'+expense_item_table_tbody_id+'","'+type+'")');
            // $("#Confirmation_alert").show();
            $("#Confirmation_alert").hide();
            $('#myModal2').modal('show');
            document.getElementById("Expense_Comment_Id").innerHTML = id;
            document.getElementById("Expense_Tracking_No").innerHTML = ExpenseTrackingNo;
            document.getElementById("Reject_Hide").innerHTML = expense_item_table_tbody_id;
        }

        function RejectExpenseOkClick(id, status, expense_item_table_tbody_id, type) {
            $("#Confirmation_alert").hide();
            $('#myModal2').modal('show');
            document.getElementById("Expense_Comment_Id").innerHTML = id;
            document.getElementById("Reject_Hide").innerHTML = expense_item_table_tbody_id;

        }



        function Rejectcomment(status) {


            var Expense_Comment_Id = document.getElementById("Expense_Comment_Id").innerHTML;
            var Expense_Tracking_No = document.getElementById("Expense_Tracking_No").innerHTML;

            var status_temp = "";

            Approver2Id = "";
            Approver2Name = "";
            Approver1Id = "";
            Approver1Name = "";
            finance_approver_id = "";
            finance_approver_name = "";
            pending_with_id = "";
            pending_with_name = "";

            PendingWithId = "";
            PendingWithName = "";
            ExpenseApproveType = "";
            expense_creater_id = "";
            GetApprovalFinaceDetail(Expense_Comment_Id);


            if (pending_with_id == Approver1Id) {
                if (Approver2Id != "Na" && Approver2Id != null && Approver2Id != "") {
                    //PendingWithId=Approver2Id;
                    //PendingWithName=Approver2Name;
                    status_temp = "Approver 1 Rejected";

                } else {

                    if (ExpenseApproveType == "2-Level") {
                        //PendingWithId=finance_approver_id; 
                        //PendingWithName=finance_approver_name; 
                        status_temp = "Manager Rejected";
                    } else {
                        //PendingWithId=finance_approver_id; 
                        //PendingWithName=finance_approver_name; 
                        status_temp = "Approver 1 Rejected";

                    }

                    //status_temp="Approved";
                }
            } else if (pending_with_id == Approver2Id) {
                //PendingWithId=finance_approver_id; 
                //PendingWithName=finance_approver_name; 	
                status_temp = "Approver 2 Rejected";
            }




            var currentdate = new Date();

            var date = currentdate;

            var Reject_Hide = document.getElementById("Reject_Hide").innerHTML;

            var Comment = document.getElementById("Txt_Comment").value;
            if (Comment == '') {
                isValid = false;
                $('#Txt_Comment').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });

                document.getElementById("AlertMsg").innerHTML = "Please Enter the Comment";
                document.getElementById("Txt_Comment").focus();

            } else if (Comment.length > 500) {
                isValid = false;
                $('#Txt_Comment').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });




                document.getElementById("AlertMsg").innerHTML = "Description can be max 500 character ";
                document.getElementById("Txt_Comment").focus();

            } else {
                $('#Txt_Comment').css({

                    "border": "",
                    "background": ""
                });

                if ((validation_data(Comment))) {


                    document.getElementById("AlertMsg").innerHTML = "";
                    var listName = "BconeExpenceMaster";
                    var proxy_name = $('#login_name_contain').text();
                    var proxy_msg = "Rejected on behalf of " + pending_with_name + " by Proxy " + proxy_name + "";


                    $('.loader').show();
                    var itemType = getListprotocol(listName);



                    var item = {
                        "__metadata": {
                            "type": itemType
                        },

                        "ReportStatus": status_temp,
                        "ProjectManagerExpenseStatus": status,
                        "ManagerActionDate": date,
                        "Comment": Comment,
                        "LastActionBy": pending_with_name,
                        "LastActionById": pending_with_id,
                        "ProxyApprovalRemark": proxy_msg

                    };


                    getListItemForUpdate(web_url, listName, Expense_Comment_Id, function(data) {



                        $.ajax({
                            url: data.d.__metadata.uri,
                            type: "POST",
                            contentType: "application/json;odata=verbose",
                            data: JSON.stringify(item),
                            headers: {
                                "Accept": "application/json;odata=verbose",
                                "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                                "X-HTTP-Method": "MERGE",
                                "If-Match": data.d.__metadata.etag
                            },
                            success: function(data) {


                                $('#FadeoutDiv' + Expense_Comment_Id).fadeOut();
                                document.getElementById("Txt_Comment").value = "";
                                $('#myModal2').modal('hide');
                                ////alert("Expence Rejected sucessfully");	
                                $("#alertmain").show();

                                //InsertIntoLog(web_url, "BconeExpenseLogHistory",Expense_Comment_Id,"13",pending_with_name,pending_with_id,"Rejected",'');
                                InsertIntoLog(web_url, "BconeExpenseLogHistory", Expense_Comment_Id, "", pending_with_name, pending_with_id, "Rejected", proxy_msg, owner_id, proxy_name);


                                if (pending_with_id == Approver1Id) {
                                    if (Approver2Id != "Na" && Approver2Id != null && Approver2Id != "") {

                                        //status_temp="Approver 1 Rejected";	
                                        finalCc = pending_with_id;
                                        finalTo = expense_creater_id;
                                        //PathUrl="https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/MyExpense.aspx?status=Rejected";
                                        //GetEmailData(Expense_Comment_Id,'03');


                                    } else {

                                        if (ExpenseApproveType == "2-Level") {

                                            //status_temp="Manager Rejected";	
                                            finalCc = pending_with_id;
                                            finalTo = expense_creater_id;
                                            //PathUrl="https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/MyExpense.aspx?status=Rejected";
                                            // GetEmailData(Expense_Comment_Id,'03');										  
                                        } else {

                                            status_temp = "Approver 1 Rejected";
                                            finalCc = pending_with_id;
                                            finalTo = expense_creater_id;
                                            // PathUrl="https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/MyExpense.aspx?status=Rejected";
                                            //GetEmailData(Expense_Comment_Id,'03');	

                                        }


                                    }
                                } else if (pending_with_id == Approver2Id) {

                                    status_temp = "Approver 2 Rejected";
                                    finalCc = pending_with_id + ";" + Approver1Id;
                                    finalTo = expense_creater_id;
                                    //PathUrl="https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/MyExpense.aspx?status=Rejected";
                                    //GetEmailData(Expense_Comment_Id,'03');									 
                                }
                                PathUrl = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/MyExpense.aspx?status=Rejected";
                                getResources(web_url, 'BconeExpenceMaster', proxyid, 'Project_view');
                                // GetEmailData(Expense_Comment_Id,'03');	


                                InsertIntoMailLog('BconeEmailData', finalTo, finalCc, PathUrl, '03', Expense_Comment_Id, '1', '');
                                document.getElementById("Alert_msg").innerHTML = " " + Expense_Tracking_No + " | Rejected sucessfully";



                                $('.loader').hide();
                            },
                            error: function(data) {
                                alert(data.responseJSON.error.message.value);
                                $('.loader').hide();
                                //  $('.loader').hide();
                            }
                        });

                    }, function(data) {
                        failure(data);
                    });

                }

            }

        }
		function Bind_CurrencyData(){
		
			var view_type=document.getElementById("Project_Resource_View").value ;
			var type=view_type;
			var temp='';
			var filtered_data ='';
			
			if(type=="Resource_view")
			{
				filtered_data= new jinqJs()
                   .from(master_data)
                .orderBy([{field: 'EmployeeId', sort: 'desc'}, ])
				.select();
			}
			else
			{
				filtered_data= new jinqJs()
                   .from(master_data)
                .orderBy([{field: 'ProjectId', sort: 'desc'}, ])
				.select();
			}
			
				
				
			$.each(filtered_data, function (key, value) {
			if(type=="Resource_view")
                            {
							
								if(value.EmployeeId!=temp)
                                {
									temp=value.EmployeeId;
									var currencybyproject=Mymethod1(value.EmployeeId,"Resource");
                                    var testtt1="";
									var panal_headingid="currspan"+value.ID;
                                    for(i=0;i<currencybyproject.length;i++)
                                    {
                                        testtt1=testtt1+"<span class='spanbor'>"+currencybyproject[i].Amount+"-"+currencybyproject[i].CurrencyId+"</span>";
                                    }
									$('#'+panal_headingid).append(testtt1);
								}
							
							}
							else
							{
								if(value.ProjectId!=temp)
                                {
									temp=value.ProjectId;
									var currencybyproject=Mymethod1(value.ProjectId,"Proj");
                                    var testtt1="";
									var panal_headingid="currspan"+value.ID;
                                    for(i=0;i<currencybyproject.length;i++)
                                    {
                                        testtt1=testtt1+"<span class='spanbor'>"+currencybyproject[i].Amount+"-"+currencybyproject[i].CurrencyId+"</span>";
                                    }
									$('#'+panal_headingid).append(testtt1);
								}
							
							}
							
			
			
			});
			
			expense_hitcount=0;
		}

        function validation_data(mystring) {

            var iChars = "!@#$%^&*()+=[]\\\'/{}|\":<>";

            for (var i = 0; i < mystring.length; i++) {
                if (iChars.indexOf(mystring[i]) != -1) {
                    $('#Txt_Comment').css({

                        "border": "1px solid red",
                        "background": "#FFCECE"
                    });
                    //alert ("Your username has special characters. \nThese are not allowed.\n Please remove them and try again.");
                    document.getElementById("AlertMsg").innerHTML = "You have entered an invalid following characters: !@#$%^&*()+=[]\'/{}|\\\":<>";
                    document.getElementById("Txt_Comment").focus();
                    return false;
                }
            }
            return true;
        }

        function hideerror(val1) {


            $('#' + val1).css({

                "border": "",
                "background": ""
            });

            document.getElementById("AlertMsg").innerHTML = "";


        }

        function getExpenseItemByExpenseID(expense_id, datatobind_divid, expenseanchorid, type, CurrencyId, EmpBaseLocation, ExpenseTrackingNo, currval1) {
            //alert('getExpenseItemByExpenseID'+ ' '+'CurrencyId:'+CurrencyId+ ' '+'EmpBaseLocation: '+EmpBaseLocation  );
            $("[data-toggle='tooltip']").tooltip();
            var BaseLocation = '';
            var AdavanceCurrency = '';

            if (CurrencyId != '' && CurrencyId != 'null' && CurrencyId != 'undefined') {
                AdavanceCurrency = CurrencyId;

            }

            if (EmpBaseLocation != '' && EmpBaseLocation != 'null' && EmpBaseLocation != 'undefined') {
                BaseLocation = EmpBaseLocation;

            }

            // alert('AdavanceCurrency'+ ' '+'AdavanceCurrency:'+AdavanceCurrency+ ' '+'BaseLocation: '+BaseLocation  );

            var isINRCurrency = true;

            var isBaseLocationBengluru = true;

            var isAdvanceTakenINR = true;

            var checkbox_checked = false;

            //checkbox_checked=$('.new-checkbox').prop("checked");

            $('.ChildCheckbox:checkbox:checked').each(function() {
                checkbox_checked = true;
                ////alert("true");
            });

            // //alert("ekdach click");
            //$('.loader').show();
            // var query_cml = '<View><Query><Where><Eq><FieldRef Name="TrackingNo" /><Value Type="Number">' + expense_id + '</Value></Eq></Where><OrderBy><FieldRef Name="ExpenseDate" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
            var Expense_item_div_data = "";
            var expense_item_table_id = datatobind_divid + "_table";
            var expense_item_table_tbody_id = datatobind_divid + "_table_tbody";

            Expense_item_div_data = Expense_item_div_data + "<div class='panel-body'>";
            Expense_item_div_data = Expense_item_div_data + "<table class='table table-striped table-bordered dataTable no-footer bgcolorrow innertable' id=" + expense_item_table_id + " role='grid' aria-describedby='student_datatable_info' style='table-layout:fixed; width:100%;'>";
            Expense_item_div_data = Expense_item_div_data + "  <thead>";
            Expense_item_div_data = Expense_item_div_data + "<tr role='row'><th class='sorting_asc' tabindex='0' aria-controls='student_datatable' rowspan='1' colspan='1' aria-sort='ascending' aria-label='Attachment: activate to sort column descending' style='width: 84px;'>Info</th><th class='sorting' tabindex='0' aria-controls='student_datatable' rowspan='1' colspan='1' aria-label='Ref No.: activate to sort column ascending' style='width: 60px;'>Ref No.</th><th>Project Phase</th><th class='sorting' tabindex='0' aria-controls='student_datatable' rowspan='1' colspan='1' aria-label='Item: activate to sort column ascending' style='width: 7.5%;'>Item</th><th style='text-align:left; width:15%;'>Expense Note</th><th style='width:7.8%'>ER Amount</th><th class='sorting' tabindex='0' aria-controls='student_datatable' rowspan='1' colspan='1' aria-label='Status: activate to sort column ascending' style='width: 9%;'>Status</th><th class='sorting' tabindex='0' aria-controls='student_datatable' rowspan='1' colspan='1' aria-label='Amount: activate to sort column ascending' style='width: 8.6%;'>Amount</th><th class='sorting' tabindex='0' aria-controls='student_datatable' rowspan='1' colspan='1' aria-label='Payment Type: activate to sort column ascending' style='width: 8.6%;'>Payment Type</th><th class='sorting' tabindex='0' aria-controls='student_datatable' rowspan='1' colspan='1' aria-label='Expense Date: activate to sort column ascending' style='width: 7.5%;'>Expense Date</th><th class='sorting' tabindex='0' aria-controls='student_datatable' rowspan='1' colspan='1' aria-label='Billable To Client: activate to sort column ascending' style='width: 7.8%;'>Billable</th></tr>";
            Expense_item_div_data = Expense_item_div_data + " <tbody id=" + expense_item_table_tbody_id + "></tbody>";
            var query_cml = 'Items?$filter=TrackingNo eq \'' + expense_id + '\' &$orderby= ExpenseDate desc';
            $.ajax({
                url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('BconeExpenceLogDetail')/" + query_cml,
                type: "GET",
                async: false,
                headers: {
                    "Accept": "application/json;odata=verbose"
                },
                success: function(data) {
                    $('#' + expenseanchorid).prop('onclick', null).off('click');
                    var i = "1";

                    if (data.d.results.length > 0) {
                        $.each(data.d.results, function(key, value) {

                            if (value.ExpenceCurrencyId != '1') {
                                if (isINRCurrency) {
                                    isINRCurrency = false;
                                }
                            }


                            var Expense_item = value.ExpenceItemText;
                            var payment_type = value.PaymentTypeText;
                            var Currency = value.ExpenceCurrencyText;
                            var convert_date1 = convert_date(value.ExpenseNewDate);
                            var curr_val = Currency;

                            Expense_item_div_data = Expense_item_div_data + "<tr id='rowhideslow6' class='deleteall6 odd' value='6' role='row'>";

                            if (value.Justification == null) {
                                var inner = "inner";
                                var outer = "outer";
                                var count = 0;
                                if (value.FileUploadedCount != null) {
                                    count = value.FileUploadedCount;
                                }
                                if (count > 0) {

                                    Expense_item_div_data = Expense_item_div_data + "<td class='sorting_1 text-center'><a style='display: inline-block;cursor:pointer;' onclick='openouterfileattach(\"" + i + "\"); getUploadedFiles(\"" + value.ID + "\",\"" + outer + "\",\"" + expense_id + "\");'> <i class='fa fa-paperclip' style='color:#5cb85c;font-size: 16px;' ></i></a></td>";
                                    // item["action"] = "<a  style='display:inline-block; margin-right:12px;cursor:pointer;'  onclick='getListItemByIdForUpdate(\"" + url + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + rowhide + "\");showmodal();'><i class='fa fa-pencil'></i></a> <a    style='display:inline-block;margin-right: 12px;cursor:pointer;' onclick='DeleteExpenseLog(" + value.ID+ ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a><a style='display: inline-block;margin-left: 12px;cursor:pointer;' onclick='openouterfileattach(\""+i+"\"); getUploadedFiles(\"" + value.ID+ "\",\""+outer+"\");'> <i class='fa fa-paperclip' style='color:#5cb85c;font-size: 16px;' ></i></a>";
                                } else {
                                    Expense_item_div_data = Expense_item_div_data + "<td class='sorting_1 text-center'></td>";
                                    //item["action"] = "<a  style='display:inline-block; margin-right:12px;cursor:pointer;'  onclick='getListItemByIdForUpdate(\"" + url + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + rowhide + "\");showmodal();'><i class='fa fa-pencil'></i></a> <a    style='display:inline-block;margin-right: 12px;cursor:pointer;' onclick='DeleteExpenseLog(" + value.ID+ ",\"" + rowhide + "\")'><i class='fa fa-trash'></i></a>";
                                }

                                var ss = 'https://bristleconeonline.sharepoint.com/sites/pwa/BconeBillAttachment/' + value.BillAttachment;

                                //table_tr = table_tr + "<td><a  href='" + ss + "' download><i  class='fa fa-chain' style='color:green;' ></i></a></td>";
                                //Expense_item_div_data=Expense_item_div_data+"<td class='sorting_1'><a href='" + ss + "' download><i class='fa fa-paperclip' style='color:#5cb85c;font-size: 18px;'></i></a></td>";
                            } else {
                                //Expense_item_div_data=Expense_item_div_data+"<td class='sorting_1 text-center'><a  name='"+value.Justification+"'  ><i  class='fa fa-commenting' style='color:#333;font-size: 16px;'  ></i></a></td>";
                                Expense_item_div_data = Expense_item_div_data + "<td class='sorting_1 text-center'><a data-toggle='tooltip' title='" + value.Justification + "' style='text-decoration:none;cursor: context-menu;'><i  class='fa fa-commenting' style='color:#333;font-size: 16px;'  ></i></a></td>";

                            }
                            var exp_amount = "-";


                            var ExpenseNote = "-";
                            if (value.ExpenseNote != null && value.ExpenseNote != "") {
                                ExpenseNote = value.ExpenseNote;
                            }
                            if (value.FinalExpenseValue != null) {
                                exp_amount = value.FinalExpenseValue;
                                if (exp_amount.toString().indexOf(".")) {
                                    exp_amount = parseFloat(exp_amount).toFixed(2);
                                } else {
                                    exp_amount = exp_amount + ".00";
                                }
                            }
                            var ExpensceAmount_amount = "-";
                            if (value.ExpensceAmount != null) {
                                ExpensceAmount_amount = value.ExpensceAmount;
                                if (ExpensceAmount_amount.toString().indexOf(".")) {
                                    ExpensceAmount_amount = parseFloat(ExpensceAmount_amount).toFixed(2);
                                } else {
                                    ExpensceAmount_amount = ExpensceAmount_amount + ".00";

                                }
                            }

                            Expense_item_div_data = Expense_item_div_data + "<td>" + i + "</td><td>" + value.TaskName + "</td><td>" + Expense_item + "</td><td class='sorting_1 text-center' style='text-align:left;' ><a class='wordellipsis' data-toggle='tooltip' title='" + ExpenseNote + "' style='text-decoration: none;' >" + ExpenseNote + "</a></td><td style='text-align: right;'>" + exp_amount + "<span style='color: #ababab;margin-left: 6px;'>" + currval1 + "</span></td><td>" + value.Status + " </td><td >" + ExpensceAmount_amount + "<span style='color: #ababab;margin-left: 6px;'>" + curr_val + "</span></td><td>" + payment_type + "</td><td>" + convert_date1 + "</td><td>" + value.BliableToClient + "</td></tr>";
                            i++;

                            //Expense_item_div_data=Expense_item_div_data+" <tr id='rowhideslow6' class='deleteall6 odd' value='6' role='row'><td class='sorting_1'><a href='NaNBconeBillAttachment/Add_Expence_bindInline.txt' download=''><i class='fa fa-chain'></i></a></td> <td><a href='javascript:void(0)' style='text-decoration:underline;'>6</a></td><td>Dinner</td><td>Active</td><td>500</td><td>Employee Paid</td><td>15-Sep-2016</td><td>Yes</td></tr>";

                        });
                        Expense_item_div_data = Expense_item_div_data + " </table>";
                        if (CurrencyId != '1' && CurrencyId != '') {
                            isAdvanceTakenINR = false;
                        }

                        if (BaseLocation != 'Bengluru') {
                            isBaseLocationBengluru = false;
                        }
                        //alert('isAdvanceTakenINR: '+isAdvanceTakenINR);
                        //alert('isINRCurrency: '+isINRCurrency);

                        var finance_guid = "";
                        var finance_name = "";
                       
                        if (!(checkbox_checked)) {
                            Expense_item_div_data = Expense_item_div_data + " <div class='bottom-btns' style='margin-top:10px;'>";
                            Expense_item_div_data = Expense_item_div_data + " <a class='green-btn' style='cursor: pointer;'  onclick='UpdateExpenseStatusTemp(\"" + expense_id + "\",\"Approved\",\"" + datatobind_divid + "\",\"" + type + "\",\"SingleApprove\",\"" + finance_guid + "\",\"" + finance_name + "\",\"" + ExpenseTrackingNo + "\")'>Approve</a>";
                            Expense_item_div_data = Expense_item_div_data + " <a class='red-btn' style='cursor: pointer;' onclick='RejectExpense(\"" + expense_id + "\",\"Reject\",\"" + datatobind_divid + "\",\"" + type + "\",\"" + ExpenseTrackingNo + "\")' >Reject</a>";
                            Expense_item_div_data = Expense_item_div_data + " </div>";
                            Expense_item_div_data = Expense_item_div_data + " <div class='bottom-btns1' style='display:none;'>";
                            Expense_item_div_data = Expense_item_div_data + " <button class='green-btn btn disabled' type='button' style='margin-right:5px;border-radius:0;'>Approve</button>";
                            Expense_item_div_data = Expense_item_div_data + "<button class='red-btn btn disabled' style='border-radius:0;' type='button'>Reject</button>";
                            Expense_item_div_data = Expense_item_div_data + " </div>";

                        } else {

                            Expense_item_div_data = Expense_item_div_data + " <div class='bottom-btns' style='display:none;' >";
                            Expense_item_div_data = Expense_item_div_data + " <a class='green-btn' style='cursor: pointer;'  onclick='UpdateExpenseStatusTemp(\"" + expense_id + "\",\"Approved\",\"" + datatobind_divid + "\",\"" + type + "\",\"SingleApprove\",\"" + finance_guid + "\",\"" + finance_name + "\",\"" + ExpenseTrackingNo + "\")'>Approve</a>";
                            Expense_item_div_data = Expense_item_div_data + " <a class='red-btn' style='cursor: pointer;' onclick='RejectExpense(\"" + expense_id + "\",\"Reject\",\"" + datatobind_divid + "\",\"" + type + "\",\"" + ExpenseTrackingNo + "\")' >Reject</a>";
                            Expense_item_div_data = Expense_item_div_data + " </div>";
                            Expense_item_div_data = Expense_item_div_data + " <div class='bottom-btns1' >";
                            Expense_item_div_data = Expense_item_div_data + " <button class='green-btn btn disabled' type='button' style='margin-right:5px;border-radius:0;'>Approve</button>";
                            Expense_item_div_data = Expense_item_div_data + "<button class='red-btn btn disabled' style='border-radius:0;' type='button'>Reject</button>";
                            Expense_item_div_data = Expense_item_div_data + " </div>";

                        }

                        Expense_item_div_data = Expense_item_div_data + "</div>";
                        $('#' + datatobind_divid).html(Expense_item_div_data);
                        //$('.loader').hide();
                    } else {
                        // $('.loader').hide();

                    }
                    showtooltip();
                },
                error: function(data) {
                    alert(data.responseJSON.error.message.value);
                    failure(data);
                }
            });

            if ($('.Parencheckbox').prop("checked")) {
            }
        }




        function getinagcheckboxvalue() {
            $("#ApproveAllBtn").show();
            Summary_TrackingIds = [];


            //Mymethod();
            $("#approve_acnhor_btn").removeClass('blue-btn');
            $("#approve_acnhor_btn").addClass('green-btn');
            var modal_data = "";
            ////alert("getinagcheckboxvalue");
            var selected = [];
            $('.Parencheckbox').each(function() {
                ////alert("checked");


                var Id = $(this).attr('id');
                //alert(Id);		
                var emp_name = $(this).attr('name');
                //alert(emp_name);

                var deatil_record = emp_name.split(":");
                var main_id = 'accor' + Id;

                // alert(deatil_record[1]);
                // alert(deatil_record[0]);
                // //alert("main_id"+   main_id);
                // modal_data=modal_data+"<div class='blockdiv'><h4 data-toggle='collapse' data-parent='#accordion'  href='#"+main_id+"' aria-expanded='true'><div class='namediv'>"+deatil_record[0]+"</div><div class='cureencydiv'><span class='curdiv'>80 USD</span><span class='curdiv'>100 INR</span><span class='curdiv'>100 USD</span></div></h4><div id=" +main_id+ " class='panel-collapse collapse-in' role='tabpanel' aria-labelledby='headingThree'>";


                //alert(modal_data);
                var para_div = Getchildcheckboxvalues(deatil_record[1]);

                if (para_div != "</div></div>") {
                    modal_data = modal_data + "<div class='blockdiv'><h4  style='cursor:pointer;'data-toggle='collapse' data-parent='#accordion'  href='#" + main_id + "' aria-expanded='true'><div class='namediv' style='cursor:pointer;'>" + deatil_record[0] + "</div></h4><div id=" + main_id + " class='panel-collapse collapse-in' role='tabpanel' aria-labelledby='headingThree'>"
                    ////alert("para_div"+para_div);
                    modal_data = modal_data + para_div;
                }


                // modal_data=modal_data+"<div style='margin-bottom: 6px;'><a>"+ss+"</a></div>";
                // $('#FadeoutDiv'+ss).fadeOut(); 

            });
            $("#Modal_Div").html(modal_data);
            if (modal_data != "") {
                $('#myModal').modal('show');
            } else {
                ////alert("Please Select Expense To Approve.");

                $("#alertmain").show();

                document.getElementById("Alert_msg").innerHTML = "Please Select Expense To Approve.";
            }
            var testtt1 = "";
            var currencybyproject = ApproveCurrencySummary();
            for (i = 0; i < currencybyproject.length; i++) {

                var exp_amount = "";
                if (currencybyproject[i].Amount != null) {
                    exp_amount = currencybyproject[i].Amount;
                    if (exp_amount.toString().indexOf(".")) {

                        //exp_amount=exp_amount.toFixed(2);
                        exp_amount = parseFloat(exp_amount).toFixed(2);
                    } else {
                        exp_amount = exp_amount + ".00";

                    }



                }
                testtt1 = testtt1 + "<span class='mldiv'>" + exp_amount + "-" + currencybyproject[i].CurrencyId + "</span>"
            }

            $("#Popup_currency").html(testtt1);
        }


        function nilam() {

            $('.ChildCheckbox:checkbox:checked').each(function() {

                var emp_name = $(this).attr('name');
                alert(emp_name);
            });
        }

        function close_div() {
            $("#alertmain").hide();
            document.getElementById("Alert_msg").innerHTML = "";

        }


        function confirmation_close() {
            $('#Confirmation_alert').hide();
        }

        function Getchildcheckboxvalues(temp) {
            var para_div = "";
            var my_var = temp + "checkboxex";
            var span_id = "";


            //  var my_var="Resource307ebf4a-742b-47ca-b16f-283fa384a817checkboxex";
            // //alert("my_var"+ my_var);


            $('.' + my_var + ':checked').each(function() {

                var ss = $(this).attr('name');
                // //alert("child_attr"+ss);
                var name_id = ss.split(":")

                para_div = para_div + "<p><a style='cursor:default;text-decoration:none;'><i class='fa fa-circle' ></i> Tracker ID : " + name_id[0] + " Expense name:" + name_id[1] + "  </a></p>";
                //document.getElementById("AllApproval_id").innerHTML=document.getElementById("AllApproval_id").innerHTML+","+name_id[0];
                $("#AllApproval_id").append("," + name_id[0]);
                Summary_TrackingIds.push(name_id[0]);
            });
            para_div = para_div + "</div></div>";

            return para_div;
        }

        function checkchild_checkboxex(parentclass, parentcheckboxID) {
            //  //alert("checkchild_checkboxex called");

            if ($('#' + parentcheckboxID).prop('checked')) {
                $('input:checkbox#' + parentcheckboxID).next().css("background", "linear-gradient(#0a891a,#0a891a)");
            } else {
                $('input:checkbox#' + parentcheckboxID).next().css("background", "linear-gradient(#587ecb,#3265be)");
            }

            var parentcheck = false;
            $('.Parencheckbox:checkbox:checked').each(function() {
                parentcheck = true;
                ////alert("true");
            });

            if (parentcheck) {
                $('.bottom-btns').css('display', 'none');
                $('.bottom-btns1').css('display', 'block');

                // $('input:checkbox#'+parentcheckboxID).next().css("background", "linear-gradient(#0a891a,#0a891a)");


            } else {
                $('.bottom-btns').css('display', 'block');
                $('.bottom-btns1').css('display', 'none');
                // $('input:checkbox#'+parentcheckboxID).next().css("background", "linear-gradient(#587ecb,#3265be)");
            }

            // //alert("checkchild_checkboxex");
            var childclass = parentclass + "checkboxex";

            //alert(childclass);

            ////alert("parentcheckboxID"+parentcheckboxID);
            ////alert("parentclass"+parentclass);
            ////alert("childclass"+childclass);
            //alert(this.checked);
            //alert($('#'+parentcheckboxID).prop("checked"));
            $("." + childclass).prop('checked', $('#' + parentcheckboxID).prop("checked"));

            //$("."+childclass).prop('checked', $('#'+parentcheckboxID).prop("checked"));
        }

        function checkparent_checkboxex(ResourceID) {
            //alert(this);
            //alert(ResourceID);
            var childclass = "Resource" + ResourceID + "checkboxex";
            var parentclass = "Resource" + ResourceID;
            //console.log(childclass);
            //childclass=childclass.trim();
            //alert(childclass);
            //alert(childclass);

            //alert(parentclass);

            //console.log($('input:checkbox.'+parentclass).closest( "a" ));

            //if($('.'+childclass).prop('checked')){



            //$('input:checkbox.'+parentclass).next().css("background", "linear-gradient(#0a891a,#0a891a)");
            //}
            //else
            //{
            //alert('Un-checked');
            //$('input:checkbox.'+parentclass).next().css("background", "linear-gradient(#587ecb,#3265be)");
            //}
            //childclass="Resource307ebf4a-742b-47ca-b16f-283fa384a817checkboxex";

            //$.each( $('.'+parentclass  input:checkbox), function(key,value) {

            //alert('hi');
            //$('div', left).each(function() {

            //});
            //});

            // $('.Resource1 > input[type=checkbox]').each(function(){
            //alert('hi');
            //$(this).doSomething();//this is the checked checkbox
            //});
            var parentcheck = true;

            var child_check = false;


            //$('.Resource307ebf4a-742b-47ca-b16f-283fa384a817checkboxex input:checkbox').each(function() {
            //alert(this.checked);
            //});


            $('input:checkbox.' + childclass).each(function() {


                //var sThisVal = (this.checked ? $(this).val() : "");
                // alert('hi');
                //alert(this.checked);

                if (this.checked) {
                    //alert('checked');
                    child_check = true;
                    //$('input:checkbox.'+parentclass).next().css("background", "linear-gradient(#0a891a,#0a891a)");
                } else {
                    //alert('Un-checked');
                    // $('input:checkbox.'+parentclass).next().css("background", "linear-gradient(#587ecb,#3265be)");
                }

                //alert(child_check);
                if (!(this.checked)) {
                    parentcheck = false;
                    $("." + parentclass).prop("checked", parentcheck);
                    $('.bottom-btns').css('display', 'block');
                    $('.bottom-btns1').css('display', 'none');

                    $('input:checkbox.' + parentclass).next().css("background", "linear-gradient(#587ecb,#3265be)");

                }

            });

            if (child_check) {
                $('.bottom-btns').css('display', 'none');
                $('.bottom-btns1').css('display', 'block');

                $('input:checkbox.' + parentclass).next().css("background", "linear-gradient(#0a891a,#0a891a)");

            }




            if (parentcheck) {
                $("." + parentclass).prop("checked", parentcheck);
                var parentcheck1 = false;
                $('.Parencheckbox:checkbox:checked').each(function() {
                    parentcheck1 = true;

                });

                // alert(child_check);

                if (parentcheck1) {
                    $('.bottom-btns').css('display', 'none');
                    $('.bottom-btns1').css('display', 'block');

                    $('input:checkbox.' + parentclass).next().css("background", "linear-gradient(#0a891a,#0a891a)");
                }




            }



            //alert(childclass);
            //alert(this.checked);
            //alert($('#'+parentcheckboxID).prop("checked"));
            //$("."+childclass).prop("checked", $('#'+parentcheckboxID).prop("checked"));
        }

        function ProjectResourceView() {

            $('.loader').show();
            var view_type = document.getElementById("Project_Resource_View").value;
            //alert(view_type);

            if (view_type == "Resource_view") {
                setTimeout(function() {
                    getResources(web_url, 'BconeExpenceMaster', owner_id, 'Resource_view');
                }, 100);

            } else {
                setTimeout(function() {
                    getResources(web_url, 'BconeExpenceMaster', owner_id, 'Project_view');
                }, 100);

            }
            //$('.loader').hide();
        }

        function loaddata1(id) {
            ////alert("loaddata1");

            //var query_cml = '<View><Query><Where><Eq><FieldRef Name="TrackingNo" /><Value Type="Number">' + id + '</Value></Eq></Where><OrderBy><FieldRef Name="ExpenseDate" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';	
            var query_cml = 'Items?$filter=TrackingNo eq \'' + id + '\' &$orderby= ExpenseDate desc';

            $.ajax({
                url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('BconeExpenceLogDetail')/" + query_cml,
                type: "GET",
                async: false,
                headers: {
                    "Accept": "application/json;odata=verbose"
                },

                success: function(data) {
                    var table_tr = "";

                    var table_tr_edit = "";
                    var curreny_amt_array = [];
                    //alert(data.d.results.length);
                    if (data.d.results.length > 0) {


                        $.each(data.d.results, function(key, value) {

                            //alert(people);



                            var curreuncyvalue = "";

                            var expenceid = value.TrackingNoId;

                            var Currency = getcurrencyValueById('BconeCurrency', value.ExpenceCurrencyId);

                            var curr_val;

                            if (Currency.indexOf("-")) {
                                var curr = Currency.split("-");

                                curr_val = curr[0];
                            } else {
                                curr_val = Currency;
                            }
                            people.push({
                                CurrencyId: curr_val,
                                Amount: value.ExpensceAmount,
                                Tracking: value.TrackingNoId
                            });
                            //curreny_amt_array.push(curr_val+"-"+value.ExpensceAmount+"-"+value.ExpenceCurrencyId);

                            // console.log(people);


                        });

                        //console.log(people);
                        //alert(curreny_amt_array);
                        // document.getElementById("TxtDate").value 
                        //Currency_refine(web_url, 'BconeExpenceLogDetail', id,curreny_amt_array);



                    } else {

                    }


                },
                error: function(data) {
                    alert(data.responseJSON.error.message.value);
                    failure(data);
                }
            });


        }

function loaddataTemp(id) 
{
    //var query_cml = '<View><Query><Where><Eq><FieldRef Name="TrackingNo" /><Value Type="Number">' + id + '</Value></Eq></Where><OrderBy><FieldRef Name="ExpenseDate" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';								          
    $.ajax({
        url: _spPageContextInfo.webAbsoluteUrl + "/_api/Web/Lists/getbytitle('BconeExpenceLogDetail')/Items?$filter=TrackingNo eq '" + id + "'&$orderby= ExpenseDate asc",
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },
        success: function(data)
		{
            var table_tr = "";
            var table_tr_edit = "";
            var curreny_amt_array = [];
            if (data.d.results.length > 0) 
			{
                $.each(data.d.results, function(key, value) 
				{
                    //people.push({CurrencyId: curr_val,Amount:value.ExpensceAmount,Tracking:value.TrackingNoId}) ;  
                });
            }
			else 
			{
            }
        },
        error: function(data) {
            alert(data.responseJSON.error.message.value);
            failure(data);
        }
    });


}

$(function() 
{
    BindEmployee('BconeProxyApprover', userid);
});
    </script>
    <script>
        $(document).ready(function() {
            $('.ms-rte-layoutszone-inner p:first').hide();
            $('.ms-rte-layoutszone-inner p:last').hide();
        });
    </script>

    <script>
    function msss() {
    var people1 = [{
            Tracking: 101
        },
        {
            Tracking: 102
        },
        {
            Tracking: 103
        }
    ];

    var population = [{
            Currency: 'USD',
            Tracking: 103,
            Amount: 200
        },
        {
            Currency: 'INR',
            Tracking: 102,
            Amount: 100
        },
        {
            Currency: 'INR',
            Tracking: 102,
            Amount: 300
        },
        {
            Currency: 'INR',
            Tracking: 101,
            Amount: 300
        }
    ];

    <!--  var result = new jinqJs() -->
    <!--  .from(people) -->
    <!--   .groupBy('CurrencyId').sum('amount').select('amount', 'CurrencyId'); -->
    var result = new jinqJs()
        .from(people1)
        .leftJoin(population1)
        .on(function(left, right) {
            return (left.Tracking === right.Tracking);
        })
        .groupBy('Currency').sum('Amount').select('Amount', 'Currency');

    //console.log(result);
    // console.log(result);
    //var whereExample1 = JSLINQ(people).Where(function(item){ return item.age == "1"; });

}

function Mymethod() {
    ////alert("Mymethod");



    <!--  var result = new jinqJs() -->
    <!--  .from(people) -->
    <!--   .groupBy('CurrencyId').sum('amount').select('amount', 'CurrencyId'); -->

    //console.log(people);
    // console.log(TrackingIds);
    var result = new jinqJs()
        .from(people)
        .leftJoin(TrackingIds)
        .on(function(left, right) {
            return (left.Tracking === right.Tracking);
        })
        .groupBy('CurrencyId').sum('Amount').select('Amount', 'CurrencyId');

    //alert(result.length);


    //console.log(result);
    //console.log(result);

    return result;
}

function Mymethod1(Id, type) {

    if (type == "Proj") {
        // console.log(people);
        // console.log(TrackingIds);
        var result = new jinqJs()
            .from(people)
            .leftJoin(TrackingIds)
            .on(function(left, right) {
                return (left.Tracking === right.Tracking);
            })
            .where(function(left, right) {
                return (left.ProjectId == Id);
            })
            .groupBy('CurrencyId').sum('Amount').select('Amount', 'CurrencyId');
    } else {
        //  console.log(people);
        // console.log(TrackingIds);
        var result = new jinqJs()
            .from(people)
            .leftJoin(TrackingIds)
            .on(function(left, right) {
                return (left.Tracking === right.Tracking);
            })
            .where(function(left, right) {
                return (left.EmployeeId == Id);
            })
            .groupBy('CurrencyId').sum('Amount').select('Amount', 'CurrencyId');

    }
    return result;
}

function GroupByTrackingNo(Id) {
    var result = new jinqJs()
        .from(people)
        .leftJoin(TrackingIds)
        .on(function(left, right) {
            return (left.Tracking === right.Tracking);
        })
        .where(function(left, right) {
            return (left.Tracking == Id);
        })
        .groupBy('CurrencyId').sum('Amount').select('Amount', 'CurrencyId');
    //console.log(result);
    return result;
}

function ApproveCurrencySummary() {
    //var test=[612,632];
    var arrayOfNumbers = Summary_TrackingIds.map(Number);
    //console.log(arrayOfNumbers);
    // console.log(TrackingIds);
    // console.log(people);
    // var Id=[307ebf4a-742b-47ca-b16f-283fa384a817,72eb9451-65c0-438a-9c00-0ed404e144b8];
    var result = new jinqJs()
        .from(people)
        .leftJoin(TrackingIds)
        .on(function(left, right) {
            return (left.Tracking === right.Tracking);
        })
        .in(arrayOfNumbers, 'Tracking')
        .groupBy('CurrencyId').sum('Amount').select('Amount', 'CurrencyId');
    //console.log(result);
    //alert(result)
    return result;
}

function showtooltip() {
    ////alert("load");
    //$('.fa-commenting').jqxTooltip({ content: 'comment', position: 'top', name: 'movieTooltip', top: 5,opacity: 1});


}

$(window).load(function() {
    showtooltip();
});




//Finance
function Getfinance(Type) {
    //alert(current_url);
    // alert('called');
    //$('.loader').show();

    //alert(listname);
    //var viewflds = '<ViewFields><FieldRef Name="Title"/><FieldRef Name="Status"/><FieldRef Name="Id"/></ViewFields>';

    //var query_cml = '<View><Query><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime"             IncludeTimeValue="True"></Value></OrderBy></Query><View>';

    var my_guid;

    //  var query_cml = '<View><Query><Where><Eq><FieldRef Name="FinanceType" /><Value Type="Text">' + Type + '</Value></Eq></Where><OrderBy><FieldRef Name="Id" Ascending="False"/><Value Type="Id" ></Value></OrderBy></Query></View>';

    var query_cml = 'Items?$filter=FinanceType eq \'' + Type + '\' &$orderby= Id desc';

    $.ajax({

        url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('FinanceTeam')/" + query_cml,
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },

        success: function(data) {

            ////alert("got data on page load event");
            alert('firstconsole')

            //console.log(data);


            if (data.d.results.length > 0) {




                $.each(data.d.results, function(key, value) {



                    //alert(value.FinancepersonnameId);
                    my_guid = GetUserId1(value.FinancepersonnameId);
                    //alert(my_guid);

                });
            } else {

            }




            // console.log(data.d);


        },
        error: function(data) {
            //failure(data);
            // alert(data.responseJSON.error.message.value);
        },
        complete: function() {

        }
    });

    return my_guid;
}

//NILAM FINANCE


function GetUserId1(userid) {
    var my_guid = "";
    var NewloginName = "";
    var loginName = "";
    var emp_name;
    jQuery.ajax({
        url: "/sites/pwa/_api/Web/GetUserById(" + userid + ")",
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },
        success: function(data) {
            var dataResults = data.d;
            // console.log(data);
            //get login name  
            //  console.log(data);
            var loginName = dataResults.LoginName;
            //console.log(loginName);
            //alert('loginName: '+loginName);
            // $('#user_name').text(dataResults.Title);
            //get display name
            // console.log(dataResults.Title);
            emp_name = dataResults.Title;
            NewloginName = encodeURIComponent(loginName); //encoding loginName from special charater to normal text
            //alert('NewloginName: '+NewloginName);
            my_guid = getResourcesGuid1(NewloginName);
            // console.log(NewloginName);
            //alert('NewloginName :' + NewloginName);

        },
        complete: function() {

            // var result = getResourcesGuid(NewloginName);
            // alert(result);
        },
    });
    return my_guid + "_" + emp_name;
}

function getResourcesGuid1(NewloginName) 
{
    var guid;
    jQuery.ajax({

        url: "/sites/pwa/_api/ProjectData/Resources?$filter=ResourceNTAccount eq('" + NewloginName + "')",
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },
        success: function(data) {
            // console.log(data);
            guid = data.d.results[0].ResourceId;
        }
    });
    return guid;
}


function GetApprovalFinaceDetail(id) {

    var query_cml = 'Items?$filter=ID eq \'' + id + '\' ';
    $.ajax({
        url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('BconeExpenceMaster')/" + query_cml,
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },


        success: function(data) {
            var table_tr = "";
			//alert(data.d.results.length);
            if (data.d.results.length > 0) {
                Approver2Id = data.d.results[0].Approver2;
                Approver2Name = data.d.results[0].Approver2Name;
                Approver1Id = data.d.results[0].Approver1;
                Approver1Name = data.d.results[0].Approver1Name;
                finance_approver_id = data.d.results[0].FinanceId;
                finance_approver_name = data.d.results[0].FinanceName;
                pending_with_id = data.d.results[0].PendingWithId;
                pending_with_name = data.d.results[0].PendingWithName;
                ExpenseApproveType = data.d.results[0].ExpenseApproveType;
                expense_creater_id = data.d.results[0].EmployeeId;
                // console.log(pending_with_id);
                // console.log(expense_creater_id);

            } else {

            }


        },
        error: function(data) {
            alert(data.responseJSON.error.message.value);
            failure(data);
        }
    });


}

function GetNoteById(Action) {

    var notes = "";
    //var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="NotesID"/><Value Type="Text">' + Action + '</Value></Eq><Eq><FieldRef Name="IsActive"/><Value Type="Boolean">1</Value></Eq></And></Where></Query></View>';

    $.ajax({
        url: _spPageContextInfo.webAbsoluteUrl + "/_api/Web/Lists/getbytitle('BconeExpenceNotesMaster')/Items?$filter=NotesID eq '" + Action + "' and  IsActive  eq '1'",
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },

        beforeSend: function() {
            //  $('.loader').show();
            //$('[data-toggle="tooltip"]').tooltip();
        },

        success: function(data) {


            if (data.d.results.length > 0) {
                notes = data.d.results[0].Notes;
            }


        },
        error: function(data) {

            alert(data.responseJSON.error.message.value);
        },
        complete: function() {}

    });
    return notes;
}


function InsertIntoLog(url, listname, TrackingNo, Action, ActorName, ActorID, Type, msg, ProxyApproverGuid, ProxyApproverName) {
    var Note;


    //alert(TrackingNo);
    if (Action != "") {
        Note = GetNoteById(Action);
        //alert(Note);
    } else {
        Note = msg;
    }
    var TrackingNo_temp = TrackingNo.toString();
    var item = "";
    var item_collections = getListprotocol(listname);

    item = {
        "__metadata": {
            "type": item_collections
        },
        "TrackingNo": TrackingNo_temp,
        "Notes": Note,
        "ActorName": ActorName,
        "ActorID": ActorID,
        "Action": Type,
        "ProxyApproverGuid": ProxyApproverGuid,
        "ProxyApproverName": ProxyApproverName

    };


    $.ajax({
        url: url + "/_api/web/lists/getbytitle('" + encodeURIComponent(listname) + "')/items",

        type: "POST",
        async: false,
        contentType: "application/json;odata=verbose",
        // contenType: "application/x-www-form-urlencoded; charset=UTF-8",
        data: JSON.stringify(item),
        headers: {
            "Accept": "application/json;odata=verbose",
            "X-RequestDigest": $("#__REQUESTDIGEST").val()
        },
        success: function(data) {

            //alert("log added sucessfully");

        },
        complete: function() {

            //cleardata();
            //  var EmployeeId = $('#resourse_id').text();
            // getDataByListName(current_url, 'BconeExpenceMaster', 'load1', EmployeeId);

        },
        error: function(data) {
            ////alert("error");
            alert(data.responseJSON.error.message.value);
            //return false;

        }
    });

}



//mail function

var To = "";
var Cc = "";
var Subject = "";
var Body = "";
var Filepath = "";
var result = "";
var subjectcontents = "";

function GetEmailData(Trackingid, emailEventId) {




    $().SPServices({
        operation: "GetListItems",
        async: false,
        listName: "BconeEmailConfiguration",
        CAMLQuery: "<Query><Where><Eq><FieldRef Name='EventID'/><Value Type='Text'>" + emailEventId + "</Value></Eq></Where></Query>",
        completefunc: function(xData, Status) {
            raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
            $(xData.responseXML).SPFilterNode("z:row").each(function() {
                Subject = $(this).attr("ows_Subject");
                Body = $(this).attr("ows_Body");
                formatSubject(Subject, Trackingid);
                formatBodyValues(Body, Trackingid);
            });
        }
    });

    function formatSubject(Subject, ListID) {
        var startString = "{";
        var endString = "}";
        var count = 0;
        var indexStart = 0,
            indexEnd = 0;
        var exit = false;
        while (!exit) {
            indexStart = Subject.indexOf(startString);
            indexEnd = Subject.indexOf(endString);
            if (indexStart != -1 && indexEnd != -1) {

                matchedstring = Subject.substring(Subject.indexOf('{') + 1, Subject.indexOf('}'));

                $().SPServices({
                    operation: "GetListItems",
                    async: false,
                    listName: "BconeEmailvariablemapping",
                    CAMLQuery: "<Query><Where><Eq><FieldRef Name='VariableName' /><Value Type='Text'>" + matchedstring + "</Value></Eq></Where></Query>",
                    completefunc: function(xData, Status) {
                        raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
                        $(xData.responseXML).SPFilterNode("z:row").each(function() {
                            var fieldvalue = $(this).attr("ows_FieldValue");
                            var str_ows = "ows_" + fieldvalue;
                            $().SPServices({
                                operation: "GetListItems",
                                async: false,
                                listName: "BconeExpenceMaster",
                                CAMLQuery: "<Query><Where><Eq><FieldRef Name='ID' /><Value Type='Counter'>" + ListID + "</Value></Eq></Where></Query>",
                                completefunc: function(xData, Status) {
                                    raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
                                    $(xData.responseXML).SPFilterNode("z:row").each(function() {

                                        var element = $(this).attr(str_ows);
                                        if (element.indexOf('#') >= 0) {
                                            element = $(this).attr(str_ows).split('#')[1];
                                        } else {
                                            element = $(this).attr(str_ows);

                                        }

                                        // alert(ccID);
                                        if (element != "" && element != undefined && element != "0") {
                                            if (count == 0) {
                                                subjectcontents = element;
                                            } else {
                                                subjectcontents = subjectcontents + (";" + element);
                                            }
                                        }
                                    });
                                }
                            });
                        });
                    }
                });

                Subject = Subject.substring(indexEnd + endString.length);
                count++;
            } else
                exit = true;
        }
        // var result = Body.substring(Body.indexOf('{') + 1, Body.indexOf('}'))
        //alert(subjectcontents);
    }


    function formatBodyValues(Body, ListID) {
        var startString = "&#123;";
        var endString = "&#125;";
        var count = 0;
        var indexStart = 0,
            indexEnd = 0;
        var exit = false;
        while (!exit) {
            indexStart = Body.indexOf(startString);
            indexEnd = Body.indexOf(endString);
            if (indexStart != -1 && indexEnd != -1) {

                matchedstring = Body.substring(Body.indexOf('&#123;') + 6, Body.indexOf('&#125;'));
                //if (count == 0) {
                //    result = matchedstring;
                //} else {
                //    result = result + (";" + matchedstring);
                //}
                $().SPServices({
                    operation: "GetListItems",
                    async: false,
                    listName: "BconeEmailvariablemapping",

                    CAMLQuery: "<Query><Where><Eq><FieldRef Name='VariableName' /><Value Type='Text'>" + matchedstring + "</Value></Eq></Where></Query>",
                    completefunc: function(xData, Status) {
                        raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
                        $(xData.responseXML).SPFilterNode("z:row").each(function() {
                            var fieldvalue = $(this).attr("ows_FieldValue");
                            var str_ows = "ows_" + fieldvalue;
                            $().SPServices({
                                operation: "GetListItems",
                                async: false,
                                listName: "BconeExpenceMaster",
                                CAMLQuery: "<Query><Where><Eq><FieldRef Name='ID' /><Value Type='Counter'>" + ListID + "</Value></Eq></Where></Query>",
                                completefunc: function(xData, Status) {
                                    raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
                                    $(xData.responseXML).SPFilterNode("z:row").each(function() {
                                        var element = $(this).attr(str_ows);
                                        if ($(this).attr(str_ows) == "ows_Comment" && element == undefined) {
                                            element = "Recalled from submit status";
                                        } else if (element == undefined) {
                                            element = "-";
                                        }
                                        if (fieldvalue == "Editor" || fieldvalue == "Author") {
                                            element = $(this).attr(str_ows).split('#')[1];
                                        } else {
                                            element = $(this).attr(str_ows);
                                        }
                                        // alert(ccID);
                                        if (element != "" && element != undefined && element != "0") {
                                            if (count == 0) {
                                                result = element;
                                            } else {
                                                result = result + (";" + element);
                                            }
                                        }
                                    });
                                }
                            });
                        });
                    }
                });

                Body = Body.substring(indexEnd + endString.length);
                count++;
            } else
                exit = true;
        }

        // var result = Body.substring(Body.indexOf('&#123;') + 1, Body.indexOf('&#125;'))
        //alert(result);
    }

    //PathUrl = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/ExpenseApproval.aspx";

    sendEmail(finalTo, finalCc, Subject, Body, Filepath, result, subjectcontents, PathUrl);

}

function sendEmail(To, Cc, Subject, Body, Filepath, bodyFormat, subjectcontents, PathUrl) {

    //console.log(To);
    //console.log(Cc);
    //console.log(Subject);
    //console.log(Body);
    //console.log(Filepath);
    //console.log(bodyFormat);
    //console.log(subjectcontents);
    //console.log(PathUrl); 


    var url = "https://ppmprod.bcone.com/api/BCONE/SendEmail"
    var EmailRequestData = {
        "To": To,
        "Subject": Subject,
        "Body": Body,
        "cc": Cc,
        "BodyFormat": bodyFormat,
        "SubjectContent": subjectcontents,
        "URL": PathUrl
    };
    $.ajax({
        url: url,
        async: false,
        data: EmailRequestData,
        type: "POST",
        dataType: "json",
        success: function(res) {
            // alert("EmailSend");
        },
        error: function(jqXHR, textStatus, errorThrown) {
            //  alert(errorThrown);
        }
    });

}

function getUploadedFiles_Count(ExpenseItemId) {

    var docurl = "/sites/Dev/BconeBillAttachment/1234";

    var raisedDocument = "0";

    var url = "https://bristleconeonline.sharepoint.com/sites/pwa/_api/web/Lists/getbytitle('BconeBillAttachment')/items?$filter=ExpenseItemId eq \'" + ExpenseItemId + "\'&$select=FileLeafRef";

    $.ajax({
        url: url,
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },


        beforeSend: function() {
            $('.loader').show();

        },

        success: function(data) {
            if (data.d.results.length > 0) {
                raisedDocument = data.d.results.length;
            }

        },
        error: function(data) {

            alert(data.responseJSON.error.message.value);
        },
        complete: function() {},
    });

    return raisedDocument.toString();

}

function openouterfileattach(reff_no) {
    $('#reff_no').text('Ref No. ' + reff_no);
    //event.stopPropagation();
    $('#openouterfileattach').show({
        width: 'toggle'
    });
}
//$(document).click(function (event) {
//if (!$(event.target).is('#openouterfileattach, #openouterfileattach *')) {
// $('#openouterfileattach').hide({ width: 'toggle'});
//}
// });
function closeouterfileattach() {
    $('#openouterfileattach').hide({
        width: 'toggle'
    });
}

function getUploadedFiles(ExpenseItemId, type, TrackingNo) {

    // alert('getUploadedFiles');

    var Folder_name = "Expense" + TrackingNo;


    var url = "https://bristleconeonline.sharepoint.com/sites/pwa/_api/web/Lists/getbytitle('BconeBillAttachment')/items?$filter=ExpenseItemId eq \'" + ExpenseItemId + "\'&$select=FileLeafRef,ID";
    var docurl = "/sites/Dev/BconeBillAttachment/1234";
    $.ajax({
        url: url,
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },
        success: function(data) {
            if (type == 'inner') {




                var file_ids = '';
                $('#delete_file_ids').text('');

                $(".raisedDocumnts").remove();
                $("#uploaded_files").empty();

                var upload_file_id = 0;
                var remove_id = '';
                $.each(data.d.results, function(key, val) {
                    upload_file_id++;
                    remove_id = 'remove' + upload_file_id;

                    ID = val.Id;

                    if (file_ids == '') {
                        file_ids = ID;
                    } else {
                        file_ids = file_ids + "," + ID;
                    }
                    //var href = "https://bristleconeonline.sharepoint.com/sites/pwa/_layouts/15/download.aspx?SourceUrl='https://bristleconeonline.sharepoint.com/sites/pwa/BconeBillAttachment/Expense928/OlaShare_25th_Inward_27-3-2017_11-9-7.pdf";
                    var href = "https://bristleconeonline.sharepoint.com/sites/pwa/_layouts/15/download.aspx?SourceUrl=https://bristleconeonline.sharepoint.com/sites/pwa/BconeBillAttachment/" + Folder_name + "/" + val.FileLeafRef + "";
                    //https://bristleconeonline.sharepoint.com/sites/pwa/_layouts/15/download.aspx?SourceUrl='https://bristleconeonline.sharepoint.com/sites/pwa/BconeBillAttachment/Expense100/OlaShare_25th_Inward_27-3-2017_11-9-7.pdf'
                    //alert(href);

                    var file_html = "<tr id=" + remove_id + "><td>" + val.FileLeafRef + "</td>";
                    file_html = file_html + "<td class='text-center' style='width:30px;'><a href=\"" + href + "\" download ><i class='fa fa-download'></i></a></td>";

                    file_html = file_html + "<td class='text-center' style='width:30px;'><a onclick='delete_file_temp(\"" + remove_id + "\",\"" + ID + "\")' href='javascript:void(0)'><i class='fa fa-trash-o'></i></a></td>";
                    file_html = file_html + " </tr>";

                    //alert(file_html);
                    var liHtml = "<li class='raisedDocumnts'><a href=\"" + href + "\">" + val.FileLeafRef + "</a></li>";
                    $("#uploaded_files").append(file_html);
                    //console.log(liHtml);
                    //  currentQuery = $(this).attr("ows_FileLeafRef").split('#')[1];
                });

                //console.log(file_ids);
                $('#delete_file_ids').text(file_ids);

                $('#uploaded_file_count').text(upload_file_id);
                //alert(raisedDocument);
                if (upload_file_id > 0) {
                    $('#outer-popup-a').show();
                    //   document.getElementById('imgQueryRaisedDoc').style.visibility = 'visible';
                    //  document.getElementById('imgQueryRaisedDoc').title = currentQuery;
                } else {
                    var file_html = "<tr><td colspan='3' style='text-align:center'>No file found</td>";
                    file_html = file_html + " </tr>";
                    $("#uploaded_files").append(file_html);
                    $('#outer-popup-a').hide();
                    // document.getElementById('imgQueryRaisedDoc').style.visibility = 'hidden';
                }
            } else if (type == 'outer') {


                //alert($(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount"));
                // raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");

                var ID = '';
                //alert(temp);
                $(".raisedDocumnts").remove();
                $("#inner_tbody").empty();

                var upload_file_id = 0;
                var remove_id = '';
                $.each(data.d.results, function(key, val) {
                    upload_file_id++;
                    remove_id = 'remove' + upload_file_id;

                    ID = val.Id;
                    //alert(ID);

                    var href = "https://bristleconeonline.sharepoint.com/sites/pwa/_layouts/15/download.aspx?SourceUrl=https://bristleconeonline.sharepoint.com/sites/pwa/BconeBillAttachment/" + Folder_name + "/" + val.FileLeafRef + "";
                    //alert(href);

                    var file_html = "<tr id=" + remove_id + "><td>" + val.FileLeafRef + "</td>";
                    file_html = file_html + "<td class='text-center' style='width:30px;'><a href=\"" + href + "\"><i class='fa fa-download'></i></a></td>";

                    // file_html = file_html + "<td class='text-center' style='width:30px;'><a onclick='delete_file_temp(\"" + remove_id + "\",\"" + ID + "\")' href='javascript:void(0)'><i class='fa fa-trash-o'></i></a></td>";
                    file_html = file_html + " </tr>";

                    //alert(file_html);
                    var liHtml = "<li class='raisedDocumnts'><a href=\"" + href + "\">" + val.FileLeafRef + "</a></li>";
                    $("#inner_tbody").append(file_html);
                    // currentQuery = $(this).attr("ows_FileLeafRef").split('#')[1];
                });

                $('#uploaded_file_count').text(upload_file_id);
                if (upload_file_id > 0) {} else {
                    var file_html = "<tr><td colspan='3' style='text-align:center'>No file found</td>";
                    file_html = file_html + " </tr>";
                    $("#inner_tbody").append(file_html);
                }
            }
        }
    });


}

function InsertIntoMailLog(listname, To, Cc, PathURL, EventId, TrackingId, Flag, PathURLPDF) {

    var item = "";
    var item_collections = getListprotocol(listname);

    item = {
        "__metadata": {
            "type": item_collections
        },
        "To": To,
        "Cc": Cc,
        "PathURL": PathURL,
        "EventId": EventId,
        "Flag": Flag,
        "TrackingId": TrackingId,
        "PathURLPDF": PathURLPDF
    };


    $.ajax({
        url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('" + encodeURIComponent(listname) + "')/items",

        type: "POST",
        async: false,
        contentType: "application/json;odata=verbose",
        // contenType: "application/x-www-form-urlencoded; charset=UTF-8",
        data: JSON.stringify(item),
        headers: {
            "Accept": "application/json;odata=verbose",
            "X-RequestDigest": $("#__REQUESTDIGEST").val()
        },
        success: function(data) {

            // alert("log added sucessfully");

        },
        complete: function() {

        },
        error: function(data) {

            alert(data.responseJSON.error.message.value);


        }
    });

}
    </script>
    <script>
    setInterval(function() {
    //$('[data-toggle="tooltip"]').tooltip(); 
    $("[data-toggle='tooltip']").tooltip();
}, 1000);
$('#all').on('click', function() {
    //if ($('.accordion-toggle a').hasClass('collapsed'))
    if ($("#all span").text() == "Collapse All") {
        //alert('1')
        $('a.accordion-toggle').attr('aria-expanded', 'false');
        $("#all span").text("Expand All");
        $('#all i').removeClass('fa-minus');
        $('.panel-collapse').removeClass('in');
        $('.panel-collapse').css('height', 'auto');
    } else {
        //alert('2')
        $('a.accordion-toggle').attr('aria-expanded', 'true');
        $("#all span").text("Collapse All");
        $('#all i').addClass('fa-minus');
        $('.panel-collapse').addClass('in');
        $('.panel-collapse').css('height', 'auto');
    }
});

function panelfun() {
    setTimeout(function() {
        //alert('a')
        var areexpand = false;
        $('#accordion').find('div[id^=panal_heading] a').each(function(e) {
            if ($(this).attr('aria-expanded') == 'true') {
                areexpand = true;
                //alert("Collapse All");
                $("#all span").text("Collapse All");
                $('#all i').addClass('fa-minus');
                return false;
            } else {
                //alert("Expand All");
                $("#all span").text("Expand All");
                $('#all i').removeClass('fa-minus');
            }
        });
    }, 100);
};


function convert_date_DDMMYYYY(date_to_convert) {
    var arr_dateandtime = date_to_convert.split(' ');
    var arr_dateonly = arr_dateandtime[0].split('-');
    //  var arr_timeonly = arr_dateandtime[1].split(':');

    var m_names = new Array("Jan", "Feb", "Mar",
        "Apr", "May", "Jun", "Jul", "Aug", "Sep",
        "Oct", "Nov", "Dec");
    var MonthNo = '';
    var MonthName = arr_dateonly[1];
    //m_names[MonthName]


    if (MonthName == '01') {
        MonthNo = 'Jan';

    } else if (MonthName == '02') {
        MonthNo = 'Feb';
    } else if (MonthName == '03') {
        MonthNo = 'Mar';
    } else if (MonthName == '04') {
        MonthNo = 'Apr';
    } else if (MonthName == '05') {
        MonthNo = 'May';
    } else if (MonthName == '06') {
        MonthNo = 'Jun';
    } else if (MonthName == '07') {
        MonthNo = 'Jul';
    } else if (MonthName == '08') {
        MonthNo = 'Aug';
    } else if (MonthName == '09') {
        MonthNo = 'Sep';
    } else if (MonthName == '10') {
        MonthNo = 'Oct';
    } else if (MonthName == '11') {
        MonthNo = 'Nov';
    } else if (MonthName == '12') {
        MonthNo = 'Dec';
    }



    converted_date = arr_dateonly[2] + "-" + MonthNo + "-" + arr_dateonly[0];
    return converted_date;
    //alert(converted_date);



}

function BindEmployee(listname, owner_id) {

    //var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="IsActive" /><Value Type="Boolean">1</Value></Eq><And><Eq><FieldRef Name="Proxysharepointid" /><Value Type="Person or Group">'+owner_id+'</Value></Eq><Eq><FieldRef Name="ProxyApproverType" /><Value Type="Text">Manager Approval</Value></Eq></And></And></Where></Query></View>';

    var query_cml = 'Items?$filter=IsActive eq \'1\' and Proxysharepointid eq \'' + owner_id + '\' and ProxyApproverType eq \'Manager Approval\' &$orderby= Modified desc';

    $.ajax({
        url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('" + listname + "')/" + query_cml,
        type: "GET",
        async: false,
        headers: {
            "Accept": "application/json;odata=verbose"
        },
        success: function(data) {
            //console.log(data.d.results.length);
            var i = 0;
            $.each(data.d.results, function(key, value) {

                //$("#ddlemployee").append($("<option></option>").val(data.d.results[i].EmpGuid).html(data.d.results[i].EmpName));
                $("#ddlemployee")[0].sumo.add(data.d.results[i].EmpGuid, data.d.results[i].EmpName)
                i++;
            });
            if (data.d.results.length == 1) {
                //alert('');
                //$('#ddlemployee option[value='+data.d.results[0].EmpGuid+']').prop("selected", true);
                $("#ddlemployee")[0].sumo.selectItem($("#ddlemployee  option[value=" + data.d.results[0].EmpGuid + "]").index());

                Binddata();
            }
        },
        error: function(data) {
            failure(data);
        }
    });
}

function Binddata() {

    $('#ddlemployee').css({
        "border": "",
        "background-color": ""
    });
	 $('.loader').show();
    setTimeout(function(){
   
    var employee = $('#ddlemployee option:selected').val();
    if (employee == "-1") {
        $('#accordion').empty();
        $("#Upper_strip").hide();
        $('#ddlemployee').css({
            "border": "1px solid red",
            "background-color": "#FFCECE"
        });

        document.getElementById("ddlemployee").focus();
        $("#alertmain").show();
        document.getElementById("Alert_msg").innerHTML = "Please select Resource Name";
        //$('.loader').hide();
        //alert('Please select employee');
    } else {
        // $('.loader').show();
        proxyid = $('#ddlemployee option:selected').val();

        //setTimeout(function() 
        //{
        //Check if the image or whatever is loaded  
        //$('.loader').show();
        getResources(web_url, 'BconeExpenceMaster', $('#ddlemployee option:selected').val(), 'Project_view');
        // $('.loader').hide();
        //}, 1000);



    }
	$('.loader').hide();
   }, 1000);
    
}

function Reset() {
    $("#Upper_strip").hide();
    $('#accordion').empty();
    $("#ddlemployee")[0].sumo.selectItem(0);
}

 function linqrefine(filter_type,filter_value){
            var filtered_data='';
            if(filter_type=='Resource_View')
            {
                filtered_data= master_data.filter(function (item) {
                    return item.EmployeeId == filter_value;
                });
            }
            else		
            {
                filtered_data= master_data.filter(function (item) {
                    return item.ProjectId == filter_value;
                });
            }
			
			
			//TrackingIds.push({Tracking:filtered_data.ID,EmployeeId:filtered_data.EmployeeId,ProjectId:filtered_data.ProjectId}) ;
                            //loaddata1(filtered_data.ID);

            return filtered_data.length;
        }
    </script>
    <div class="allcommentdiv-main " id="openouterfileattach">
        <!-- inner-popup outer-popup add class -->
        <div class="allcommentdiv outer-popup ">
            <div class="allcommentdiv-heading">
                Uploaded File List
            </div>
            <div class="allcommentdiv-mid">
                <h3 id="reff_no">Ref No. 1</h3>
                <div class="vertical-scoll">
                    <table class="table table-bordered text-left">
                        <tbody id="inner_tbody">

                        </tbody>
                    </table>
                </div>
            </div>
            <div class="allcommentdiv-foot">
                <a href="javascript:void(0)" class="blue-btn" onclick="closeouterfileattach()">Got it</a>
            </div>
        </div>
    </div>



</body>


</html>
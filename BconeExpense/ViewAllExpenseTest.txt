<html>


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Home</title>
    <script src="../SiteAssets/BconeExpenseJs/jquery.min.js"></script>
    <script src="../SiteAssets/BconeExpenseJs/bootstrap.min.js"></script>
    <!-- <script src="../SiteAssets/BconeExpenseJs/dialogbox.js"></script>
    <script src="../SiteAssets/BconeExpenseJs/overhang.js"></script> -->
    <link href="../SiteAssets/BconeExpenseCss/bootstrap.min.css" rel="stylesheet" />
    <!--  <link href="../SiteAssets/BconeExpenseCss/overhang.css" rel="stylesheet" />
    <link href="../SiteAssets/BconeExpenseCss/dialogbox.css" rel="stylesheet" /> -->
    <link href="../SiteAssets/BconeExpenseCss/stylesheet.css" rel="stylesheet" />
    <link href="../SiteAssets/BconeExpenseCss/font-awesome.min.css" rel="stylesheet" />
    <!-- <link href="../SiteAssets/BconeExpenseCss/jquery-ui.css" rel="stylesheet" /> -->
    <!-- <script src="../SiteAssets/BconeExpenseJs/jqueryui.js"></script> -->
    <!-- <link rel="stylesheet" href="../SiteAssets/BconeExpenseCss/jquery.dataTables.min.css"> -->
    <!-- <script src="../SiteAssets/BconeExpenseJs/jquery.dataTables.min.js"></script> -->
    <!-- <link rel="stylesheet" href="../SiteAssets/BconeExpenseCss/jqx.base.css" type="text/css" />
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxcore.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxdata.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxbuttons.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxscrollbar.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxlistbox.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxdropdownlist.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxmenu.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.pager.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.sort.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.filter.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxcheckbox.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.columnsresize.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxgrid.selection.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxpanel.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/demos.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxwindow.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqxtooltip.js"></script>
    <script type='text/javascript' src="../SiteAssets/BconeExpenseJs/jquery.mousewheel.min.js"></script>
     -->
    <link rel="stylesheet" type="text/css" href="../SiteAssets/BconeExpenseCss/jquery.dataTables.css">
    <script type="text/javascript" language="javascript" src="../SiteAssets/BconeExpenseJs/jquery.dataTables.js"></script>



    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jquery.SPServices.min.js"></script>
     <style>
        .ms-core-pageTitle, .ms-core-pageTitle a {color: #fff; display: none; } #login_name_contain {float: right; margin: -32px 20px 0px 0px; background: url(https://bristleconeonline.sharepoint.com/sites/pwa/SiteAssets/BconeExpenseImg/user-icon.png) no-repeat right center; padding: 2px 32px 2px 0px; } .table > thead > tr > th {text-align: center; } .displayblock {display: block; } .displaynone {display: none; } a, a:visited, a:active, a:link { } a:visited {color: #337ab7; } input:-webkit-autofill, input:-webkit-autofill:hover, input:-webkit-autofill:focus, input:-webkit-autofill:active {-webkit-box-shadow: 0 0 0px 50px white inset; } #jqxWidget1d584650 {display: none !important; } .jqx-clear > span {display: none !important; }.fk-suc-msg {background: url(http://img1a.flixcart.com/www/prod/images/tick1-042bc15a.png) no-repeat scroll 5px 2px #337ab7; border: 1px solid #2e6da4; color: #fff; font-size: 13px; padding: 2px 0 2px 28px; text-align: left; width: 91%; } .new-th {border: 0; border-top: 1px solid #000; } #s4-workspace {width: 100% !important; } #ui-id-1, #ui-id-2, #ui-id-3, #ui-id-4 {height: auto !important; } .SumoSelect {margin-bottom: 10px; } .readonlycolor {background: #F2F2F2 !important; } .body {margin: 0px; padding: 0px; font-size: 12px; } .black-bg {width: 100%; height: 100%; top: 0; position: fixed; background-color: rgba(22,22,22,0.5); z-index: 9999; left: 0; } .popup-main {background-color: #fff; width: 350px; margin: 19% auto; text-align: center; } .green-btn {<!-- padding: 5px 10px; --> border-radius: 3px; color: #fff; background: #0A891A; text-decoration: none; display: inline-block; } .grey-btn {padding: 5px 10px; border-radius: 3px; color: #333; background: #ccc; text-decoration: none; display: inline-block; } .popup-heading {width: 100%; text-align: center; font-size: 15px; color: #fff; padding: 8px 0; } .alert-main .popup-heading {background-color: #0072c6; } .success-main .popup-heading {background-color: #090; } .pop-mid {padding: 0 15px 15px 15px; } .pop-mid p {margin-bottom: 20px; } .divnewbtn {background-color: #e7e7e7 !important; color: black; } .jqx-grid-column-filterbutton {display: none !important; } tfoot input {width: 100%; padding: 3px; box-sizing: border-box; } tfoot {display: table-header-group; } .black-bg {width: 100%; height: 100%; top: 0; position: fixed; background-color: rgba(22,22,22,0.5); z-index: 9999; left: 0; } .popup-main {background-color: #fff; width: 350px; margin: 19% auto; text-align: center; } .grey-btn {padding: 5px 10px; border-radius: 3px; color: #333; background: #ccc; text-decoration: none; display: inline-block; } .popup-heading {width: 100%; text-align: center; font-size: 15px; color: #fff; padding: 8px 0; } .middle {width: 100%; } .alert-main .popup-heading {background-color: #0072c6; } .success-main .popup-heading {background-color: #090; } .pop-mid {padding: 0 15px 15px; } .pop-mid p {margin-bottom: 20px; } .divnewbtn {background-color: #e7e7e7!important; color: #000; } .newpopupdiv .modal-header {padding: 5px 8px; background: #0072c6; } .newpopupdiv .modal-title {color: #fff; font-size: 15px; } .newpopupdiv .close {opacity: 1; color: #fff; } .newpopupdiv .modal-dialog {margin: 190px auto; } tfoot input {width: 100%; padding: 3px; box-sizing: border-box; } tfoot {display: table-header-group; } .example thead th[data-orderable="false"] {background-image: none!important; cursor: auto; } .example tbody tr td:first-child {text-align: center; } .example tfoot th:first-child input[type="text"] {display: block; } #innertable_wrapper .dataTables_length {float: left!important; margin: 0; text-align: left; } #innertable_wrapper .dataTables_filter {margin-top: 0; } .ms-core-pageTitle, .ms-core-pageTitle a {color: #fff; display: none; }  .ms-webpartPage-root {border-spacing: 0; } .ms-breadcrumb-box {display: none; } #siteIcon {height: 45px; } .ms-siteicon-img {max-height: 40px; } #login_name_contain {padding: 3px 32px 3px 0 !important; } table.dataTable {border-collapse: collapse; } .dataTables_filter {margin-bottom: 15px; } .example thead tr th {background: #e8e8e8; color: #333; text-align: left; vertical-align: middle;; font-size: 12px!important; } .breadcrumb-new a {color: #337ab7; } .breadcrumb-new a:visited {color: #337ab7!important; } .breadcrumb-new .ms-link:visited {color: #337ab7!important; } .example {color: #333; } table.dataTable thead .sorting {font-size: 12px; text-align: left; } table.dataTable tbody {font-size: 12px; } ::-webkit-input-placeholder {font-size: 11px; font-weight: normal !important; } ::-moz-placeholder {font-size: 11px; font-weight: normal !important; } :-ms-input-placeholder {font-size: 11px; font-weight: normal !important; } :-moz-placeholder {font-size: 11px; font-weight: normal !important; } .dataTables_length {} .dataTables_filter {} .top-refine ul li {float: none; margin-bottom: 10px; } .top-refine ul li:last-child {margin-bottom: 0; } .openDetailsMain {background: rgba(255,255,255,0.57); position: fixed; top: 0; left: 0; z-index: 999; width: 100%; height: 100%; display: none; } .openDetailsMainInner {width: 85%; margin: 60px auto; border-radius: 5px; border: 1px solid #0072c6; background: #fff; } .openDetailsMain-heading {padding: 5px 8px; background: #0072c6; font-size: 14px; color: #fff; line-height: 1.6; } .openDetailsMain-heading a {color: #fff; float: right; cursor: pointer; } .openDetailsMain-mid {padding: 10px; } .openDetailsMain-midTop {margin-bottom: 15px; } .openDetailsMain-midTop table {width: 100%; } .openDetailsMain-midTop table tbody tr td {padding: 5px; } .openDetailsMain-midTop table tbody tr th {padding: 5px; text-align: left; background: #efefef; color: #333; } .openDetailsMain-midBottom table {margin-bottom: 0!important; width: 100% !important} .openDetailsMain-midBottom table thead tr th {vertical-align: middle; background: #e8e8e8; } .wordWrap {overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; } table {font-size: 12px!important; text-align: left!important; } label {font-weight: normal; } #siteIcon {min-width: 64px; height: 64px; line-height: 64px; text-align: center; margin-right: 20px; float: left; }.example tfoot tr th:first-child input{display: none !important;}.example tbody tr td:first-child{text-align:center !important;}.dataTables_scrollHeadInner{width:100% !important;}.openDetailsMain-midBottom .dataTables_scrollBody table{width: 99.99% !important;}
    </style>



</head>

<body>

    <div id="alertmain" class="alert-main" style="display: none">
        <div class="black-bg" id="backcolor">
            <div class="popup-main">
                <div class="popup-heading"><span id="Alert_msg">Saved successfully</span></div>
                <div class="pop-mid">
                    <p id="submitValue"></p>
                    <input type='Button' class="divnewbtn" value="OK" id="ok_click1" onclick="close_div('')" />  
                </div>
            </div>
        </div>
    </div>


    <div id="Confirmation_alert" class="alert-main" style="display: none;">
        <span id="confirmation_type"></span>
        <span id="delete_expense_id" style="display: none;"></span>
        <div class="black-bg" id="Div1">
            <div class="popup-main">
                <div class="popup-heading"><span id="Confirmation_msg">Are you sure you want To Reject Expense?</span></div>
                <div class="pop-mid">
                    <p id="P1"></p>
                    <span id="Method_tocall"></span>
                    <input type="Button" class="divnewbtn" value="OK" id="ok_click" onclick="deleteexpense();">
                    <input type="Button" class="divnewbtn" value="Cancel" onclick="confirmation_close();">
                </div>
            </div>
        </div>
    </div>


    <header>
    </header>
    <div style="text-align: right;" id="login_name_contain"></div>
    <section class="middle">
        <div class="breadcrumb-new">
            <div class="container-fluid">
                <ul>
                    <li>
                        <a href="https://bristleconeonline.sharepoint.com/sites/pwa/default.aspx">Home</a>
                    </li>
                    <li>
                        <a href="javascript:void(0)" style="cursor: default;">Expense</a>

                    </li>
                    <li>
                        <a href="javascript:void(0)" style="cursor: default; color: black;"><span id="navigation_span">All Record</span></a>

                    </li>

                </ul>


                <div class="clearfix"></div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="top-refine">
                    <ul class="pull-left">
                        
                         <li style="float:left;">
								<a href="javascript:void(0)" class="blue-btn" onclick="ReSet()" id="BtnReSet">ReSet</a>
							</li> 
							
                      
                        
                        <li></li>
                        <li></li>
                    </ul>
					   <ul>
 <li><span id="SelectedItemCount">0</span> item selected</li>
    </ul>
                    <ul class="pull-right">
                        <li>
                            <a href="javascript:void(0)" class="green-btn" id="AllRecord" onclick="refine_status('FirstTimeLoad',this.id);"><i class="fa fa-flag-o" aria-hidden="true"></i>All Record <span class="red-count" id="AllRecordCount"></span></a>
                            <a href="javascript:void(0)" class="blue-btn" id="Open" onclick="refine_status('Open',this.id);"><i class="fa fa-folder-o"></i>Open <span class="red-count" id="OpenExpenceCount"></span></a>
                            <a href="javascript:void(0)" class="blue-btn" id="Submitted" onclick="refine_status('Submitted',this.id)"><i class="fa fa-send"></i>Submitted<span class="red-count" id="SubmittedExpenceCount"></span></a>

                            <a href="javascript:void(0)" class="blue-btn" id="Approved" onclick="refine_status('Approved',this.id)"><i class="fa fa-check"></i>Approved<span class="red-count" id="ApprovedExpenceCount"></span></a>
                            <a href="javascript:void(0)" class="blue-btn" id="Rejected" onclick="refine_status('Rejected',this.id)"><i class="fa fa-ban"></i>Rejected<span class="red-count" id="RejectedExpenceCount"></span></a>
                            <a href="javascript:void(0)" class="blue-btn" id="Reimbursed" onclick="refine_status('Reimbursed',this.id)"><i class="fa fa-usd"></i>Reimbursed<span class="red-count" id="ReimburesedExpenceCount"></span></a>

                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>


            </div>



            <div class="clearfix"></div>
            <div class="">

                <div class="row" id="jqxgrid_container">
                   
				<table id="ExpenceDataTable" class="display example table table-bordered" cellspacing="0" width="100%">
                </table>
				
                </div>

                




            </div>
        </div>
			
<div class="openDetailsMain">
	<div class="openDetailsMainInner">
		<div class="openDetailsMain-heading">
			Tracking No : <span id="TrackingIdBind">61</span>
			<a onclick="closedetails()"><i class="fa fa-remove"></i></a>
		</div>
		<div class="openDetailsMain-mid">
			<div class="openDetailsMain-midTop">
				<table class="table table-bordered" style="table-layout: inherit;  word-break: break-all;  word-wrap: break-word;">
					<tbody>
						<tr>
							<th style="width: 20%;">Project Name</th>
							<th style="width: 20%;">Expense Report Name</th>
							<th style="width: 12%;">Advance Amount </th>
							<th style="width: 10%;">ER Currency</th>
							<th style="width: 32%;">Description</th>
						</tr>
						<tr>
							<td><span id="ProjectNameBind">03651 - Expense Project 091</span></td>
							<td><span id="ExpenseReportNameBind">Test</span></td>
							<td style="text-align: right;"><span id="AdvanceAmountBind">8765.01 </span><span style="color: #ababab;margin-left: 6px;" id="AdvanceCurrency">USD</span></td>
							<td><span id="Expensecurrency">INR</span></td>
							<td colspan="5"><span id="DescriptionBind">Loren lipsum  Loren lipsum Loren lipsum</span></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="openDetailsMain-midBottom">
				<table id="innertable" class="table example table-bordered" style="width: 100% !important;">
					<thead>
						<tr>
							<th style="width: 50px !important; padding: 10px 5px;" data-orderable="false" class="sorting_asc">Info</th>
							<th style="width: 40px !important; padding: 10px 5px;">Ref <br> No</th>
							<th style="padding: 10px 5px;">Project Phase</th>
							<th style="padding: 10px 5px;">Item</th>
							<th style="padding: 10px 5px;">Expense Note</th>
							<th style="width: 70px !important; padding: 10px 5px;">Status</th>
							<th style="width: 80px !important; padding: 10px 5px;">ER <br> Amount</th>
							<th style="width: 80px !important; padding: 10px 5px;">Amount</th>
							<th style="width: 90px !important; padding: 10px 5px;">Payment <br> Type</th>
							<th style="width: 90px !important; padding: 10px 5px;">Expense <br> Date</th>
							<th style="width: 70px !important; padding: 10px 5px;">Billable</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
        <script>
		var FLoginname="";
	  var FloginId="";
		  var expense_creater_id="";
	  var Approver2Id="";
	  var ExpenseApproveType="";
      var Approver1Id="";
	  var FinanceApprovalId="";
	  var PathUrl="";
            function cleardata() {
			
		

                $('#jqxgrid_container').empty();

                $("#jqxgrid_container").append("<table id='ExpenceDataTable' class='display example table table-bordered' cellspacing='0' width='100%'></table>")
               
            }
        </script>
    </section>
    <div class="export-to-exl">

        <div class="clearfix"></div>
    </div>

    <style>
        .textwidth .modal-body table tr td .form-control {
            width: 100% !important;
        }
    </style>
    <div id="myModal" class="modal fade textwidth" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Expense Initiate Form</h4>
                </div>
                <div class="modal-body">
                    <table>
                        <tbody>
                            <tr style='display: none;'>
                                <td>Project Source<sup style="color: #f00; font-size: 14px;">*</sup></td>
                                <td>
                                    <div id="advance1" class="radio-main">



                                        <input type="radio" name="advance1" style="cursor: pointer" value="AllocatedProjects">Allocated Projects
									<input type="radio" name="advance1" value="ExceptionalProjects" style="cursor: pointer">Exceptional Projects
                                    
                                    </div>

                                </td>
                            </tr>

                            <tr>
                                <td style="vertical-align: top;">Select Project<sup style="color: #f00; font-size: 14px;">*</sup><br>
                                    <sup style="color: #ababab; font-size: 12px;"><span id="project_type"></span></sup></td>
                                <td>


                                    <select class="form-control" id="ddlProjects" onchange="hideerror(this.id); hideerror('txtProManager'); ">
                                        <option value="0">Select</option>
                                    </select>





                                </td>
                            </tr>



                            <tr>
                                <td>Expense Currency<sup style="color: #f00; font-size: 14px;">*</sup></td>
                                <td>
                                    <select class="form-control" id="ddlExpensecurrency" onchange="hideerror1(this.id)">
                                        <option>Select</option>

                                    </select>
                                </td>
                            </tr>



                            <tr>

                                <td style="width: 195px;">Expense Report Name<sup style="color: #f00; font-size: 14px;">*</sup><br>
                                    <sup style="color: #ababab; font-size: 12px;">(Max 256 character allowed)</sup></td>
                                <td>
                                    <input type="text" id="Txtexpensereport" onkeyup="hideerror('Txtexpensereport')" class="form-control" />
                                </td>
                            </tr>
                            <tr>
                                <td style="vertical-align: top;">Description<!--<sup style="color: #f00; font-size: 14px;">*</sup>--><br>
                                    <sup style="color: #ababab; font-size: 12px;">(Max 500 character allowed)</sup></td>
                                <td>

                                    <!-- <input type="text" style="width: 100%; height: 81px;" class="form-control" id="TxtDescription" onkeyup="hideerror('TxtDescription')" style="height: 40px" /> -->

                                    <textarea rows="4" cols="45" id="TxtDescription" onkeyup="hideerror('TxtDescription')"></textarea>



                                </td>
                            </tr>



                            <tr>
                                <td>Have you taken Advance ?<sup style="color: #f00; font-size: 14px;">*</sup></td>
                                <td>
                                    <div id="advance" class="radio-main">

                                        <input type="radio" name="advance" value="Yes">
                                        Yes
									<input type="radio" name="advance" value="No">
                                        No
                                    
                                    </div>

                                </td>
                            </tr>



                            <tr>
                                <td>Advance Currency<sup id="currency_validation_star" style="color: #f00; font-size: 14px; display: none;">*</sup></td>
                                <td>
                                    <select class="form-control" id="currency" onchange="hideerror1(this.id)">
                                        <option>Select</option>

                                    </select>
                                </td>
                            </tr>


                            <tr>
                                <td>Advance Amount<sup id="amount_validation_star" style="color: #f00; font-size: 14px; display: none;">*</sup></td>
                                <td>
                                    <div class="Amount-right-side">
                                        <input readonly="true" type="text" id="Txtamttaken" class="form-control" onkeyup="hideerror('Txtamttaken')" />
                                        <span class="amt-right-text" style="color: #ababab;" id="currencyspan"></span>
                                    </div>
                                </td>
                            </tr>

                            <tr>

                                <td style="width: 195px;">Expense Approver Name<sup style="color: #f00; font-size: 14px;">*</sup><br>
                                    <sup style="color: #ababab; font-size: 12px;"><span id="Role_assign"></span></sup></td>
                                <td>

                                    <input type="text" id="txtProManager" class="form-control" readonly="true" />

                                    <select class="form-control" style="display: none;" id="ddlProjectsmanager" onchange="hideerror1(this.id)">
                                    </select>


                                </td>
                            </tr>


                            <tr>
                                <td></td>
                                <td>
                                    <span id="AlertMsg" style="color: red;"></span>
                                    <span id="user_id" style="display: none;"></span>
                                    <span id="user_name" style="display: none;"></span>
                                    <span id="resourse_id" style="display: none;"></span>
                                    <span id="ClientPartnerEmployeeId" style="display: none;"></span>
                                    <span id="ClientPartnerEmployeeName" style="display: none;"></span>
                                    <span id="Span3"></span>

                                    <span id="ReportingManager" style="display: none;"></span>
                                    <span id="ReportingManagerGuid" style="display: none;"></span>
                                    <span id="ReportingManagerName" style="display: none;"></span>
                                    <span id="EmpBaseLocation" style="display: none;"></span>

                                </td>
                            </tr>
                            <tr id="add_tr">
                                <td></td>
                                <td>
                                    <a href="javascript:void(0)" class="blue-btn" id="btnSubmit">Save & close</a>

                                    <a href="javascript:void(0)" class="blue-btn" id="btnSaveAndAdd">Save & Add Item</a>

                                    <a href="javascript:void(0)" class="gray-btn" data-dismiss="modal">Cancel</a>


                                </td>
                            </tr>




                            <tr id="update_tr" style="display: none;">
                                <td></td>
                                <td>
                                    <span id="edit_id" style="display: none;"></span>
									<span id="edit_ExpenseTrackingNo" style="display: none;"></span>
                                    <span id="tr_editid" style="display: none"></span>
                                    <a href="javascript:void(0)" class="blue-btn" id="btn_update" onclick="updateListItem('BconeExpenceMaster','https://bristleconeonline.sharepoint.com/sites/pwa/');">Update</a>

                                    <a href="javascript:void(0)" class="blue-btn" id="Item_log_detail">Update Item Detail</a>
                                    <a href="javascript:void(0)" class="gray-btn" data-dismiss="modal">Cancel</a>


                                </td>
                            </tr>

                            <tr id="mytr">
                                <td></td>
                                <td style="padding-bottom: 0px; padding-top: 0px;">
                                    <div class="fk-suc-msg" id="per-info-suc" style="display: none;"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="loader"></div>


    <script>
	
	
	
	
        var reporting_manager_name='';
	   
        var Emp_ID;
        var exceptional_name;
        var exceptional_guid;
        var finalCc="";
        var finalTo="";
        var First_approver_detail="";
        var Second_approver_detail="";
  
        var First_approver_EmpId="";
        var Second_approver_EmpId="";
  
        var exceptional_guid1="";
        var Approver_type="";
		
        var PendingWithId="";
        var PendingWithName="";
        var ddlExpensecurrencytext="";
		
        var ExceptionalProjectApproverName="NA";

        $(function () {
		
            var ditached_counter_div = null;



            $('#pageTitle').find("a").html('');


            $('#btnSubmit').click(function (e) {

                var isValid = false;
                if (check_validation()) {


                    var EmpBaseLocation=$('#EmpBaseLocation').text();

                    var expensereport = document.getElementById("Txtexpensereport").value;


                    var Description = document.getElementById("TxtDescription").value;

                    var amount = document.getElementById("Txtamttaken").value;


                    var currentdate = new Date();

                    var date = currentdate;

                    var currency_text = $('#currency :selected').text();
					
                    var ProjectOwnerName='';
                    var ProjectOwnerId='';
					 
                    var resourse_id =''
					
					 
                    var approver2_guid='';
                    var approver2_name='';
					
                    var currencyval = $('#currency :selected').val();
                    var ddlExpensecurrency = $('#ddlExpensecurrency :selected').val();
                    var  ddlExpensecurrencytext = $('#ddlExpensecurrency :selected').text();

                    var ProjectId = $('#ddlProjects :selected').val();
                   
                    var Projectname=    $('#ddlProjects :selected').text();

                    var ProjectOwner  =    $('#ddlProjectsmanager :selected').text();
                    ProjectOwner=ProjectOwner.split('|');
					 
                    resourse_id=$('#resourse_id').text();
                    ReportingManagerGuid=$('#ReportingManagerGuid').text();
                    ReportingManagerName=$('#ReportingManagerName').text();
				
					 
                    if(resourse_id==ProjectOwner[2])
                    {
                        
                        ProjectOwnerName=ReportingManagerName;
                    
                        ProjectOwnerId=   ReportingManagerGuid;
						
                    }
                    else
                    {
                       
                        if(ProjectOwner[1]==resourse_id)
                        {
                            ProjectOwnerName=ProjectOwner[3];
                    
                            ProjectOwnerId=   ProjectOwner[2];
							
                        }
                        else
                        {
                            ProjectOwnerName=ProjectOwner[0];
                    
                            ProjectOwnerId=   ProjectOwner[1];
							
                        }
                    }

                   



                    var EmployeeId=  $('#user_id').text();
                    var EmployeeName=$('#user_name').text();
                    var ResourseId= $('#resourse_id').text();

                    var ddladvancetaken = ($('input[name=advance]:checked', '#advance').val());
                    var Project_source = ($('input[name=advance1]:checked', '#advance1').val());

                    if (ddladvancetaken == 'No') {

                        currencyval = 'null';
                        currency_text = '';
                    }
                    if(Project_source=="AllocatedProjects")
                    {
                    }
                   
                    if(Approver_type=="3-Level")
                    {  
                        var detail=First_approver_detail.split(':');
                        var detail1=Second_approver_detail.split(':');
			   
                        PendingWithId=detail[0];
                        PendingWithName=detail[1];
				  
                        approver2_guid=detail1[0];
                        approver2_name=detail1[1];
					
		
				  
                    }
			 
                    addExpense(current_url, 'BconeExpenceMaster', expensereport, Description, currencyval, date, amount, currency_text, 'save',ProjectId,Projectname,ProjectOwnerId,ProjectOwnerName,EmployeeId,EmployeeName,ResourseId,PendingWithId,PendingWithName,EmpBaseLocation,Project_source,approver2_guid,approver2_name,ddlExpensecurrency,ddlExpensecurrencytext);

                }

                

            });

            $('#btnSaveAndAdd').click(function (e) {

                var approver2_guid='Na';
                var approver2_name='Na';

                var isValid = false;
                if (check_validation()) {

                    var EmpBaseLocation=$('#EmpBaseLocation').text();

                    var expensereport = document.getElementById("Txtexpensereport").value;


                    var Description = document.getElementById("TxtDescription").value;

                    var amount = document.getElementById("Txtamttaken").value;

                    if (amount == '') {
                        amount = '0';
                    }
					
                    var currentdate = new Date();

                    var date = currentdate;

                    var currency_text = $('#currency :selected').text();

                  

                    var currencyval = $('#currency :selected').val();
                    var ddlExpensecurrency = $('#ddlExpensecurrency :selected').val();
					
                    var  ddlExpensecurrencytext = $('#ddlExpensecurrency :selected').text();

                    var ProjectId = $('#ddlProjects :selected').val();
                   

                    var Projectname=    $('#ddlProjects :selected').text();


                    var ProjectOwner  =    $('#ddlProjectsmanager :selected').text();
                    ProjectOwner=ProjectOwner.split('|');
                   
                    var ProjectOwnerId=   ProjectOwner[1];
					
					
					
					
                    resourse_id=$('#resourse_id').text();
                    ReportingManagerGuid=$('#ReportingManagerGuid').text();
                    ReportingManagerName=$('#ReportingManagerName').text();
					
                    if(resourse_id==ProjectOwner[2])
                    {
                        ProjectOwnerName=ReportingManagerName;
                    
                        ProjectOwnerId=   ReportingManagerGuid;
						
                    }
                    else
                    {
                        //if Pm selected his own projects.
                        if(ProjectOwner[1]==resourse_id)
                        {
                            ProjectOwnerName=ProjectOwner[3];
                    
                            ProjectOwnerId=   ProjectOwner[2];
							
                        }
                        else
                        {
                            ProjectOwnerName=ProjectOwner[0];
                    
                            ProjectOwnerId=   ProjectOwner[1];
							
                        }
                    }
				
	
                    var EmployeeId=  $('#user_id').text();
                    var EmployeeName=$('#user_name').text();
                    var ResourseId= $('#resourse_id').text();
					
                    var ddladvancetaken = ($('input[name=advance]:checked', '#advance').val());

                    if (ddladvancetaken == 'No') {
                        //set currency default value
                        currencyval = 'null';
                        currency_text = '';
                    }


                    var Project_source = ($('input[name=advance1]:checked', '#advance1').val());

                    if(Approver_type=="3-Level")
                    {  
			 
                        var detail=First_approver_detail.split(':');
			 
                        if(Second_approver_detail!=null&&Second_approver_detail!='')
                        {
                            var detail1=Second_approver_detail.split(':');
			 
                            approver2_guid=detail1[0];
                            approver2_name=detail1[1];
                        }
                        else
                        {
			 
                            approver2_guid="";
                            approver2_name="";
                        }
			   
                        PendingWithId=detail[0];
                        PendingWithName=detail[1];
				 
                    }
                   
                    addExpense(current_url, 'BconeExpenceMaster', expensereport, Description, currencyval, date, amount, currency_text, 'saveandcreate', ProjectId, Projectname, ProjectOwnerId, ProjectOwnerName, EmployeeId, EmployeeName, ResourseId,PendingWithId,PendingWithName,EmpBaseLocation,Project_source,approver2_guid,approver2_name,ddlExpensecurrency,ddlExpensecurrencytext);
                   
                }

            });


            $('#btnSubmitandNew').click(function (e) {


                var isValid = false;
                if (check_validation()) {


                    $('.loader').show();

                    var expensereport = document.getElementById("Txtexpensereport").value;


                    var Description = document.getElementById("TxtDescription").value;

                    var amount = document.getElementById("Txtamttaken").value;

                    var currentdate = new Date();

                    var date = currentdate;

                    var ss = $('#currency :selected').text();

                    var currencyval = $('#currency :selected').val();
                    var Project_source = ($('input[name=advance1]:checked', '#advance1').val());

                    addExpense(current_url, 'BconeExpenceMaster', expensereport, Description, currencyval, date, amount,Project_source);


                    add_success_exp_msg('Expense Created Successfully..', 'createnew');
                    $('.loader').hide();
                   
                    clearAllInputs('myModal');

                    //here record count dynamically based on total record
                    var record_count = 'new_record';




                    destroyjs();

                    getDataByListName(current_url, 'BconeExpenceMaster');

                    $('#student_datatable').DataTable();




                }

            });

            $('input:radio[name=advance]').change(function () {


                hideerror1('ddladvancetaken');
               
            });

			
            $('input:radio[name=advance1]').change(function () {

               
                var ddladvancetaken = ($('input[name=advance1]:checked', '#advance1').val());
               
                if(ddladvancetaken=="AllocatedProjects")
                {
                    document.getElementById("Role_assign").innerHTML="";

					
                    $('#txtProManager').val('');
                    
                    document.getElementById('ddlProjects').options.length = 0;
                    $('#ddlProjects').append("<option value = '0'>Select</option>");
                    $('#ddlProjects').attr("disabled", true);
                    getProjectsByGUID(GUID);
			
			
                }else
                {
                    document.getElementById("Role_assign").innerHTML="";

					
                    $('#txtProManager').val('');
                    document.getElementById('ddlProjects').options.length = 0;
                    $('#ddlProjects').append("<option value = '0'>Select</option>");
                    $('#ddlProjects').attr("disabled", true);
                    GetProjectsForOthers(Emp_ID);
                    
                }
		   
            });
           
            $('#Txtamttaken').mouseout(function () {
               
                convert_amount();
            });

            $("#Txtamttaken").blur(function () {
                convert_amount();
               
            });



            $("input[id*='Txtamttaken']").keydown(function (event) {


                if (event.shiftKey == true) {
                    event.preventDefault();
                }

                if ((event.keyCode >= 48 && event.keyCode <= 57) ||
                    (event.keyCode >= 96 && event.keyCode <= 105) ||
                    event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
                    event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) {

                } else {
                    event.preventDefault();
                }

                if ($(this).val().indexOf('.') !== -1 && event.keyCode == 190 || $(this).val().indexOf('.') !== -1 && event.keyCode == 110)
                    event.preventDefault();
                //if a decimal has been added, disable the "."-button

            });


        });

        function show_loader() {

            $('.loader').show();
        }

        function convert_amount() {

            var current_val = $('#Txtamttaken').val();
            
            if (current_val != '') {
                var num = parseFloat(current_val);
                //alert(num.toFixed(2)); // "2.40"
                $('#Txtamttaken').val(num.toFixed(2));
            }

        }



        function load_datatable_js() {




            $('#student_datatable').DataTable({

                aoColumnDefs: [

                   { "aTargets": [0], "bSortable": false }


                ],
                "lengthMenu": [[25, 50, 100, -1], [25, 50, 100, "All"]],
                "order": []

            });

            $('#student_datatable tfoot th').each(function () {
                var title = $(this).text();
               
                if (title != '') {
                    $(this).html('<input style="width:100px;" type="text" placeholder="Search" />');
                }
            });


            var table = $('#student_datatable').DataTable();


            table.columns().every(function () {
                var that = this;

                $('input', this.footer()).on('keyup change', function () {
                    if (that.search() !== this.value) {
                        that
                            .search(this.value)
                            .draw();
                    }
                });
            });

            $('.dataTables_wrapper #student_datatable').wrapAll(document.createElement('div'));
            $('.dataTables_wrapper #student_datatable').parent('div').addClass('table-responsive');
          
            $('.dataTables_wrapper .table-responsive').css("width", "1030px");

            $("#student_datatable_paginate").on("click", function () {
                $('[data-toggle="tooltip"]').tooltip();
            });

            $(".sorting").on("click", function () {
                $('[data-toggle="tooltip"]').tooltip();
            });




        }




        function add_success_exp_msg(message, type) {

            $("#alertmain").show();
            document.getElementById("Alert_msg").innerHTML=message;

            $("#per-info-suc").fadeOut(1000, function () {

                if (type == 'save') {
                    hidemodal();
                    clearAllInputs('myModal');
                }
                else if (type = 'saveandcreate') {

                }
                else {
                   
                    $('#Txtexpensereport').focus();
                }
            });



        }

        function alert_message_overhang(message) {
            $("body").overhang({
                custom: true, // Set custom to true
                primary: "#337ab7", // Your custom primary color
                accent: "#fff",// Your custom accent color
                message: message
            });
        }



        function isNumber1(evt) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {

                //alert($('#Txtamttaken').val());
                return false;
            }

            //alert($('#Txtamttaken').val());
            return true;
        }

        function isNumber(evt, element) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if ((charCode != 190 || $(element).val().indexOf('.') != -1)  // ?.? CHECK DOT, AND ONLY ONE.
                    && (charCode != 110 || $(element).val().indexOf('.') != -1)  // ?.? CHECK DOT, AND ONLY ONE.
                    && ((charCode < 48 && charCode != 8)
                            || (charCode > 57 && charCode < 96)
                            || charCode > 105))
                return false;
            return true;
        }

        function openalerbox() {
            var title = 'my amol m';
            $.dialogbox({
                type: 'msg',
                title: title,
                icon: 'http://i.stack.imgur.com/akO3g.png',
                content: 'Alert Content',
                btn: ['Confirm'],
                call: [
                  function () {
                      $.dialogbox.close();
                  }
                ]
            });
        }

        function destroyjs() {

            $('#student_datatable').DataTable({
                "filter": false,
                "destroy": true
            });


            var tables = $.fn.DataTable.fnTables(true);

            $(tables).each(function () {
                $(this).DataTable().fnDestroy();
            });


            clear_tbody();





        }

        function getDataByListName(url, listname, type,EmployeeId) {
         document.getElementById("SelectedItemCount").innerHTML=0;
            jsonObj = [];
            var trackingno = '';
            var title = '';

            var status = '';
            var advanceamount = '';

            var list_name = listname;
            var i = "0";
            var url1 = url;
            var rowhide = "";

            var Project_Name = "Project Name";
            var Pending_With = "Pending With";
            var Reimbursed_Total_Money = "Reimbursed_Total_Money";
            var Balance = "Balance";
            var fromdate = "";
            var ReportCreatedDate = "";
            var converted_date = "";
			

            var ModifiedDate = "";

            var openstatus_count = 0;
            var submittedstatus_count = 0;
            var approvedstatus_count = 0;
            var rejectedstatus_count = 0;
            var reimburesedstatus_count = 0;
            // var ReSubmittedExpenceCount = 0;
            var curreuncyvalue = 0;
            var advance = "";
            var tooltip_date = "";
            var allrecord_count = 0;
            var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/ExpenseItemDetailTest.aspx?TrackingNo=";
            var expenceid = '';
            var curr = '';
            var action_data = '';
			
			var date_data='';

            var data = '';
            var datetooltip='datetooltip';
            var pending_datetooltip='pendingdatetooltip';
            var final_status="";
            var pending_since="";
            var tooptipdate_pendinfsince="";
            var date_pending_since;
            var table_header="";
            var table_body="";
            var table_element="";
			var query_cml = "";
			var exp_amount='0.00';
			
			cleardata();
			

            table_header="<thead><tr>";
			table_header=table_header +"<th style='text-align:center; width:20px !important; padding:10px 0px;' data-orderable='false' class='sorting_disabled'><input type='checkbox' id='checkAll' name='' onclick='checkallclick()'></th>";
					
			if(type=='FirstTimeLoad')
			{
			
			  $('.pull-right').find('a').each(function () {
                $(this).removeClass('green-btn').addClass('blue-btn');
            });

           $('#AllRecord').addClass('green-btn');

            document.getElementById('navigation_span').innerHTML="All Record";
          
			query_cml='<View><Query><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			
            table_header=table_header +"<th style='width: 80px !important;'>ER No</th>";
		    table_header=table_header +"<th>User</th> ";
            table_header=table_header +"<th>Title</th> ";
            table_header=table_header +"<th>Project Name</th>";
			table_header=table_header +"<th style='width: 80px !important;'>ER <br> Amount</th>";
            table_header=table_header +"<th style='width: 80px !important;'>Date <br> Created</th>";
            table_header=table_header +"<th style='width: 80px !important;'>Pending <br> With</th>";
            table_header=table_header +"<th style='width: 70px !important;'>Status</th>";
            table_header=table_header +"</tr></thead>";
				//footer menu	
            table_header=table_header +"<tfoot><tr>";
			
			table_header=table_header +"<th></th>";
            table_header=table_header +"<th>ER No</th>";
			 table_header=table_header +"<th>User</th> ";
            table_header=table_header +"<th>Title</th>";
            table_header=table_header +"<th>Project Name</th>";
			table_header=table_header +"<th>ER Amount</th>";
			table_header=table_header +"<th>Date Created</th>";
            table_header=table_header +"<th>Pending With</th>";
            table_header=table_header +"<th>Status</th>";
            table_header=table_header +" </tr></tfoot>";
			}
			else if(type=='Open')
			{
			query_cml = '<View><Query><Where><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">' + type+ '</Value></Eq></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//table_header=table_header +"<th style='width: 65px !important;'>Action</th>";
			  table_header=table_header +"<th style='width: 80px !important;'>ER No</th>";
            table_header=table_header +"<th>User</th> ";
            table_header=table_header +"<th>Title</th>";
            table_header=table_header +"<th>Project Name</th>";
			table_header=table_header +"<th style='width: 80px !important;'>ER <br> Amount</th>";
			//table_header=table_header +"<th>ER Currency</th>";
            table_header=table_header +"<th style='width: 94px !important;'>Date Created</th>";
            table_header=table_header +"</tr></thead>";
				//footer menu	
            table_header=table_header +"<tfoot><tr>";
            //table_header=table_header +"<th>Action</th>";
			table_header=table_header +"<th></th>";
			
            table_header=table_header +"<th>ER No</th>";
			 table_header=table_header +"<th>User</th> ";
            table_header=table_header +"<th>Title</th>";
			table_header=table_header +"<th>Project Name</th>";
            table_header=table_header +"<th>ER Amount</th>";
           // table_header=table_header +"<th>ER Currency</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Date <br> Created</th>";
            table_header=table_header +" </tr></tfoot>";	
			
			}
			else if(type=='Submitted')
			{
			query_cml = '<View><Query><Where><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">' + type+ '</Value></Eq></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			//table_header=table_header +"<th >Action</th>";
		
            table_header=table_header +"<th style='width: 80px !important;'>ER No</th> ";
			 table_header=table_header +"<th style='width:150px !important;'>User</th> ";
            table_header=table_header +"<th>Title</th>";
            table_header=table_header +"<th style='width:150px !important;'>Project Name</th>";
			table_header=table_header +"<th style='width: 70px !important;'>ER <br> Amount</th>";
			//table_header=table_header +"<th>ER Currency</th>";
            table_header=table_header +"<th style='width: 80px !important;'>Date <br> Submitted</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Approver1</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Approver2</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Finance</th>";
            table_header=table_header +"</tr></thead>";
				//footer menu	
            table_header=table_header +"<tfoot><tr>";
           // table_header=table_header +"<th>Action</th>";
		   table_header=table_header +"<th></th>";
            table_header=table_header +"<th>ER No</th>";
			 table_header=table_header +"<th>User</th> ";
            table_header=table_header +"<th>Title</th>";
			table_header=table_header +"<th>Project Name</th>";
            table_header=table_header +"<th>ER Amount</th>";
           // table_header=table_header +"<th>ER Currency</th>";
			table_header=table_header +"<th>Date Submitted</th>";
			table_header=table_header +"<th >Approver1</th>";
			table_header=table_header +"<th >Approver2</th>";
			table_header=table_header +"<th >Finance</th>";
            table_header=table_header +" </tr></tfoot>";	
			
			}
			else if(type=='Approved')
			{
			//query_cml = '<View><Query><Where><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">' + type+ '</Value></Eq></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			 query_cml="<View>"+
"<Query>"+
   "<Where>"+
   
  "<Or>"+
    "<Eq><FieldRef Name='ReportStatus' /><Value Type='Text'>Approver 1 Approved</Value></Eq>"+
    "<Or>"+
    "<Eq><FieldRef Name='ReportStatus' /><Value Type='Text'>Manager Approved</Value></Eq>"+
    "<Or>"+
     "<Eq><FieldRef Name='ReportStatus' /><Value Type='Text'>Approver 2 Approved</Value></Eq>"+
     "<Eq><FieldRef Name='ReportStatus' /><Value Type='Text'>Approved</Value></Eq>"+
      "</Or>"+
     "</Or>"+
      "</Or>"+
    
    
      
  
 "</Where>"+
"</Query>"+
"</View>";
			//table_header=table_header +"<th >Action</th>";
			
            table_header=table_header +"<th style='width: 80px !important;'>ER No</th> ";
			 table_header=table_header +"<th>User</th> ";
            table_header=table_header +"<th>Title</th>";
            table_header=table_header +"<th>Project Name</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Date <br> Submitted</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Status</th>";
            table_header=table_header +"<th style='width: 80px !important;'>Approved By</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Date <br> Approved</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Pending <br> With</th>";
			table_header=table_header +"<th style='width: 80px !important;'>ER <br> Amount</th>";
			//table_header=table_header +"<th >ER Currency</th>";
			table_header=table_header +"<th style='width: 30px !important; padding:10px 5px;'>Log</th>";
            table_header=table_header +"</tr></thead>";
				//footer menu	
            table_header=table_header +"<tfoot><tr>";
			table_header=table_header +"<th></th>";
			//table_header=table_header +"<th >Action</th>";
            table_header=table_header +"<th >ER No</th> ";
			 table_header=table_header +"<th>User</th> ";
            table_header=table_header +"<th>Title</th>";
            table_header=table_header +"<th>Project Name</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Date <br> Submitted</th>";
			table_header=table_header +"<th>Status</th>";
            table_header=table_header +"<th >Approved By</th>";
			table_header=table_header +"<th >Date Approved</th>";
			table_header=table_header +"<th >Pending With</th>";
			table_header=table_header +"<th >ER Amount</th>";
			//table_header=table_header +"<th >ER Currency</th>";
			table_header=table_header +"<th >Log</th>";
            table_header=table_header +" </tr></tfoot>";	
			
			}
			else if(type=='Rejected')
			{
			//query_cml = '<View><Query><Where><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">' + type+ '</Value></Eq></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
					 query_cml="<View>"+
"<Query>"+
   "<Where>"+
   
  "<Or>"+
    "<Eq><FieldRef Name='ReportStatus' /><Value Type='Text'>Approver 1 Rejected</Value></Eq>"+
    "<Or>"+
    "<Eq><FieldRef Name='ReportStatus' /><Value Type='Text'>Manager Rejected</Value></Eq>"+
    "<Or>"+
     "<Eq><FieldRef Name='ReportStatus' /><Value Type='Text'>Approver 2 Rejected</Value></Eq>"+
     "<Eq><FieldRef Name='ReportStatus' /><Value Type='Text'>Rejected</Value></Eq>"+
      "</Or>"+
     "</Or>"+
      "</Or>"+
    
    
      
  
 "</Where>"+
"</Query>"+
"</View>";
			//table_header=table_header +"<th >Action</th>";
		
            table_header=table_header +"<th style='width: 80px !important;'>ER No</th> ";
			 table_header=table_header +"<th>User</th> ";
            table_header=table_header +"<th>Title</th>";
            table_header=table_header +"<th>Project Name</th>";
			table_header=table_header +"<th style='width: 80px !important;'>ER <br> Amount</th>";
			//table_header=table_header +"<th>ER Currency</th>";
            table_header=table_header +"<th >Status</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Rejected <br> By</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Date <br> Rejected</th>";
			table_header=table_header +"<th style='width: 100px !important;'>Rejection Comment</th>";
			table_header=table_header +"<th style='width: 30px !important; padding:10px 5px;'>Log</th>";
            table_header=table_header +"</tr></thead>";
				//footer menu	
            table_header=table_header +"<tfoot><tr>";
			//table_header=table_header +"<th >Action</th>";
			table_header=table_header +"<th></th>";
			
            table_header=table_header +"<th >ER No</th> ";
			 table_header=table_header +"<th>User</th> ";
            table_header=table_header +"<th>Title</th>";
            table_header=table_header +"<th>Project Name</th>";
			table_header=table_header +"<th>ER Amount</th>";
			//table_header=table_header +"<th>ER Currency</th>";
            table_header=table_header +"<th >Status</th>";
			table_header=table_header +"<th >Rejected By</th>";
			table_header=table_header +"<th >Date Rejected</th>";
			table_header=table_header +"<th >Rejection Comment</th>";
			table_header=table_header +"<th >Log</th>";
            table_header=table_header +" </tr></tfoot>";	
			
			}
			else if(type=='Reimbursed')
			{
			query_cml = '<View><Query><Where><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">' + type+ '</Value></Eq></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
			
			table_header=table_header +"<th style='width: 80px !important;'>ER No</th> ";
			 table_header=table_header +"<th>User</th> ";
            table_header=table_header +"<th>Title</th>";
            table_header=table_header +"<th>Project Name</th>";
			table_header=table_header +"<th style='width: 80px !important;'>ER Amount</th>";
			//table_header=table_header +"<th>ER Currency</th>";
            table_header=table_header +"<th style='width: 80px !important;'>Reimbursed <br> By</th>";
			table_header=table_header +"<th style='width: 80px !important;'>Date <br> Paid</th>";
			//table_header=table_header +"<th >Reimbursed Total</th>";
			//table_header=table_header +"<th >Reimbursed Comment</th>";
            table_header=table_header +"</tr></thead>";
				//footer menu	
            table_header=table_header +"<tfoot><tr>";
			table_header=table_header +"<th></th>";
			
			table_header=table_header +"<th >ER No</th> ";
			 table_header=table_header +"<th>User</th> ";
            table_header=table_header +"<th>Title</th>";
            table_header=table_header +"<th>Project Name</th>";
			table_header=table_header +"<th>ER Amount</th>";
			//table_header=table_header +"<th>ER Currency</th>";
            table_header=table_header +"<th >Reimbursed By</th>";
			table_header=table_header +"<th >Date Paid</th>";
			//table_header=table_header +"<th >Reimbursed Total</th>";
			//table_header=table_header +"<th >Reimbursed Comment</th>";
            table_header=table_header +" </tr></tfoot>";	
			
			}
			
            

            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/GetItems",
                type: "POST",
                async:false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                beforeSend: function () {
                    $('.loader').show();
                 
                },

                success: function (data) {
				//console.log(data);
                    table_body="<tbody>";
                    if (data.d.results.length > 0) {

                        $.each(data.d.results, function (key, value) {
						
						exp_amount='0.00';
                            
						if (value.FinalExpenseValue != null) 
						{
                                exp_amount = value.FinalExpenseValue;
                                if (exp_amount.toString().indexOf(".")) {
								
								exp_amount=exp_amount.toFixed(2);
                                }
                                else {
                                    exp_amount = exp_amount + ".00";

                                }



                            }

						
                            Project_Name=value.Projectname;
                            Project_Name=value.Projectname;
                            resubmit_count=value.ReSubmitCount
                            if(value.ReportStatus=="Open")
                            {
                                Pending_With="";
                                final_status=value.ReportStatus;

                            }
                            else if(value.ReportStatus=="Submitted")
                            {

                                final_status=value.ReportStatus;
                                Pending_With=value.PendingWithName;	
                     					 

                            }
                            else  if (value.ReportStatus =="Approved" || value.ReportStatus=="Approver 2 Approved" || value.ReportStatus=="Approver 1 Approved" || value.ReportStatus=="Manager Approved")
                            {
					 
                                if(value.ReportStatus=="Approved")
                                {
                                    Pending_With=value.FinanceName;
                                    final_status="Finance "+value.ReportStatus;
                                    //approved_date=value.FinanaceActionDate;
                                    // = convert_date_amol(value.FinanaceActionDate);
                                    approved_date=convert_date_amol(value.Modified);
                                    approvedby=value.FinanceName;
                                }
                                else if(value.ReportStatus=="Approver 2 Approved")
                                {
                                    Pending_With=value.FinanceName;
                                    final_status="Approver2 Approved";
                                    //approved_date=value.FinanaceActionDate;
                                    //approved_date = convert_date_amol(value.FinanaceActionDate);
                                    approved_date=convert_date_amol(value.Modified);
                                    approvedby=value.Approver2Name;
                                }
                                else if(value.ReportStatus=="Approver 1 Approved")
                                {
                                    Pending_With=value.PendingWithName;
                                    final_status="Approver1 Approved";
                                    //approved_date=value.FinanaceActionDate;
                                    // approved_date = convert_date_amol(value.FinanaceActionDate);
                                    approved_date=convert_date_amol(value.Modified);
                                    approvedby=value.Approver1Name;
                                }
					
                                else
                                {
					
                                    Pending_With=value.FinanceName;
                                    //final_status="Manager "+value.ReportStatus;
                                    final_status="Manager Approved";
                                    //var	converted_date1 = convert_date_amol_tooltip(value.ReportSubmittedDate);
                                    //approved_date = convert_date_amol(value.ManagerActionDate);
                                    approved_date=convert_date_amol(value.Modified);
                                    approvedby=value.Approver1Name;
					   
                                }
					  
                            }
					
                            else if (value.ReportStatus =="Rejected" || value.ReportStatus=="Approver 2 Rejected" || value.ReportStatus=="Approver 1 Rejected" || value.ReportStatus=="Manager Rejected")			
                            {
					
                                if(value.FinanceExpenseStatus=="Rejected")
                                {
                                    Pending_With=value.FinanceName;
                                    final_status="Finance "+value.ReportStatus;
                                    //rejected_date=value.FinanaceActionDate;
                                    rejected_date=convert_date_amol(value.Modified);
					  
                                }
                                else if(value.ReportStatus=="Approver 2 Rejected")
                                {
                                    Pending_With=value.PendingWithName;
                                    final_status="Approver2 Reject";
                                    //approved_date=value.FinanaceActionDate;
                                    //approved_date = convert_date_amol(value.FinanaceActionDate);
                                    approved_date=value.Modified;
                                    rejected_date=convert_date_amol(value.Modified);
                                }
                                else if(value.ReportStatus=="Approver 1 Rejected")
                                {
                                    Pending_With=value.PendingWithName;
                                    final_status="Approver1 Reject";
                                    //approved_date=value.FinanaceActionDate;
                                    // approved_date = convert_date_amol(value.FinanaceActionDate);
                                    approved_date=value.FinanaceActionDate;
                                    rejected_date=convert_date_amol(value.Modified);
                                }
					
                                else
                                {
					
                                    Pending_With=value.PendingWithName;
                                    //final_status="Manager "+value.ReportStatus;
                                    final_status="Manager Reject";
                                    //var	converted_date1 = convert_date_amol_tooltip(value.ReportSubmittedDate);
                                    //approved_date = convert_date_amol(value.ManagerActionDate);
                                    approved_date=value.FinanaceActionDate;
                                    rejected_date=convert_date_amol(value.Modified);
                                }

                            }
                            else if(value.ReportStatus=="Reimbursed")
                            {
                                Pending_With="NA";
                                final_status=value.ReportStatus;

                            }
                            
                            
                           
                            rowhide = "rowhideslow" + i + "";

                            curreuncyvalue = "";
                            advance = "-";


                            if (value.AmountTaken != null) {
                                advance = value.AmountTaken;
                                if (advance.toString().indexOf(".")) 
                                {
								
							
                                }
                                else {
								
                                    advance = advance + ".00";
								   
                                   
                                }
                             

                            }
                            var  reim_advance = "-";


                            if (value.BalanceAmount != null && value.BalanceAmount != '') 
                            {
                                reim_advance = value.BalanceAmount;
                                if (reim_advance.toString().indexOf(".")) 
                                {
								
							
                                }
                                else {
								
                                   
                                    reim_advance="";
                                    
                                }
                               
                            }

                            curreuncyvalue = value.currencytext;

                            if (curreuncyvalue == null) 
                            {
                                curreuncyvalue = "";

                            }
                            else {

                                Expenseitem = curreuncyvalue;


                                if (Expenseitem.indexOf("-")) {
                                    curr = Expenseitem.split("-");
                                    curreuncyvalue = curr[0];
                                }
                                else {
                                }

                            }
                            var  curreuncyvalue_reimberssed = value.ReimburseCurrencyText;
                            var curreuncyvalue_reimberssed_currency;
                            if (curreuncyvalue_reimberssed == null) {
                                curreuncyvalue_reimberssed = "-";

                            }
                            else {

                                curreuncyvalue_reimberssed_currency = curreuncyvalue_reimberssed;


                                if (curreuncyvalue_reimberssed_currency.indexOf("-")) {
                                    curr = curreuncyvalue_reimberssed_currency.split("-");
                                    curreuncyvalue_reimberssed = curr[0];
                                }
                                else {
                                }

                            }
                            var ReimburseComment="-";
                            if(value.ReimburseComment!=null && value.ReimburseComment!='')
                            {
							
                                ReimburseComment=value.ReimburseComment;
                            }
                            expenceid = value.ID;
                            comment = value.Comment;
							
                            action_data="<a data-toggle='tooltip' data-placement='top' title='Edit' style='display:inline-block; margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\",\"0\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='top' title='Delete' style='display:inline-block; cursor:pointer;' onclick='showConfirmation(" + value.ID + ",\"" + rowhide + "\",\"Are you sure you want to Delete the record?\")'><i class='fa fa-trash'></i></a>";
						if(type=='FirstTimeLoad')
						{
							allrecord_count++;
								
                            if (value.ReportStatus == "Open") {
                                openstatus_count++;
                            }

                            else if (value.ReportStatus == "Submitted") {
                                submittedstatus_count++;
                            }
                           
                           else  if (value.ReportStatus =="Rejected" || value.ReportStatus=="Approver 2 Rejected" || value.ReportStatus=="Approver 1 Rejected" || value.ReportStatus=="Manager Rejected")
                            {
                                rejectedstatus_count++;
                            }

                           else  if (value.ReportStatus =="Approved" || value.ReportStatus=="Approver 2 Approved" || value.ReportStatus=="Approver 1 Approved" || value.ReportStatus=="Manager Approved")
                            {
							
                                approvedstatus_count++;
                                
                            }

                           else  if (value.ReportStatus == "Reimbursed") {
                                reimburesedstatus_count++;
                                
                            }
					}

                           
						if (value.FinalExpenseValue != null) {
                                exp_amount = value.FinalExpenseValue;
                                if (exp_amount.toString().indexOf(".")) {
								
								exp_amount=exp_amount.toFixed(2);
                                }
                                else {
                                    exp_amount = exp_amount + ".00";

                                }



                            }

							//exp_amount="<div style='text-align:right;'>"+exp_amount+"</div>";
                            Project_Name=value.Projectname;
                            Project_Name=value.Projectname;
                            resubmit_count=value.ReSubmitCount
                            if(value.ReportStatus=="Open")
                            {
                                Pending_With="";
                                final_status=value.ReportStatus;

                            }
                            else if(value.ReportStatus=="Submitted")
                            {

                                final_status=value.ReportStatus;
                                Pending_With=value.PendingWithName;	
                     					 

                            }
                            else  if (value.ReportStatus =="Approved" || value.ReportStatus=="Approver 2 Approved" || value.ReportStatus=="Approver 1 Approved" || value.ReportStatus=="Manager Approved")
                            {
					 
                                if(value.ReportStatus=="Approved")
                                {
                                    Pending_With=value.FinanceName;
                                    final_status="Finance "+value.ReportStatus;
                                    //approved_date=value.FinanaceActionDate;
                                    // = convert_date_amol(value.FinanaceActionDate);
                                    approved_date=convert_date_amol(value.Modified);
                                    approvedby=value.FinanceName;
                                }
                                else if(value.ReportStatus=="Approver 2 Approved")
                                {
                                    Pending_With=value.FinanceName;
                                    final_status="Approver2 Approved";
                                    //approved_date=value.FinanaceActionDate;
                                    //approved_date = convert_date_amol(value.FinanaceActionDate);
                                    approved_date=convert_date_amol(value.Modified);
                                    approvedby=value.Approver2Name;
                                }
                                else if(value.ReportStatus=="Approver 1 Approved")
                                {
                                    Pending_With=value.PendingWithName;
                                    final_status="Approver1 Approved";
                                    //approved_date=value.FinanaceActionDate;
                                    // approved_date = convert_date_amol(value.FinanaceActionDate);
                                    approved_date=convert_date_amol(value.Modified);
                                    approvedby=value.Approver1Name;
                                }
					
                                else
                                {
					
                                    Pending_With=value.FinanceName;
                                    //final_status="Manager "+value.ReportStatus;
                                    final_status="Manager Approved";
                                    //var	converted_date1 = convert_date_amol_tooltip(value.ReportSubmittedDate);
                                    //approved_date = convert_date_amol(value.ManagerActionDate);
                                    approved_date=convert_date_amol(value.Modified);
                                    approvedby=value.Approver1Name;
					   
                                }
					  
                            }
					
                            else if (value.ReportStatus =="Rejected" || value.ReportStatus=="Approver 2 Rejected" || value.ReportStatus=="Approver 1 Rejected" || value.ReportStatus=="Manager Rejected")			
                            {
					
                                if(value.FinanceExpenseStatus=="Rejected")
                                {
                                    Pending_With=value.FinanceName;
                                    final_status="Finance "+value.ReportStatus;
                                    //rejected_date=value.FinanaceActionDate;
                                    rejected_date=convert_date_amol(value.Modified);
					  
                                }
                                else if(value.ReportStatus=="Approver 2 Rejected")
                                {
                                    Pending_With=value.PendingWithName;
                                    final_status="Approver2 Reject";
                                    //approved_date=value.FinanaceActionDate;
                                    //approved_date = convert_date_amol(value.FinanaceActionDate);
                                    approved_date=value.Modified;
                                    rejected_date=convert_date_amol(value.Modified);
                                }
                                else if(value.ReportStatus=="Approver 1 Rejected")
                                {
                                    Pending_With=value.PendingWithName;
                                    final_status="Approver1 Reject";
                                    //approved_date=value.FinanaceActionDate;
                                    // approved_date = convert_date_amol(value.FinanaceActionDate);
                                    approved_date=value.FinanaceActionDate;
                                    rejected_date=convert_date_amol(value.Modified);
                                }
					
                                else
                                {
					
                                    Pending_With=value.PendingWithName;
                                    //final_status="Manager "+value.ReportStatus;
                                    final_status="Manager Reject";
                                    //var	converted_date1 = convert_date_amol_tooltip(value.ReportSubmittedDate);
                                    //approved_date = convert_date_amol(value.ManagerActionDate);
                                    approved_date=value.FinanaceActionDate;
                                    rejected_date=convert_date_amol(value.Modified);
                                }

                            }
                            else if(value.ReportStatus=="Reimbursed")
                            {
                                Pending_With="NA";
                                final_status=value.ReportStatus;

                            }
                           

                          

                            curreuncyvalue = "";
                            advance = "-";


                            if (value.AmountTaken != null) {
                                advance = value.AmountTaken;
                                if (advance.toString().indexOf(".")) 
                                {
								
							
                                }
                                else {
								
                                    advance = advance + ".00";
								   
                                   

                                }
                              
                            }
                            var  reim_advance = "-";


                            if (value.BalanceAmount != null && value.BalanceAmount != '') 
                            {
                                reim_advance = value.BalanceAmount;
                                if (reim_advance.toString().indexOf(".")) 
                                {
								
							
                                }
                                else {
								
                                    //reim_advance = reim_advance + ".00";
                                    reim_advance="";
                                    //advance=value.AmountTaken

                                }
                                //alert(value.AmountTaken);
                                // alert(advance);

                            }

                            curreuncyvalue = value.currencytext;

                            if (curreuncyvalue == null) 
                            {
                                curreuncyvalue = "";

                            }
                            else {

                                Expenseitem = curreuncyvalue;


                                if (Expenseitem.indexOf("-")) {
                                    curr = Expenseitem.split("-");
                                    curreuncyvalue = curr[0];
                                }
                                else {
                                }

                            }
                            var  curreuncyvalue_reimberssed = value.ReimburseCurrencyText;
                            var curreuncyvalue_reimberssed_currency;
                            if (curreuncyvalue_reimberssed == null) {
                                curreuncyvalue_reimberssed = "-";

                            }
                            else {

                                curreuncyvalue_reimberssed_currency = curreuncyvalue_reimberssed;


                                if (curreuncyvalue_reimberssed_currency.indexOf("-")) {
                                    curr = curreuncyvalue_reimberssed_currency.split("-");
                                    curreuncyvalue_reimberssed = curr[0];
                                }
                                else {
                                }

                            }
                            var ReimburseComment="-";
                            if(value.ReimburseComment!=null && value.ReimburseComment!='')
                            {
							
                                ReimburseComment=value.ReimburseComment;
                            }
                            expenceid = value.ExpenseTrackingNo;
                            comment = value.Comment;
							
                            action_data="<a data-toggle='tooltip1' data-placement='top' title='Edit' style='display:inline-block; margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\",\"0\"); showmodal1(\"update\"); ';><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='top' title='Delete' style='display:inline-block; cursor:pointer;' onclick='showConfirmation(" + value.ID + ",\"" + rowhide + "\",\"Are you sure you want to Delete the record?\")'><i class='fa fa-trash'></i></a>";


							var ERAmount_Currency="";
							ERAmount_Currency="<div style='text-align:right;'>"+exp_amount +"<span style='color: #ababab;margin-left: 6px;'>"+ value.ExpenseCurrencyText +"</span></div>";

							
							if (type == 'FirstTimeLoad')
                            {
							
								if(value.Created!=""&&value.Created!=null)
                                {
                                    ReportCreatedDate = value.Created;
                                    converted_date = convert_date_amol_tooltip(ReportCreatedDate);
                                    tooltip_date = convert_date_amol(ReportCreatedDate);
                                }
                                else
                                {
                                    converted_date = "";
                                    tooltip_date = "";
							
                                }

							
							
                            table_body=table_body+"<tr>";
							 table_body=table_body+'<td><input type="checkbox" onchange="onchildcheck()" name="'+value.ID+'" title1="'+value.ReportStatus+'" title="'+value.ExpenseTrackingNo+'" /></td>';
                            table_body=table_body+"<td>"+expenceid+"</td>";
							 table_body=table_body+"<td>"+value.EmployeeName+"</td>";
							 table_body=table_body+"<td><a href='javascript:void(0)'  onclick='opendetails("+value.ID+")'>"+value.ExpenseReportName+"</a></td>";
							  
                            //table_body=table_body+"<td><a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;color: #337ab7;'>" + value.ExpenseReportName + "</a></td>";
                            table_body=table_body+"<td>"+Project_Name+"</td>";
							
                           table_body=table_body+"<td>"+ERAmount_Currency+"</td>";
						    table_body=table_body+"<td><a style='text-decoration:none; cursor:default;' data-toggle='tooltip' data-placement='top' title='" + converted_date + "'>" + tooltip_date + "</a></td>";	
                            table_body=table_body+"<td>"+Pending_With+"</td>";
							table_body=table_body+"<td>"+final_status+"</td>";
                            table_body=table_body+"</tr>"
							}
							else if(type == 'Open')
							{
							 if(value.Created!=""&&value.Created!=null)
                                {
                                    ReportCreatedDate = value.Created;
                                    converted_date = convert_date_amol_tooltip(ReportCreatedDate);
                                    tooltip_date = convert_date_amol(ReportCreatedDate);
                                }
                                else
                                {
                                    converted_date = "";
                                    tooltip_date = "";
							
                                }
                                var count_check=1; //GetExpenseDetailByTrackingid(url,value.ID);
                                //alert(count_check);
                                if(count_check>0)
                                {
                                    //action_data=action_data+"<a>ss</a>";
                                    //alert(count);
                                    action_data=action_data+"<a data-toggle='tooltip' data-placement='top' title='Submit' style='display:inline-block; cursor:pointer; margin-left: 12px;'  href='" + redirect_tolink + value.ID + "' ><i class='fa fa-send'></i></a>";
                                }
                                else
                                {
                                    action_data=action_data+"<a data-toggle='tooltip' data-placement='top' title='Submit' style='display:inline-block; cursor:pointer; margin-left: 12px; color: #a6a6a6;' ><i class='fa fa-send'></i></a>";
                                    //alert(count);
                                }
							
								
							table_body=table_body+"<tr>";
							table_body=table_body+'<td><input type="checkbox" onchange="onchildcheck()" name="'+value.ID+'" title1="'+value.ReportStatus+'" title="'+value.ExpenseTrackingNo+'" /></td>';
                            
                            //table_body=table_body+"<td>"+action_data+"</td>";
							table_body=table_body+"<td>"+expenceid+"</td>";
							table_body=table_body+"<td>"+value.EmployeeName+"</td>";
							 table_body=table_body+"<td><a href='javascript:void(0)' onclick='opendetails("+value.ID+")'>"+value.ExpenseReportName+"</a></td>";
							  
                           // table_body=table_body+"<td><a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;color: #337ab7;'>" + value.ExpenseReportName + "</a></td>";
                            table_body=table_body+"<td>"+Project_Name+"</td>";
							//table_body=table_body+"<td>"+exp_amount+"</td>";
                            
                            table_body=table_body+"<td>"+ERAmount_Currency+"</td>";
							//table_body=table_body+"<td><a  id='"+datetooltip+"' style='text-decoration:none; cursor:default' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")'>" + tooltip_date + "</a></td>";
							table_body=table_body+"<td><a style='text-decoration:none; cursor:default;' data-toggle='tooltip' data-placement='top' title='" + converted_date + "'>" + tooltip_date + "</a></td>";
                            table_body=table_body+"</tr>"

							
							}
							else if(type=='Submitted')
							{
							if(value.ReportSubmittedDate!=""&&value.ReportSubmittedDate!=null)
                                {
                                    ReportCreatedDate = value.ReportSubmittedDate;
                                    converted_date = convert_date_amol_tooltip(ReportCreatedDate);
                                    tooltip_date = convert_date_amol(ReportCreatedDate);
                                }
                                else
                                {
                                    converted_date = "";
                                    tooltip_date = "";
							
                                }
                                var submit_achor="";
								
                                if(resubmit_count<3)
                                {
					
                                    // submit_achor="<a data-toggle='tooltip' data-placement='top' title='Recall' style='display:inline-block; cursor:pointer;margin-right: 12px; margin-left: 12px;'  onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\",\""+refine_status+"\"); showmodal1(\"update\");'><i class='fa fa-repeat'></i></a>";
                                    submit_achor="<a data-toggle='tooltip' data-placement='top' title='Edit' style='display:inline-block; cursor:pointer;margin-right: 12px; margin-left: 12px;'  onclick='Confirm_RecallExpense(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\",\""+type+"\"); '><i class='fa fa-repeat'></i></a>";
                                }
                                else
                                {
                                    submit_achor="<a data-toggle='tooltip' data-placement='top' title='Edit' style='display:inline-block; cursor:pointer;margin-right: 12px; margin-left: 12px;'  onclick='showRecallCount()'><i class='fa fa-repeat'></i></a>";
                                }
								
							table_body=table_body+"<tr>";
                            //table_body=table_body+"<td>"+submit_achor+"</td>";
							table_body=table_body+'<td><input type="checkbox" onchange="onchildcheck()" name="'+value.ID+'" title1="'+value.ReportStatus+'" title="'+value.ExpenseTrackingNo+'" /></td>';
                            
							table_body=table_body+"<td>"+expenceid+"</td>";
							table_body=table_body+"<td>"+value.EmployeeName+"</td>";
							 table_body=table_body+"<td><a href='javascript:void(0)' onclick='opendetails("+value.ID+")'>"+value.ExpenseReportName+"</a></td>";
							  
                           // table_body=table_body+"<td><a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;color: #337ab7;'>" + value.ExpenseReportName + "</a></td>";
                            table_body=table_body+"<td>"+Project_Name+"</td>";
							table_body=table_body+"<td>"+ERAmount_Currency+"</td>";
                            
                           // table_body=table_body+"<td>"+value.ExpenseCurrencyText+"</td>";
							//table_body=table_body+"<td><a  id='"+datetooltip+"' style='text-decoration:none; cursor:default' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")'>" + tooltip_date + "</a></td>";
							table_body=table_body+"<td><a style='text-decoration:none; cursor:default;' data-toggle='tooltip' data-placement='top' title='"+converted_date+"'>"+tooltip_date+"</a> </td>";
							table_body=table_body+"<td>"+value.Approver1Name+"</td>";
							
							if(value.Approver2Name!=""&&value.Approver2Name!=null&&value.Approver2Name!="Na")
                                {
                                    table_body=table_body+"<td>"+value.Approver1Name+"</td>";
                                }
                                else
                                {
                                    table_body=table_body+"<td>NA</td>";
                                }
							
							table_body=table_body+"<td>"+value.FinanceName+"</td>";
							
                            table_body=table_body+"</tr>"

							
							}
							else if(type=='Approved')
							{
							
							if(value.Modified!=""&&value.Modified!=null)
                                {
                                    ReportCreatedDate = value.Modified;
                                    converted_date = convert_date_amol_tooltip(ReportCreatedDate);
                                    tooltip_date = convert_date_amol(ReportCreatedDate);
                                }
                                else
                                {
                                    converted_date = "";
                                    tooltip_date = "";
							
                                }
								
								
							table_body=table_body+"<tr>";
                            //table_body=table_body+"<td><a onclick='genratePdf(" + value.ID + ")'><i class='fa fa-file-pdf-o' aria-hidden='true' style='width: 100%; text-align: center; display: inline-block;cursor:pointer;'></i></a></td>";
							table_body=table_body+'<td><input type="checkbox" onchange="onchildcheck()" name="'+value.ID+'" title1="'+value.ReportStatus+'" title="'+value.ExpenseTrackingNo+'" /></td>';
                            
							table_body=table_body+"<td>"+expenceid+"</td>";
							table_body=table_body+"<td>"+value.EmployeeName+"</td>";
							 table_body=table_body+"<td><a href='javascript:void(0)' onclick='opendetails("+value.ID+")'>"+value.ExpenseReportName+"</a></td>";
							  
                            //table_body=table_body+"<td><a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;color: #337ab7;'>" + value.ExpenseReportName + "</a></td>";
							table_body=table_body+"<td>"+Project_Name+"</td>";
							var  tooltip_date1 = convert_date_amol(value.ReportSubmittedDate);
							var tooltip_date2 = convert_date_amol_tooltip(value.ReportSubmittedDate);
                            table_body=table_body+"<td><a style='text-decoration:none; cursor:default;' data-toggle='tooltip' data-placement='top' title='" + tooltip_date2 + "'>"+tooltip_date1+"</a></td>";
							table_body=table_body+"<td>"+final_status+"</td>";
                            
                            table_body=table_body+"<td>"+approvedby+"</td>";
							//table_body=table_body+"<td><a id='"+datetooltip+"' style='text-decoration:none;' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")'>" + tooltip_date + "</a></td>";
							table_body=table_body+"<td><a style='text-decoration:none; cursor:default;' data-toggle='tooltip' data-placement='top' title='" + converted_date + "'>" + tooltip_date + "</a></td>";
							table_body=table_body+"<td>"+Pending_With+"</td>";
							
							
                            table_body=table_body+"<td>"+ERAmount_Currency+"</td>";
                               
                           // table_body=table_body+"<td>"+value.ExpenseCurrencyText+"</td>";
                                
							
							table_body=table_body+"<td><a  onclick='GetAllExpenseLog(\"" + value.ID + "\",\"" + value.ExpenseTrackingNo + "\")' class='comment-icon' style='cursor:pointer;'><i class='fa fa-info-circle' aria-hidden='true'></i></a></td>";
							
                            table_body=table_body+"</tr>"
							
							
							}
							else if(type=='Rejected')
							{
							
							  if(value.Modified!=""&&value.Modified!=null)
                        {
                            ReportCreatedDate = value.Modified;
                            converted_date = convert_date_amol_tooltip(ReportCreatedDate);
                            tooltip_date = convert_date_amol(ReportCreatedDate);
                        }
                        else
                        {
                            converted_date = "";
                            tooltip_date = "";
							
                        }
                        var commnet_tooptip="Reject"+expenceid;
                        var submit_achor="";
                        // var submit_achor="<a data-toggle='tooltip' data-placement='top' title='Recall' style='display:inline-block; cursor:pointer;margin-right: 12px; margin-left: 12px;'  href='" + redirect_tolink + value.ID + "'  ><i class='fa fa-repeat'></i></a>";
                        // var submit_achor="<a data-toggle='tooltip' data-placement='top' title='Recall' style='display:inline-block; cursor:pointer;margin-right: 12px; margin-left: 12px;'  onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\",\""+refine_status+"\"); showmodal1(\"update\");'  ><i class='fa fa-repeat'></i></a>";
                        if(resubmit_count<3)
                        {
                            // submit_achor="<a data-toggle='tooltip' data-placement='top' title='Recall' style='display:inline-block; cursor:pointer;margin-right: 12px; margin-left: 12px;'  onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\",\""+refine_status+"\"); showmodal1(\"update\");'><i class='fa fa-repeat'></i></a>";
						   
                            submit_achor="<a data-toggle='tooltip' data-placement='top' title='Edit' style='display:inline-block; cursor:pointer;margin-right: 12px; margin-left: 12px;'  onclick='Confirm_RecallExpense(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\",\""+type+"\"); '><i class='fa fa-repeat'></i></a>";
                        }
                        else
                        {
                            submit_achor="<a data-toggle='tooltip' data-placement='top' title='Edit' style='display:inline-block; cursor:pointer;margin-right: 12px; margin-left: 12px;'  onclick='showRecallCount()'><i class='fa fa-repeat'></i></a>";
                        }
						
						
							
							table_body=table_body+"<tr>";
                           // table_body=table_body+"<td>"+submit_achor+"</td>";
						   table_body=table_body+'<td><input type="checkbox" onchange="onchildcheck()" name="'+value.ID+'" title1="'+value.ReportStatus+'" title="'+value.ExpenseTrackingNo+'" /></td>';
                            
							table_body=table_body+"<td>"+expenceid+"</td>";
							table_body=table_body+"<td>"+value.EmployeeName+"</td>";
							 table_body=table_body+"<td><a href='javascript:void(0)' onclick='opendetails("+value.ID+")'>"+value.ExpenseReportName+"</a></td>";
							  
							//table_body=table_body+"<td><a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;color: #337ab7;'>" + value.ExpenseReportName + "</a></td>";
                            table_body=table_body+"<td>"+Project_Name+"</td>";
                            table_body=table_body+"<td>"+ERAmount_Currency+"</td>";
							//table_body=table_body+"<td>"+value.ExpenseCurrencyText+"</td>";
                            
                            table_body=table_body+"<td>"+final_status+"</td>";
							table_body=table_body+"<td>"+Pending_With+"</td>";
							//table_body=table_body+"<td><a  id='"+datetooltip+"' style='text-decoration:none; cursor:default' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")'>" + tooltip_date + "</a></td>";
							table_body=table_body+"<td><a style='text-decoration:none; cursor:default;' data-toggle='tooltip' data-placement='top' title='" + converted_date + "'>" + tooltip_date + "</a></td>";
							
							
                           // table_body=table_body+"<td><div style=' white-space: nowrap;overflow: hidden;width: 90px; display: inline-block;text-overflow: ellipsis'><a style='color:black;cursor:default;text-decoration: none;' id='"+commnet_tooptip+"' onmouseover='bigImg(\"" + comment + "\",\"" + commnet_tooptip + "\")' >"+comment+"</a><div></td>";
                               
                            table_body=table_body+"<td><a data-toggle='tooltip' data-placement='top' title='" + comment + "' style='display:inline-block; text-decoration:none;  cursor:default;margin-right: 12px; margin-left: 12px;' >"+comment+"</a></td>";
                                
							
							table_body=table_body+"<td><a href='javascript:void(0)' style='cursor:pointer;' onclick='GetAllExpenseLog(\"" + value.ID + "\",\"" + value.ExpenseTrackingNo + "\")' class='comment-icon'><i class='fa fa-info-circle' aria-hidden='true'></i></a></td>";
							
                            table_body=table_body+"</tr>"
							
							}
							else if(type=='Reimbursed')
							{
							
							if(value.ReimbursedDate!=""&&value.ReimbursedDate!=null)
                        {
                            ReportCreatedDate = value.Modified;
                            converted_date = convert_date_amol_tooltip(ReportCreatedDate);
                            tooltip_date = convert_date_amol(ReportCreatedDate);
                        }
                        else
                        {
                            converted_date = "";
                            tooltip_date = "";
							
                        }
							
                        var commnet_tooptip="ReimburseComment"+expenceid;
						
						
						
							table_body=table_body+"<tr>";
							table_body=table_body+'<td><input type="checkbox" onchange="onchildcheck()" name="'+value.ID+'" title1="'+value.ReportStatus+'" title="'+value.ExpenseTrackingNo+'" /></td>';
                            
                            table_body=table_body+"<td>"+expenceid+"</td>";
							table_body=table_body+"<td>"+value.EmployeeName+"</td>";
							 table_body=table_body+"<td><a href='javascript:void(0)' onclick='opendetails("+value.ID+")'>"+value.ExpenseReportName+"</a></td>";
							  
							//table_body=table_body+"<td><a href='" + redirect_tolink + value.ID + "' style='text-decoration:underline;color: #337ab7;'>" + value.ExpenseReportName + "</a></td>";
                            table_body=table_body+"<td>"+Project_Name+"</td>";
                            table_body=table_body+"<td>"+ERAmount_Currency+"</a></td>";
							//table_body=table_body+"<td>"+value.ExpenseCurrencyText+"</td>";
                            
                            table_body=table_body+"<td>"+value.FinanceName+"</td>";
							
							//table_body=table_body+"<td><a  id='"+datetooltip+"' style='text-decoration:none; cursor:default' onmouseover='bigImg(\"" + converted_date + "\",\"" + datetooltip + "\")'>" + tooltip_date + "</a></td>";
							table_body=table_body+"<td><a style='text-decoration:none; cursor:default;' data-toggle='tooltip' data-placement='top' title='" + converted_date + "'>" + tooltip_date + "</a></td>";
							
							
                           // table_body=table_body+"<td><div style='text-align:right;'>"+ reim_advance + " <span style='color: #ababab;margin-left: 6px;'>" + curreuncyvalue_reimberssed + " </span></div></td>";
                               
                           // table_body=table_body+"<td><div style=' white-space: nowrap;overflow: hidden;width: 90px; display: inline-block;text-overflow: ellipsis'><a style='color:black;cursor:default;text-decoration: none;' id='"+commnet_tooptip+"' onmouseover='bigImg(\"" + ReimburseComment + "\",\"" + commnet_tooptip + "\")' >"+ReimburseComment+"</a><div></td>";
                                
							
                            table_body=table_body+"</tr>"
						
							
							}


                        });
                    }
                    
                    else {
                        //table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a                         href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";

                    }
                    table_body=table_body+"/<tbody>";
					if (type == 'FirstTimeLoad')
                            {

                    document.getElementById("OpenExpenceCount").innerHTML = openstatus_count;
                    document.getElementById("SubmittedExpenceCount").innerHTML = submittedstatus_count;
                    
                    document.getElementById("RejectedExpenceCount").innerHTML = rejectedstatus_count;
                    document.getElementById("ApprovedExpenceCount").innerHTML = approvedstatus_count;
                    document.getElementById("ReimburesedExpenceCount").innerHTML = reimburesedstatus_count;
                    document.getElementById("AllRecordCount").innerHTML = allrecord_count;
					}
                    //alert(approvedstatus_count);

                    table_element=table_header+table_body;

                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
				//alert(table_element);
				
                    $('#ExpenceDataTable').html(table_element);
					// $('#ExpenceDataTable').DataTable();
					bind_dataTable();
					loadBSTooltips();
                    $('.loader').hide();

                   
					  
                }



               

            });
        }





        


        var pathname = window.location.pathname; // Returns path only
        var current_url = window.location.href;  //Return full url

        current_url = current_url.substring(0, current_url.lastIndexOf('/') - 9); // current url changes to specific path.

        // getDataByListName(current_url, 'BconeExpenceMaster', 'load1');  //getting data by ListName on page load
        //getCurrencyListData(current_url, 'BconeCurrency');


        //load_datatable_js();
        // getDataByStatus('Open', '');
        //  getDataByStatus('Submitted', '');
        // getDataByStatus('Rejected', '');
        //getDataByStatus('Approved', '');
        // getDataByStatus('Reimbursed', '');

        function clear_tbody() {
            //alert('clear tbody called');
            $("#student_data").html("");
            //$("#student_datatable > thead").html("");
            $("#student_datatable tbody tr").remove();
            // alert('after clear');
        }

        function refine_status1(status_name, id) {


            $('.pull-right').find('a').each(function () {

                $(this).removeClass('green-btn').addClass('blue-btn');


            })

            var a = $('#' + id).hasClass('blue-btn');


            a ? $('#' + id).removeClass('blue-btn').addClass('green-btn') : $('#' + id).removeClass('blue-btn').addClass('green-btn');

            $('#' + id).css('color', '#fff');


            $('.loader').show();


            //setTimeout(function(){
            destroyjs();
            //},2000);






            setTimeout(function () {

                getDataByListName1(current_url, 'BconeExpenceMaster', 'refine');
                update_refine(status_name);

            }, 2000);

            //setTimeout(function () {
            // alert('called');
            // $('#student_datatable').DataTable();

            //}, 1000);

            // $('#student_datatable').DataTable();

            //if (update_refine()) {
            //alert('return from update refine');
            // load_datatable_js();
            // }


            setTimeout(function () {
                //load_datatable_js();
                $('.loader').hide();
                load_datatable_js();
            }, 5000)


            // $('.loader').show();

        }


        function refine_status_old(inputVal, id) {
            //alert(inputVal);
            //var table = $('#student_datatable');
            var table = $('#student_datatable').DataTable();

            // #column3_search is a <input type="text"> element
            if (inputVal != '') {
                table
                    .columns(4)
                    .search("^" + inputVal + "$", true, false, true)
                    .draw();
            }
            else {
                table
                .columns(4)
                .search(inputVal)
                .draw();
            }

            $('.pull-right').find('a').each(function () {

                $(this).removeClass('green-btn').addClass('blue-btn');


            })

            var a = $('#' + id).hasClass('blue-btn');


            a ? $('#' + id).removeClass('blue-btn').addClass('green-btn') : $('#' + id).removeClass('blue-btn').addClass('green-btn');

            $('#' + id).css('color', '#fff');



        }

        function refine_status(inputVal, id) {
            ////alert("method"+inputVal);
            //$('.loader').show();
 
            $('.loader').show();
            $('.pull-right').find('a').each(function () {
                $(this).removeClass('green-btn').addClass('blue-btn');
            });

            var a = $('#' + id).hasClass('blue-btn');


            a ? $('#' + id).removeClass('blue-btn').addClass('green-btn') : $('#' + id).removeClass('blue-btn').addClass('green-btn');

            $('#' + id).css('color', '#fff');

            var   EmployeeId =$('#resourse_id').text();


           // cleardata();
            if (inputVal != '') {
			 
                ////alert("refine_status"+inputVal);
                document.getElementById('navigation_span').innerHTML=id;
			
                //$('.loader').hide();
                //getDataByListName_Refine(current_url, 'BconeExpenceMaster', inputVal);
				var   EmployeeId =$('#resourse_id').text();
				getDataByListName(current_url, 'BconeExpenceMaster',inputVal,EmployeeId);
				
            }
            else {
                ////alert("refine_status"+inputVal);
                ////alert("refine_status"+inputVal);
                document.getElementById('navigation_span').innerHTML="All Record";
                //$('.loader').hide();
                getDataByListName(current_url, 'BconeExpenceMaster', 'load1',EmployeeId);

            }
        }

        function update_refine(status_name) {
            var status = '';
            //alert(status_name);
            //alert(('#student_data').html());

            if (status_name.toString().toLowerCase() != 'allrecord') {

                $('#student_data > tr').each(function (key, value) {

                    //alert('main ids: '+this.id);

                    status = $(this).closest('tr').find('td:eq(4)').text().toLowerCase();
                    //alert(status);

                    if (status_name.toLowerCase() == status) {

                        //alert(status_name);
                        //$(this).css('display', 'block');
                        // $(this).addClass('displayblock');
                        // $(this).show();
                        // alert(this.id);

                    }
                    else {
                        //alert('not loaded');
                        $(this).remove();
                    }









                });
            }
            else {
                //alert('aaal');
            }

            return true;


        }


        function getListItemById(url, listname, id, i, type,recall_status) {
            showmodal1("update");
            $("#Confirmation_alert").hide();
            var temp="https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/ExpenseItemDetailTest.aspx?TrackingNo="+id;
		
            $('#edit_id').text(id);
            $('#tr_editid').text(i);
            var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/ExpenseItemDetailTest.aspx?TrackingNo=";

            var table_tr_edit = "";

            $('.loader').show();
            var rowhide = "rowhideslow" + i + "";
            var Project_Name = "Project Name";
            var Pending_With = "Pending With";
            var Reimbursed_Total_Money = "Reimbursed_Total_Money";
            var Balance = "Balance";
            var fromdate = "";
            var ReportCreatedDate = "";
            var converted_date = "";
            var resubmit_count="0";
            var MyEmpName="";
            var loginid="";
			
            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/items(" + id + ")",
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                success: function (data) {
                    $.each(data, function (key, value) {
						ReportCreatedDate = value.Modified;
                        converted_date = convert_date(ReportCreatedDate);
                        resubmit_count=value.ReSubmitCount;
                        loginid=value.EmployeeId;
                        MyEmpName=value.EmployeeName;
						$('#edit_ExpenseTrackingNo').text(value.ExpenseTrackingNo);
						
						
                            if(recall_status=='Submitted')
                            {
						
                                if(resubmit_count<3)
                                {
                                    var my_count=resubmit_count+1;
                                    $('#btn_update').attr('onclick','updateListItem("BconeExpenceMaster","https://bristleconeonline.sharepoint.com/sites/pwa/","recall",\'' + my_count + '\',\''+MyEmpName+'\',\''+loginid+'\',\''+recall_status+'\')');
                                    $('#Item_log_detail').attr('onclick','updateListItem("BconeExpenceMaster","https://bristleconeonline.sharepoint.com/sites/pwa/","recallupdate",\'' + my_count + '\',\''+MyEmpName+'\',\''+loginid+'\',\''+recall_status+'\')');
                                }
                                else
                                {
                                    $('#btn_update').attr('onclick','showRecallCount()');
                                    $('#Item_log_detail').attr('onclick','showRecallCount()');
								
							
                                }
                            }
                            else if(recall_status=='Rejected')
                            {
                                if(resubmit_count<3)
                                {
                                    var my_count=resubmit_count+1;
                                    $('#btn_update').attr('onclick','updateListItem("BconeExpenceMaster","https://bristleconeonline.sharepoint.com/sites/pwa/","recall",\'' + my_count + '\',\''+MyEmpName+'\',\''+loginid+'\',\''+recall_status+'\')');
                                    $('#Item_log_detail').attr('onclick','updateListItem("BconeExpenceMaster","https://bristleconeonline.sharepoint.com/sites/pwa/","recallupdate",\'' + my_count + '\',\''+MyEmpName+'\',\''+loginid+'\',\''+recall_status+'\')');
                                }
                                else
                                {
                                    $('#btn_update').attr('onclick','showRecallCount()');
                                    $('#Item_log_detail').attr('onclick','showRecallCount()');
								
							
                                }
						
                            }
                            else{
                                $('#btn_update').attr('onclick','updateListItem("BconeExpenceMaster","https://bristleconeonline.sharepoint.com/sites/pwa/","norecall",\'' + resubmit_count + '\',\''+MyEmpName+'\',\''+loginid+'\',\''+recall_status+'\')');
                                $('#Item_log_detail').attr('onclick','updateListItem("BconeExpenceMaster","https://bristleconeonline.sharepoint.com/sites/pwa/","norecall_redirection",\'' + resubmit_count + '\',\''+MyEmpName+'\',\''+loginid+'\',\''+recall_status+'\')');
								
                            }
                            $('#add_tr').hide();
                            $('#update_tr').show();


                            var element = document.getElementById('currency');
                            element.value = value.CurrencyId;
							
                            var element = document.getElementById('ddlExpensecurrency');
                            element.value = value.ExpenseCurrencyId;
                            $('#ddlExpensecurrency').attr("disabled", true);



                            var ddlProjects = document.getElementById('ddlProjects');
                                ddlProjects.value = value.ProjectId;
								$('#ddlProjects').prop('disabled', true);
							
                            $("input[name=advance1]").prop('disabled', true);
                            $('#Txtexpensereport').val(value.ExpenseReportName);
                            $('#TxtDescription').val(value.Description);
                            $('#TxtDate').val(converted_date);
							$('#txtProManager').val(value.Approver1Name);
                            if (value.AmountTaken > 0) {

                                //var curreuncyvalue = getcurrencyValueById(current_url, 'BconeCurrency', value.CurrencyId);
                                hideerror1('currency');
                                advance = value.AmountTaken;
                                if (advance.toString().indexOf(".")) {
                                }
                                else {
                                    advance = advance + ".00";

                                }
                                $('#Txtamttaken').val(advance);

                                $("input[name=advance][value=Yes]").prop('checked', 'checked');

                                $("#Txtamttaken").attr("readonly", false);

                                $('#currency_validation_star').show();
                                $('#amount_validation_star').show();

                            }
                            else {
                                $("input[name=advance][value=No]").prop('checked', 'checked');
                                $("#Txtamttaken").attr("readonly", true);
                                $("select#currency").prop('selectedIndex', 0);

                                $('#currency').attr("disabled", true);


                            }



                        $('.loader').hide();




                    });
                    
                },
                error: function (data) {
                    
                }

            });
        }
		
		
        function convert_date_amol(date_to_convert){
            var arr_dateandtime = date_to_convert.split('T');
            var arr_dateonly = arr_dateandtime[0].split('-');
            var arr_timeonly = arr_dateandtime[1].split(':');
            var Month;
            var converted_date;
            switch ( parseInt(arr_dateonly[1])-1) {
                case 0:
                    Month = "Jan";
                    break;
                case 1:
                    Month = "Feb";
                    break;
                case 2:
                    Month = "Mar";
                    break;
                case 3:
                    Month = "Apr";
                    break;
                case 4:
                    Month = "May";
                    break;
                case 5:
                    Month = "Jun";
                    break;
                case 6:
                    Month = "Jul";
									
                case 7:
                    Month = "Aug";
                    break;
                case 8:
                    Month = "Sep";
                    break;
                case 9:
                    Month = "Oct";
                    break;
                case 10:
                    Month = "Nov";
                    break;
                case 11:
                    Month = "Dec";
                    break;
								
									
            }
				
            converted_date=arr_dateonly[2]+"-"+Month+"-"+arr_dateonly[0];
            return converted_date;
            //alert(converted_date);
				
			
		
        }
		
        function convert_date_amol_tooltip(date_to_convert){
            var arr_dateandtime = date_to_convert.split('T');
            var arr_dateonly = arr_dateandtime[0].split('-');
            var arr_timeonly = arr_dateandtime[1].split(':');
            var Month;
            var converted_date;
            var suffix;
            switch ( parseInt(arr_dateonly[1])-1) {
                case 0:
                    Month = "Jan";
                    break;
                case 1:
                    Month = "Feb";
                    break;
                case 2:
                    Month = "Mar";
                    break;
                case 3:
                    Month = "Apr";
                    break;
                case 4:
                    Month = "May";
                    break;
                case 5:
                    Month = "Jun";
                    break;
                case 6:
                    Month = "Jul";
									
                case 7:
                    Month = "Aug";
                    break;
                case 8:
                    Month = "Sep";
                    break;
                case 9:
                    Month = "Oct";
                    break;
                case 10:
                    Month = "Nov";
                    break;
                case 11:
                    Month = "Dec";
                    break;
								
									
            }
				
				
            var curr_hours = arr_timeonly[0];


            suffix = (curr_hours >= 12) ? 'PM' : 'AM';

            if (curr_hours > 12) {
                curr_hours -= 12;
            }

            //alert(suffix);

            var curr_min = arr_timeonly[1];

            if (curr_min < 10) {
                //curr_min = "0" + curr_min;
                curr_min =  curr_min;
            }


            var curr_seconds = arr_timeonly[2];
				
            converted_date=arr_dateonly[2]+"-"+Month+"-"+arr_dateonly[0]+" " + curr_hours + ":" + curr_min + " " + suffix;
            return converted_date;
            //alert(converted_date);
				
		
        }
function convert_date_test(date_to_convert){
		 var arr_dateandtime = date_to_convert.split('T');
		var arr_dateonly = arr_dateandtime[0].split('-');
		var arr_timeonly = arr_dateandtime[1].split(':');
		var Month;
		 var converted_date;
		switch ( parseInt(arr_dateonly[1])-1) {
									case 0:
									Month = "Jan";
									break;
									case 1:
									Month = "Feb";
									break;
									case 2:
									Month = "Mar";
									break;
									case 3:
									Month = "Apr";
									break;
									case 4:
									Month = "May";
									break;
									case 5:
									Month = "Jun";
									break;
									case 6:
									Month = "Jul";									
									case 7:
									Month = "Aug";
									break;
									case 8:
									Month = "Sep";
									break;
									case 9:
									Month = "Oct";
									break;
									case 10:
									Month = "Nov";
									break;
									case 11:
									Month = "Dec";
									break;
				}
				converted_date=arr_dateonly[2]+"-"+Month+"-"+arr_dateonly[0];
				return converted_date;
		}
        function convert_date(date_to_convert) {


            //2016-10-06T11:32:46


            var arr_date = date_to_convert.split('T');
            var updated_date = arr_date[0] + " " + arr_date[1];

            var m_names = new Array("Jan", "Feb", "Mar",
                        "Apr", "May", "Jun", "Jul", "Aug", "Sep",
                        "Oct", "Nov", "Dec");

            //var d = new Date(date_to_convert).toISOString();
            var d = new Date(updated_date);
            //var d =  Date.parse(date_to_convert);
            // d = date_to_convert;
            var curr_date = d.getDate();
            var curr_month = d.getMonth();
            var curr_year = d.getFullYear();
            var suffix = "";


            //hours minute and seconds add here



            var curr_hours = d.getHours();


            suffix = (curr_hours >= 12) ? 'PM' : 'AM';

            if (curr_hours > 12) {
                curr_hours -= 12;
            }

            //alert(suffix);

            var curr_min = d.getMinutes();

            if (curr_min < 10) {
                curr_min = "0" + curr_min;
            }


            var curr_seconds = d.getSeconds();

            var converted_date = curr_date + "-" + m_names[curr_month] + "-" + curr_year + " " + curr_hours + ":" + curr_min + " " + suffix;

            return converted_date;

        }

        function convert_date1(date_to_convert) {
            //alert(convert_date1);

            var arr_date = date_to_convert.split('T');
            var updated_date = arr_date[0] + " " + arr_date[1];


            var m_names = new Array("Jan", "Feb", "Mar",
                        "Apr", "May", "Jun", "Jul", "Aug", "Sep",
                        "Oct", "Nov", "Dec");

            // var d = new Date(date_to_convert).toISOString();
            //  var d = new Date("2016-06-10 02:03:05");

            var d = new Date(updated_date);

            //d = date_to_convert;
            // var d = Date.parse(date_to_convert);

            var curr_date = d.getDate();
            var curr_month = d.getMonth();
            var curr_year = d.getFullYear();

            //hours minute and seconds add here

            // var curr_hours = d.getHours();
            // var curr_min = d.getMinutes();
            // var curr_seconds = d.getSeconds();

            var converted_date = curr_date + "-" + m_names[curr_month] + "-" + curr_year;

            return converted_date;

        }


        function getDataByStatus(ReportStatus, refine) {

            //$('#student_datatable').DataTable();

            //alert(ReportStatus);

            var query_cml = '<View><Query><Where><Eq><FieldRef Name="ReportStatus" /><Value Type="Text">' + ReportStatus + '</Value></Eq></Where></Query></View>';

            //alert(query_cml);

            $.ajax({
                url: _spPageContextInfo.webAbsoluteUrl + "/_api/Web/Lists/getbytitle('BconeExpenceMaster')/GetItems",
                type: "POST",
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),
                success: function (data) {
                    console.log(data);
                    //alert(data.d.results.length);
                    //if (ReportStatus == "Open") {
                    //    document.getElementById("OpenExpenceCount").innerHTML = data.d.results.length;
                    //}
                    //else if (ReportStatus == "Submitted") {
                    //    document.getElementById("SubmittedExpenceCount").innerHTML = data.d.results.length;
                    //}
                    //else if (ReportStatus == "Rejected") {
                    //    document.getElementById("RejectedExpenceCount").innerHTML = data.d.results.length;
                    //}
                    //else if (ReportStatus == "Approved") {
                    //    document.getElementById("ApprovedExpenceCount").innerHTML = data.d.results.length;
                    //}
                    //else if (ReportStatus == "Reimbursed") {
                    //    document.getElementById("ReimburesedExpenceCount").innerHTML = data.d.results.length;
                    //}

                    if (refine != "") {
                        $('.loader').show();
                        ////alert("loader");


                        $("#student_data").find("tr").remove();
                        var table_tr = "";

                        var table_tr_edit = "";
                        //alert(data.d.results.length);
                        if (data.d.results.length > 0) {

                            document.getElementById("totalrecord").value = data.d.results.length;
                            if (document.getElementById("totalrecord").value > 0) {
                                //$("#deletediv").show();
                            }

                            var list_name = "BconeExpenceMaster";
                            var i = "0";
                            var url1 = current_url;
                            var rowhide = "";





                            $.each(data.d.results, function (key, value) {


                                var fromdate = new Date(value.ReportCreatedDate);

                                // alert('fromdate:' + fromdate);
                                var dd = fromdate.getDate();
                                //	alert('dd: '+ dd);
                                var mm = fromdate.getMonth() + 1; //January is 0!
                                //alert('mm: '+ mm);
                                var yyyy = fromdate.getFullYear();
                                //	alert('yyyy: '+ yyyy);

                                var updated_date = (fromdate.getMonth() + 1) + '-' + fromdate.getDate() + '-' + fromdate.getFullYear();

                                rowhide = "rowhideslow" + i + "";

                                tr_edit = "row_edit" + i + "";

                                //alert(value.Currency_x003a_ID);

                                var curreuncyvalue = "INR";

                                //var curreuncyvalue = getcurrencyValueById('https://e2eprojects.sharepoint.com/sites/pwa/', 'BconeCurrency',                                 value.CurrencyId);
                                //alert(curreuncyvalue);

                                //alert(ss);
                                var expenceid = value.ID;

                                table_tr = table_tr + "<tr id=" + rowhide + " class='deleteall" + value.ID + "' value=" + value.ID + ">";

                                table_tr = table_tr + "<td><input type='checkbox' id='record" + i + "' name='record" + i + "'  value=" + value.ID + "  /></td>";

                                // alert(value.attchment);
                                table_tr = table_tr + "<td>" + value.ID + "</td>";

                                table_tr = table_tr + " <td><a href='javascript:void(0)' style='text-decoration:underline;'>" + value.ExpenseReportName + "</a></td>";
                                table_tr = table_tr + "<td>" + value.Description + "</td>";
                                table_tr = table_tr + "<td>" + curreuncyvalue + "</td>";
                                table_tr = table_tr + "<td>" + value.AmountTaken + "</td>";
                                table_tr = table_tr + "<td>" + updated_date + "</td>";
                                table_tr = table_tr + " <td>" + value.ReportStatus + "</td>";
                                table_tr = table_tr + " <td><a href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\",\"update\")';><i class='fa fa-pencil'></i></a></td>";
                                table_tr = table_tr + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa fa-                                trash'></i></a></td>";



                                table_tr = table_tr + "</tr>";


                                //amol coding




                                table_tr_edit = table_tr_edit + "<tr id=" + tr_edit + " class='deleteall" + value.ID + "' value=" + value.ID + "                                 style='display:'block';' >";

                                table_tr_edit = table_tr_edit + "<td><input type='checkbox' id='record" + i + "' name='record" + i + "'  value=" + value.ID + "  /></td>";

                                // alert(value.attchment);
                                table_tr_edit = table_tr_edit + "<td>" + value.ID + "</td>";

                                table_tr_edit = table_tr_edit + " <td><input type='text' id='ExpenseReportName" + i + "' value=" + value.ExpenseReportName + "/></td>";
                                table_tr_edit = table_tr_edit + "<td><input type='text' id='Description" + i + "' value=" + value.Description + " /></td>";
                                table_tr_edit = table_tr_edit + "<td><select id='curreuncyvalue" + i + "'></select></td>";
                                table_tr_edit = table_tr_edit + "<td><input type='text' id='AmountTaken" + i + "' value=" + value.AmountTaken + " /></td>";
                                table_tr_edit = table_tr_edit + "<td><input type='text' id='ReportCreatedDate" + i + "' value=" + value.ReportCreatedDate + " /></td>";
                                table_tr_edit = table_tr_edit + " <td>" + value.ReportStatus + "</td>";
                                table_tr_edit = table_tr_edit + " <td><a href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "\",\"" + list_name + "\",\"" + value.ID + "\",\"" + i + "\");  '><i class='fa fa-pencil'></i></a></td>";
                                table_tr_edit = table_tr_edit + " <td><a onclick='deleteexpense(" + value.ID + ",\"" + rowhide + "\")'><i class='fa                                 fa-trash'></i></a></td>";



                                table_tr_edit = table_tr_edit + "</tr>";

                                i++;


                            });
                        }
                        else {
                            //alert(data.d.results.length);

                            table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a                             href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";

                        }
                        //alert(table_tr);
                        //$('#student_data').append(table_tr);

                        //  $('#student_data').append(table_tr_edit);

                        $('.loader').hide();


                        //alert(table_tr);


                        console.log(data.d);


                        $('.loader').hide();
                    }


                },
                error: function (error) {
                    alert(JSON.stringify(error));
                }
            });

        }

        function setCurrencySelectedValUpdate(element_id, currency_id) {
            var element = document.getElementById(element_id);
            alert('element_id : ' + element_id);

            alert('currency_id : ' + currency_id);

            element.value = currency_id;
        }

        function setCalendorToControl(control_id) {
            //alert(control_id);

            $('#' + control_id).datepicker({ dateFormat: 'mm-dd-yy' });

        }


        function updateListItem(listName, siteUrl,type1,ReSubmitCount,MyEmpName,loginid,recall_status) {

            //alert(listName);
            // alert(siteUrl);




            if (check_validation()) {


                $('.loader').show();
                ////alert("updateListItem: "+ Id_edit);

                //var Id_edit= document.getElementById('hiddenid').value;
                var Id_edit = $('#edit_id').text();

                var tr_editid = $('#tr_editid').text();

                //var Id_edit = edit_id;

                ////alert("updateListItem: "+ Id_edit);


                var itemType = getListprotocol(listName);

                //alert(itemType);

                var curency_name = "";
                var expensereport = document.getElementById("Txtexpensereport").value;

                //var attchment=cc;
                // alert(expensereport);

                var Description = document.getElementById("TxtDescription").value;
                //alert(Description);
                var amount = document.getElementById("Txtamttaken").value;

                var ss = $('#currency :selected').text();
                var currencyval = $('#currency :selected').val();
                var ddlExpensecurrency = $('#ddlExpensecurrency :selected').val();
                var item = "";

                var ProjectId = $('#ddlProjects :selected').val();
                var Projectname = $('#ddlProjects :selected').text();

                var ProjectOwner  =    $('#ddlProjectsmanager :selected').text();
                ProjectOwner=ProjectOwner.split('|');
                ProjectOwnerName=ProjectOwner[0];
                //var ProjectOwnerId=   $('#ddlProjects :selected').val();
                var ProjectOwnerId=   ProjectOwner[1];



                var ddladvancetaken = ($('input[name=advance]:checked', '#advance').val());
                var Project_source = ($('input[name=advance1]:checked', '#advance1').val());
				
                var resourse_id =''
					 
                var PendingWithId='';
                var PendingWithName='';

                resourse_id=$('#resourse_id').text();
                var ReportingManagerGuid=$('#ReportingManagerGuid').text();
                var ReportingManagerName=$('#ReportingManagerName').text();
                var NotesID="";
				
                if(ReSubmitCount=="1"){
                    NotesID="08";
                }
                else if(ReSubmitCount=="2"){NotesID="09";}
                else if(ReSubmitCount=="3"){NotesID="10";}
					 
               
                   


                if(resourse_id==ProjectOwner[2])
                {
                    //alert('RM');
                    ProjectOwnerName=ReportingManagerName;
                    
                    ProjectOwnerId=   ReportingManagerGuid;
							
                    // PendingWithId=ProjectOwnerId;
                    // PendingWithName=ProjectOwnerName;
                }
                else if(ProjectOwner[1]==resourse_id)
                {
                    //if Pm selected his own projects.
				
						
                    ProjectOwnerName=ProjectOwner[3];
                    
                    ProjectOwnerId=   ProjectOwner[2];
							
                    //PendingWithId=ProjectOwnerId;
                    //PendingWithName=ProjectOwnerName;
                }	
						
                else if(ProjectOwner[0]==resourse_id)
                {
                    ProjectOwnerName=ProjectOwner[0];
                    
                    ProjectOwnerId=   ProjectOwner[1];
							
                    // PendingWithId=ProjectOwnerId;
                    // PendingWithName=ProjectOwnerName;
                }
                else
                {
						
                    ProjectOwnerName=ProjectOwner[0];
                    
                    ProjectOwnerId=   ProjectOwner[1];
							
                    //PendingWithId=ReportingManagerGuid;
                    //PendingWithName=ReportingManagerName;
						
                }


                //alert(ddladvancetaken);
		
		

                if (ddladvancetaken == 'No') {
                    //set currency default value
                    currencyval = null;
                    amount = null;
                    curency_name = null;

                    item = {
                        "__metadata": { "type": itemType },
                        "Title": expensereport,
                        "ExpenseReportName": expensereport,
                        "Description": Description,
                        "AmountTaken": amount,
                        "CurrencyId": currencyval,
                        "currencytext": curency_name,
                        "ProjectSource":Project_source

                    };
                }
                else {

                    curency_name = $('#currency :selected').text();

                    item = {
                        "__metadata": { "type": itemType },
                        "Title": expensereport,
                        "ExpenseReportName": expensereport,
                        "Description": Description,
                        "AmountTaken": amount,
                        "CurrencyId": currencyval,
                        "currencytext": curency_name,
                        "ProjectSource":Project_source
                    };

                }
		
                if(type1=='recall' || type1=='recallupdate')
                {
                    $.extend(item, { ReportStatus: 'Open' });
			
                    $.extend(item, { ReSubmitCount: ReSubmitCount });
			
                }

                getListItemForUpdate(siteUrl, listName, Id_edit, function (data) {

                    ////alert("vvv");


                    $.ajax({
                        url: data.d.__metadata.uri,
                        type: "POST",
                        contentType: "application/json;odata=verbose",
                        data: JSON.stringify(item),
                        headers: {
                            "Accept": "application/json;odata=verbose",
                            "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                            "X-HTTP-Method": "MERGE",
                            "If-Match": data.d.__metadata.etag
                        },
                        success: function (data) {
				
				
                            var redirection="https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/ExpenseItemDetailTest.aspx?TrackingNo="+Id_edit+"";
							
							
                            if(type1=='recall' || type1=='norecall' || type1=='recallupdate' || type1=='norecall_redirection'  )
                            {
							
							
                                InsertIntoLog(siteUrl, "BconeExpenseLogHistory",Id_edit,NotesID,MyEmpName,loginid,recall_status);
								
                            }
							
							
                            if(type1=='recallupdate' || type1=='norecall_redirection' )
                            {
							
                                window.location=redirection;
                            }
                            else
                            {
							var edit_ExpenseTrackingNo=$('#edit_ExpenseTrackingNo').text();
							 add_success_exp_msg(edit_ExpenseTrackingNo+' Updated Successfully!', 'save');
                               // add_success_exp_msg('ER No '+Id_edit+' | Updated Successfully..', 'save');
							
                            }
				
                            ////alert("true");



                            //  //alert("Data upadted sucessfully");

                           // destroyjs();
							
							

                           

                            //getDataByListName(current_url, 'BconeExpenceMaster', 'load1');

                           // cleardata();

                           // var   EmployeeId =$('#resourse_id').text();

                            //getDataByListName(current_url, 'BconeExpenceMaster', 'load1',EmployeeId);
                            refine_status('Open','Open');


                            //alert_message_overhang('Expense updated successfully.');

                            //window.frameElement.COMMENT_NODE;

                            //pass this para dynamically..

                            // $('#rowhideslow' + tr_editid).html('');



                            // getListItemById(current_url, 'BconeExpenceMaster', Id_edit, tr_editid, 'updated');

                            //$('#myModal').hide();
                            // $('.modal-backdrop.in').hide();
                            // $("#student_data").find("tr").remove();

                            // hidemodal();

                            //load_datatable_js();






                            // setTimeout(function () { }, 1000);

                            // $('.loader').hide();






                            // success(data);
                        },
                        error: function (data) {
                            alert(data.responseJSON.error.message.value);
                            ////alert("false");
                            // failure(data);
                            $('.loader').hide();
                        }
                    });


                }, function (data) {
                    failure(data);
                });
            }
            else {
                //  alert('validation not complete');
            }
        }

        function getListItemForUpdate(url, listname, Id, complete) {

            // alert(Id);
            // //alert("getlistitembyid");

            $.ajax({

                url: url + "/_api/web/lists/GetByTitle('" + listname + "')/items('" + Id + "')",
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                success: function (data) {

                    complete(data);
                    ////alert("getListItembyid1");
                },
                error: function (data) {
                    //  //alert("false");   
                }
            });
        }
        function getListprotocol(name) {
            //alert(name);

            return "SP.Data." + name.charAt(0).toUpperCase() + name.split(" ").join("").slice(1) + "ListItem";
        }


        function check_validation() {
            var isValid = true;
            var expensereport = document.getElementById("Txtexpensereport").value;
            var Description = document.getElementById("TxtDescription").value;
            var amount = document.getElementById("Txtamttaken").value;
            var ProjectId = $('#ddlProjects :selected').val();
            var txtProManager = document.getElementById("txtProManager").value;
			

            // alert(ProjectId);

            var ss = $('#currency :selected').text();
            var currencyval = $('#currency :selected').val();


            var ddladvancetaken = ($('input[name=advance]:checked', '#advance').val());
			var ddlExpensecurrency = $('#ddlExpensecurrency :selected').text();



            if (ProjectId == '0') {
                isValid = false;
                $('#ddlProjects').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });




                document.getElementById("AlertMsg").innerHTML = "Please select the Project";
                document.getElementById("ddlProjects").focus();

                return isValid;

            }
			
			if (ddlExpensecurrency == 'Select') {
                isValid = false;
                $('#ddlExpensecurrency').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });




                document.getElementById("AlertMsg").innerHTML = "Please select the Expense Currency";
                document.getElementById("ddlExpensecurrency").focus();

                return isValid;

            }
			
			
            if (txtProManager == '') {
                isValid = false;
                $('#txtProManager').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });




                document.getElementById("AlertMsg").innerHTML = "Expense Approver is Missing. Please Contact Admin";
                document.getElementById("txtProManager").focus();

                return isValid;

            }

            if (expensereport == '') {
                isValid = false;
                $('#Txtexpensereport').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });




                document.getElementById("AlertMsg").innerHTML = "Please enter the Expence Report Name";
                document.getElementById("Txtexpensereport").focus();

                return isValid;

            }
			
            if(/^[a-zA-Z0-9- ]*$/.test(expensereport) == false)
            {
                isValid = false;
                var msg="You have entered an invalid following characters: .(period) \ / : ; | ? ' < > * # ~ % & { } +";
                $('#Txtexpensereport').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });
                document.getElementById("AlertMsg").innerHTML = msg;
                document.getElementById("Txtexpensereport").focus();
                return isValid;
            }
			
			

            if (expensereport.length > 256) {
                isValid = false;
                $('#Txtexpensereport').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });




                document.getElementById("AlertMsg").innerHTML = "Expence Report Name should be 256 character max";
                document.getElementById("Txtexpensereport").focus();

                return isValid;

            }

            if (Description.length > 500) {
                isValid = false;
                $('#TxtDescription').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });




                document.getElementById("AlertMsg").innerHTML = "Description can be max 500 character ";
                document.getElementById("TxtDescription").focus();

                return isValid;

            }
			
            if(/^[a-zA-Z0-9- ]*$/.test(Description) == false)
            {
                isValid = false;
                var msg="You have entered an invalid following characters: .(period) \ / : ; | ? ' < > * # ~ % & { } +";
                $('#TxtDescription').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });
                document.getElementById("AlertMsg").innerHTML = msg;
                document.getElementById("TxtDescription").focus();
                return isValid;
            }




            //alert(ddladvancetaken);

            if (ddladvancetaken != 'Yes' && ddladvancetaken != 'No') {
                //alert(ddladvancetaken);
                isValid = false;

                $('#advance').css({

                    "border": "1px solid red",
                    "background": "#FFCECE"
                });
                document.getElementById("AlertMsg").innerHTML = "Please select the Option";
                document.getElementById("advance").focus();

                return isValid;

            }



            if (ddladvancetaken == 'Yes') {


                if (currencyval == 'Select') {
                    isValid = false;
                    $('#currency').css({

                        "border": "1px solid red",
                        "background": "#FFCECE"
                    });
                    document.getElementById("AlertMsg").innerHTML = "Please select the Currency";
                    document.getElementById("currency").focus();

                    return isValid;
                }

                if (amount == '') {

                    ////alert("amount");
                    isValid = false;
                    $('#Txtamttaken').css({

                        "border": "1px solid red",
                        "background": "#FFCECE"
                    });
                    document.getElementById("AlertMsg").innerHTML = "Please enter the Amount";
                    document.getElementById("Txtamttaken").focus();
                    return isValid;
                }

                if (parseFloat(amount) != amount && parseInt(amount) != amount) {
                    isValid = false;

                    $('#Txtamttaken').css({
                        "border": "1px solid red",
                        "background": "#FFCECE"
                    });

                    document.getElementById("AlertMsg").innerHTML = "Please enter valid amount ";
                    document.getElementById("Txtamttaken").focus();
                    return isValid;
                }

            }










            return isValid;
        }



        function getcurrencyValueById(url, listname, id) {
            ////alert("id"+id);
            ////alert("getListItem1");
            ////alert("show();");
            //$('.loader').show();
            var ss;
            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/items(" + id + ")",
                async: false,
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },

                success: function (data) {




                    //alert(data.d);
                    $.each(data, function (key, value) {
                        ////alert("value"+value.Currency);
                        ss = value.Currency;
                        return ss;

                    });

                },
                error: function (data) {
                    //failure(data);
                    alert(data.responseJSON.error.message.value);
                }
            });
            return ss;
        }


        function getCurrencyDataUpdate(url, listname, i, currency_value) {
            ////alert("gfhkltnyklhmdtykhtkh");
            ////alert("getListItem1");
            ////alert("show();");
            //$('.loader').show();

            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/items",
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                success: function (data) {




                    // $.each(data.d.results, function (key, value) {

                    var class1 = "";
                    // alert(value.ID);
                    // alert(value.Currency);
                    // $("#curreuncyvalue" + i).append($("<option></option>").val(value.ID).html(value.Currency));

                    //});

                    // setCurrencySelectedValUpdate('curreuncyvalue' + i, currency_value);

                    //setCurrencySelectedValUpdate('currency', currency_value);

                    // setCalendorToControl('ReportCreatedDate' + i);


                    //loginuser();



                },
                error: function (data) {
                    // failure(data);
                }
            });
        }
        function noattchment() {

            //alert("Attachement not found!!!!");

        }

        function getListItemForDelete(url, listname, Id, complete) {
            //alert(Id);


            $.ajax({

                url: url + "/_api/web/lists/GetByTitle('" + listname + "')/items('" + Id + "')",
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                success: function (data) {



                    complete(data);
                    ////alert("getListItembyid1");
                },
                error: function (data) {
                    //  //alert("false");  
                    ////alert("hide();");
                    //$('.loader').hide();
                }
            });
        }
		
		
        function showConfirmation(id,hide_id,Confirmation_msg){
            $('#Confirmation_alert').show();
            $('#delete_expense_id').text(id);
            $('#Confirmation_msg').text(Confirmation_msg);
		
        }
		
        function confirmation_close(){
            $('#Confirmation_alert').hide();
        }
		
		


        function deleteexpense() {
            ////alert("deleteexpense");
            //alert(i);
            //var r = confirm("Are you sure to Delete the record?");
            //var r = confirm("Are you sure you want to Delete the record?");
            var r =true;
            var id=$('#delete_expense_id').text();
			
            if (r == true) {

                // $('.loader').show();

                var listname = "BconeExpenceMaster";
                //alert(listname);
                var requestUri = _spPageContextInfo.siteAbsoluteUrl;
                // alert(requestUri);

                //destroyjs();

                getListItemForDelete(requestUri, listname, id, function (data) {

                    //alert('getListItem1 function Returning');

                    $.ajax({
                        url: data.d.__metadata.uri,
                        type: "POST",
                        headers: {
                            "Accept": "application/json;odata=verbose",
                            "X-Http-Method": "DELETE",
                            "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                            "If-Match": data.d.__metadata.etag
                        },
                        success: function (data) {
                            // $('.loader').hide();

                            // $('#' + i).fadeOut();
                            //alert('delete success');
                            //  $("#student_data").find("tr").remove();

                            // hidemodal();

                            //getDataByListName(current_url, 'BconeExpenceMaster');

                           // var offset = $("#jqxgrid").offset();

                           // $('#jqxgrid').jqxGrid('deleterow', id);
						   
						refine_status('Open','Open');

                        },
                        error: function (data) {


                        },
                        complete: function (data) {
						
                            $('#Confirmation_alert').hide();
							
							$('#OpenExpenceCount').text(($('#OpenExpenceCount').text())-1);
							$('#AllRecordCount').text(($('#AllRecordCount').text())-1);

                            //getDataByListName(current_url, 'BconeExpenceMaster');

                        }
                    });
                });




                //setTimeout(function () {
                //load_datatable_js();
                //}, 1000);


                //$('#' + i).fadeOut();
                // $('#' + i).remove();


                //}
                //else {

                //}



            }
        }





        function loginuser() {
            var loginid = "";
            var userid = _spPageContextInfo.userId;


            var requestUri = _spPageContextInfo.siteAbsoluteUrl + "/_api/web/getuserbyid(" + userid + ")";
            var requestHeaders = { "accept": "application/json;odata=verbose" };
            $.ajax({
                async: false,
                url: requestUri,

                contentType: "application/json;odata=verbose",
                headers: requestHeaders,
                success: onSuccess,
                error: onError
            });

            function onSuccess(data, request) {
                var loginName = data.d.Id;
                loginid = data.d.Id;
                //alert(loginName);
            }

            function onError(error) {
                //alert("error");
            }
            return loginid;
        }


        function hideerror1(val) {
            //alert(val);

            //var ss = $('#val :selected').text();

            var Expenseitem = '';

            if (val == 'currency') {

                var e = document.getElementById(val);
                var ss = e.options[e.selectedIndex].value;

                // Expenseitem =ss;

                if (ss == "Select") {
                    $('#' + val).css({

                        "border": "1px solid red",
                        "background": "#FFCECE"
                    });

                    document.getElementById("AlertMsg").innerHTML = "Please select currency";
                    document.getElementById("currencyspan").innerHTML = "";

                    $("#Txtamttaken").attr("readonly", true);


                }
                else {

                    $("#Txtamttaken").attr("readonly", false);

                    //alert('false');
                    $('#' + val).css({

                        "border": "",
                        "background": ""
                    });

                    document.getElementById("AlertMsg").innerHTML = "";
                    //document.getElementById("currencyspan").innerHTML="";



                    Expenseitem = $('#' + val + ' :selected').text();




                    // alert(Expenseitem);
                    if (Expenseitem.indexOf("-")) {
                        var curr = Expenseitem.split("-");
                        //alert(curr[0]);
                        document.getElementById("currencyspan").innerHTML = curr[0];

                    }
                    else {
                        document.getElementById("currencyspan").innerHTML = Expenseitem;

                    }


                }



            }
            else if (val == 'ddlExpensecurrency') {

                var e = document.getElementById(val);
                var ss = e.options[e.selectedIndex].value;

                // Expenseitem =ss;

                if (ss == "Select") {
                    $('#' + val).css({

                        "border": "1px solid red",
                        "background": "#FFCECE"
                    });

                    document.getElementById("AlertMsg").innerHTML = "Please select the Expense currency";
                   


                }
                else {


                    $('#' + val).css({

                        "border": "",
                        "background": ""
                    });

                    document.getElementById("AlertMsg").innerHTML = "";
                   


                }



            }
            else if (val == 'ddladvancetaken') {

                ss = $('input[name=advance]:checked', '#advance').val();

                //alert(ss);

                if (ss == "Yes") {
				
                    ////alert("Yes");
                    // $('#Txtamttaken').css({

                    //   "border": "1px solid red",
                    // "background": "#FFCECE"
                    // });

                    $('#advance').css({

                        "border": "",
                        "background": ""
                    });

                    $('#currency').focus();
                    //$("#Txtamttaken").attr("readonly", false);

                    $('#currency_validation_star').show();
                    $('#amount_validation_star').show();

                    $('#currency').attr("disabled", false);

                    document.getElementById("AlertMsg").innerHTML = "";

                }
                else {
				
                    ////alert("no");
                    $('#Txtamttaken').css({

                        "border": "",
                        "background": ""
                    });

                    $('#advance').css({

                        "border": "",
                        "background": ""
                    });



                    $("#Txtamttaken").attr("readonly", true);
                    $("#Txtamttaken").val('');

                    $("select#currency").prop('selectedIndex', 0);

                    $('#currency').attr("disabled", true);

                    $('#currency_validation_star').hide();
                    $('#amount_validation_star').hide();

                    document.getElementById("AlertMsg").innerHTML = "";

                    document.getElementById("currencyspan").innerHTML = "";

                }

            }

        }

        function hideerror(val) {



            $('#' + val).css({

                "border": "",
                "background": ""
            });

            document.getElementById("AlertMsg").innerHTML = "";
            if(val=='ddlProjects')
            {
                setTimeout(function(){
                    setProjectManager(val);
                }, 4000);
            }
        }

        function amount_validation(selecetd_value) {


        }
		
        function InsertIntoLog(url, listname,TrackingNo,Action,ActorName,ActorID,type)
        {
 
            var Note=GetNoteById(Action);
            var TrackingNo_temp=TrackingNo.toString();
            var item = "";
            var item_collections = getListprotocol(listname);
	       
            item = {
                "__metadata": { "type": item_collections},
                "TrackingNo":TrackingNo_temp,
                "Notes":Note,
                "ActorName":ActorName,
                "ActorID":ActorID,
                "Action":type
            };
            
      
            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" +encodeURIComponent(listname)  + "')/items",
                type: "POST",
                async:false,
                contentType: "application/json;odata=verbose",
                data: JSON.stringify(item),
                headers: {
                    "Accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val()
                },
                success: function (data) {
                },
                complete: function () {
                },
                error: function (data) {
                    alert(data.responseJSON.error.message.value);
                }
            });
 
        }
		
		
        function addExpense(url, listname, expensereport, Description, currencyval, date, amount, curency_name, type, ProjectId,Projectname,ProjectOwnerId,ProjectOwnerName,EmployeeId,EmployeeName,ResourseId,PendingWithId,PendingWithName,EmpBaseLocation,Project_source,approver2_guid,approver2_name,ddlExpensecurrency,ddlExpensecurrencytext) 
        {
            // alert(PendingWithName);
            // $('.loader').show();
            //var EmpBaseLocation1=$('#EmpBaseLocation').text();

            //alert(listname);
            // var start = new Date();
            //alert(start);

            $('.loader').show();


            var item = "";
            var item_collections = getListprotocol(listname);
            var temmp="";
            //alert(item_collections);
            //var loginid=loginuser();

            if (currencyval != 'null') {

                item = {
                    "__metadata": { "type": item_collections },
                    "Title": expensereport,
                    "ExpenseReportName": expensereport,
                    "Description": Description,
                    "AmountTaken": amount,
                    "ReportStatus": 'Open',
                    "status": 'Active',
                    "CurrencyId": currencyval,
                    "ReportCreatedDate": date,
                    "currencytext": curency_name,
                    "ProjectId": ProjectId,
                    "Projectname":Projectname,
                    "ProjectOwnerId":ProjectOwnerId,
                    "ProjectOwnerName":ProjectOwnerName,
                    "EmployeeId":ResourseId,
                    "EmployeeName":EmployeeName,
                    "PendingWithId":PendingWithId,
                    "PendingWithName":PendingWithName,
                    "EmpBaseLocation":EmpBaseLocation,
                    "ProjectSource":Project_source,
                    "ReSubmitCount":0,
                    "Approver2":approver2_guid,
                    "Approver2Name":approver2_name,
                    "Approver1":PendingWithId,
                    "Approver1Name":PendingWithName,
                    "ExpenseApproveType":Approver_type,
                    "ExpenseCurrencyId":ddlExpensecurrency,
                    "ExpenseCurrencyText":ddlExpensecurrencytext

                };
            }
            else {
			
                item = {
                    "__metadata": { "type": item_collections },
                    "Title": expensereport,
                    "ExpenseReportName": expensereport,
                    "Description": Description,
                    "ReportStatus": 'Open',
                    "status": 'Active',
                    "ReportCreatedDate": date,
                    "ProjectId": ProjectId,
                    "Projectname":Projectname,
                    "ProjectOwnerId":ProjectOwnerId,
                    "ProjectOwnerName":ProjectOwnerName,
                    "EmployeeId":ResourseId,
                    "EmployeeName":EmployeeName,
                    "PendingWithId":PendingWithId,
                    "PendingWithName":PendingWithName,
                    "EmpBaseLocation":EmpBaseLocation,
                    "ProjectSource":Project_source,
                    "ReSubmitCount":0,
                    "Approver2":approver2_guid,
                    "Approver2Name":approver2_name,
                    "Approver1":PendingWithId,
                    "Approver1Name":PendingWithName,
                    "ExpenseApproveType":Approver_type,
                    "ExpenseCurrencyId":ddlExpensecurrency,
                    "ExpenseCurrencyText":ddlExpensecurrencytext
					
					
                };

            }




            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" +encodeURIComponent(listname)  + "')/items",

                type: "POST",
                contentType: "application/json;odata=verbose",
                // contenType: "application/x-www-form-urlencoded; charset=UTF-8",
                data: JSON.stringify(item),
                headers: {
                    "Accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val()
                },
                success: function (data) {
				
                    finalTo=PendingWithId;
                    finalCc=GUID;
				
                    //alert(data.d.ID);
                    temmp=data.d.ID;
						
                    updateTrackingNO('BconeExpenceMaster',url,temmp,ExpenseTrackingNo);
					
                    // console.log('updated');
					
                    InsertIntoLog(url, "BconeExpenseLogHistory",temmp,"01",EmployeeName,ResourseId,"Created");
                    // GetEmailData(data.d.ID,'01');
                    //add_success_exp_msg('Expense Created Successfully..', 'save');
                    var ExpenseTrackingNo="ExpenseTrackingNo";
					
					 
					
					

                    //console.log(data);
					
                    if (type == 'saveandcreate') {
					
					
					
					
                        var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/ExpenseItemDetailTest.aspx?TrackingNo=" + temmp + "&type=new";
                        //alert(redirect_tolink);
                        //$('#alert_ok_click').attr('onclick','RedirectTo_ExpenseDetails("'+redirect_tolink+'")');
                        window.location = redirect_tolink;
                    }
                    
                    else if(type=='save')
                    {
                       // add_success_exp_msg('ER No'+data.d.ID+' | added successfully.','save');
						
                    }

                    // //alert("Data added sucessfully");

                    // alert_message_overhang('Expense added successfully.');

                    //add_success_exp_msg('Expense added successfully.');
                    // console.log(data);
                    //  alert(data.d.results);



                    // clearAllInputs('myModal');

                    //here record count dynamically based on total record
                    // var record_count = 'new_record';




                    // destroyjs();

                    //  getDataByListName(current_url, 'BconeExpenceMaster');

                    // getListItemById(current_url, 'BconeExpenceMaster', data.d.ID, record_count, 'added');

                    //hidemodal();

                    //$('.loader').hide();

                    //$('#student_datatable').DataTable();


                    //  alert(data.d.attchment);

                    // var list_name = "BconeExpenceMaster";

                    //var url1 = "https://e2eprojects.sharepoint.com/sites/pwa/";

                    // document.getElementById("Txtexpensereport").value = "";


                    //document.getElementById("TxtDescription").value = "";
                    //
                    //document.getElementById("Txtamttaken").value = "";


                    //document.getElementById("TxtDate").value = "";
                    //document.getElementById("filename").innerHTML="";

                    //$("#currency")[0].selectedIndex = 0;

                    //var genderS = document.getElementsByName('gender');

                    // $("#student_data").find("tr").remove();




                    //getDataByListName(current_url, 'BconeExpenceMaster');


                    //$('.loader').hide();

                    //return true;


                },
                complete: function () {
				
					

                  //  cleardata();
                    var EmployeeId = $('#resourse_id').text();
                    $('.loader').hide();
					
					//add_success_exp_msg(ExpenseTrackingNo+' added successfully','save');
					
					
                    //getDataByListName(current_url, 'BconeExpenceMaster', 'load1', EmployeeId);
                  //  refine_status('Open','Open');
					$('#OpenExpenceCount').text(parseInt(($('#OpenExpenceCount').text()))+1);
					$('#AllRecordCount').text(parseInt(($('#AllRecordCount').text()))+1);
					

                },
                error: function (data) {
                    ////alert("error");
                    alert(data.responseJSON.error.message.value);
                    //return false;

                }
            });


        }


        function clearAllInputs(selector) {
            $('#' + selector).find(':input').each(function () {

                // alert(this.type);

                if (this.type == 'submit') {
                    //do nothing
                }
                else if (this.type == 'checkbox') {
                    this.checked = false;
                }
                else if (this.type == 'file') {
                    var control = $(this);
                    control.replaceWith(control = control.clone(true));
                }
                else if (this.type == 'select-one') {
                    var control = $(this);
                    this.selectedIndex = 0;
                }
                else if (this.type == 'radio') {
                    this.checked = false;
                }

                else {
                    $(this).val('');
                }
            });
        }



        function clearvalues() {
            //   //alert("dfghjft");
            document.getElementById("Txtexpensereport").value = "";


            document.getElementById("TxtDescription").value = "";

            document.getElementById("Txtamttaken").value = "";


            // document.getElementById("TxtDate").value = "";
            // document.getElementById("filename").innerHTML="";

            $("#currency")[0].selectedIndex = 0;



        }

        function hidepopup() {
            //alert();
            $('#myModal').modal('hide');
            $('.modal-backdrop.in').hide();



        }


        function tempfunction() {


            if (document.getElementById("all").checked) {
                ////alert("checked");
                var count = document.getElementById("totalrecord").value;
                //alert(count);
                for (var i = 0; i <= parseInt(count - 1) ; i++) {

                    //alert();
                    document.getElementById("record" + i.toString()).checked = true;
                    ////alert("record" + i.toString());
                    //  $("#record" + i.toString()).attr('checked', 'checked');


                }
            }
            else {
                ////alert("uncheck");
                var count = document.getElementById("totalrecord").value;
                for (var i = 0; i <= parseInt(count - 1) ; i++) {

                    //alert();
                    document.getElementById("record" + i.toString()).checked = false;
                    ////alert("record" + i.toString());
                    // $("#record" + i.toString()).removeAttr('checked', '');


                }
            }

        }

        function showmodal() {

            ////alert("showmodal");
            $('#myModal').modal('show');
            $('.modal-backdrop.in').show();

            // $("input[name=advance][value=No]").attr('checked', 'checked');

            $('#Txtexpensereport').focus();



        }

        function hidemodal() {
            ////alert("showmodal");
            $('#myModal').modal('hide');
            $('.modal-backdrop.in').hide();


        }
		
		function getCurrencyListData(url, listname) {
            ////alert("gfhkltnyklhmdtykhtkh");
            ////alert("getListItem1");
            ////alert("show();");
            //$('.loader').show();
			
			var query_cml='';
			
             query_cml = '<View><Query><Where><Eq><FieldRef Name="IsActive" /><Value Type="Boolean">1</Value></Eq></Where></Query></View>';
            // alert(query_cml);
            $.ajax({
                url: _spPageContextInfo.webAbsoluteUrl + "/_api/Web/Lists/getbytitle('"+listname+"')/GetItems",
                type: "POST",
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),
                success: function (data) {
				




                    $.each(data.d.results, function (key, value) {

                        var class1 = "";
                        // alert(value.ID);
                        // alert(value.Currency);
                        $("#currency").append($("<option></option>").val(value.ID).html(value.Currency));
                        $("#ddlExpensecurrency").append($("<option></option>").val(value.ID).html(value.Currency));

                    });
                    //loginuser();



                },
                error: function (data) {
                    failure(data);
                }
            });
        }

        function showmodal1(type) {
		
		var length = $('#ddlExpensecurrency > option').length;
				//alert(length);
				if(length=='1')
				{
				 getCurrencyListData(current_url, 'BconeCurrency');
				 getReportingManagerByGuid(GUID);
				 getProjectsByGUID(GUID);
				 }
				
				if(type=='add')
				{
				// $('.loader').show();
				
				
				setTimeout(function(){
			//	getProjectsByGUID(GUID);
				
				
				},100);
				
				// $('.loader').hide();
				}
		
            $('#project_type').text('');
            $('#ddlExpensecurrency').attr("disabled", false);
				
            $('#Role_assign').text('');
            if (type == 'update' || type == 'add') {
			
				


                $('#myModal').modal('show');
                $('.modal-backdrop.in').show();
                $('#update_tr').hide();
                $('#add_tr').show();

                //clearvalues();

                clearAllInputs('myModal');


                $('#myModal').find(':input').each(function (key, value) {


                    $(this).css('border', '');
                    $(this).css('background', '');

                    $(this).attr("readonly", false);
                    $(this).attr("disabled", false);



                });

                if (type == 'add') {
                    //$("#Txtamttaken").attr("readonly", true);
                    //$("#Txtamttaken").attr("readonly","readonly");
                    $("#Txtamttaken").attr("readonly", true);
                    $('#currency').attr("disabled", true);

                    $("input[name=advance1][value=AllocatedProjects]").prop('checked', 'checked');
                    //alert('readonly');
                }

                $('#currency_validation_star').hide();
                $('#amount_validation_star').hide();

                document.getElementById("AlertMsg").innerHTML = "";
                document.getElementById("currencyspan").innerHTML = "";
            }
            else {
                $('#myModal').modal('show');
                $('.modal-backdrop.in').show();
                $('#update_tr').hide();
                $('#add_tr').show();

                //clearvalues();

                //clearAllInputs('myModal');


                //$('#myModal').find(':input').each(function (key, value) {


                // $(this).css('border', '');
                // $(this).css('background', '');

                // $(this).attr("readonly", false);
                // $(this).attr("disabled", false);



                // });

                // $('#currency_validation_star').hide();
                //$('#amount_validation_star').hide();

                document.getElementById("AlertMsg").innerHTML = "";
                document.getElementById("currencyspan").innerHTML = "";
            }

            $("#txtProManager").attr("readonly", true);
        }


        function uploadFile() {
            $('.loader').show();
            if (document.getElementById("getFile").files.length === 0) {
                alert('No file was selected');
                return;
            }
            var parts = document.getElementById("getFile").value.split("\\");
            var filename = parts[parts.length - 1];
            var file = document.getElementById("getFile").files[0];
            //alert(filename);
            uploadFileSync("https://e2eprojects.sharepoint.com/sites/pwa/", "BconeBillLibrary", filename, file);
            return filename;

        }


        function uploadFileSync(spWebUrl, library, filename, file) {
            var reader = new FileReader();
            reader.onloadend = function (evt) {
                if (evt.target.readyState == FileReader.DONE) {
                    var buffer = evt.target.result;
                    var completeUrl = spWebUrl
                      + "/_api/web/lists/getByTitle('" + library + "')"
                      + "/RootFolder/Files/add(url='" + filename + "',overwrite='true')?"
                      + "@TargetLibrary='" + library + "'&@TargetFileName='" + filename + "'";

                    $.ajax({
                        url: completeUrl,
                        type: "POST",
                        data: buffer,
                        async: false,
                        processData: false,
                        headers: {
                            "accept": "application/json;odata=verbose",
                            "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                            "content-length": buffer.byteLength
                        },
                        complete: function (data) {
                            alert('succes');
                            //document.getElementById("filename").innerHTML=filename;
                            $('.loader').hide();
                            return filename;



                        },
                        error: function (err) {
                            alert('failed');
                            return filename;

                        }
                    });
                }
            };
            reader.readAsArrayBuffer(file);
        }


        function deletecheckrecord() {
            var count = document.getElementById("totalrecord").value;
            //alert(count);

            var my_count = 0;
            var r = confirm("Are you sure to Delete the record?");
            if (r == true) {


                for (var i = 0; i <= parseInt(count - 1) ; i++) {



                    if ($("#record" + i.toString()).prop("checked") == true) {
                        ////alert("true");
                        var checkboxes = true;
                        my_count++;

                    }
                    else {

                        ////alert("false");
                        var checkboxes = false;
                    }

                    if (checkboxes == true) {
                        var expenes_id = document.getElementById("record" + i.toString()).value;
                        $(".deleteall" + expenes_id).addClass("deletealloncomplete");


                        tp(expenes_id);

                    }

                    else {
                    }
                }
                ////alert("deletealloncomplete");
                $(".deletealloncomplete").fadeOut("slow");

                //$("#student_data").find("tr").remove();



                if (my_count == 0) {
                    //alert("Please check checkbox to delete.");
                }


                $('.loader').hide();

                return true;

            }
            else {
                return false;
                ////alert("return false");

            }


        }
        function tp(id) {
            //alert();
            var listname = "BconeExpenceMaster";
            //alert(listname);
            var requestUri = _spPageContextInfo.siteAbsoluteUrl;
            // alert(requestUri);
            getListItemForDelete(requestUri, listname, id, function (data) {

                //alert('getListItem1 function Returning');

                $.ajax({
                    url: data.d.__metadata.uri,
                    type: "POST",
                    headers: {
                        "Accept": "application/json;odata=verbose",
                        "X-Http-Method": "DELETE",
                        "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                        "If-Match": data.d.__metadata.etag
                    },
                    success: function (data) {
                        $('.loader').hide();
                        //  alert('delete success');

                        // 	$("#student_data").find("tr").remove();

                        //hidemodal();
                        //getDataByListName('https://e2eprojects.sharepoint.com/sites/pwa/','BconeExpenceMaster');


                        $('.loader').hide();

                        return true;
                    },
                    error: function (data) {
                        return false;


                    }
                });
            });
        }
        var GUID;
 
        function getQueryStringValue(key) {
            return unescape(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + escape(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));
        }
		
        var Type_query = getQueryStringValue("status");
        var default_open = getQueryStringValue("Default");
  
        function getResourcesGuid(NewloginName) {
            //alert('nilamcall');
            //alert(Type_query);
          
            jQuery.ajax({

                url: "/sites/pwa/_api/ProjectData/Resources?$filter=ResourceNTAccount eq('" + NewloginName + "')",
                type: "GET",
                async:false,
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
                    GUID = data.d.results[0].ResourceId;
                    Emp_ID=data.d.results[0].EmployeeID;
					//alert("fgdtrf");
                    FLoginname=data.d.results[0].ResourceName;
	                   FloginId=data.d.results[0].ResourceId;
                    $('#resourse_id').text(GUID);

                    $('.loader').hide();

                    if(Type_query!='')
                    {
                        ////alert("getDataByListName"+Type_query); 
                        //Refine_count_Update(current_url, 'BconeExpenceMaster', 'load1',GUID);
                        //getDataByListName(current_url, 'BconeExpenceMaster', 'load1',GUID);
                        //                        getDataByListName(current_url, 'BconeExpenceMaster', 'load1',GUID);
                        //refine_status(Type_query,Type_query);
                    }
                    else
                    {
                        //                    getDataByListName(current_url, 'BconeExpenceMaster', 'load1',GUID);
                        if(default_open!='')
                        {
                            showmodal1('add');
                        }
                    }

                }
            });

        }

        function GetUserId(userid) {
		//alert();
            var NewloginName = "";
            jQuery.ajax({
                url: "/sites/pwa/_api/Web/GetUserById(" + userid + ")",
                type: "GET",
				async:false,
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
                    var dataResults = data.d;
                    //console.log(dataResults);
                    //get login name  
                    //  console.log(data);
                    var loginName = dataResults.LoginName;
                    //console.log(loginName);
                    //alert('loginName: '+loginName);
                    $('#user_name').text(dataResults.Title);
                    $('#login_name_contain').text(dataResults.Title);
					
					
                    //get display name
                    // console.log(dataResults.Title);
                    NewloginName = encodeURIComponent(loginName); //encoding loginName from special charater to normal text
                    //alert('NewloginName: '+NewloginName);
                    getResourcesGuid(NewloginName);
                    // console.log(NewloginName);
                    //alert('NewloginName :' + NewloginName);

                },
                complete: function () {

                    // var result = getResourcesGuid(NewloginName);
                    // alert(result);
                },
            });
        }
		
		function getProjectsByGUID(ResGUID) {
		
		//console.log('loader started');
		 //$('.loader').show();
		//show_Loader();
		
            var ClientPartner_ID="";
            var ClientPartnerEmployeeId='CPId';
            var ClientPartnerEmployeeName='CPName';
            //var url = "https://ppmprod.bcone.com/api/BCONE/GetProjectName";
            var url = "https://ppmprod.bcone.com/api/BCONE/GetProjectNameDBDev";
            var count=0;
            var requestData = { "ResGUID": ResGUID,"EmployeeID":Emp_ID };
            //var requestData = { "ResGUID": ResGUID };
            $.ajax({
                url: url,
                data: requestData,
                async: false,
                type: "POST",
                dataType: "json",
                success: function (res) {
				
				//show_Loader();
                   // console.log(res);
                   // console.log (ResGUID);
                    $.each(res.SubOptions[0].Projectinfo, function (index, value) {
					
                        count++;
                       
						
                        // $('#ddlProjects').append("<option value = '" + value.ProjectId + "'>" + value.Projectname + "</option>");
						
                        //ClientPartnerEmployeeId=value.ClientPartnerEmployeeId;
                        //ClientPartnerEmployeeName=value.ClientPartnerEmployeeName;
						
                        //ClientPartnerEmployeeId=value.ProjectOwnerId+"test";
                        ClientPartnerEmployeeId="d8221044-ed7b-e611-80ce-00155d04851d";
                        //ClientPartnerEmployeeName=value.ProjectOwnerName+"test";
                        ClientPartnerEmployeeName="CPartner "+"Name";
						
                        //alert(value.ClientPartnerEmployeeId);
                        //alert(value.ClientPartnerEmployeeName);
						
                        if(value.ClientPartner=='NULL' || value.ClientPartner=='' || value.ClientPartner=='undefined')
                        {
                            getClintPartnerDetailsById('',value.ProjectId,value.Projectname,value.ProjectOwnerId,value.ProjectOwnerName);
                            //	alert('if block');
                            //$('#ddlProjectsmanager').append("<option value = '" + value.ProjectId + "'>" + value.ProjectOwnerName +"|"+ value.ProjectOwnerId+"|"+ClientPartnerEmployeeId+"|"+ClientPartnerEmployeeName+"</option>");
                        
						
                            //alert($( "#ddlProjectsmanager" ).html());
                        }
                        else
                        {
						
                            //alert('else block');
						
                            ClientPartner_ID='';
						
                            if(value.ClientPartner.indexOf('|'))
                            {
                                //alert('contain');
						
                                ClientPartner_ID=value.ClientPartner.split('|');
						
                                //alert(ClientPartner_ID[0]);
						
                                getClintPartnerDetailsById(ClientPartner_ID[0],value.ProjectId,value.Projectname,value.ProjectOwnerId,value.ProjectOwnerName);
						
                                //ClientPartner_ID
                            }
                            else
                            {
                                //alert('not contain');
                                ClientPartner_ID=value.ClientPartner;
                                getClintPartnerDetailsById(ClientPartner_ID,value.ProjectId,value.Projectname,value.ProjectOwnerId,value.ProjectOwnerName);
                            }
						
						
                            //alert($( "#ddlProjectsmanager" ).html());
						
                            //$('#ddlProjectsmanager').append("<option value = '" + value.ProjectId + "'>" + value.ProjectOwnerName +"|"+ value.ProjectOwnerId+"|"+value.ClientPartnerEmployeeId+"|"+value.ClientPartnerEmployeeName+"</option>");
                        }
						
                        //alert(count);
                        $('#ddlProjects').attr("disabled", false);
                    });
					 
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    ////alert("ResourcesFailed");
                },
				complete: function(data)
				{
				 $('.loader').hide();
				 console.log('loader stopped');
				},
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                }
            });

        }
		function show_Loader(){
		 //$('.loader').show();
		}

     
		
        function getClintPartnerDetailsById(ID,ProjectId,Projectname,ProjectOwnerId,ProjectOwnerName){
		
            //alert(ID);
			//console.log(ID);
			//show_Loader();
		
            var	ClientPartnerEmployeeId="d8221044-ed7b-e611-80ce-00155d04851d";
            var  ClientPartnerEmployeeName="ProjectManager PPM"+"";
		
		
            jQuery.ajax({

                url: "/sites/pwa/_api/ProjectData/Resources?$select=ResourceId,ResourceName&$filter=EmployeeID eq('" + ID + "')",
                type: "GET",
                async: false,
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
                    //alert(data.d.results.length);
                   // console.log(data);
				   
                    if(data.d.results!='')
                    {
				   
                        // alert(data.d.results.ResourceId);
					
                        $.each(data.d.results, function (index, value) {
                            // alert(value.ResourceId);
                            $('#ddlProjects').append("<option value = '" + ProjectId + "'>" + Projectname + "</option>");
                            $('#ddlProjectsmanager').append("<option value = '" + ProjectId + "'>" + ProjectOwnerName +"|"+ ProjectOwnerId+"|"+value.ResourceId+"|"+value.ResourceName+"</option>");
					
                        });
                    }
                    else
                    {
					
                        $('#ddlProjects').append("<option value = '" + ProjectId + "'>" + Projectname + "</option>");
                        $('#ddlProjectsmanager').append("<option value = '" + ProjectId + "'>" + ProjectOwnerName +"|"+ ProjectOwnerId+"|"+ClientPartnerEmployeeId+"|"+ClientPartnerEmployeeName+"</option>");
					
					
                    }
                }
            });	
		
		
        }
		
        function getResourcesEmpGuid(emp_Guid) {
            if(emp_Guid !="")
            {
                var Resourse_Emp_ID='';
          
                jQuery.ajax({

                    url: "/sites/pwa/_api/ProjectData/Resources?$filter=ResourceId eq(guid'" + emp_Guid + "')",
                    type: "GET",
                    async:false,
                    headers: { "Accept": "application/json;odata=verbose" },
                    success: function (data) {
                 
                        Resourse_Emp_ID=data.d.results[0].EmployeeID;
				
							 
                        //return GUID;

                    }
                });
            }
			
            return Resourse_Emp_ID;

        }


        function setProjectManager(dropdown) {
            //alert(dropdown);
            //alert(reporting_manager_name);
            var emp_Guid='';
            var Resourse_Emp_ID='';
            var IsManager=false;
            var IsCp=false;
            var IsVp=false;
            var resourse_id ='';
            var project_id='';

            project_id = $("#ddlProjects option:selected").val();
            resourse_id=$('#resourse_id').text();
            $('#txtProManager').val('');
            //$('#Txtexpensereport').focus();
            $('#Role_assign').text('');
            if(project_id=='0')
            {
                $('#project_type').text('');
			
			 
                return;
            }
			  
            var Delegation_Found=false;
            var Exceptional_Found=false;
			
			
			
            ExceptionalProjectApproverName=getExceptionalProjectsApprovarName(resourse_id,project_id);			
			
            getGuidByProjectID(resourse_id,project_id);
			
            //alert(emp_Guid);
			
            //Resourse_Emp_ID=getResourcesEmpGuid(exceptional_guid1);
          
            var Exceptional_Approval=0;
			
            var Delegation_Approval=0;
			
            Exceptional_Approval=GetExceptionalApproval(Emp_ID,project_id);
			
            var a1=	First_approver_EmpId;
            var a2=	Second_approver_EmpId;
			
            if(Exceptional_Approval>0)
            {
                document.getElementById("Role_assign").innerHTML="(Approver1 Exceptional)";
                if(a1!='')
                {
			
                    GetExceptionalDelegationApproval1(a1,project_id);
			
                }
			
                if(a2!='')
                {
                    GetExceptionalDelegationApproval2(a2,project_id);
                }
			
                //alert('First_approver_detail: '+ First_approver_detail);
                //alert('Second_approver_detail: '+ Second_approver_detail);
			
                Approver_type="3-Level";
                //alert(First_approver_detail);
                var detail=First_approver_detail.split(':');
                $('#txtProManager').val(detail[1]);
			
			
                //Delegation_Found=true;
                Exceptional_Found=true;
			
                $('#project_type').text('(Exceptional Projects)');
			
			
            }
            else
            {
                Resourse_Emp_ID=getResourcesEmpGuid(exceptional_guid1);
			
                Delegation_Approval=GetDelegationApproval(Resourse_Emp_ID,project_id);
			
            }
			
			
			
			
			
			
			
			
            if(Delegation_Approval>0)
            {
                //alert("3level");
                Approver_type="3-Level";
                //alert(First_approver_detail);
                var detail=First_approver_detail.split(':');
                $('#txtProManager').val(detail[1]);
                document.getElementById("Role_assign").innerHTML="(Approver1 Delegation)";
			
                $('#project_type').text('(Exceptional Projects)');
			
            }
            else if(!(Exceptional_Found))
            {
                $('#project_type').text('(Allocated Projects)');
                Approver_type="2-Level";
                // //alert("2level");
                var odata = ($('input[name=advance1]:checked', '#advance1').val());
                if(odata=="AllocatedProjects")
                {
                    ////alert("AllocatedProjects");
			
			
			
                    // element.value = valueToSelect;
                    if (project_id == 'undefined' || project_id=='0') 
                    {

                        // alert('executed this block');
                        //$("select#ddlProjects").prop('selectedIndex', 0);
                        $('#ddlProjects').prop('selectedIndex', 0);
                        $('#project_type').text('');
				
                        $('#Role_assign').text('');
                        $('#txtProManager').val('');
				


                    }
                    else {
                        document.getElementById('ddlProjectsmanager').value = project_id;
                        var projectManager = $("#ddlProjectsmanager option:selected").text();
                        projectManager=projectManager.split('|');
                        ////alert("Excep");
                        jQuery.ajax({
                            url: "/sites/pwa/_api/ProjectData/Projects?$filter=ProjectId eq (guid'"+project_id+"')",
                            type: "GET",
                            async:false,
                            headers: { "Accept": "application/json;odata=verbose" },
                            success: function (data) {
                                var dataResults = data.d;
                                ////alert("chexck");
                                console.log(data.d);
                                var BuildTeamResourceGUID=data.d.results[0].BuildTeamResourceGUID;
                                var ProjectOwnerId1=data.d.results[0].ProjectOwnerId;
                                var CPartner=data.d.results[0].ClientPartner;
                                if(CPartner!=null)
                                {
                                    CPartner=data.d.results[0].ClientPartner.split('|')[0];
					
                                }
                                if (ProjectOwnerId1==resourse_id)
                                {
                                    if(CPartner !=null)
                                    {
                                        document.getElementById("Role_assign").innerHTML="(Client Partner)";
                                        $('#txtProManager').val(projectManager[3]);
                                    }
                                   
					
                                }
                                else if(CPartner.trim()==Emp_ID)
                                {
						
                                    document.getElementById("Role_assign").innerHTML="(Reporting Manager)";
                                    $('#txtProManager').val(reporting_manager_name);
                                    
                                }
                                else if(BuildTeamResourceGUID != null)
                                {
                                    if (BuildTeamResourceGUID.indexOf(resourse_id) >= 0)
                                    {
                                        document.getElementById("Role_assign").innerHTML="(Project Manager)";
                                        $('#txtProManager').val(projectManager[0]);
                                       
                                    }
                                }
                                else{
                                    document.getElementById("Role_assign").innerHTML="(Reporting Manager)";
                                    $('#txtProManager').val(reporting_manager_name);
                                   
                                }
                          
                            },
                            complete: function () {
                            },
                        });

                    }
                }
                else
                {
                    document.getElementById('ddlProjectsmanager').value = project_id;
				
			


                    var projectManager = $("#ddlProjectsmanager option:selected").text();
                    projectManager=projectManager.split('|');

                    ////alert("Excep");
                    jQuery.ajax({
                        url: "/sites/pwa/_api/ProjectData/Projects?$filter=ProjectId eq (guid'"+project_id+"')",
                        type: "GET",
                        headers: { "Accept": "application/json;odata=verbose" },
                        success: function (data) {
                            var dataResults = data.d;
                            ////alert("chexck");
                            console.log(data.d);
                            var BuildTeamResourceGUID=data.d.results[0].BuildTeamResourceGUID;
                            var ProjectOwnerId1=data.d.results[0].ProjectOwnerId;
                            var CPartner=data.d.results[0].ClientPartner;
                            if(CPartner!=null)
                            {
                                CPartner=data.d.results[0].ClientPartner.split('|')[0];
					
                            }
                            if (ProjectOwnerId1==resourse_id)
                            {
                                if (CPartner != null) {
                                    document.getElementById("Role_assign").innerHTML="(Client Partner)";
                                    $('#txtProManager').val(projectManager[3]);
                                    exceptional_name=projectManager[3];
                                    exceptional_guid=projectManager[2];
                                }
					
                            }
                            else if(CPartner==Emp_ID)
                            {
						
                                document.getElementById("Role_assign").innerHTML="(Reporting Manager)";
                                $('#txtProManager').val(reporting_manager_name);
                                exceptional_name=ReportingManagerName;
                                exceptional_guid=reporting_manager_Id;
                            }
                            else if (BuildTeamResourceGUID.indexOf(resourse_id) >= 0)
                            {
                                //document.getElementById("Role_assign").innerHTML="(Project Manager)";
                                //$('#txtProManager').val(projectManager[0]);
                                //exceptional_name=projectManager[0];
                                //exceptional_guid=projectManager[1];
                                
                                if(ExceptionalProjectApproverName!='NA')
                                {
                                    if(ExceptionalProjectApproverName=='Project Manager')
                                    {
                                        document.getElementById("Role_assign").innerHTML="(Project Manager)";
                                        $('#txtProManager').val(projectManager[0]);
                                        exceptional_guid1=projectManager[1];
									
                                        PendingWithId=exceptional_guid1;
                                        PendingWithName=projectManager[0];
                                    }
                                    else if(ExceptionalProjectApproverName=='Reporting Manager')
                                    {
                                        document.getElementById("Role_assign").innerHTML="(Reporting Manager)";
                                        $('#txtProManager').val(reporting_manager_name);
                                        if(reporting_manager_Id !="")
                                        {
                                            exceptional_guid1=reporting_manager_Id;
									
                                            PendingWithId=exceptional_guid1;
                                            PendingWithName=reporting_manager_name;
                                        }
                                    }
						
                                }
                            }
                            else{
                                //document.getElementById("Role_assign").innerHTML="(Reporting Manager)";
                                //$('#txtProManager').val(reporting_manager_name);
                                //exceptional_name=reporting_manager_name;
                                //exceptional_guid=reporting_manager_Id;
                                
                                if(ExceptionalProjectApproverName!='NA')
                                {
                                    if(ExceptionalProjectApproverName=='Project Manager')
                                    {
                                        document.getElementById("Role_assign").innerHTML="(Project Manager)";
                                        $('#txtProManager').val(projectManager[0]);
                                        exceptional_guid1=projectManager[1];
									
                                        PendingWithId=exceptional_guid1;
                                        PendingWithName=projectManager[0];
                                    }
                                    else if(ExceptionalProjectApproverName=='Reporting Manager')
                                    {
                                        document.getElementById("Role_assign").innerHTML="(Reporting Manager)";
                                        $('#txtProManager').val(reporting_manager_name);
                                        if(reporting_manager_Id !="")
                                        {
                                            exceptional_guid1=reporting_manager_Id;
									
                                            PendingWithId=exceptional_guid1;
                                            PendingWithName=reporting_manager_name;
                                        }
                                    }
						
                                }
                            }
                        },
                        complete: function () {
                        },
                    });
                }
            }
			
			if($('#txtProManager').val()!='')
			{
					$('#txtProManager').css({

						"border": "",
						"background": ""
					});
					document.getElementById("AlertMsg").innerHTML = "";
			
			}

        }
		
        function getGuidByProjectID(resourse_id,project_id){
		
		
            document.getElementById('ddlProjectsmanager').value = project_id;
            var projectManager = $("#ddlProjectsmanager option:selected").text();
            projectManager=projectManager.split('|');
            ////alert("Excep");
            jQuery.ajax({
                url: "/sites/pwa/_api/ProjectData/Projects?$select=BuildTeamResourceGUID,ProjectOwnerId,ClientPartner&$filter=ProjectId eq (guid'"+project_id+"')",
                type: "GET",
                async: false,
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
                    var dataResults = data.d;
                    ////alert("chexck");
                    console.log(data.d);
                    var BuildTeamResourceGUID=data.d.results[0].BuildTeamResourceGUID;
                    var ProjectOwnerId1=data.d.results[0].ProjectOwnerId;
                    var CPartner=data.d.results[0].ClientPartner;
                    if(CPartner!=null)
                    {
                        CPartner=data.d.results[0].ClientPartner.split('|')[0];
					
                    }
                    if (ProjectOwnerId1==resourse_id)
                    {
                        if (CPartner != null) {
                            document.getElementById("Role_assign").innerHTML="(Client Partner)";
                            $('#txtProManager').val(projectManager[3]);
                            exceptional_guid1=projectManager[2];
                            PendingWithId=exceptional_guid1;
                            PendingWithName=projectManager[3];	
                        }
                    }
                    else if(CPartner==Emp_ID)
                    {
						
                        document.getElementById("Role_assign").innerHTML="(Reporting Manager)";
                        $('#txtProManager').val(reporting_manager_name);
                        exceptional_guid1=reporting_manager_Id;
								
                        PendingWithId=exceptional_guid1;
                        PendingWithName=ReportingManagerName;
                    }
                    else if(BuildTeamResourceGUID != null)
                    {
                        if (BuildTeamResourceGUID.indexOf(resourse_id) >= 0)
                        {
                            document.getElementById("Role_assign").innerHTML="(Project Manager)";
                            $('#txtProManager').val(projectManager[0]);
                            exceptional_guid1=projectManager[1];
									
                            PendingWithId=exceptional_guid1;
                            PendingWithName=projectManager[0];
                        }
                        else
                        {
                            //Amol condition
						
                            if(ExceptionalProjectApproverName!='NA')
                            {
                                if(ExceptionalProjectApproverName=='Project Manager')
                                {
                                    document.getElementById("Role_assign").innerHTML="(Project Manager)";
                                    $('#txtProManager').val(projectManager[0]);
                                    exceptional_guid1=projectManager[1];
									
                                    PendingWithId=exceptional_guid1;
                                    PendingWithName=projectManager[0];
                                }
                                else if(ExceptionalProjectApproverName=='Reporting Manager')
                                {
                                    document.getElementById("Role_assign").innerHTML="(Reporting Manager)";
                                    $('#txtProManager').val(reporting_manager_name);
                                    if(reporting_manager_Id !="")
                                    {
                                        exceptional_guid1=reporting_manager_Id;
									
                                        PendingWithId=exceptional_guid1;
                                        PendingWithName=reporting_manager_name;
                                    }
                                }
						
                            }
                            
                        }
						
						
                    }
                    else{
                        if(ExceptionalProjectApproverName!='NA')
                        {
                            if(ExceptionalProjectApproverName=='Project Manager')
                            {
                                document.getElementById("Role_assign").innerHTML="(Project Manager)";
                                $('#txtProManager').val(projectManager[0]);
                                exceptional_guid1=projectManager[1];
									
                                PendingWithId=exceptional_guid1;
                                PendingWithName=projectManager[0];
                            }
                            else if(ExceptionalProjectApproverName=='Reporting Manager')
                            {
                                document.getElementById("Role_assign").innerHTML="(Reporting Manager)";
                                $('#txtProManager').val(reporting_manager_name);
                                if(reporting_manager_Id !="")
                                {
                                    exceptional_guid1=reporting_manager_Id;
									
                                    PendingWithId=exceptional_guid1;
                                    PendingWithName=reporting_manager_name;
                                }
                            }
						
                        }
                               
                    }
                    
                },
                complete: function () {
                },
                 
            });

        }
		
        function amol(){
            alert('calledd');
					
        }
		
		
		
        function getReportingManagerByGuid(Guid) {
          
            jQuery.ajax({
                url: "https://bristleconeonline.sharepoint.com/sites/pwa/_api/ProjectData/Resources?$select=BaseLocation,ReportingManager&filter= ResourceId eq (guid'"+Guid+"')",
                type: "GET",
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
				
                   // console.log(data);
                    var BaseLocation=data.d.results[0].BaseLocation;
                    var RPEmployeeId=data.d.results[0].ReportingManager;
                    //alert(BaseLocation);
                    $('#EmpBaseLocation').text(BaseLocation);
				
                    if(RPEmployeeId!=null )
                    {
                        RPEmployeeId=RPEmployeeId.split('|');
				
                        getReportingManagerGuidByRMEmp(RPEmployeeId[0]);
				
				
                    }
				
                }
            });

        }
  
        function getReportingManagerGuidByRMEmp(RMempId) {
            RMempId = RMempId.trim();
            jQuery.ajax({

                url: "https://bristleconeonline.sharepoint.com/sites/pwa/_api/projectdata/Resources?$select=ResourceId,ResourceName&filter=EmployeeID eq '"+RMempId+"'",
                type: "GET",
                async:false,
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
                          
					
                    $('#ReportingManagerGuid').text(data.d.results[0].ResourceId);
                    $('#ReportingManagerName').text(data.d.results[0].ResourceName);
					
                    reporting_manager_name=data.d.results[0].ResourceName;
                    reporting_manager_Id = data.d.results[0].ResourceId;
                           
                }
            });

        }

function CheckAdminLogin(ResGUID) {		  
		var count=0;
           var url = "https://ppmprod.bcone.com/api/BCONE/UserGroupsUAT";
		 var requestData = { "Id": ResGUID };
			var count=0;
			//var url = "https://ppmprod.bcone.com/api/BCONE/GetProjectNameDBDev";
            //var requestData = { "ResGUID": ResGUID,"EmployeeID":Emp_ID };
			
            $.ajax({
                url: url,
                data: requestData,
                async: false,
                type: "POST",
                dataType: "json",
                success: function (res) {
				
				
				//alert(res.Data[0].Groups.length);
				if(res.Data[0].Groups.length>0)
				{
				count=res.Data[0].Groups.length;
				//alert(count);
			//	getExpenseForAdmin(web_url, 'BconeExpenceMaster');
				getDataByListName(current_url, 'BconeExpenceMaster', 'FirstTimeLoad','');
				}
				else
				{
				
				window.location="https://bristleconeonline.sharepoint.com/sites/pwa/default.aspx";
				}					 
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    
                },
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                }
            });
			return count;

        }
        $(document).ready(function () {
		 var userid = _spPageContextInfo.userId;
		CheckAdminLogin(userid);
		
            setTimeout(function(){
                $("a").hover(function(){
                    if($(this).attr('title1')=='Edit'){
                        $(this).jqxTooltip({ content: 'Edit', position: 'right', name: 'movieTooltip', top: 10,opacity: 1});
                    }
                    else if($(this).attr('title1')=='Delete'){
                        $(this).jqxTooltip({ content: 'Delete', position: 'right', name: 'movieTooltip', top: 10,opacity: 1});
                    }
                    //alert('hi');
                });
				
					
		
					
            },4000)
					
            $('.new-th').css("display", "block");
            $("#txtProManager").prop("readonly", true);

            $("#student_datatable_paginate").click(function () {
                //do something
               // alert('clicked');
            });

            $('.dataTables_paginate').click(function () {
                document.getElementById("SelectedItemCount").innerHTML=0; 
            });

            $("#student_datatable_paginate").on("click", function () {
                //alert('hi11');
            });

		
            $('.loader').show();

            
        });
		
        function bigImg(date,tooltipid){
            ////alert("tooltipid"+tooltipid);
            ////alert("date"+date);
            //tooltipid
		
            //$("#"+tooltipid).jqxTooltip({ content: date, position: 'top', name: 'movieTooltip', top: 5,opacity: 1});
        }
		
        $(window).load(function(){
		
            //var now = new Date();

            //console.log('window loaded..'+now);
            //$('.iconscontainer').css('margin-left','-48px');
            //$('.jqx-widget-header').css('margin-left','-16px');
            //$('.jqx-widget-header').css('display','block');
		
		
            var jsonarr=[];
            for(var i=0;i<10;i++)
            {
                jsonarr.push({
                    id:i+'id',
                    name:i+'asname'
		
                });
            }
		
            var spanelement='';
            $.each(jsonarr,function(key,value){
                spanelement=spanelement+'<span>'+value.id+','+value.name+'</span>';
            });
		
            //console.log(spanelement);
		
        });
		
		
        function GetExpenseDetailByTrackingid(current_url, id) {

            //alert(refine_status);
            var count=0;
            var query_cml = '<View><Query><Where><Eq><FieldRef Name="TrackingNo" /><Value Type="Number">' + id + '</Value></Eq></Where></Query></View>';
            // alert(query_cml);
            $.ajax({
                url: _spPageContextInfo.webAbsoluteUrl + "/_api/Web/Lists/getbytitle('BconeExpenceLogDetail')/GetItems",
                type: "POST",
                async: false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),
				
                success: function (data) {
                   
                    //alert(data.d.results.length);
                    if (data.d.results.length > 0) {

                       
                        count=data.d.results.length;
                        return count;
					
                    }else
                    {
					
                        return count;
                    }
					

                },
                error: function (data) {
                    alert(data.responseJSON.error.message.value);
                    failure(data);
					
                }
            });
			
            return count;
        }
		
        function close_div(type)
        {
            if(type!="")
	  {
	getDataByListName(current_url, 'BconeExpenceMaster', 'FirstTimeLoad','');
	 // getExpenseForAdmin(web_url, 'BconeExpenceMaster');
	  }
	  $("#alertmain").hide();
	  document.getElementById("Alert_msg").innerHTML="";
            //refine_status('Open','open');
            //getDataByListName(current_url, 'BconeExpenceMaster', 'load1',GUID);
	  
        }
        function Submit_ExpenseTo_Pm(listName,status,tracking_id,refine_status,ids) 
			
        {
		   
		   
            if(status=="Submitted")
            {
                document.getElementById("Confirmation_msg").innerHTML="Are you sure you want To Submit Expense?";
            }
            else
            {
                document.getElementById("Confirmation_msg").innerHTML="Are you sure you want To Edit Expense?";
			 
            }
            $('#ok_click').attr('onclick','Submit_ExpenseTo_Pm_temp("'+listName+'","'+status+'","'+tracking_id+'","'+refine_status+'","'+ids+'")');
            $("#Confirmation_alert").show();
           
        }
        function Submit_ExpenseTo_Pm_temp(listName,status,Id_edit,refine_statu,ids) {
            //alert(refine_statu);
            $("#Confirmation_alert").hide();
            $('.loader').show();
            //var Id_edit=TrackingNo;
            //alert(Id_edit);
            //  alert(BliableToClient);
            var itemType = getListprotocol(listName);
            var item = {
                "__metadata": { "type": itemType },
                "ReportStatus": status
                   
                    

            };
            //alert(item);

            getListItemForUpdate(current_url, listName, Id_edit, function (data) {
                ////alert("vvv");
                // showmodal1('Update');

                $.ajax({
                    url: data.d.__metadata.uri,
                    type: "POST",
                    contentType: "application/json;odata=verbose",
                    data: JSON.stringify(item),
                    headers: {
                        "Accept": "application/json;odata=verbose",
                        "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                        "X-HTTP-Method": "MERGE",
                        "If-Match": data.d.__metadata.etag
                    },
                    success: function (data) {

                        ////alert("Expense Submitted Sucessfully");
                        $('.loader').hide();
                        $("#Confirmation_alert").hide();
                        $("#alertmain").show();
							
                        if(status=="Submitted")
                        {
	
                            document.getElementById("Alert_msg").innerHTML="Expense Submitted Sucessfully.";	
							
                        }
                        else
                        {
                            document.getElementById("Alert_msg").innerHTML="Expense Recalled Sucessfully.";
                        }
                        Refine_count_Update(current_url, 'BconeExpenceMaster', 'load1',GUID);
                        //getDataByListName(current_url, 'BconeExpenceMaster', 'load1',GUID);
                        refine_status(refine_statu,ids);
                                                    
                          
                    },
                    error: function (data) {
                        alert(data.responseJSON.error.message.value);
                        ////alert("false");
                        // failure(data);
                        $('.loader').hide();
                    }
                });

            }, function (data) {
                failure(data);
            });
           
        }
		
		
		
		
        function Refine_count_Update(url, listname, type,EmployeeId) {

            ////alert("first");
            jsonObj = [];
            var trackingno = '';
            var title = '';

            var status = '';
            var advanceamount = '';

            var list_name = listname;
            var i = "0";
            var url1 = url;
            var rowhide = "";

            var Project_Name = "Project Name";
            var Pending_With = "Pending With";
            var Reimbursed_Total_Money = "Reimbursed_Total_Money";
            var Balance = "Balance";
            var fromdate = "";
            var ReportCreatedDate = "";
            var converted_date = "";

            var ModifiedDate = "";

            var openstatus_count = 0;
            var submittedstatus_count = 0;
            var approvedstatus_count = 0;
            var rejectedstatus_count = 0;
            var reimburesedstatus_count = 0;
            // var ReSubmittedExpenceCount = 0;
            var curreuncyvalue = 0;
            var advance = "";
            var tooltip_date = "";
            var allrecord_count = 0;
            var redirect_tolink = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/ExpenseItemDetailTest.aspx?TrackingNo=";
            var expenceid = '';
            var curr = '';
            var action_data = '';

            var data = '';
            var datetooltip='datetooltip';



            var query_cml = '<View><Query><Where><Eq><FieldRef Name="EmployeeId"/><Value Type="Text">' + EmployeeId + '</Value></Eq></Where><OrderBy><FieldRef Name="Modified" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';

            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/GetItems",
                type: "POST",
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                beforeSend: function () {
                    $('.loader').show();
                    //$('[data-toggle="tooltip"]').tooltip();
                },

                success: function (data) {



                    if (data.d.results.length > 0) {


                        $.each(data.d.results, function (key, value) {


                         

                            allrecord_count++;
                            //alert(allrecord_count);
                           
						


                            //action_data = "<a  title1='Edit' style='display:inline-block; margin-right:12px;' href='javascript:void(0)' onclick='getListItemById(\"" + url1 + "

                            if (value.ReportStatus == "Open") {
                                openstatus_count++;
                            }

                            if (value.ReportStatus == "Submitted") {
                                submittedstatus_count++;
                            }
                            if (value.ReportStatus == "ReSubmitted") {
                                // ReSubmittedExpenceCount++;
                            }


                            if (value.ReportStatus == "Rejected") {
                                rejectedstatus_count++;
                            }

                            if (value.ReportStatus == "Approved") {
                                approvedstatus_count++;
                                //action_data = "";
                                // action_data = "<a data-toggle='tooltip' data-placement='top'  style='display:inline-block; text-decoration:none; color:#a6a6a6;margin-right:12px; cursor:default; ' href='javascript:void(0)' ><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='top'  style='display:inline-block; text-decoration:none; color:#a6a6a6; cursor:default;' ><i class='fa fa-trash'></i></a>";

                            }

                            if (value.ReportStatus == "Reimbursed") {
                                reimburesedstatus_count++;
                                // action_data = "";
                                // action_data = "<a data-toggle='tooltip' data-placement='top'  style='display:inline-block; text-decoration:none; color:#a6a6a6;margin-right:12px; cursor:default; ' href='javascript:void(0)' ><i class='fa fa-pencil'></i></a> <a   data-toggle='tooltip' data-placement='top'  style='display:inline-block; text-decoration:none; color:#a6a6a6; cursor:default;' ><i class='fa fa-trash'></i></a>";
                            }


                            i++;





                        });
                    }
                    else {
                        //table_tr = table_tr + "<tr id='ss' style='color:red' style='text-decoration:underline;'><td colspan='15'><a                         href='javascript:void(0)' style='color:#d9534f;'>No Record Found</a></td></tr>";

                    }
                    document.getElementById("OpenExpenceCount").innerHTML = openstatus_count;
                    document.getElementById("SubmittedExpenceCount").innerHTML = submittedstatus_count;
                    //document.getElementById("ReSubmittedExpenceCount").innerHTML = ReSubmittedExpenceCount;
                    document.getElementById("RejectedExpenceCount").innerHTML = rejectedstatus_count;
                    document.getElementById("ApprovedExpenceCount").innerHTML = approvedstatus_count;
                    document.getElementById("ReimburesedExpenceCount").innerHTML = reimburesedstatus_count;
                    document.getElementById("AllRecordCount").innerHTML = allrecord_count;


                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                }



               

            });
        }
		
		
		
        function GetProjectsForOthers(Emp_ID){
            ////alert("Emp_ID"+Emp_ID);
		
            //alert(ID);
		
            //var	ClientPartnerEmployeeId="d8221044-ed7b-e611-80ce-00155d04851d";
            //var  ClientPartnerEmployeeName="ProjectManager PPM"+"";
		
		
            jQuery.ajax({

                url: "/sites/pwa/_api/ProjectData/Resources?$select=ReportingManager,&filter=EmployeeID eq('" + Emp_ID + "')",
                type: "GET",
                async: false,
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
				
                    console.log(data)
                    // console.log(data.d.results[0].RoleBand);
                    //  console.log(data.d.results[0].ReportingManager);
				   
                    if(data.d.results[0].ReportingManager!=null&&data.d.results[0].ReportingManager!='')
                    {
                        var my_id=data.d.results[0].ReportingManager.split("|");
                        // alert(my_id);
				  
                        var guid1=getResourcesGuid1(my_id[0]);
                        var reportingmanager_guid=guid1;
                        var reportingmanager_name=my_id[1];
                        $('#ReportingManagerGuid').text(guid1);
                        $('#ReportingManagerName').text(my_id[1]);
                        GetExceptionalProjectsByEmpid(Emp_ID);
					
					
					
					
                    }else
                    {
                        $('#ddlProjects').attr("disabled", false);
                        //alert("Reporting Manager Is Not Assign.");
					
                    }
                    <!-- if(data.d.results[0].RoleBand=="RB2") -->
                    <!-- { -->
                    <!-- //alert("rb2"); -->
				   
                    <!-- }else -->
                    <!-- { -->
                      <!-- alert(data.d.results[0].RoleBand); -->
				   
                    <!-- } -->
				   
				 
					
                    }
                });	
		
		
        }
		
        function getResourcesGuid1(NewloginName) {
            //alert(NewloginName);
            //alert(Type_query);
            var guid1="";
            jQuery.ajax({

                url: "/sites/pwa/_api/ProjectData/Resources?$select=ResourceId,ResourceName&filter=EmployeeID eq('" + NewloginName + "')",
                type: "GET",
                async:false,
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
                    //alert(data.d.results.length);
                    console.log(data.d);
                    //  alert(data.d);
                    guid1 = data.d.results[0].ResourceId;
                    var guid2= data.d.results[0].ResourceName;
					
                   

                }
            });
            return guid1;

        }
		
		
		
		
        function GetExceptionalProjectsByEmpid(Emp_ID) {
            ////alert("GetExceptionalProjectsByEmpid");
            // alert(current_url);

         
            var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="EmployeeID"/><Value Type="Text">' + Emp_ID + '</Value></Eq><Eq><FieldRef Name="IsActive"/><Value Type="Boolean">1</Value></Eq></And></Where></Query></View>';

            $.ajax({
                url: current_url + "/_api/web/lists/getbytitle('BconeExceptionalProjects')/GetItems",
                type: "POST",
                async:false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                beforeSend: function () {
                    //  $('.loader').show();
                    //$('[data-toggle="tooltip"]').tooltip();
                },

                success: function (data) {

                    //   alert(data.d.results.length);
                    //  console.log(data.d);
                    // alert(data.d.results[0].AllocatedProjectCode);
                    if (data.d.results.length > 0) {
                     

                        $.each(data.d.results, function (key, value) {


                            <!-- AllocatedProjectCode -->

                            //alert(value.AllocatedProjectCode);
                           GetprojectcodebyAllocatedcodeId(value.AllocatedProjectCode)





                        });
                    }
                    else {
                        

                    }
                    


                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                } 

            });
        }
		
        function GetprojectcodebyAllocatedcodeId(AllocatedProjectCode) {
		 
            jQuery.ajax({
                url: "https://bristleconeonline.sharepoint.com/sites/pwa/_api/projectdata/Projects?$filter=ProjectCode eq '"+AllocatedProjectCode+"'",
                type: "GET",
                async:false,
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
				
                    $('#ddlProjects').append("<option value = '" + data.d.results[0].ProjectId + "'>" + data.d.results[0].ProjectName + "</option>");
                }
				
            });
            $('#ddlProjects').attr("disabled", false);
        }
		
        function GetEmailData(Trackingid,emailEventId) {
		
            var To = "";
            var Cc = "";
            var Subject = "";
            var Body = "";
            var Filepath = "";
            var result = "";
            var subjectcontents = "";
       

            $().SPServices({
                operation: "GetListItems",
                async: false,
                listName: "BconeEmailConfiguration",
                CAMLQuery: "<Query><Where><Eq><FieldRef Name='EventID'/><Value Type='Text'>" + emailEventId + "</Value></Eq></Where></Query>",
                completefunc: function (xData, Status) {
                    raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
                    $(xData.responseXML).SPFilterNode("z:row").each(function () {
                        Subject = $(this).attr("ows_Subject");
                        Body = $(this).attr("ows_Body");
                        formatSubject(Subject,Trackingid);
                        formatBodyValues(Body,Trackingid);
                    });
                }
            });
            function formatSubject(Subject,ListID) {
                var startString = "{";
                var endString = "}";
                var count = 0;
                var indexStart = 0, indexEnd = 0;
                var exit = false;
                while (!exit) {
                    indexStart = Subject.indexOf(startString);
                    indexEnd = Subject.indexOf(endString);
                    if (indexStart != -1 && indexEnd != -1) {

                        matchedstring = Subject.substring(Subject.indexOf('{') + 1, Subject.indexOf('}'));

                        $().SPServices({
                            operation: "GetListItems",
                            async: false,
                            listName: "BconeEmailvariablemapping",
                            CAMLQuery: "<Query><Where><Eq><FieldRef Name='VariableName' /><Value Type='Text'>" + matchedstring + "</Value></Eq></Where></Query>",
                            completefunc: function (xData, Status) {
                                raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
                                $(xData.responseXML).SPFilterNode("z:row").each(function () {
                                    var fieldvalue = $(this).attr("ows_FieldValue");
                                    var str_ows = "ows_" + fieldvalue;
                                    $().SPServices({
                                        operation: "GetListItems",
                                        async: false,
                                        listName: "BconeExpenceMaster",
                                        CAMLQuery: "<Query><Where><Eq><FieldRef Name='ID' /><Value Type='Counter'>" + ListID + "</Value></Eq></Where></Query>",
                                        completefunc: function (xData, Status) {
                                            raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
                                            $(xData.responseXML).SPFilterNode("z:row").each(function () {

                                                var element = $(this).attr(str_ows);
                                                if (element.indexOf('#') >= 0) {
                                                    element = $(this).attr(str_ows).split('#')[1];
                                                } else {
                                                    element = $(this).attr(str_ows);

                                                }

                                                // alert(ccID);
                                                if (element != "" && element != undefined && element != "0") {
                                                    if (count == 0) {
                                                        subjectcontents = element;
                                                    } else {
                                                        subjectcontents = subjectcontents + (";" + element);
                                                    }
                                                }
                                            });
                                        }
                                    });
                                });
                            }
                        });

                        Subject = Subject.substring(indexEnd + endString.length);
                        count++;
                    }
                    else
                        exit = true;
                }
            }


            function formatBodyValues(Body,ListID) {
                var startString = "&#123;";
                var endString = "&#125;";
                var count = 0;
                var indexStart = 0, indexEnd = 0;
                var exit = false;
                while (!exit) {
                    indexStart = Body.indexOf(startString);
                    indexEnd = Body.indexOf(endString);
                    if (indexStart != -1 && indexEnd != -1) {

                        matchedstring = Body.substring(Body.indexOf('&#123;') + 6, Body.indexOf('&#125;'));
                        //if (count == 0) {
                        //    result = matchedstring;
                        //} else {
                        //    result = result + (";" + matchedstring);
                        //}
                        $().SPServices({
                            operation: "GetListItems",
                            async: false,
                            listName: "BconeEmailvariablemapping",
                     
                            CAMLQuery: "<Query><Where><Eq><FieldRef Name='VariableName' /><Value Type='Text'>" + matchedstring + "</Value></Eq></Where></Query>",
                            completefunc: function (xData, Status) {
                                raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
                                $(xData.responseXML).SPFilterNode("z:row").each(function () {
                                    var fieldvalue = $(this).attr("ows_FieldValue");
                                    var str_ows = "ows_" + fieldvalue;
                                    $().SPServices({
                                        operation: "GetListItems",
                                        async: false,
                                        listName: "BconeExpenceMaster",
                                        CAMLQuery: "<Query><Where><Eq><FieldRef Name='ID' /><Value Type='Counter'>" + ListID + "</Value></Eq></Where></Query>",
                                        completefunc: function (xData, Status) {
                                            raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
                                            $(xData.responseXML).SPFilterNode("z:row").each(function () {
                                                var element = $(this).attr(str_ows);
                                                if (fieldvalue == "Editor" || fieldvalue == "Author") {
                                                    element = $(this).attr(str_ows).split('#')[1];
                                                }
                                                else {
                                                    element = $(this).attr(str_ows);
                                                }
                                                // alert(ccID);
                                                if (element != "" && element != undefined && element != "0") {
                                                    if (count == 0) {
                                                        result = element;
                                                    } else {
                                                        result = result + (";" + element);
                                                    }
                                                }
                                            });
                                        }
                                    });
                                });
                            }
                        });

                        Body = Body.substring(indexEnd + endString.length);
                        count++;
                    }
                    else
                        exit = true;
                }

                   
            }

            PathUrl = "https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/ExpenseApproval.aspx";

            sendEmail(finalTo, finalCc, Subject, Body, Filepath, result, subjectcontents, PathUrl);

        }
        function sendEmail(To, Cc, Subject, Body, Filepath, bodyFormat, subjectcontents, PathUrl) 
        {
            var url = "https://ppmprod.bcone.com/api/BCONE/SendEmail"
            var EmailRequestData = {
                "To": To, "Subject": Subject, "Body": Body, "cc": Cc, "BodyFormat": bodyFormat, "SubjectContent": subjectcontents, "URL": PathUrl
            };
            $.ajax({
                url: url,
                async:false,
                data: EmailRequestData,
                type: "POST",
                dataType: "json",
                success: function (res) {
                    //alert("EmailSend");
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });

        }

	
	
        function getResourcesGuid_Temp(NewloginName) {
            //alert(NewloginName);
            //alert(Type_query);
            var guid1="";
            var guid2="";
            var my_var="";
            jQuery.ajax({

                url: "/sites/pwa/_api/ProjectData/Resources?$filter=EmployeeID eq('" + NewloginName + "')",
                type: "GET",
                async:false,
                headers: { "Accept": "application/json;odata=verbose" },
                success: function (data) {
                    guid1 = data.d.results[0].ResourceId;
                    guid2= data.d.results[0].ResourceName;
                    my_var=guid1+":"+guid2;
                }
            });
            return my_var;

        }
	
	
	
        function GetExceptionalApproval(Emp_ID,project_id) {
            var count=0;
         
            var query_Caml = '<View><Query><Where><And><Eq><FieldRef Name="EmployeeID"/><Value Type="Text">' + Emp_ID + '</Value></Eq><And><Eq><FieldRef Name="ProjectGUID" /><Value Type="Text">' + project_id + '</Value></Eq><And><Eq><FieldRef Name="IsActive" /><Value Type="Boolean">1</Value></Eq><Eq><FieldRef Name="ActionType" /><Value Type="Text">Exception</Value></Eq></And></And></And></Where></Query></View>';
                    
            $.ajax({
                url: current_url + "/_api/web/lists/getbytitle('BconeExceptionalApprovals')/GetItems",
                type: "POST",
                async:false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_Caml
                    }
                }),

                beforeSend: function () {
                    //  $('.loader').show();
                    //$('[data-toggle="tooltip"]').tooltip();
                },

                success: function (data) {
                    console.log(data.d);

                    //alert(data.d.results.length);
                    if (data.d.results.length > 0) 
                    {
					
					
					
					
					
					
                        // alert(data.d.results[0].Apr2EmployeeID);
                        var approver1_Guid=getResourcesGuid_Temp(data.d.results[0].Apr1EmployeeID);
                        var approver2_Guid="";
					
					
					
                        if(data.d.results[0].Apr2EmployeeID!=null&&data.d.results[0].Apr2EmployeeID!="")
                        {
                            approver2_Guid=getResourcesGuid_Temp(data.d.results[0].Apr2EmployeeID);
                            Second_approver_EmpId=data.d.results[0].Apr2EmployeeID;
					 
                        }
					
                        First_approver_detail=approver1_Guid;
                        Second_approver_detail=approver2_Guid;
						 
                        First_approver_EmpId=data.d.results[0].Apr1EmployeeID;
						 
						
                        count=data.d.results.length;
					
					

                    
                    }
                     
                    


                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                } 

            });
            return count;
        }
		
		
		
		
        function GetDelegationApproval(Resourse_Emp_ID,project_id) {
            var count=0;			 
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth()+1; //January is 0!
            var yyyy = today.getFullYear();

            if(dd<10) {
                dd='0'+dd
            } 

            if(mm<10) {
                mm='0'+mm
            } 

            today = yyyy+'-'+mm+'-'+dd+'T00:00:00Z';
            var todays_date='';
            var query_Caml = '<View><Query><Where><And><Eq><FieldRef Name="EmployeeID" /><Value Type="Text">' + Resourse_Emp_ID + '</Value></Eq><And><Eq><FieldRef Name="ProjectGUID" /><Value Type="Text">' + project_id + '</Value></Eq><And><Eq><FieldRef Name="ActionType" /><Value Type="Text">Delegation</Value></Eq><And><Eq><FieldRef Name="IsActive" /><Value Type="Boolean">1</Value></Eq><And><Leq><FieldRef Name="Startdatetime" /><Value IncludeTimeValue="TRUE" Type="DateTime">'+today+'</Value></Leq><Geq><FieldRef Name="Finishdatetime" /><Value IncludeTimeValue="TRUE" Type="DateTime">'+today+'</Value></Geq></And></And></And></And></And></Where></Query></View>';
                   
            $.ajax({
                url: current_url + "/_api/web/lists/getbytitle('BconeExceptionalApprovals')/GetItems",
                type: "POST",
                async:false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_Caml
                    }
                }),

                beforeSend: function () {
                },

                success: function (data) {
                    console.log(data.d);

                    //alert(data.d.results.length);
                    if (data.d.results.length > 0) 
                    {
					
					
					
					
					
					
                        // alert(data.d.results[0].Apr2EmployeeID);
                        var approver1_Guid=getResourcesGuid_Temp(data.d.results[0].Apr1EmployeeID);
                        var approver2_Guid="";
					
                        if(data.d.results[0].Apr2EmployeeID!=null&&data.d.results[0].Apr2EmployeeID!="")
                        {
                            approver2_Guid=getResourcesGuid_Temp(data.d.results[0].Apr2EmployeeID);
                        }
					
                        First_approver_detail=approver1_Guid;
                        Second_approver_detail=approver2_Guid;
						
                        count=data.d.results.length;
					
					

                    
                    }
                     
                    


                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                } 

            });
            return count;
        }
		
		
        function GetExceptionalDelegationApproval1(a1,project_id) {
            // //alert("GetExceptionalApproval");
            // alert(current_url);
            var count=0;
			 
			 
			 
			 
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth()+1; //January is 0!
            var yyyy = today.getFullYear();

            if(dd<10) {
                dd='0'+dd
            } 

            if(mm<10) {
                mm='0'+mm
            } 

            today = yyyy+'-'+mm+'-'+dd+'T00:00:00Z';
            //document.write(today);
			 
			 
			 
            var todays_date='';
            var query_Caml = '<View><Query><Where><And><Eq><FieldRef Name="EmployeeID" /><Value Type="Text">' + a1 + '</Value></Eq><And><Eq><FieldRef Name="ProjectGUID" /><Value Type="Text">' + project_id + '</Value></Eq><And><Eq><FieldRef Name="ActionType" /><Value Type="Text">Delegation</Value></Eq><And><Eq><FieldRef Name="IsActive" /><Value Type="Boolean">1</Value></Eq><And><Leq><FieldRef Name="Startdatetime" /><Value IncludeTimeValue="TRUE" Type="DateTime">'+today+'</Value></Leq><Geq><FieldRef Name="Finishdatetime" /><Value IncludeTimeValue="TRUE" Type="DateTime">'+today+'</Value></Geq></And></And></And></And></And></Where></Query></View>';
                   
            $.ajax({
                url: current_url + "/_api/web/lists/getbytitle('BconeExceptionalApprovals')/GetItems",
                type: "POST",
                async:false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_Caml
                    }
                }),

                beforeSend: function () {
                           
                },

                success: function (data) {
                    console.log(data.d);

                    //alert(data.d.results.length);
                    if (data.d.results.length > 0) 
                    {
					
                        var approver1_Guid=getResourcesGuid_Temp(data.d.results[0].Apr1EmployeeID);
                        var approver2_Guid="";
					
                        if(data.d.results[0].Apr2EmployeeID!=null&&data.d.results[0].Apr2EmployeeID!="")
                        {
                            approver2_Guid=getResourcesGuid_Temp(data.d.results[0].Apr2EmployeeID);
                        }
					
                        First_approver_detail=approver1_Guid;
                        document.getElementById("Role_assign").innerHTML="(Approver1 Delegation)";
						
                        count=data.d.results.length;
					
					

                    
                    }
                     
                    


                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                } 

            });
            return count;
        }
		
        function GetExceptionalDelegationApproval2(a2,project_id) {
                
            var count=0;
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth()+1; //January is 0!
            var yyyy = today.getFullYear();

            if(dd<10) {
                dd='0'+dd
            } 

            if(mm<10) {
                mm='0'+mm
            } 

            today = yyyy+'-'+mm+'-'+dd+'T00:00:00Z';
                    
            var todays_date='';
            var query_Caml = '<View><Query><Where><And><Eq><FieldRef Name="EmployeeID" /><Value Type="Text">' + a2 + '</Value></Eq><And><Eq><FieldRef Name="ProjectGUID" /><Value Type="Text">' + project_id + '</Value></Eq><And><Eq><FieldRef Name="ActionType" /><Value Type="Text">Delegation</Value></Eq><And><Eq><FieldRef Name="IsActive" /><Value Type="Boolean">1</Value></Eq><And><Leq><FieldRef Name="Startdatetime" /><Value IncludeTimeValue="TRUE" Type="DateTime">'+today+'</Value></Leq><Geq><FieldRef Name="Finishdatetime" /><Value IncludeTimeValue="TRUE" Type="DateTime">'+today+'</Value></Geq></And></And></And></And></And></Where></Query></View>';
                   
            $.ajax({
                url: current_url + "/_api/web/lists/getbytitle('BconeExceptionalApprovals')/GetItems",
                type: "POST",
                async:false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_Caml
                    }
                }),

                beforeSend: function () {
                    //  $('.loader').show();
                    //$('[data-toggle="tooltip"]').tooltip();
                },

                success: function (data) {
                    console.log(data.d);

                    //alert(data.d.results.length);
                    if (data.d.results.length > 0) 
                    {
					
					
					
					
					
					
                        // alert(data.d.results[0].Apr2EmployeeID);
                        var approver1_Guid=getResourcesGuid_Temp(data.d.results[0].Apr1EmployeeID);
                        var approver2_Guid="";
					
                        if(data.d.results[0].Apr2EmployeeID!=null&&data.d.results[0].Apr2EmployeeID!="")
                        {
                            approver2_Guid=getResourcesGuid_Temp(data.d.results[0].Apr2EmployeeID);
                        }
					
                        //First_approver_detail=approver1_Guid;
                        Second_approver_detail=approver1_Guid;
						
                        count=data.d.results.length;
					
					

                    
                    }
                     
                    


                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                } 

            });
            return count;
        }
		
		
    </script>


    <!-- Log Pop up -->
    <div class="allcommentdiv">
        <div class="allcommentdiv-heading">
            Log
        </div>
        <div class="allcommentdiv-mid">
            <h3><span id="LogId"></span></h3>
            <div class="vertical-scoll">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th style="width: 150px;">Date</th>
                            <th style="width: 100px;">Actor</th>

                            <th style="width: 80px;">Action</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody id="bindlog">
                    </tbody>
                </table>
            </div>
        </div>
        <div class="allcommentdiv-foot">
            <a href="javascript:void(0)" class="blue-btn" onclick="closeallcomment()">got it</a>
        </div>
    </div>
	  <div class="allcommentdiv-main " id="openouterfileattach"> <!-- inner-popup outer-popup add class -->
<div class="allcommentdiv outer-popup ">
 <div class="allcommentdiv-heading">
  Uploaded File List
 </div>
 <div class="allcommentdiv-mid">
 <h3 id="reff_no">Ref No. 1</h3>
  <div class="vertical-scoll">
   <table class="table table-bordered text-left">
    <tbody id="inner_tbody">    
    </tbody>
   </table>
  </div>
 </div>
 <div class="allcommentdiv-foot">
  <a href="javascript:void(0)" class="blue-btn" onclick="closeouterfileattach()">Got it</a>
 </div>
</div>
</div>
    <!-- Log Pop up -->


    <script>
        $(document).ready(function(){

            $('.ms-rte-layoutszone-inner p:first').hide();
            $('.ms-rte-layoutszone-inner p:last').hide();
		
        });
    </script>

    <script>
        function GetAllExpenseLog1(TrackingId){
            event.stopPropagation();
            $('.allcommentdiv').animate({ width: 'toggle'});
        }
        $(document).click(function (event) {
            	if($(event.target).is('.comment-icon, .comment-icon *'))
       {
        return;
       }
  else if (!$(event.target).is('.allcommentdiv, .allcommentdiv *')) {
   $('.allcommentdiv').hide({ width: 'toggle'});
  }
        });
        function closeallcomment(){
            $('.allcommentdiv').animate({ width: 'toggle'});
        }
 
 
        function GetNoteById(Action)
        {
            var notes="";
            var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="NotesID"/><Value Type="Text">' + Action + '</Value></Eq><Eq><FieldRef Name="IsActive"/><Value Type="Boolean">1</Value></Eq></And></Where></Query></View>';

            $.ajax({
                url: current_url + "/_api/web/lists/getbytitle('BconeExpenceNotesMaster')/GetItems",
                type: "POST",
                async:false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                beforeSend: function () {
                },

                success: function (data) {

          
                    if (data.d.results.length > 0) {
                        notes=data.d.results[0].Notes;
                    }
                 

                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                } 

            });
            return notes;
        }
 
 
       
 
        function GetAllExpenseLog(TrackingId,ExpenseTrackingNo)
        {
            document.getElementById("LogId").innerHTML=ExpenseTrackingNo;
            var Div_Log="";
            var notes="";
            var query_cml = '<View><Query><Where><Eq><FieldRef Name="TrackingNo"/><Value Type="Text">' + TrackingId + '</Value></Eq></Where><OrderBy><FieldRef Name="Created" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></Query></View>';

            $.ajax({
                url: current_url + "/_api/web/lists/getbytitle('BconeExpenseLogHistory')/GetItems",
                type: "POST",
                async:false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                beforeSend: function () {
                },

                success: function (data) {
                    if (data.d.results.length > 0) {
                        $.each(data.d.results, function (key, value) {
                            var date=convert_date_amol(value.Created);
                            var converted_date = convert_date_amol_tooltip(value.Created);
                            Div_Log=Div_Log+"<tr><td>"+converted_date+"</td><td>"+value.ActorName+"</td><td>"+value.Action+"</td><td>"+value.Notes+"</td></tr>";
                        });
                        $("#bindlog").html(Div_Log);
						 //  event=window.event;
                      //  event.stopPropagation();
                        $('.allcommentdiv').animate({ width: 'toggle'});
                    }
                },
                error: function (data) {

                    alert(data.responseJSON.error.message.value);
                },
                complete: function () {
                } 

            });
			
        }
        function genratePdf (ID)
        {
            window.open('https://ppmprod.bcone.com/download.aspx?TID='+ID);
        }
        function RedirectTo_ExpenseDetails(redirect_tolink) 
        {
            window.location=redirect_tolink;
        }
        function GetResubmittedCount(url, listname, id) {
            var resubmit_count="0";
            $.ajax({
                url: url + "/_api/web/lists/getbytitle('" + listname + "')/items(" + id + ")",
                async: false,
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                success: function (data) {
                    resubmit_count=data.d.ReSubmitCount;
                },
                error: function (data) {
                    failure(data);
                    alert(data.responseJSON.error.message.value);
                }
            });
            return resubmit_count;
        }
        function showRecallCount(){
            $("#alertmain").show(); 
            document.getElementById("Alert_msg").innerHTML="Expense Recall Allowed Max 3 Times";	
        }
		
        function Confirm_RecallExpense(url, listname, id, i, type,recall_status){
		
            document.getElementById("Confirmation_msg").innerHTML="Are you sure you want to Edit expense?";
            $('#ok_click').attr('onclick','getListItemById("'+url+'","'+listname+'","'+id+'","'+i+'","'+type+'","'+recall_status+'")');
            $("#Confirmation_alert").show();
		
        }
        function updateTrackingNO(listName, siteUrl,ID,ExpenseTrackingNo) {
		
            var today = new Date();	
		
            var curMonth = today.getMonth();
     
            var fiscalYr = "";
            if (curMonth > 3) { //
                var nextYr1 = (today.getFullYear() + 1).toString();
                fiscalYr = today.getFullYear().toString() + "-" + nextYr1.charAt(2) + nextYr1.charAt(3);
            } else {
                var nextYr2 = today.getFullYear().toString();
                fiscalYr = (today.getFullYear() - 1).toString().charAt(2)+(today.getFullYear() - 1).toString().charAt(3) + "-" + nextYr2.charAt(2) + nextYr2.charAt(3);
            }
	
            ExpenseTrackingNo="ER "+ID+"|"+fiscalYr;
	
	
		
            var itemType = getListprotocol(listName);
            var item  = {
                "__metadata": { "type": itemType }
            };
            $.extend(item, { ExpenseTrackingNo: ExpenseTrackingNo });
            getListItemForUpdate(siteUrl, listName, ID, function (data) {
                $.ajax({
                    url: data.d.__metadata.uri,
                    type: "POST",
                    async:false,
                    contentType: "application/json;odata=verbose",
                    data: JSON.stringify(item),
                    headers: {
                        "Accept": "application/json;odata=verbose",
                        "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                        "X-HTTP-Method": "MERGE",
                        "If-Match": data.d.__metadata.etag
                    },
                    success: function (data) {
                    },
                    error: function (data) {
                        alert(data.responseJSON.error.message.value);
                    },
					complete: function(data){
					
					 //var EmployeeId = $('#resourse_id').text();
					 refine_status('Open','Open');
					 add_success_exp_msg(ExpenseTrackingNo+' added successfully!','save');
					 
					 
					 // getDataByListName(current_url, 'BconeExpenceMaster', 'load1', EmployeeId);
						//refine_status('Open','Open');
					}
                });


            }, function (data) {
                failure(data);
            });
        }
			
        function getExceptionalProjectsApprovarName(EmployeeGUID,ProjectGUID) {
		
            var Approver='NA';
            //var query_cml = '<View><Query><Where><And><Eq><FieldRef Name="TrackingNo" /><Value Type="Number">' + id + '</Value></Eq><Eq><FieldRef Name="ExpenceCurrency" /><Value Type="Number" >'+refine+'</Value></Eq></And></Where><OrderBy><FieldRef Name="ExpenseDate" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
            var query_cml="<View>"+
           "<Query>"+
              "<Where>"+
               "<And>"+
	
	 
                          "<Eq><FieldRef Name='IsActive' /><Value Type='Boolean'>1</Value></Eq>"+
                
                               "<And>"+
					
                          "<Eq><FieldRef Name='EmployeeGUID' /><Value Type='Text'>"+EmployeeGUID+"</Value></Eq>"+
                          "<Eq><FieldRef Name='ProjectGUID'/><Value Type='Text'>"+ProjectGUID+"</Value></Eq>"+
                             "</And>"+
				
      
               "</And>"+
            "</Where>"+
           "</Query>"+
           "</View>";
            //alert(query_cml);
            $.ajax({
               
                url: _spPageContextInfo.webAbsoluteUrl + "/_api/Web/Lists/getbytitle('BconeExceptionalProjects')/GetItems",
                type: "POST",
                async:false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),

                success: function (data) {
				
                    if(data.d.results.length>0)
                    {
                        //console.log(data);
                        $.each(data.d.results,function(key,value){

                            Approver=value.Approver;
				
				
                        });
                    }
                },
                error: function (data) {},
                complete: function () {}
            });
			
            return Approver;
						
            
        }
		
        $(function(){
		   var userid = _spPageContextInfo.userId;
            $('#user_id').text(userid);
            GetUserId(userid);
		var   EmployeeId =$('#resourse_id').text();
			//getDataByListName(current_url, 'BconeExpenceMaster', 'FirstTimeLoad','');
		var Type_query = getQueryStringValue("status");
		
		
		
		
		if(Type_query!='')
		{
		refine_status(Type_query,Type_query)
		}
		
		//getProjectsByGUID(GUID);
		//getReportingManagerByGuid(GUID);
		
		
        });
		
		window.onload = function() {
		
		
		};	
		
		
		function bind_dataTable(){
		//$('#ExpenceDataTable').DataTable();
		
		$('#ExpenceDataTable').DataTable( {
			"order": [],
			"pagingType": "full_numbers",
			"columnDefs": [
				{ "orderable": false, "targets": 0 },
				
				
			]
    // Your other options here...
		} );


		var ExpenceDataTableElement = $('#ExpenceDataTable').DataTable();
		$('#ExpenceDataTable tfoot th').each( function () {
                var title = $(this).text();
				if(title!='Action'&&title!='Log')
				{
                $(this).html( '<input type="text" placeholder="Search" />' );
				}
				else
				{
				$(this).html('');
				}
            } );
            ExpenceDataTableElement.columns().every( function () {
                var that = this;
                $( 'input', this.footer() ).on( 'keyup change', function () {
                    if ( that.search() !== this.value ) {
                        that
                            .search( this.value )
                            .draw();
                    }
                } );
            } );
			
			
			if($('.dataTables_empty').text()=='No data available in table')
			$('#ExpenceDataTable tfoot,.dataTables_length,.dataTables_filter,.dataTables_info,.dataTables_paginate').remove();
		}
		function loadBSTooltips()
		{
		$('[data-toggle="tooltip"]').tooltip(); 
		}
		function ReSet()
	{
	
		var childCheckboxes = $('#ExpenceDataTable tbody tr td').find('input[type=checkbox]'),
    no_checked = childCheckboxes.filter(':checked').length;


		if(no_checked==0)
		{
		
		 document.getElementById("Alert_msg").innerHTML="Please Select At-least One Expense To Reset";	
	     $("#alertmain").show();
		}else
		{
		document.getElementById("Confirmation_msg").innerHTML="Are you sure, you want to Reset Expense(s)?";
		$('#ok_click').attr('onclick','UpdateExpenseStatus()');
		$("#Confirmation_alert").show();		
		}
	}
	function UpdateExpenseStatus()
	{
	var table = $('#ExpenceDataTable').DataTable();
	  var IDs = [];
	  var tackingids=[];
	  var display_trackingid=[];
	 var count=0;
	 var childCheckboxes = $('#ExpenceDataTable tbody tr td').find('input[type=checkbox]'),
    no_checked = childCheckboxes.filter(':checked').length;
	
	//alert(no_checked);
	 $('.loader').show();
        $("#ExpenceDataTable tbody tr td input[type='checkbox']:checked").each(function(){		
		count++;
		var iddd=($(this).closest('tr').attr("id"));		
		IDs.push($(this).closest('tr').attr("id"));
		 tackingids.push($(this).attr("name"));
		var trackingid=($(this).attr("name"));
		
		 display_trackingid=($(this).attr("title"));
		 var status_Final=($(this).attr("title1"));
		 //alert("status_Final"+status_Final);
		UpdateExpenseStatusByTrackingId(trackingid,'Open',iddd,status_Final);
		//table.row('#'+iddd).remove().draw( false );
		});
		
		
		//alert(no_checked);
		$('#ok_click1').attr('onclick','close_div("msg")');
		
		if(tackingids.length==1)
		{
		document.getElementById("Alert_msg").innerHTML="Selected "+display_trackingid+" Reset Sucessfully";	
		}else
		{
		document.getElementById("Alert_msg").innerHTML="Selected ER Reset Sucessfully!";
		}
		
		
	     $("#alertmain").show();
		 
		 
	}
		function UpdateExpenseStatusByTrackingId(id,status,remove_id,status_Final)
		    {
				$('.loader').show();
				var currentdate = new Date();
				var date = currentdate;
				expense_creater_id="";
				Approver2Id=""; 
				Approver1Id=""; 
				ExpenseApproveType="";
				FinanceApprovalId="";
				GetApprovalFinaceDetail(id);
				$("#Confirmation_alert").hide();
				var listName="BconeExpenceMaster";
				var itemType = getListprotocol(listName);
                var item = {
                    "__metadata": { "type": itemType },
					   "ReimbursedDate":date,			
					  "ReportStatus":status,
					  "finalstatus":status_Final
				// "PendingWithId":"",
			   // "PendingWithName":""
                };
                getListItemForUpdate(current_url, listName, id, function (data) {
			    $.ajax({
									url: data.d.__metadata.uri,
									type: "POST",
									async:false,
									contentType: "application/json;odata=verbose",
									data: JSON.stringify(item),
									headers: {
									"Accept": "application/json;odata=verbose",
									"X-RequestDigest": $("#__REQUESTDIGEST").val(),
									"X-HTTP-Method": "MERGE",
									"If-Match": data.d.__metadata.etag
									},
									success: function (data) {
									//alert(FLoginname);
							   InsertIntoLog(current_url, "BconeExpenseLogHistory",id,"19",FLoginname,FloginId,"Reset");
                                PathUrl="https://bristleconeonline.sharepoint.com/sites/pwa/SitePages/MyExpense.aspx";	
						    if(status_Final!='Open')
									{
									if(status_Final=='Submitted')
									{
									finalCc=FloginId+";"+Approver1Id;
									finalTo=expense_creater_id;


									}
							else if(status_Final=='Approved' || status_Final=='Approver 1 Approved' ||status_Final=='Approver 2 Approved'|| status_Final=='Manager Approved'|| status_Final=='Rejected' || status_Final=='Approver 1 Rejected' ||status_Final=='Approver 2 Rejected'|| status_Final=='Manager Rejected')
							  {
							   finalTo=expense_creater_id;
								if(status_Final=='Approver 1 Approved'||status_Final=='Manager Approved'||status_Final=='Approver 1 Rejected'||status_Final=='Manager Rejected')
									{
									finalCc=FloginId+";"+Approver1Id;
									
							        
									}
								  if(status_Final=='Approver 2 Approved'||status_Final=='Approver 2 Rejected')
								 {
									finalCc=FloginId+";"+Approver1Id;
									if(Approver2Id!=null &&  Approver2Id!="" && Approver2Id!='Na')
								   {
									finalCc=finalCc+";"+Approver2Id;
									
							       }
								   
                                }
							   if(status_Final=='Approved'||status_Final=='Rejected')
								 {
									finalCc=FloginId+";"+Approver1Id+";"+FinanceApprovalId;
									finalTo=expense_creater_id;
									var test='Na';
									if(Approver2Id!=null &&  Approver2Id!='' && Approver2Id!='Na')
								   {
									finalCc=finalCc+";"+Approver2Id;
									
							       }
								   
                                }
							
								
							}
							else if(status_Final=='Reimbursed')
							  {
							     finalCc=FloginId+";"+Approver1Id+";"+FinanceApprovalId;
									finalTo=expense_creater_id;
									if(Approver2Id!=null &&  Approver2Id!="" && Approver2Id!='Na')
								   {
									finalCc=finalCc+";"+Approver2Id;
									
							       }
								
							
							  }
							  
							  InsertIntoMailLog('BconeEmailData',finalTo,finalCc,PathUrl,'20',id,'1');
									}
									},
									error: function (data) {
									alert(data.responseJSON.error.message.value);
									 $('.loader').hide();
									},
									complete:function(){									
									$('.loader').hide();
									}
					});
                },        function (data) {
                    failure(data);
                });
		}
		
		function InsertIntoMailLog(listname,Too,Ccc,PathURL,EventId,TrackingId,flag)
        {
 
            var item = "";
            var item_collections = getListprotocol(listname);
	       
            item = {
                "__metadata": { "type": item_collections},
                "To":Too,
                "Cc":Ccc,
               "PathURL":PathURL,
			   "EventId":EventId,
                "Flag":flag,
              "TrackingId":	TrackingId			
            };
            
      
            $.ajax({
                 url: _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('" +encodeURIComponent(listname)  + "')/items",

                type: "POST",
                async:false,
                contentType: "application/json;odata=verbose",
                // contenType: "application/x-www-form-urlencoded; charset=UTF-8",
                data: JSON.stringify(item),
                headers: {
                    "Accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val()
                },
                success: function (data) {
				
                    // alert("log added sucessfully");

                },
                complete: function () {

                },
                error: function (data) {
                   
                    alert(data.responseJSON.error.message.value);
                    

                }
            });
 
        }
		    function GetApprovalFinaceDetail(id) {
				  var query_cml = '<View><Query><Where><Eq><FieldRef Name="ID"/><Value Type="Counter">'+id+'</Value></Eq></Where></Query></View>';
            $.ajax({
                url: _spPageContextInfo.webAbsoluteUrl +"/_api/web/lists/getbytitle('BconeExpenceMaster')/GetItems",
                type: "POST",
				async:false,
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),				
                success: function (data) {
                    var table_tr = "";                   
                    Approver2Id=data.d.results[0].Approver2; 
					
					Approver1Id=data.d.results[0].Approver1; 
				    ExpenseApproveType=data.d.results[0].ExpenseApproveType;
                     FinanceApprovalId=data.d.results[0].FinanceId;	
                    if (data.d.results.length > 0) {
				expense_creater_id=data.d.results[0].EmployeeId;						
                    }
                    else {				
                    }
                },
                error: function (data) {
                    alert(data.responseJSON.error.message.value);
                    failure(data);
                }
            });
        }
	  function onchildcheck()
	  {
	 		var childCheckboxes = $('#ExpenceDataTable tbody tr td').find('input[type=checkbox]'),
    no_checked = childCheckboxes.filter(':checked').length;

  if(childCheckboxes.length == no_checked){ 
  $("#checkAll").prop('checked',true);
   }
   else
   {
    $("#checkAll").prop('checked',false);
   }
   document.getElementById("SelectedItemCount").innerHTML=no_checked; 
}

function checkallclick()
{
	if ($("#checkAll").is(':checked')) {
			 $("#ExpenceDataTable tbody tr td input[type=checkbox]").each(function () {
                $(this).prop("checked", true);
            });
			  }
			  else 
			  {   		  
               $("#ExpenceDataTable tbody tr td input[type=checkbox]").each(function () {
                $(this).prop("checked", false);
            });
                 }
				 var childCheckboxes = $('#ExpenceDataTable tbody tr td').find('input[type=checkbox]'),
    no_checked = childCheckboxes.filter(':checked').length;
	    no_checked = childCheckboxes.filter(':checked').length;
  
 document.getElementById("SelectedItemCount").innerHTML=no_checked;
		
			$('#ExpenceDataTable tbody tr td input[type=checkbox]').change(function(){
			//alert("cfkgm");
		var childCheckboxes = $('#ExpenceDataTable tbody tr td').find('input[type=checkbox]'),
    no_checked = childCheckboxes.filter(':checked').length;
 document.getElementById("SelectedItemCount").innerHTML=no_checked;
  if(childCheckboxes.length == no_checked){ 
  $("#checkAll").prop('checked',true);
   }
   else
   {
    $("#checkAll").prop('checked',false);
   }
		
});
}
function opendetails(trackingid)
	{
	setTimeout(function(){ 
		$('[data-toggle="tooltip"]').tooltip();  
	}, 1000);
	$.ajax({
                url: current_url + "/_api/web/lists/getbytitle('BconeExpenceMaster')/items(" + trackingid + ")",
                async: false,
                method: "GET",
                headers: { "Accept": "application/json; odata=verbose" },
                success: function (data) {
								    var advance = "0.00";
		var Expenseitem="";
		var curreuncyvalue="";
                            if (data.d.AmountTaken != null) {
                                advance = data.d.AmountTaken;
                                if (advance.toString().indexOf(".")) 
								{
                                }
                                else {
                                    advance = advance + ".00";
                                }
                            } 
                  var ExpenseCurrencyText="-";
								if(data.d.ExpenseCurrencyText!=null&&data.d.ExpenseCurrencyText!="")
								{
								ExpenseCurrencyText=data.d.ExpenseCurrencyText;
								
								if (ExpenseCurrencyText.indexOf("-")) {
                                    var curr = ExpenseCurrencyText.split("-");
                                    ExpenseCurrencyText = curr[0];
                                }
								}
if(data.d.currencytext!=null&& data.d.currencytext!='')	
{						
	   Expenseitem = data.d.currencytext;
        if (Expenseitem.indexOf("-")) {
                                    var curr = Expenseitem.split("-");
                                    curreuncyvalue = curr[0];
                                }
                                else {
                                }
}
					var desc="-";
								if(data.d.Description!=null&&data.d.Description!="")
								{
								desc=data.d.Description;
								}					 
				GetExpenseDeatil(data.d.ID,ExpenseCurrencyText);
				document.getElementById("TrackingIdBind").innerHTML=data.d.ExpenseTrackingNo;
				document.getElementById("ProjectNameBind").innerHTML=data.d.Projectname;
				document.getElementById("ExpenseReportNameBind").innerHTML=data.d.ExpenseReportName;
				document.getElementById("AdvanceAmountBind").innerHTML=advance;
				document.getElementById("AdvanceCurrency").innerHTML=curreuncyvalue;
				document.getElementById("Expensecurrency").innerHTML=ExpenseCurrencyText;
				document.getElementById("DescriptionBind").innerHTML= '<a data-toggle="tooltip" title="'+desc+'" style="text-decoration:none;cursor: context-menu;">'+desc+'</a>';
                },
				complete: function(data){
				},
                error: function (data) {
                    failure(data);
                    alert(data.responseJSON.error.message.value);
                }
            });
 		$('.openDetailsMain').show();
		setTimeout(function(){ 
			$('[data-toggle="tooltip"]').tooltip();  
		}, 1000);
 	}

	



	function GetExpenseDeatil(id,ExpenseCurrencyText) 
	{
	//$('[data-toggle="tooltip"]').tooltip(); 
	$('.loader').show();
	var i=1;
	var table1 = $('#innertable').DataTable();
	

$('#innertable').dataTable().fnClearTable();
                var query_cml = '<View><Query><Where><Eq><FieldRef Name="TrackingNo" /><Value Type="Number">' + id + '</Value></Eq></Where><OrderBy><FieldRef Name="ExpenseDate" Ascending="False"/><Value Type="DateTime" IncludeTimeValue="True"></Value></OrderBy></Query></View>';
            $.ajax({
                url: _spPageContextInfo.webAbsoluteUrl + "/_api/Web/Lists/getbytitle('BconeExpenceLogDetail')/GetItems",
                type: "POST",
                headers: {
                    "accept": "application/json;odata=verbose",
                    "X-RequestDigest": $("#__REQUESTDIGEST").val(),
                    "content-Type": "application/json;odata=verbose"
                },
                data: JSON.stringify({
                    query: {
                        __metadata: {
                            type: "SP.CamlQuery"
                        },
                        ViewXml: query_cml
                    }
                }),				
                success: function (data) { 
              // alert(data.d.results.length);				
                    if (data.d.results.length > 0) {
                        $.each(data.d.results, function (key, value) {						
						       // var Expense_item = getcurrencyValueById('BconeItemMaster', value.ExpenceItemId);
								//var payment_type = getcurrencyValueById('BconeItemMaster', value.PaymentTypeId);								
								//var Currency= getcurrencyValueById('BconeCurrency', value.ExpenceCurrencyId);								
								var convert_date1=convert_date_test(value.ExpenseDate);
								//var Expense_item="";
								//var payment_type = "";						
								//var Currency=      "";							
								//var convert_date1= "";
								//var curr_val="";
								//if(Currency.indexOf("-"))
								//{
								//var curr=Currency.split("-");
								//curr_val=curr[0]; 
								//} else {
								//curr_val=Currency;
								//}
								var Expense_item = value.ExpenceItemText;
								var payment_type = value.PaymentTypeText;								
								var Currency=value.ExpenceCurrencyText;								
								
                            var my_var="";
								if (value.Justification==null) {
								var outer="outer";
								//var count=getUploadedFiles_Count(value.ID);
							var count=0;
        if(value.FileUploadedCount!=null)
        {
         count=value.FileUploadedCount;
        }
									if(count>0)
									{									
								my_var="<td class='sorting_1 text-center'><a style='display: inline-block;cursor:pointer;' onclick='openouterfileattach(\""+i+"\"); getUploadedFiles(\"" + value.ID+ "\",\""+outer+"\");'> <i class='fa fa-paperclip' style='color:#5cb85c;font-size: 16px;' ></i></a></td>";
                                   }
									else
									{
									my_var="<td class='sorting_1 text-center'></td>";
									}								
								var ss = 'https://bristleconeonline.sharepoint.com/sites/pwa/BconeBillAttachment/' + value.BillAttachment;
								}
								else {
								my_var="<td class='sorting_1 text-center'><a  name="+value.Justification+" data-toggle='tooltip' title="+value.Justification+" style='text-decoration:none;cursor: context-menu;'   ><i  class='fa fa-commenting' style='color:#333;font-size: 16px;'  ></i></a></td>";
								}	
                                 var ExpenseNote="-";
                                 if(value.ExpenseNote!=null&&value.ExpenseNote!="")
                                 {
								   ExpenseNote=value.ExpenseNote;
                                 }
								 
								 var FinalExpenseValue="0.00";
								if (value.FinalExpenseValue != null) {
                                FinalExpenseValue = value.FinalExpenseValue;
                                if (FinalExpenseValue.toString().indexOf(".")) {
								
								FinalExpenseValue=parseFloat(FinalExpenseValue).toFixed(2);
                                }
                                else {
                                    FinalExpenseValue = FinalExpenseValue + ".00";

                                }
                              }
							   var ExpensceAmount="0.00";
								if (value.ExpensceAmount != null) {
                                ExpensceAmount = value.ExpensceAmount;
                                if (ExpensceAmount.toString().indexOf(".")) {
								
								ExpensceAmount=parseFloat(ExpensceAmount).toFixed(2);
                                }
                                else {
                                    ExpensceAmount = ExpensceAmount + ".00";

                                }
                              }
                table1.row.add([ 
                                my_var,
                                "<td>"+i+"</td>",
								"<td>"+value.TaskName+"</td>",
								"<td>"+Expense_item+"</td>",
								'<a  data-toggle="tooltip" title="'+ExpenseNote+'" style="text-decoration:none;cursor: context-menu;">'+ExpenseNote+'</a>',
								"<td>"+value.Status +"</td>",
								"<td style='text-align:right;'><div style='text-align: right;'>" + FinalExpenseValue + "<span style='color: #ababab;margin-left: 6px;'>"+ ExpenseCurrencyText +"</span></div></td>",
								
								"<td style='text-align:right;'><div style='text-align: right;'>" + ExpensceAmount + "<span style='color: #ababab;margin-left: 6px;'>"+ Currency +"</span></div></td>",
				
								"<td>"+payment_type+"</td>",
								"<td>"+convert_date1+"</td>",
								"<td>"+value.BliableToClient+"</td>"  
								]).draw();; 
								i++;
                        });						
						$('.loader').hide();
                    }
                    else {
					$('.loader').hide();
                    }
                },
                error: function (data) {
                    alert(data.responseJSON.error.message.value);
                    failure(data);
                }
            });
        }
		function closedetails(){
 		$('.openDetailsMain').hide();
 	}
		   function openouterfileattach(reff_no){
 $('#reff_no').text('Ref No. '+reff_no);
  $('#openouterfileattach').show({ width: 'toggle'});
 }
function closeouterfileattach(){
  $('#openouterfileattach').hide({ width: 'toggle'});
 }
 function getUploadedFiles(ExpenseItemId,type){       
           var docurl = "/sites/Dev/BconeBillAttachment/1234";
        $().SPServices({                                          //Query Raised Documents
            operation: "GetListItems",
            async: false,
            listName: "BconeBillAttachment",
            CAMLQuery: "<Query><Where><Eq><FieldRef Name='ExpenseItemId'/><Value Type='Text'>"+ExpenseItemId+"</Value></Eq></Where><OrderBy><FieldRef Name='Modified' Ascending='False' /></OrderBy></Query>",
            CAMLViewFields: "<ViewFields><FieldRef Name='FileLeafRef' /><FieldRef Name='EncodedAbsUrl' /></ViewFields>",
            CAMLQueryOptions: "<QueryOptions><ViewAttributes Scope='RecursiveAll'/></QueryOptions>",
            completefunc: function (xData, Status) {
   if(type=='inner')
   {
   var file_ids='';
   $('#delete_file_ids').text('');
                raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
                var temp = $(this).attr("ows_Created_x0020_Date");
                var temp2 = $(this).attr("ows_Last_x0020_Modified");
    var ID = '';
                $(".raisedDocumnts").remove();
    $("#uploaded_files").empty();
    var upload_file_id=0;
    var remove_id='';
                $(xData.responseXML).SPFilterNode("z:row").each(function () {
    upload_file_id++;
    remove_id='remove'+upload_file_id;
    ID=$(this).attr("ows_ID");
    if(file_ids=='')
    {
    file_ids=ID;
    }
    else
    {
    file_ids=file_ids+","+ID;
    }
    var href=$(this).attr("ows_EncodedAbsUrl");
  var file_html="<tr id="+remove_id+"><td>"+$(this).attr('ows_FileLeafRef').split('#')[1]+"</td>";
     file_html=file_html+"<td class='text-center' style='width:30px;'><a href="+href+" download ><i class='fa fa-download'></i></a></td>";
      file_html=file_html+"<td class='text-center' style='width:30px;'><a onclick='delete_file_temp(\""+remove_id+"\",\""+ID+"\")' href='javascript:void(0)'><i class='fa fa-trash-o'></i></a></td>";
    file_html=file_html+" </tr>";
                    var liHtml = "<li class='raisedDocumnts'><a href=" + $(this).attr("ows_EncodedAbsUrl") + ">" + $(this).attr("ows_FileLeafRef").split('#')[1] + "</a></li>";
                    $("#uploaded_files").append(file_html);
                    currentQuery = $(this).attr("ows_FileLeafRef").split('#')[1];
                });
    $('#delete_file_ids').text(file_ids);
    $('#uploaded_file_count').text(raisedDocument);
                if (raisedDocument > 0) {
     $('#outer-popup-a').show();
                } else {
    var file_html="<tr><td colspan='3' style='text-align:center'>No file found</td>";
    file_html=file_html+" </tr>";
     $("#uploaded_files").append(file_html);
     $('#outer-popup-a').hide();
                }
            }
   else if(type=='outer')
   {   
                raisedDocument = $(xData.responseXML).SPFilterNode("rs:data").attr("ItemCount");
                var temp = $(this).attr("ows_Created_x0020_Date");
                var temp2 = $(this).attr("ows_Last_x0020_Modified");
    var ID = '';
                $(".raisedDocumnts").remove();
    $("#inner_tbody").empty();
    var upload_file_id=0;
    var remove_id='';
                $(xData.responseXML).SPFilterNode("z:row").each(function () {
    upload_file_id++;
    remove_id='remove'+upload_file_id;
    ID=$(this).attr("ows_ID");
    var href=$(this).attr("ows_EncodedAbsUrl");
  var file_html="<tr id="+remove_id+"><td>"+$(this).attr('ows_FileLeafRef').split('#')[1]+"</td>";
     file_html=file_html+"<td class='text-center' style='width:30px;'><a href="+href+" download ><i class='fa fa-download'></i></a></td>";
    file_html=file_html+" </tr>";
                    var liHtml = "<li class='raisedDocumnts'><a href=" + $(this).attr("ows_EncodedAbsUrl") + ">" + $(this).attr("ows_FileLeafRef").split('#')[1] + "</a></li>";
                    $("#inner_tbody").append(file_html);
      console.log(liHtml);
                    currentQuery = $(this).attr("ows_FileLeafRef").split('#')[1];
                });
    $('#uploaded_file_count').text(raisedDocument);
                if (raisedDocument > 0) {
                } else {
    var file_html="<tr><td colspan='3' style='text-align:center'>No file found</td>";
    file_html=file_html+" </tr>";
     $("#inner_tbody").append(file_html);
                }
   }
   }
        });
          }
$(document).ready(function(){
		
         //alert("TESR");				
	
});
    </script>
</body>
</html>
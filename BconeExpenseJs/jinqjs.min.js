var jinqJs=function(n){"use strict";var o=[],v=[],h=[],c=!1,g=!1,s=null,f=!1,e=0,r=1,l=2,i=3,u=4,a=5,d=6,p=7,y=8,m={};jinqJs.settings=jinqJs.settings||{},jinqJs.settings=void 0!==n?n:{includeIdentity:jinqJs.settings.includeIdentity||!1};var J=function(n){return void 0===n||0===n.length},b=function(n){return w(n,"length")&&!j(n)&&!O(n)},N=function(n){return null!==n&&(n.constructor===Object||b(n))},j=function(n){return null!==n&&n.constructor===String},w=function(n,t){return void 0!==n[t]},O=function(n){return"function"==typeof n},q=function(n){return"number"==typeof n},x=function(n,t,e){for(var r=0;r<n.length;r++)if(n[r][t]===e)return!0;return!1},k=function(n,t,e){var r=null,l=!1,i=[],u=!1;e=e||!1;for(var s=0;s<n.length;s++){for(var f in l=!1,t){if(r=n[s],!(u=N(r))&&r!=t[f]||u&&r[f]!=t[f]){l=!1;break}l=!0}if(l){if(e)return r;i.push(r)}}return 0===i.length?null:i},V=function(n,t){for(var e={},r=null,l=0;l<t.length;l++)r=t[l],w(n,r)?e[r]=n[r]:e[r]=0;return e},F=function(n,t){for(var e=[],r=null,l=null,i=null,u=0;u<v.length;u++)if(r=V(v[u],h),l=V(v[u],n),null===(i=k(e,r,!0))){for(var s in i={},r)i[s]=r[s];for(var f in l)i[f]=t(i[f],l[f],JSON.stringify(r)+f);e.push(i)}else for(var a in l)i[a]=t(i[a],v[u][a],JSON.stringify(r)+a);return h=[],e},S=function(n){switch(n.length){case 1:return n[0].concat();case 2:return[].concat(n[0],n[1]);case 3:return[].concat(n[0],n[1],n[2]);case 4:return[].concat(n[0],n[1],n[2],n[3]);case 5:return[].concat(n[0],n[1],n[2],n[3],n[4]);default:for(var t=[],e=0;e<n.length;e++)t=t.concat(n[e]);return t}},A=function(n){for(var t={},e=0;e<n.length;e++)for(var r in n[e])t[r]=n[e][r];return t},I=function(n){var t={};for(var e in n)t[e]="";return t},E=function(n){switch(n){case"<":return e;case">":return l;case"!=":return d;case"!==":return p;case"=":case"==":return u;case"===":return a;case"<=":return r;case">=":return i;case"*":return y;default:throw"Invalid Expression!"}},T=function(n){var t=[];for(var e in n)t.push({field:e});return t},t=function(n,t){if(0===t.length)return this;(o=[]).func=n;for(var e=0;e<t.length;e++)0<t[e].length&&o.push(t[e])},B=function(r,n,l){require("http").get(n,function(n){var e="";n.on("data",function(n){e+=n}),n.on("end",function(){var n=JSON.parse(e),t=null;t=b(n)?n:new Array(n),o.push(t),v=t,O(l)&&l(r)})})},C=function(t,n,e){var r=new XMLHttpRequest,l=null;if(O(e)&&(r.onreadystatechange=function(){if(0!==r.response.length){var n=JSON.parse(r.response);l=b(n)?n:new Array(n),o.push(l),v=l,e(t)}}),r.open("GET",n,O(e)),r.send(),!O(e)){var i=JSON.parse(r.response);l=b(i)?i:new Array(i),o.push(l)}},M=function(n){for(var t=/([^\s]+)\s(<|>|!=|!==|=|==|===|<=|>=|\*)\s(.+)/,e=n.length,r=new Array(e),l=0;l<e;l++){var i=n[l].match(t);if(4!==i.length)throw"Invalid expression!";r[l]={lField:i[1],operator:E(i[2]),rValue:i[3]}}return r},_=function(n,t){switch(t.operator){case a:return n[t.lField]===t.rValue;case p:return n[t.lField]!==t.rValue;case e:return n[t.lField]<t.rValue;case l:return n[t.lField]>t.rValue;case d:return n[t.lField]!=t.rValue;case u:return n[t.lField]==t.rValue;case r:return n[t.lField]<=t.rValue;case i:return n[t.lField]>=t.rValue;case y:return-1<n[t.lField].indexOf(t.rValue);default:return!1}},D=function(){o.func=null;for(var n=0;n<arguments.length;n++)v=v.concat(arguments[n]);return this},G=function(n){var t=0;return t=-1<n&&n<1?v.length*n:n,v=n<0?v.slice(t,v.length- -1*Math.abs(t)):v.slice(0,t),this},H=function(n){var t,e=[],r=!1,l=arguments.length,i=v.length,u=null,s=null;if(void 0===n)return this;(t=O(n))||(u=M(arguments));for(var f=0;f<i;f++)if(s=v[f],t)n(s,f)&&e.push(s);else{for(var a=0;a<l&&(r=_(s,u[a]));a++);r&&e.push(s)}return v=e,this},L=function(){var n=[],t=null,e=null,r=0,l=v.length,i=0,u=!1;if(0===arguments.length)if(N(v[0]))for(r=0;r<l;r++){u=!1;for(var s=0;s<i;s++)if(v[r]===n[s]){u=!0;break}u||(n[i++]=v[r])}else{var f={};for(r=0;r!==l;r++)1!==f[t=v[r]]&&(f[t]=1,n[n.length]=t)}else{var a=arguments;for(Array.isArray(arguments[0])&&(a=arguments[0]),r=0;r<l;r++){t=V(v[r],a);for(var o=0;o<a.length;o++)if(e=a[o],!x(n,e,t[e])){n.push(t);break}}}return v=n,this},P=function(){var l={};return v=F(arguments,function(n,t,e){var r=JSON.stringify(e);return w(l,r)||(l[r]=0),++l[r]}),this},R=function(){var n=1,t=0===arguments.length?"ID":arguments[0],e=0<v.length&&!N(v[0]),r=[],l=null;g=!0;for(var i=0;i<v.length;i++)e?((l={})[t]=n++,l.Value=v[i],r.push(l)):v[i][t]=n++;return e&&(v=r),this};this.from=function(){var n=null,t=null;if(0===arguments.length)return this;v=[];for(var e=0;e<arguments.length;e++)if(null!==arguments[e]&&0!==arguments[e].length){if(2==arguments.length&&O(arguments[1]))n=arguments[0],t=arguments[1],e=arguments.length;else if(n=arguments[e],O(n))continue;j(n)?"undefined"==typeof module||void 0===module.exports?C(this,n,t):B(this,n,t):o.push(n)}return o.func="from",v=S(o),O(t)?t:this},this.select=function(){var n=null,t=!1,e=!1,r=null;if(J(v))return[];var l,i=null,u=null,s=null,f=null;if(jinqJs.settings.includeIdentity&&!g&&R(),J(arguments))return v;if(r=new Array(v.length),b(arguments[0])){n=arguments[0],t=!0,f=new Array(n.length);for(var a=0;a<n.length;a++)f[a]={hasField:w(n[a],"field"),hasText:w(n[a],"text"),hasValue:w(n[a],"value")}}else O(arguments[0])?(n=arguments[0],e=!0):n=arguments;l=!N(v[0]);for(var o=0;o<v.length;o++)if(e)r[o]=n(v[o],o);else{i={};for(var h=0;h<n.length;h++)t?(f[h].hasField&&(u=q(n[h].field)?Object.keys(v[o])[n[h].field]:n[h].field),s=f[h].hasText?n[h].text:n[h].field):s=u=n[h],t&&f[h].hasValue?O(n[h].value)?i[s]=n[h].value(v[o]):i[s]=n[h].value:i[s]=l?v[o]:0===v[o][u]?0:v[o][u]||null;r[o]=i}return r},this.update=function(n){if(f)throw"A pending delete operation exists!";return void 0!==n&&O(n)&&(s=n),this},this.top=G,this.bottom=function(n){return G(-1*n),this},this.where=H,this.distinct=L,this.groupBy=function(){return h=arguments,this},this.sum=function(){var l={};if(0===h.length){for(var n=l=0;n<v.length;n++)l+=0===arguments.length?v[n]:v[n][arguments[0]];v=[l]}else v=F(arguments,function(n,t,e){var r=e;return w(l,r)||(l[r]=0),l[r]+=t});return this},this.count=P,this.min=function(){var l={},n=0;if(0===h.length){l=-1;for(var t=0;t<v.length;t++)n=0===arguments.length?Number(v[t]):Number(v[t][arguments[0]]),l=n<l||-1===l?n:l;v=[l]}else v=F(arguments,function(n,t,e){var r=JSON.stringify(e);return w(l,r)||(l[r]=0),(0===l[r]||t<l[r])&&(l[r]=t),l[r]});return this},this.max=function(){var l={},n=0;if(0===h.length){l=-1;for(var t=0;t<v.length;t++)n=0===arguments.length?Number(v[t]):Number(v[t][arguments[0]]),l=l<n||-1===l?n:l;v=[l]}else v=F(arguments,function(n,t,e){var r=JSON.stringify(e);return w(l,r)||(l[r]=0),t>l[r]&&(l[r]=t),l[r]});return this},this.avg=function(){var l={};if(0===h.length){for(var n=l=0;n<v.length;n++)l+=0===arguments.length?v[n]:v[n][arguments[0]];v=[l/v.length]}else v=F(arguments,function(n,t,e){var r=JSON.stringify(e);return w(l,r)||(l[r]={count:0,sum:0}),l[r].count++,l[r].sum+=t,l[r].sum/l[r].count});return this},this.identity=R,this.orderBy=function(){var l=arguments;return 0<arguments.length&&b(arguments[0])?function(n){for(var t=null,u=null,s=null,f=null,a=null,o=null,h=null,c=1,g=!1,e=0;e<n.length;e++)u=0<e?n[e-1]:null,t=n[e],s=w(t,"field")?t.field:null,c=w(t,"sort")&&"desc"===t.sort?-1:1,g=null!==s&&!isNaN(s),v.sort(function(n,t){var e,r=!1,l=!1,i=null;if(g?(f=Object.keys(n)[s],a=Object.keys(t)[s],null!==u&&(o=Object.keys(n)[u.field],h=Object.keys(t)[u.field])):(f=a=s,null!==u&&(o=h=u.field)),i=null===s?n:isNaN(n[f])?n[f]:Number(n[f]),e=null===s?t:isNaN(t[a])?t[a]:Number(t[a]),j(i)&&j(e))switch(i.localeCompare(e)){case-1:r=!0;break;case 1:l=!0}else r=i<e,l=e<i;return!r||null!==u&&null!==s&&n[o]!=t[h]?!l||null!==u&&null!==s&&n[o]!=t[h]?0:1*c:-1*c})}(arguments[0]):v.sort(function(n,t){var e=JSON.stringify(V(n,l)),r=JSON.stringify(V(t,l));return e.localeCompare(r)}),this},this.on=function(){return 0!==arguments.length&&w(o,"func")&&(function(n,e){var r=null,l=[],i=null,t=[],u=1;if(b(e)&&0!==e.length&&0!==o.length){switch(n){case"from":if(1===o.length)return v=o[0];t=o[0];break;case"full":case"inner":case"left":t=v,u=0;break;default:return}for(var s=u;s<o.length;s++){if(l=[],t.forEach(function(t){O(e[0])?(i=[],o[s].forEach(function(n){e[0](t,n)&&i.push(n)}),0===i.length&&(i=null)):(r=V(t,e),i=k(o[s],r)),null!==i?j(i[0])?l.push(t):i.forEach(function(n){l.push(A([n,t]))}):"left"!==n&&"full"!==n||(0<o[s].length&&(r=I(o[s][0]),r=A([r,t])),l.push(A([t,r])))}),"full"===n){var f=null;O(e[0])&&(f=e[0],e[0]=function(n,t){f(t,n)});var a=(new jinqJs).from(o[s]).not().in(l,e).select(T(l[0]));l=l.concat(a),f&&(e[0]=f,f=null)}t=l}o=[],v=l}}(o.func,arguments),o.func=null),this},this.join=function(){return t("inner",arguments),this},this.leftJoin=function(){return t("left",arguments),this},this.fullJoin=function(){return t("full",arguments),this},this.concat=D,this.union=function(){if(0===arguments.length||!b(arguments[0])||0===arguments[0].length)return this;if(N(arguments[0][0])){var n=S(arguments);for(var t in D(n),h=[],arguments[0][0])h.push(t);P()}else{for(var e=0;e<arguments.length;e++)D(arguments[e]);L()}return this},this.not=function(){return c=!0,this},this.in=function(){var n,t=[],e=[],r=null;if(0===arguments.length)return this;if(0===(n=arguments[0]).length||0===v.length)return this;var l=!N(n[0]),i=!N(v[0]);if((!l||!i)&&arguments.length<2)throw"Invalid field or missing field!";if(arguments.length<2)e=[0];else if(b(arguments[1])&&O(arguments[1][0]))r=arguments[1][0];else if(b(arguments[1]))e=arguments[1];else for(var u=1;u<arguments.length;u++)e.push(arguments[u]);for(var s=0,f=0;f<v.length;f++){for(var a=0;a<n.length;a++)if(r){if(r(v[f],n[a]))break}else{for(var o=s=0;o<e.length;o++)(i?v[f]:v[f][e[o]])===(l?n[a]:n[a][e[o]])&&s++;if(s===e.length)break}(a<n.length&&!c||a===n.length&&c)&&t.push(v[f])}return c=!1,v=t,this},this.skip=function(){var n=0;if(0===arguments.length||!q(arguments[0]))return this;var t=arguments[0];return n=-1<t&&arguments[0]<1?v.length*t:t,v=v.slice(n),this},this.filter=H,this.at=function(){var n=v.length,t=null,e=!1,r=!1,l=arguments.length;if(null===s&&!f||0===n)return this;if(f&&0===l)return v=[],o=[],s=null,f=!1,this;0<l&&((e=O(arguments[0]))||(t=M(arguments)));for(var i=n-1;-1<i;i--)if(e)arguments[0](v,i)&&(f?v.splice(i,1):s(v,i));else if(0===l)f?v.splice(i,1):s(v,i);else{for(var u=0;u<l&&(r=_(v[i],t[u]));u++);r&&(f?v.splice(i,1):s(v,i))}return s=null,f=!1,this},this.delete=function(){if(null!==s)throw"A pending update operation exists!";return f=!0,this},this._x=function(n,t,e){return m[n]=m[n]||{},e.call(this,v,t,m[n])}};!function(){"use strict";jinqJs.addPlugin=function(n,t){jinqJs.prototype[n]=function(){return this._x(n,arguments,t)}},"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=jinqJs),"undefined"!=typeof angular&&angular.module("angular-jinqjs",[]).service("$jinqJs",function(){return new jinqJs})}();
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head id="Head1" runat="server">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="stylesheet" href="../SiteAssets/BconeExpenseCss/jquery-ui.css" />
   
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jquery.min.js"></script>
    <script type="text/javascript" src="../SiteAssets/BconeExpenseJs/jqueryui.js"></script>
    <script type="text/javascript" src="../SiteAssets/js/jquery.sumoselect.js"></script>
    <link rel="stylesheet" href="../SiteAssets/BconeExpenseCss/sumoselect1.css">
    <script type="text/javascript" src="../SiteAssets/js/jquery.sumoselect.js"></script>
    <script src="../SiteAssets/Timesheet/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../SiteAssets/Timesheet/css/bootstrap.min.css">
    <link rel="stylesheet" href="../SiteAssets/Timesheet/css/stylesheet.css">
    <link rel="stylesheet" href="../SiteAssets/Timesheet/css/font-awesome.min.css">
	<link rel="stylesheet" href="../SiteAssets/Timesheet/css/sumoselect.css">
	<script type="text/javascript" src="../SiteAssets/Timesheet/js/jquery.sumoselect.min.js"></script>
	
    <style type="text/css">
	#DeltaTopNavigation{	
    display: none;

}
        .SumoSelect {width: 100% !important;}
		body {font-family: Verdana,Arial,sans-serif !important;color: #444;font-size: 13px;}
        p, div, ul, li {padding: 0px;margin: 0px;}
        .txt { display: inline-block; position: relative;outline: none;width: 160px;height: 24px;border-radius: 2px;border: 1px solid #CCC;}
        input[type=text] {color: #555 !important;}
        .combo {
            /* width: 100%;
            height: 28px;
            border-radius: 2px;
            border: 1px solid #CCC;*/
        }
        #s4-titlerow {height: 40px !important;}
        #myModal .modal-body table tr td .form-control { outline: none; width: 100%; border-radius: 0; box-shadow: none; padding: 5px !important; }
		.form-table { width: 100%; }

            .form-table tr td {
                padding: 5px;
                /*width: 25%;*/
            }
		.form-control {border-radius: 0px;border-color: #ccc !important;}
		.SumoSelect { border-radius: 0px; border-color: #ccc !important; }
		.SumoSelect > .CaptionCont { border-radius: 0px; border-color: #ccc !important; }
		.SumoSelect > .optWrapper > .options li.opt label { font-weight: normal; }
		.SumoSelect .select-all { padding: 6px 0 4px 35px; height: auto; }
		.SumoSelect .select-all label { font-weight: normal; }
        .ui-datepicker-calendar thead tr th { background: #00b0f0; color: #fff; }
        .SumoSelect > .CaptionCont > span.placeholder { font-style: normal; }
        table.ms-core-tableNoSpace { display: table !important; width: 100%; }
        .right-icon { cursor: pointer !important;}
        img.ui-datepicker-trigger { position: absolute; top: 27px;right: 8px; z-index: 9;cursor: pointer !important; }
        .clear {clear: both; }
        .SelectBox { padding: 6px 8px; }
		select[multiple], select[size]{height: auto;z-index: -1;}
		
		img.ui-datepicker-trigger {right: 12px;	}
		#SelectProject .multiple{width:300px !important}
    </style>
</head>
<body>
    <div class="form-table" id="tblTimesheetDump" style="display: none">
        <div class="container-fluid">
            <div class="breadcrumb-main" style="margin-top: 15px;">
                <div class="container-fluid">
                    <ul>
                        <li>
                            <a href="../default.aspx">Home</a>
                        </li>
                        <li>Timesheet Dump Report
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="form-table" id="Div1">
                <div style="width: 19%; float: left; margin-right: 10px;">
                    Report Type
                    <br>

                    <select id="reporttype" style="width: 100% !important;" name="somename" class="selectbox4"  onchange="changeReportType()">
                        <option value="Select" selected>Select</option>
                        <option value="No">Timesheet Dump</option>
                        <option value="Yes">Utilization Report</option>
                        <option value="TimeSheetMissing">Timesheet Missing</option>
                        <option value="TimeSheetDelay">Timesheet Delay</option>
                        <option value="TimeSheetConsolidated">TimeSheet Missing/Consolidated</option>
						<option value="Defaulter_Report">Defaulter Report</option>
						<option value="TS_Missing_Details">Timesheet Missing Details</option>
						<!-- <option value="Delay_Missing_Mix_Timesheet_Report">Delay Missing Mix Timesheet Report</option> -->
			        </select>
                </div>
                <div style="width: 150px; display: none; position: relative; margin-right: 5px; float: left" id="TimesheetMissingMonth1">
                    Month<br>
                    <input type="text" id="TimesheetMissingMonth" class="form-control">
                  
                </div>
                 <div style="width: 150px; display: none; position: relative; margin-right: 5px; float: left" id="TimesheetDelaygMonth1">
                    Month<br>
                    <input type="text" id="TimesheetDelaygMonth" class="form-control">
                   
                </div>

            </div>
            <div style="display: none; position: relative; margin-right: 5px; float: left" id="DeligateFromDate1">
                TS From Date
                        <br>
                <input type="text" id="DeligateFromDate" class="form-control"  style="width:130px">
             
            </div>
            <div style=" position: relative; display: none; margin-right: 5px; float: left" id="DeligateToDate1">
                TS To Date
                        <br>
                <input type="text" id="DeligateToDate" class="form-control"  style="width:130px">
          
            </div>
           <div style="width: 250px; display: none; position: relative; margin-right: 5px; float: left" id="selCountry1">
                Country Legal   
                        <br>
                <select id="selCountry" name="selCountry" multiple="multiple" class="search-Country" style="width: 100% !important;">
                </select>
            </div>
            <div style="width: 150px; display: none; position: relative; margin-right: 5px; float: left" id="selStatus1">
                TS Status
                        <br>
                <select id="selStatus" name="selStatus" multiple="multiple" class="search-Status" style="width: 100% !important;">
                    <option >All</option>
					<option >APPROVED</option>
                    <option >OPEN</option>
					 <option >REJECTED</option>
                    <option >SUBMITTED</option>
                  </select>
            </div>
            <div style="width: 150px; float: left; margin-right: 5px; display: none;" id="sel_Periods">
                Periods
                    <br>
			
                 <select id="ddlSelectePeriods" style="width: 100% !important;" name="somename"  class="form-control"> 
                 </select> 
            </div>
			 <div style="width: 250px; float: left; margin-right: 5px; display: none;    " id="sel_Projects">
                Project Type
                    <br>
			
                 <select id="selProjects" name="selProjects" multiple="multiple" class="search-Project" style="width: 100% !important;"> 
                 </select> 
            </div>
			<br>
			<div style="width: 350px; float: left; margin-right: 5px; display: none;margin-top: 15px;" id="sel_Projects_name">
                Project Name (Max 10 can be selected)
                    <br>
			
                 <select id="selProjectsName" name="selProjectsName" multiple="multiple" style="width: 250px !important;" class="search_Project_name"> 
                 </select> 
            </div>
            <br />
            <div class="clear"></div>
            <span>&nbsp;</span><br>
            <!-- <input type="button" value="Generate"  name="btnGenrate"/>    -->
            <a href="javascript:void(0)" class="blue-btn" name="btnGenrate"><i class="fa fa-sticky-note"></i>Generate Report</a>
            <!-- <input type="button" value="Clear"  name="btnClear"/> -->
            <a href="javascript:void(0)" class="blue-btn" name="btnClear"><i class="fa fa-remove"></i>Clear</a><br>
            <span id="" style="color: red"></span>

            <div id="errMessage" class="alert-main" style="display: none;">
                <div class="black-bg" id="backcolor">
                    <div class="popup-main">
                        <div class="popup-heading"><span id="Alert_msg">Please Select At-least One Expense To Reset</span></div>
                        <div class="pop-mid">
                            <p id="submitValue"></p>
                            <input type="Button" class="divnewbtn" value="OK" id="ok_click1" onclick="close_div('')">
                        </div>
                    </div>
                </div>
            </div>
            <div class="loader" style="display: none;"></div>
            <div id="TimeSheetConsolidated" style="display: none;">
                <h3></h3>
            </div>
            <iframe id="rptTimesheet" height="580px" width="100%"></iframe>
        </div>

    </div>

    <script>
	
		var date = new Date();
		var datetxt = new Date();
		var firstDayTxt = new Date(datetxt.getFullYear(), datetxt.getMonth(), 1);
		var lastDaytxt = new Date(datetxt.getFullYear(), datetxt.getMonth() + 1, 0);
		var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        var selectedFromYear, selectedFromMonth, selectedToYear, selectedToMonth, CountryName, selectedMissingMonth, selectedMissingYear, selectedDelayMonth, selectedDelayYear;
        $(document).ready(function () 
		{
            window.asd = $('.SlectBox').SumoSelect({ csvDispCount: 2, captionFormatAllSelected: "Yeah, OK, so everything." });
            window.test = $('.testsel').SumoSelect({ okCancelInMulti: true, captionFormatAllSelected: "Yeah, OK, so everything." });
            window.testSelAll = $('.testSelAll').SumoSelect({ okCancelInMulti: true, selectAll: true });
            window.testSelAlld = $('.SlectBox-grp').SumoSelect({ okCancelInMulti: true, selectAll: true });
            window.testSelAll2 = $('.testSelAll2').SumoSelect({ csvDispCount: 2, search: true, searchText: 'Enter here.' });
            window.Search = $('.search-box').SumoSelect({ csvDispCount: 2, search: true, searchText: 'Enter here.', selectAll: true });
			window.searchSelAll = $('.search-box-sel-all').SumoSelect({ csvDispCount: 2, selectAll: true, search: true, searchText: 'Enter here.', okCancelInMulti: true });
            window.searchSelAll = $('.search-box-open-up').SumoSelect({ csvDispCount: 2, selectAll: true, search: false, searchText: 'Enter here.', up: true });
            window.groups_eg_g = $('.groups_eg_g').SumoSelect({ selectAll: true, search: true });
			
			GetProjectTypeData();
			
			$('.search-Status').SumoSelect({search: true, searchText: 'Search Status'});
          	$('#selStatus')[0].sumo.selectItem(0); //default select first option
			$('#selStatus option').each(function(e){if(e != 0){$('#selStatus')[0].sumo.disableItem(e)}});
			$(".sumo_selStatus li").bind('click', function(event, ui) 
			{
				if($(this).find('label').text().trim() == "All")
				{
					if($(this).is(".selected"))
					{
						$('#selStatus option').each(function(e){if(e != 0){$('#selStatus')[0].sumo.disableItem(e)}});									
					}
					else
					{
						$('#selStatus option').each(function(e){$('#selStatus')[0].sumo.enableItem(e)});
					}
				}
				else
				{
					$(".sumo_selStatus li").each(function(e){
						if(!$(this).is(".selected"))
						{
							$('#selStatus')[0].sumo.enableItem(e)
						}
					})
				}
				if($(".sumo_selStatus li.selected").length > 10)
				{
					$('#selStatus')[0].sumo.unSelectItem($(this).index());
					$('#Alert_msg').html("you can't select more than 10 projects");
					$("#errMessage").css("display", "block");
				}
			})
			
		});
        function getFormate(Date)
		{
            var year = Date.getFullYear();
            var month = Date.getMonth();
            var day = Date.getDate();
            return parseInt(month) + 1 + "/" + day + "/" + year;
        }
		
        var url = "";
        var requestData;
        var Email = "";
        function getUser()
		{
            var userid = _spPageContextInfo.userId;
            var requestUri = _spPageContextInfo.webAbsoluteUrl + "/_api/web/getuserbyid(" + userid + ")";
            var requestHeaders = { "accept": "application/json;odata=verbose" };
            $.ajax({
                url: requestUri,
                contentType: "application/json;odata=verbose",
                headers: requestHeaders,
                success: onSuccess,
                error: onError,
                async: false
            }); function onSuccess(data, request) {

                var loginName = data.d.Title;
                Email = data.d.Email
                $('#login_name_contain').html(loginName)
                //alert(Email);
            } function onError(error) {
                alert("Error on retrieving current user.");
            }
        }
        $(function ()
		{
			$('.selectbox4').SumoSelect({search: true, searchText: 'Search Report Type'});
            $('.selectbox4').SumoSelect();
            getUser();
            bindProjectData();
            var date = new Date();
            var firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            var lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            $("#DeligateFromDate").datepicker({
                dateFormat: 'dd-M-yy',
                changeMonth: true,
                buttonImage: "../SiteAssets/BconeExpenseImg/calendar.png",
                showOn: "both",
                buttonImageOnly: true,
                changeYear: true,
                onSelect: function (selected)
				{
					$("#DeligateToDate").datepicker("option", "minDate", selected);
					var date = $(this).datepicker('getDate'),
					day = date.getDate(),
					month = date.getMonth() + 1,
					year = date.getFullYear();
					selectedFromYear = month + '/' + day + '/' + year;
                }
            }).datepicker('setDate', firstDay);

            $("#DeligateToDate").datepicker({
                //dateFormat: 'yy-mm-dd',
                dateFormat: 'dd-M-yy',
                buttonImage: "../SiteAssets/BconeExpenseImg/calendar.png",
                showOn: "both",
                buttonImageOnly: true,
                changeMonth: true,
                changeYear: true,
                onSelect: function (selected) 
				{
					$("#DeligateFromDate").datepicker("option", "maxDate", selected)
					var date = $(this).datepicker('getDate'),
					day = date.getDate(),
					month = date.getMonth() + 1,
					year = date.getFullYear();
					selectedToYear = month + '/' + day + '/' + year;
                }
            }).datepicker('setDate', lastDay);

            $("#TimesheetMissingMonth").datepicker({
                dateFormat: 'M-y',
                changeMonth: true,
                buttonImage: "../SiteAssets/BconeExpenseImg/calendar.png",
                showOn: "both",
                buttonImageOnly: true,
                changeYear: true,
                onSelect: function (selected) {
                    //$("#DeligateToDate").datepicker("option", "minDate", selected);
                    var array = selected.split("-");
                    var months = {'Jan': '1','Feb': '2','Mar': '3','Apr': '4','May': '5','Jun': '6','Jul': '7','Aug': '8','Sep': '9','Oct': '10','Nov': '11','Dec': '12'}
                    var date = $(this).datepicker('getDate'),
					day = date.getDate(),
					month = date.getMonth() + 1,
					year = date.getFullYear();
					// selectedMissingMonth = month + '/' + year;
					selectedMissingMonth = month;
					selectedMissingYear = year;
                }
            }).datepicker('setDate', firstDay);

            selectedToYear = getFormate(lastDay)
            selectedFromYear = getFormate(firstDay)

            $("#TimesheetDelaygMonth").datepicker
			({
                dateFormat: 'M-y',
                changeMonth: true,
                buttonImage: "../SiteAssets/BconeExpenseImg/calendar.png",
                showOn: "both",
                buttonImageOnly: true,
                changeYear: true,
                onSelect: function (selected) 
				{
                    var array = selected.split("-");
                    var months = {'Jan': '1','Feb': '2','Mar': '3','Apr': '4','May': '5','Jun': '6','Jul': '7','Aug': '8','Sep': '9','Oct': '10','Nov': '11','Dec': '12'}
                    var monthNumber = months[array[0]];
					var date = $(this).datepicker('getDate'),
					day = date.getDate(),
					month = date.getMonth() + 1,
					year = date.getFullYear();
					selectedDelayMonth = month;
					selectedDelayYear = year;
                    bindPeriods(year, monthNumber, day);
                }
            }).datepicker('setDate', firstDay);;
            bindPeriods($('.ui-datepicker-year').val(), parseFloat($('.ui-datepicker-month').val()) + 1, 1);
        });


        function bindPeriods(year, month, day) 
		{
			var url = "https://ppmprod.bcone.com/api/bconeReport/GetAllPeriodByMonth";
            requestData = {
                "Date": year + "-" + month + "-" + day,
            };
            $('#ddlSelectePeriods').find('option').remove().end().append('<option value="Select" selected>Select</option>');
            $.ajax({
                url: url,
                async: false,
                type: "POST",
                dataType: "json",
                data: requestData,
                success: function (res) 
				{
                    var a = res;
                    var len = res.Data.length;
                    for (var i = 0; i < len ; i++)
					{
                        $('#ddlSelectePeriods').append('<option  value="' + res.Data[i].PeriodId + '">' + res.Data[i].PeriodName + '</option>')
                    }
                    return false;
                }
            });
        }
        window.onload = getUser();

        

        $('[name="btnGenrate"]').click(function () 
		{
            var reporttype = $("#reporttype option:selected").val();
            if (reporttype == "Select") 
			{
                $('#sel_Projects,#selCountry1,#TimesheetMissingMonth1,#DeligateToDate1,#DeligateFromDate1,#selStatus1,#sel_Periods,#TimesheetDelaygMonth1,#sel_Projects_name').css("display", "none");
                return false;
            }
            else 
			{
                if (reporttype == "TimeSheetMissing") //ts missing
				{
                    var len = $('#selCountry :selected').length;
					if ($('#DeligateFromDate').val() == "" || $('#DeligateToDate').val() == "") 
					{
                        $('#Alert_msg').html("Please Select Date");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
                    else if (len <= 0) 
					{
                        $('#Alert_msg').html("Please Select Country");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
					$('.loader').css("display", "block")
                    var finalurl = "";
                    getUser();
                    var selCountry = $('#selCountry :selected');
                    var seprator = ',', CountryName = '', status = '';
                    selCountry.each(function (index, item) 
					{
                        CountryName += seprator + $(item).val();
                    });

                    CountryName = CountryName + ",";


                    finalurl = "";
                    var month = parseInt($('.ui-datepicker-month').val()) + 1;

                    finalurl = document.getElementById("rptTimesheet").src = "https://ppmprod.bcone.com//TimeSheetMissing.aspx?login=" + Email + "&StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val() + "&CountryLegal=" + CountryName;
					//alert("https://ppmprod.bcone.com//TimeSheetMissing.aspx?login=" + Email + "&StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val() + "&CountryLegal=" + CountryName);
					$('.loader').css("display", "none")
                }
				else if (reporttype == "TimeSheetDelay") //ts delay
				{
                    var Period = $('#ddlSelectePeriods').val();
                	if ($('#DeligateFromDate').val() == "" || $('#DeligateToDate').val() == "") 
					{
                        $('#Alert_msg').html("Please Select Date");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
                    else if (reporttype == "TimeSheetDelay")
					{
                        finalurl = document.getElementById("rptTimesheet").src = "https://ppmprod.bcone.com//TimesheetStatusDelayIntime.aspx?login=" + Email + "&StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val();
						//alert( "https://ppmprod.bcone.com//TimesheetStatusDelayIntime.aspx?login=" + Email + "&StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val());
						return false;
                    }

                }
                else if (reporttype == "TimeSheetConsolidated") //ts consolidated
				{
                
                    var len = $('#selCountry :selected').length
                    var len1 = $('#selStatus :selected').length;
                    if ($('#DeligateFromDate').val() == "" || $('#DeligateToDate').val() == "")
					{
                        $('#Alert_msg').html("Please Select Date");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
                    finalurl = document.getElementById("rptTimesheet").src = "https://ppmprod.bcone.com//ConsolidatedReport.aspx?login=" + Email + "&StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val();
                    //alert("https://ppmprod.bcone.com//ConsolidatedReport.aspx?login=" + Email + "&StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val());
					return false;
                }
                else if (reporttype == "TimeSheetConsolidated") {
                    $('#TimeSheetConsolidated').css("display", "block");
                    return false;
                }
				else if (reporttype == "Defaulter_Report") //Defaulter_Report
				{
					finalurl = "";
					var len = $('#selCountry :selected').length
                    var len1 = $('#selStatus :selected').length;
                    if ($('#DeligateFromDate').val() == "" || $('#DeligateToDate').val() == "") 
					{
                        $('#Alert_msg').html("Please Select Date");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
					finalurl = document.getElementById("rptTimesheet").src = "https://ppmprod.bcone.com/DelayMissingMixTimesheetReport.aspx?login=" + Email + "&StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val();
					//alert("https://ppmprod.bcone.com/DelayMissingMixTimesheetReport.aspx?login=" + Email + "&StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val());
					return false;
                }
				else if (reporttype == "TS_Missing_Details") //Ts missing details
				{
					finalurl = "";
					if ($('#DeligateFromDate').val() == "" || $('#DeligateToDate').val() == "") 
					{
                        $('#Alert_msg').html("Please Select Date");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
                    finalurl = document.getElementById("rptTimesheet").src = "https://ppmprod.bcone.com/TimesheetMissingDetails.aspx?login=" + Email + "&StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val();
					//alert("https://ppmprod.bcone.com/TimesheetMissingDetails.aspx?login=" + Email + "&StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val());
					return false;
                }
				else if(reporttype == "No") //"timesheet dump"
				{
					var diffDays ="";
					if ($('#DeligateFromDate').val() != "" || $('#DeligateToDate').val() != "") 
					{
						var start = DateFormatVal($('#DeligateFromDate').val());
						var end = DateFormatVal($('#DeligateToDate').val());
						var date1 = new Date(start);
						var date2 = new Date(end);
						var timeDiff = Math.abs(date2.getTime() - date1.getTime());
						diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
					}
					
					var len = $('#selCountry :selected').length
                    var len1 = $('#selStatus :selected').length;
					var emptyProject = $("#selProjects option:selected").val();
					var emptyProjectCode = $("#selProjectsName option:selected").val();
                    if ($('#DeligateFromDate').val() == "" || $('#DeligateToDate').val() == "") {
                        $('#Alert_msg').html("Please Select Date");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
                    else if (len <= 0) {
                        $('#Alert_msg').html("Please Select Country");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
                    else if (len1 <= 0) {
                        $('#Alert_msg').html("Please Select TS Status");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
					else if (emptyProject==undefined ||emptyProject=="" )
					{
                        $('#Alert_msg').html("Please Select Project Type");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
					else if (emptyProjectCode==undefined ||emptyProjectCode=="" )
					{
                        $('#Alert_msg').html("Please Select Project Name");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
					else if(diffDays>92)
					{
						$('#Alert_msg').html("TS From Date and TS To Date should be less than 3 months");
                        $("#errMessage").css("display", "block");
                        return false;
					}
                    else
					{
                        $("#errMessage").css("display", "none");
                    }
                    $('.loader').css("display", "block")
                    var finalurl = "";
                    getUser();
                    var selCountry = $('#selCountry :selected');
                    var seprator = ',', CountryName = '', status = '';
                    selCountry.each(function (index, item) 
					{
                        CountryName += seprator + $(item).val();
                    });
                    CountryName = CountryName + ",";
                    var selStatus = $('#selStatus :selected');
                    selStatus.each(function (index, item)
					{
                        status += seprator + $(item).val();
                    });
                    status = status + ",";
					
					var selProName = $('#selProjects :selected');
                    var seprator = ',', ProjName = '';
                    selProName.each(function (index, item) 
					{
                        ProjName += seprator + $(item).val();
                    });
                    ProjName = ProjName + ",";
					
					var selProNameCode = $('#selProjectsName :selected');
                    var sepratorCode = ',', ProjNameCode = '';
                    selProNameCode.each(function (index, item) 
					{
                        ProjNameCode += sepratorCode + $(item).val();
                    });
                    ProjNameCode = ProjNameCode + ",";
					
                    finalurl = document.getElementById("rptTimesheet").src = "https://ppmprod.bcone.com/TimesheetDump.aspx?StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val() + "&CountryLegal=" + CountryName + "&ReportStatus=" + status + "&Login=" + Email + "&reporttype=" + $("#reporttype option:selected").val() +"&ProjectType="+encodeURIComponent(ProjName)+ "&ProjectCode=" +encodeURIComponent(ProjNameCode);
                   // alert("https://ppmprod.bcone.com/TimesheetDump.aspx?StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val() + "&CountryLegal=" + CountryName + "&ReportStatus=" + status + "&Login=" + Email + "&reporttype=" + $("#reporttype option:selected").val() +"&ProjectType="+ProjName+ "&ProjectCode=" +ProjNameCode);
					$('.loader').css("display", "none");
                    return false;
				}
				else //utilization
				{
					var diffDays ="";
					if ($('#DeligateFromDate').val() != "" || $('#DeligateToDate').val() != "") 
					{
						var start = DateFormatVal($('#DeligateFromDate').val());
						var end = DateFormatVal($('#DeligateToDate').val());
						var date1 = new Date(start);
						var date2 = new Date(end);
						var timeDiff = Math.abs(date2.getTime() - date1.getTime());
						diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
					}
                    var len = $('#selCountry :selected').length
                    var len1 = $('#selStatus :selected').length;
                    if ($('#DeligateFromDate').val() == "" || $('#DeligateToDate').val() == "") {
                        $('#Alert_msg').html("Please Select Date");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
                    else if (len <= 0)
					{
                        $('#Alert_msg').html("Please Select Country");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
                    else if (len1 <= 0)
					{
                        $('#Alert_msg').html("Please Select TS Status");
                        $("#errMessage").css("display", "block");
                        return false;
                    }
					else if(diffDays>92)
					{
						$('#Alert_msg').html("TS From Date and TS To Date should be less than 3 months");
                        $("#errMessage").css("display", "block");
                        return false;
					}
                    else {
                        $("#errMessage").css("display", "none");

                    }
                    $('.loader').css("display", "block");
                    var finalurl = "";
                    getUser();
                    var selCountry = $('#selCountry :selected');
                    var seprator = ',', CountryName = '', status = '';
                    selCountry.each(function (index, item) {
                        CountryName += seprator + $(item).val();
                    });

                    CountryName = CountryName + ",";

                    var selStatus = $('#selStatus :selected');
                    selStatus.each(function (index, item) {
                        status += seprator + $(item).val();
                    });
                    status = status + ",";

                    finalurl = document.getElementById("rptTimesheet").src = "https://ppmprod.bcone.com/TimesheetDump.aspx?StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val() + "&CountryLegal=" + CountryName + "&ReportStatus=" + status + "&Login=" + Email + "&reporttype=" + $("#reporttype option:selected").val();
					//alert("https://ppmprod.bcone.com/TimesheetDump.aspx?StartDate=" + $('#DeligateFromDate').val() + "&EndDate=" + $('#DeligateToDate').val() + "&CountryLegal=" + CountryName + "&ReportStatus=" + status + "&Login=" + Email + "&reporttype=" + $("#reporttype option:selected").val());
				   $('.loader').css("display", "none")

                    return false;
                }
            }
        });

       /* function abc()
		{
            alert();
        }*/
		
        $('[name=\'btnClear\']').click(function ()
		{         
            $('#reporttype').val('Select');
            $('#reporttype')[0].sumo.enable(); // Enable the SUMO SELECT 
            $('#reporttype')[0].sumo.reload();
            hideshow("clear");
			$('#errMessage').html('');
            $('#rptTimesheet').attr('src', '');
        });

        setTimeout(function () 
		{
            $('#tblTimesheetDump').css("display", "table");
        }, 1000);
        
		function close_div() 
		{
            $("#errMessage").css("display", "none");
        }

        function changeReportType()
		{
            $('#TimeSheetConsolidated').css("display", "none");
            $('#rptTimesheet').attr('src', '');
            var reporttype = $("#reporttype option:selected").val();
            if (reporttype == "Select") 
			{
                $('#sel_Projects,#selCountry1,#TimesheetMissingMonth1,#DeligateToDate1,#DeligateFromDate1,#selStatus1,#sel_Periods,#TimesheetDelaygMonth1,#sel_Projects_name').css("display", "none");
                return false;
            }
            else
			{
                hideshow(reporttype);
            }
	    }

        function hideshow(reporttype)
		{
            if (reporttype == "TimeSheetMissing") //ts missing
			{
				$('#selCountry1,#DeligateToDate1,#DeligateFromDate1').css("display", "block");
                $('#sel_Projects,#selStatus1,#sel_Periods,#TimesheetDelaygMonth1,#TimesheetMissingMonth1,#sel_Projects_name').css("display", "none");
				DDLValueCahanges();
			}
		    else if (reporttype == "TimeSheetDelay") //ts delay
			{
             	$('#DeligateToDate1,#DeligateFromDate1').css("display", "block");
                $('#sel_Projects,#sel_Periods,#sel_consolidated_periods ,#ddlConsolidatedPeriods,#TimesheetDelaygMonth1,#selCountry1,#TimesheetMissingMonth1,#selStatus1,#sel_Projects_name').css("display", "none");
				DDLValueCahanges();
			}
            else if (reporttype == "TimeSheetConsolidated") //ts consolidated
			{
                $('#sel_Projects,#selCountry1,#TimesheetMissingMonth1,#DeligateToDate1,#DeligateFromDate1,#selStatus1,#sel_Periods,#TimesheetDelaygMonth1,#sel_Projects_name').css("display", "none");
               	$('#DeligateToDate1,#DeligateFromDate1').css("display", "block");
				DDLValueCahanges();
			}
			else if (reporttype == "Defaulter_Report") //Default report
			{
                $('#sel_Projects,#selCountry1,#TimesheetMissingMonth1,#selStatus1,#sel_Periods,#TimesheetDelaygMonth1,#sel_Projects_name').css("display", "none");
                $('#DeligateToDate1,#DeligateFromDate1').css("display", "block");
				DDLValueCahanges();
			}
 			else if (reporttype == "TS_Missing_Details") //ts Missing Details
			{
				$('#DeligateToDate1,#DeligateFromDate1').css("display", "block");
            	$('#sel_Projects,#sel_Periods,#sel_consolidated_periods,#sel_Projects_name ,#ddlConsolidatedPeriods,#TimesheetDelaygMonth1,#selCountry1,#TimesheetMissingMonth1,#selStatus1').css("display", "none");
				DDLValueCahanges();
				
			}
			
            else if (reporttype == "clear") 
			{
                $('#sel_Projects,#selCountry1,#TimesheetMissingMonth1,#sel_Projects_name,#DeligateToDate1,#DeligateFromDate1,#selStatus1,#sel_Periods,#TimesheetDelaygMonth1').css("display", "none");
            }
			else if (reporttype == "No") //ts dump
			{
				$('#selCountry1,#DeligateToDate1,#DeligateFromDate1,#selStatus1,#sel_Projects,#sel_Projects_name').css("display", "block");
				$('#TimesheetMissingMonth1,#sel_Periods,#TimesheetDelaygMonth1').css("display", "none");
				DDLValueCahanges();
				GetProjectTypeData();
			}
            else //ts utilization
			{
                $('#selCountry1,#DeligateToDate1,#DeligateFromDate1,#selStatus1').css("display", "block");
                $('#TimesheetMissingMonth1,#sel_Periods,#TimesheetDelaygMonth1,#sel_Projects,#sel_Projects_name').css("display", "none");
				DDLValueCahanges();
			}
        }
		
		
		function GetProjectTypeData() 
		{
			 $('.loader').css("display", "block");
			$.ajax
			({
				url:"https://ppmprod.bcone.com/api/BCONEReport/GetAllProjectEPT_Type",
				method:"POST",
				headers: { "Accept": "application/json; odata=verbose" },
				success:function(data)
				{
					if(data.Data.length==0)
					{
					}
					else
					{
						if($("#selProjects").hasClass("SumoUnder")){$("#selProjects").html('');$("#selProjects")[0].sumo.unload();}
			
						for(var i=0;i<data.Data.length;i++)
						{
							$("#selProjects").append("<option value=\""+data.Data[i].ENTERPRISEPROJECTTYPENAME+"\" >"+data.Data[i].ENTERPRISEPROJECTTYPENAME+"</option>")
						}
						$('.search-Project').SumoSelect({search: true, searchText: 'Search Project'});
						$('#selProjects')[0].sumo.enable(); // Enable the SUMO SELECT 
						$('#selProjects')[0].sumo.reload();
						$('#selProjects')[0].sumo.selectItem(0); //default select first option
						$('#selProjects option').each(function(e){if(e != 0){$('#selProjects')[0].sumo.disableItem(e)}});
						 $('.loader').css("display", "none");
						//GetProjectNameSelected(); 
						$(".sumo_selProjects li").bind('click', function(event, ui) 
						{
							if($(this).find('label').text().trim() == "Select All Project Type")
							{
								if($(this).is(".selected"))
								{
									$('#selProjects option').each(function(e){if(e != 0){$('#selProjects')[0].sumo.disableItem(e)}});									
								}
								else
								{
									$('#selProjects option').each(function(e){$('#selProjects')[0].sumo.enableItem(e)});
								}
							}
							else
							{
								$(".sumo_selProjects li").each(function(e)
								{
									if(!$(this).is(".selected"))
									{
										$('#selProjects')[0].sumo.enableItem(e)
									}
								})
							}
							//event.stopPropagation();
							//event.preventDefault()
							/*if($(".sumo_selProjects li.selected").length > 10)
							{
								$('#selProjects')[0].sumo.unSelectItem($(this).index());
								$('#Alert_msg').html("you can't select more than 10 projects");
								$("#errMessage").css("display", "block");
							}*/
							//$("#selProjects")[0].sumo.showOpts();
						})
						
					}
				},
				error:function()
				{
					alert("failed");
					 $('.loader').css("display", "none");
				}	
			});
		}
		
				
		document.getElementById("selProjects").onchange = function() // onchange of project type dropdown
		{
			
			var selProjecName = $('#selProjects :selected');
			var seprator = ',', ProjecName = '', status = '';
			selProjecName.each(function (index, item) 
			{
				ProjecName += seprator + $(item).val();
			});

			ProjecName = ProjecName + ",";
			if(ProjecName==","||ProjecName=="")
			{
			}
			else
			{
				
				GetProjectNameSelected();	
			}
			
		}
		
		
		function GetProjectNameSelected() 
		{
			var seprator = ',', ProjNames = '', status = '';
			var selProNames = $('#selProjects :selected');
			
			var SelectedPeriods = $('#selProjects option:selected').val();
			if(SelectedPeriods =="Select All Project Type")
			{
				$("#selProjects").prop("selectedIndex",0); //unselect check box  
			
				var Proj="Select All Project Type";
				ProjNames = ","+Proj + ",";
				
			}
			else
			{
				selProNames.each(function (index, item) 
				{
					ProjNames += seprator + $(item).val();
				});
				ProjNames = ProjNames + ",";
			}
			
			console.log(ProjNames);
			$.ajax
			({
				url:"https://ppmprod.bcone.com/api/BCONEReport/GetAllProjectCode",
				method:"POST",
				headers: { "Accept": "application/json; odata=verbose" },
				data:{
						"EPT_Type":ProjNames
						},
				success:function(Resdata)
				{
					if(Resdata.Data.length==0)
					{
					}
					else
					{
						if($("#selProjectsName").hasClass("SumoUnder")){$("#selProjectsName").html('');$("#selProjectsName")[0].sumo.unload();}
			
						for(var i=0;i<Resdata.Data.length;i++)
						{
							$("#selProjectsName").append("<option value=\""+Resdata.Data[i].PROJ_UID+"\" >"+Resdata.Data[i].PROJECTCODE+"</option>")
						}
						$('.search_Project_name').SumoSelect({search: true, searchText: 'Search Project Name'});
						$('#selProjectsName')[0].sumo.enable(); // Enable the SUMO SELECT 
						$('#selProjectsName')[0].sumo.reload();
						$('#selProjectsName')[0].sumo.selectItem(0); //default select first option
						$('#selProjectsName option').each(function(e){if(e != 0){$('#selProjectsName')[0].sumo.disableItem(e)}});
						$(".sumo_selProjectsName li").bind('click', function(event, ui) 
						{
							if($(this).find('label').text().trim() == "Select All Projects")
							{
								if($(this).is(".selected"))
								{
									$('#selProjectsName option').each(function(e){if(e != 0){$('#selProjectsName')[0].sumo.disableItem(e)}});									
								}
								else
								{
									$('#selProjectsName option').each(function(e){$('#selProjectsName')[0].sumo.enableItem(e)});
								}
							}
							else
							{
								$(".sumo_selProjectsName li").each(function(e){
									if(!$(this).is(".selected"))
									{
										$('#selProjectsName')[0].sumo.enableItem(e)
									}
								})
							}
							if($(".sumo_selProjectsName li.selected").length > 10)
							{
								$('#selProjectsName')[0].sumo.unSelectItem($(this).index());
								$('#Alert_msg').html("Max 10 projects can be selected!");
								$("#errMessage").css("display", "block");
							}
						})
					}
				},
				error:function()
				{
					alert("failed");
				}	
			});
		}
		
		function bindProjectData()
		{
            var NewElementCollection;
            url = "https://ppmprod.bcone.com/api/bconeReport/GetCountryLeagleName";
            $.ajax({
                url: url,
                async: false,
                type: "POST",
                dataType: "json",
                success: function (res)
				{
                    var a = res;
                    var len = res.Country.length;
					if(res.Country.length==0)
					{
					
					}
					else
					{
						if($("#selCountry").hasClass("SumoUnder")){$("#selCountry").html('');$("#selCountry")[0].sumo.unload();}
			
						for (var i = 0; i < len ; i++)
						{
							$('#selCountry').append('<option selected value="' + res.Country[i].CountryLegal + '">' + res.Country[i].CountryLegal + '</option>')
						}
						$('.search-Country').SumoSelect({search: true, searchText: 'Search Project'});
						
						$('#selCountry')[0].sumo.enable(); // Enable the SUMO SELECT 
						$('#selCountry')[0].sumo.reload();
				
						$('#selCountry')[0].sumo.selectItem(0); //default select first option
						$('#selCountry option').each(function(e){if(e != 0){$('#selCountry')[0].sumo.disableItem(e)}});
						$(".sumo_selCountry li").bind('click', function(event, ui) 
						{
							if($(this).find('label').text().trim() == "Select All Country Legal")
							{
								if($(this).is(".selected"))
								{
									$('#selCountry option').each(function(e){if(e != 0){$('#selCountry')[0].sumo.disableItem(e)}});									
								}
								else
								{
									$('#selCountry option').each(function(e){$('#selCountry')[0].sumo.enableItem(e)});
								}
							}
							else
							{
								$(".sumo_selCountry li").each(function(e){
									if(!$(this).is(".selected"))
									{
										$('#selCountry')[0].sumo.enableItem(e)
									}
								})
							}
							if($(".sumo_selCountry li.selected").length > 10)
							{
								$('#selCountry')[0].sumo.unSelectItem($(this).index());
								$('#Alert_msg').html("you can't select more than 10 projects");
								$("#errMessage").css("display", "block");
							}
						})
					}
                }
            });
        }
		
		
		
		function DDLValueCahanges()
		{
			$('#DeligateFromDate,#DeligateToDate').val('').datepicker('option', {minDate: null, maxDate: null});
			var fd =new Date(firstDayTxt);
			var ld =new Date(lastDaytxt);
			$('#DeligateFromDate').datepicker('setDate',fd );
			$('#DeligateToDate').datepicker('setDate',ld);
			//select country legal
			$('#selCountry')[0].sumo.selectItem(0); //default select first option
			$('#selCountry option').each(function(e){if(e != 0){$('#selCountry')[0].sumo.disableItem(e)}});
			$(".sumo_selCountry li").bind('click', function(event, ui) 
			{
				if($(this).find('label').text().trim() == "Select All Country Legal")
				{
					if($(this).is(".selected"))
					{
						$('#selCountry option').each(function(e){if(e != 0){$('#selCountry')[0].sumo.disableItem(e)}});									
					}
					else
					{
						$('#selCountry option').each(function(e){$('#selCountry')[0].sumo.enableItem(e)});
					}
				}
				else
				{
					$(".sumo_selCountry li").each(function(e){
						if(!$(this).is(".selected"))
						{
							$('#selCountry')[0].sumo.enableItem(e)
						}
					})
				}
				if($(".sumo_selCountry li.selected").length > 10)
				{
					$('#selCountry')[0].sumo.unSelectItem($(this).index());
					$('#Alert_msg').html("you can't select more than 10 projects");
					$("#errMessage").css("display", "block");
				}
			})
			//staus 
			$('.search-Status').SumoSelect({search: true, searchText: 'Search Status'});
          	$('#selStatus')[0].sumo.selectItem(0); //default select first option
			$('#selStatus option').each(function(e){if(e != 0){$('#selStatus')[0].sumo.disableItem(e)}});
			$(".sumo_selStatus li").bind('click', function(event, ui) 
			{
				if($(this).find('label').text().trim() == "All")
				{
					if($(this).is(".selected"))
					{
						$('#selStatus option').each(function(e){if(e != 0){$('#selStatus')[0].sumo.disableItem(e)}});									
					}
					else
					{
						$('#selStatus option').each(function(e){$('#selStatus')[0].sumo.enableItem(e)});
					}
				}
				else
				{
					$(".sumo_selStatus li").each(function(e){
						if(!$(this).is(".selected"))
						{
							$('#selStatus')[0].sumo.enableItem(e)
						}
					})
				}
				if($(".sumo_selStatus li.selected").length > 10)
				{
					$('#selStatus')[0].sumo.unSelectItem($(this).index());
					$('#Alert_msg').html("you can't select more than 10 projects");
					$("#errMessage").css("display", "block");
				}
			})
			
		}
		
		
		function DateFormatVal(showDAte)
		{
			var start = showDAte;
			var split=start.split("-");
			var dd = split[0];             
			var y = split[2];
			var GetMonth ={"Jan": "01",'Feb':"02",'Mar': "03",'Apr':"04",'May':"05",'Jun':"06",'Jul':"07",'Aug': "08",'Sep': "09",'Oct': "10",'Nov': "11",'Dec':"12"}
			var Month =['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
			var mm = GetMonth[split[1]];
			var Month =['01','02','03','04','05','06','07','08','09','10','11','12'];
			var EDate1 = "";
			EDate1= mm + "/" + dd + "/" + y;
			return EDate1;
		}
    </script>
</body>
</html>
